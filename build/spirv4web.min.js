var SPIRV=function(e){"use strict";var t,r=function(){this.version=0,this.shader_model=0,this.set_version=!1,this.set_shader_model=!1,this.dump_resources=!1,this.force_temporary=!1,this.flatten_ubo=!1,this.fixup=!1,this.yflip=!1,this.sso=!1,this.support_nonzero_baseinstance=!0,this.glsl_emit_push_constant_as_ubo=!1,this.glsl_emit_ubo_as_plain_uniforms=!1,this.glsl_force_flattened_io_blocks=!1,this.glsl_keep_unnamed_ubos=!1,this.glsl_ovr_multiview_view_count=0,this.glsl_ext_framebuffer_fetch=[],this.glsl_ext_framebuffer_fetch_noncoherent=!1,this.emit_line_directives=!1,this.enable_storage_image_qualifier_deduction=!0,this.force_zero_initialized_variables=!1,this.pls_in=[],this.pls_out=[],this.remaps=[],this.extensions=[],this.variable_type_remaps=[],this.interface_variable_renames=[],this.masked_stage_outputs=[],this.masked_stage_builtins=[],this.entry_point_rename=[],this.cpp=!1,this.flatten_multidimensional_arrays=!1,this.use_420pack_extension=!0,this.remove_unused=!0,this.combined_samplers_inherit_bindings=!1,this.glsl_remove_attribute_layouts=!1,this.specialization_constant_prefix="SPIRV_CROSS_CONSTANT_ID_"},i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)};
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function s(e,t,r){if(r||2===arguments.length)for(var i,a=0,s=t.length;a<s;a++)!i&&a in t||(i||(i=Array.prototype.slice.call(t,0,a)),i[a]=t[a]);return e.concat(i||Array.prototype.slice.call(t))}function o(e,t){for(var r=new Array(e),i=0;i<e;++i)r[i]=t(i);return r}function n(e,t){var r=e.length;if(e.length!==t.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}function _(e){return e.reduce((function(e){return e+1}),0)}!function(e){e[e.None=0]="None",e[e.Type=1]="Type",e[e.Variable=2]="Variable",e[e.Constant=3]="Constant",e[e.Function=4]="Function",e[e.FunctionPrototype=5]="FunctionPrototype",e[e.Block=6]="Block",e[e.Extension=7]="Extension",e[e.Expression=8]="Expression",e[e.ConstantOp=9]="ConstantOp",e[e.CombinedImageSampler=10]="CombinedImageSampler",e[e.AccessChain=11]="AccessChain",e[e.Undef=12]="Undef",e[e.String=13]="String",e[e.Count=14]="Count"}(t||(t={}));var c=function(){function e(e){this.holder=null,this.type=t.None,this.allow_type_rewrite=!1,this.group=e,this.createdIn=(new Error).stack}return e.prototype.set=function(e,r){if(this.holder&&this.group.pools[this.type].deallocate_opaque(this.holder),this.holder=null,!this.allow_type_rewrite&&this.type!==t.None&&this.type!==r)throw e&&this.group.pools[r].deallocate_opaque(e),new Error("Overwriting a variant with new type.");this.holder=e,this.type=r,this.allow_type_rewrite=!1},e.prototype.allocate_and_set=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var i=this.group.pools[e],a=i.allocate.apply(i,t);return this.set(a,e),a},e.prototype.get=function(e){if(!this.holder)throw new Error("nullptr");if(e.type!==this.type)throw new Error("Bad cast");return this.holder},e.prototype.get_type=function(){return this.type},e.prototype.get_id=function(){return this.holder?this.holder.self:0},e.prototype.empty=function(){return!this.holder},e.prototype.reset=function(){this.holder&&this.group.pools[this.type].deallocate_opaque(this.holder),this.holder=null,this.type=t.None},e.prototype.set_allow_type_rewrite=function(){this.allow_type_rewrite=!0},e}();function l(e,t){return t.get(e)}function p(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.allocate_and_set.apply(t,s([e.type],r,!1))}var u=function(){this.pools=new Array(t.Count)};function h(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=d(e[r]))}function f(e,t){var r=new e;return h(t,r),r}function d(e){if(null==e)return e;if(Array.isArray(e))return e.map((function(e){return d(e)}));if(e instanceof Set){var t=new Set;return e.forEach((function(e){t.add(d(e))})),t}var r=typeof e;if("object"===r){if("function"==typeof e.clone)return e.clone();if(e instanceof Set){var i=new Set;return e.forEach((function(e){return i.add(e)})),i}if(e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof BigInt64Array||e instanceof BigUint64Array||e instanceof Float32Array||e instanceof Float64Array)return e.slice();throw new Error("The object ".concat(e," does not have a clone function."))}return"function"!==r?e:void 0}var m,g,b,y=function(){function e(e){void 0===e&&(e=0),this.higher=new Set,this.lower=e}return e.prototype.get=function(e){return e<32?0!=(this.lower&1<<e):this.higher.has(e)},e.prototype.set=function(e){e<32?this.lower|=1<<e:this.higher.add(e)},e.prototype.clear=function(e){e<32?this.lower&=~(1<<e):this.higher.delete(e)},e.prototype.get_lower=function(){return this.lower},e.prototype.reset=function(){this.lower=0,this.higher.clear()},e.prototype.merge_and=function(e){this.lower&=e.lower;var t=new Set;this.higher.forEach((function(r){e.higher.has(r)&&t.add(r)})),this.higher=t},e.prototype.merge_or=function(e){var t=this;this.lower|=e.lower,e.higher.forEach((function(e){return t.higher.add(e)}))},e.prototype.equals=function(e){return this.lower===e.lower&&function(e,t){if(e.size!==t.size)return!1;for(var r=e.values(),i=null;i=r.next().value;)if(!t.has(i))return!1;return!0}(this.higher,e.higher)},e.prototype.for_each_bit=function(e){for(var t=0;t<32;t++)this.lower&1<<t&&e(t);if(0!==this.higher.size){var r=Array.from(this.higher);r.sort(),r.forEach(e)}},e.prototype.empty=function(){return 0===this.lower&&0===this.higher.size},e.prototype.clone=function(){return f(e,this)},e}();!function(e){e[e.Position=0]="Position",e[e.PointSize=1]="PointSize",e[e.ClipDistance=3]="ClipDistance",e[e.CullDistance=4]="CullDistance",e[e.VertexId=5]="VertexId",e[e.InstanceId=6]="InstanceId",e[e.PrimitiveId=7]="PrimitiveId",e[e.InvocationId=8]="InvocationId",e[e.Layer=9]="Layer",e[e.ViewportIndex=10]="ViewportIndex",e[e.TessLevelOuter=11]="TessLevelOuter",e[e.TessLevelInner=12]="TessLevelInner",e[e.TessCoord=13]="TessCoord",e[e.PatchVertices=14]="PatchVertices",e[e.FragCoord=15]="FragCoord",e[e.PointCoord=16]="PointCoord",e[e.FrontFacing=17]="FrontFacing",e[e.SampleId=18]="SampleId",e[e.SamplePosition=19]="SamplePosition",e[e.SampleMask=20]="SampleMask",e[e.FragDepth=22]="FragDepth",e[e.HelperInvocation=23]="HelperInvocation",e[e.NumWorkgroups=24]="NumWorkgroups",e[e.WorkgroupSize=25]="WorkgroupSize",e[e.WorkgroupId=26]="WorkgroupId",e[e.LocalInvocationId=27]="LocalInvocationId",e[e.GlobalInvocationId=28]="GlobalInvocationId",e[e.LocalInvocationIndex=29]="LocalInvocationIndex",e[e.WorkDim=30]="WorkDim",e[e.GlobalSize=31]="GlobalSize",e[e.EnqueuedWorkgroupSize=32]="EnqueuedWorkgroupSize",e[e.GlobalOffset=33]="GlobalOffset",e[e.GlobalLinearId=34]="GlobalLinearId",e[e.SubgroupSize=36]="SubgroupSize",e[e.SubgroupMaxSize=37]="SubgroupMaxSize",e[e.NumSubgroups=38]="NumSubgroups",e[e.NumEnqueuedSubgroups=39]="NumEnqueuedSubgroups",e[e.SubgroupId=40]="SubgroupId",e[e.SubgroupLocalInvocationId=41]="SubgroupLocalInvocationId",e[e.VertexIndex=42]="VertexIndex",e[e.InstanceIndex=43]="InstanceIndex",e[e.SubgroupEqMask=4416]="SubgroupEqMask",e[e.SubgroupEqMaskKHR=4416]="SubgroupEqMaskKHR",e[e.SubgroupGeMask=4417]="SubgroupGeMask",e[e.SubgroupGeMaskKHR=4417]="SubgroupGeMaskKHR",e[e.SubgroupGtMask=4418]="SubgroupGtMask",e[e.SubgroupGtMaskKHR=4418]="SubgroupGtMaskKHR",e[e.SubgroupLeMask=4419]="SubgroupLeMask",e[e.SubgroupLeMaskKHR=4419]="SubgroupLeMaskKHR",e[e.SubgroupLtMask=4420]="SubgroupLtMask",e[e.SubgroupLtMaskKHR=4420]="SubgroupLtMaskKHR",e[e.BaseVertex=4424]="BaseVertex",e[e.BaseInstance=4425]="BaseInstance",e[e.DrawIndex=4426]="DrawIndex",e[e.PrimitiveShadingRateKHR=4432]="PrimitiveShadingRateKHR",e[e.DeviceIndex=4438]="DeviceIndex",e[e.ViewIndex=4440]="ViewIndex",e[e.ShadingRateKHR=4444]="ShadingRateKHR",e[e.BaryCoordNoPerspAMD=4992]="BaryCoordNoPerspAMD",e[e.BaryCoordNoPerspCentroidAMD=4993]="BaryCoordNoPerspCentroidAMD",e[e.BaryCoordNoPerspSampleAMD=4994]="BaryCoordNoPerspSampleAMD",e[e.BaryCoordSmoothAMD=4995]="BaryCoordSmoothAMD",e[e.BaryCoordSmoothCentroidAMD=4996]="BaryCoordSmoothCentroidAMD",e[e.BaryCoordSmoothSampleAMD=4997]="BaryCoordSmoothSampleAMD",e[e.BaryCoordPullModelAMD=4998]="BaryCoordPullModelAMD",e[e.FragStencilRefEXT=5014]="FragStencilRefEXT",e[e.ViewportMaskNV=5253]="ViewportMaskNV",e[e.SecondaryPositionNV=5257]="SecondaryPositionNV",e[e.SecondaryViewportMaskNV=5258]="SecondaryViewportMaskNV",e[e.PositionPerViewNV=5261]="PositionPerViewNV",e[e.ViewportMaskPerViewNV=5262]="ViewportMaskPerViewNV",e[e.FullyCoveredEXT=5264]="FullyCoveredEXT",e[e.TaskCountNV=5274]="TaskCountNV",e[e.PrimitiveCountNV=5275]="PrimitiveCountNV",e[e.PrimitiveIndicesNV=5276]="PrimitiveIndicesNV",e[e.ClipDistancePerViewNV=5277]="ClipDistancePerViewNV",e[e.CullDistancePerViewNV=5278]="CullDistancePerViewNV",e[e.LayerPerViewNV=5279]="LayerPerViewNV",e[e.MeshViewCountNV=5280]="MeshViewCountNV",e[e.MeshViewIndicesNV=5281]="MeshViewIndicesNV",e[e.BaryCoordNV=5286]="BaryCoordNV",e[e.BaryCoordNoPerspNV=5287]="BaryCoordNoPerspNV",e[e.FragSizeEXT=5292]="FragSizeEXT",e[e.FragmentSizeNV=5292]="FragmentSizeNV",e[e.FragInvocationCountEXT=5293]="FragInvocationCountEXT",e[e.InvocationsPerPixelNV=5293]="InvocationsPerPixelNV",e[e.LaunchIdKHR=5319]="LaunchIdKHR",e[e.LaunchIdNV=5319]="LaunchIdNV",e[e.LaunchSizeKHR=5320]="LaunchSizeKHR",e[e.LaunchSizeNV=5320]="LaunchSizeNV",e[e.WorldRayOriginKHR=5321]="WorldRayOriginKHR",e[e.WorldRayOriginNV=5321]="WorldRayOriginNV",e[e.WorldRayDirectionKHR=5322]="WorldRayDirectionKHR",e[e.WorldRayDirectionNV=5322]="WorldRayDirectionNV",e[e.ObjectRayOriginKHR=5323]="ObjectRayOriginKHR",e[e.ObjectRayOriginNV=5323]="ObjectRayOriginNV",e[e.ObjectRayDirectionKHR=5324]="ObjectRayDirectionKHR",e[e.ObjectRayDirectionNV=5324]="ObjectRayDirectionNV",e[e.RayTminKHR=5325]="RayTminKHR",e[e.RayTminNV=5325]="RayTminNV",e[e.RayTmaxKHR=5326]="RayTmaxKHR",e[e.RayTmaxNV=5326]="RayTmaxNV",e[e.InstanceCustomIndexKHR=5327]="InstanceCustomIndexKHR",e[e.InstanceCustomIndexNV=5327]="InstanceCustomIndexNV",e[e.ObjectToWorldKHR=5330]="ObjectToWorldKHR",e[e.ObjectToWorldNV=5330]="ObjectToWorldNV",e[e.WorldToObjectKHR=5331]="WorldToObjectKHR",e[e.WorldToObjectNV=5331]="WorldToObjectNV",e[e.HitTNV=5332]="HitTNV",e[e.HitKindKHR=5333]="HitKindKHR",e[e.HitKindNV=5333]="HitKindNV",e[e.IncomingRayFlagsKHR=5351]="IncomingRayFlagsKHR",e[e.IncomingRayFlagsNV=5351]="IncomingRayFlagsNV",e[e.RayGeometryIndexKHR=5352]="RayGeometryIndexKHR",e[e.WarpsPerSMNV=5374]="WarpsPerSMNV",e[e.SMCountNV=5375]="SMCountNV",e[e.WarpIDNV=5376]="WarpIDNV",e[e.SMIDNV=5377]="SMIDNV",e[e.Max=2147483647]="Max"}(m||(m={})),function(e){e[e.RTE=0]="RTE",e[e.RTZ=1]="RTZ",e[e.RTP=2]="RTP",e[e.RTN=3]="RTN",e[e.Max=2147483647]="Max"}(g||(g={})),function(e){e[e.BufferBlockRepacked=0]="BufferBlockRepacked",e[e.PhysicalTypeID=1]="PhysicalTypeID",e[e.PhysicalTypePacked=2]="PhysicalTypePacked",e[e.PaddingTarget=3]="PaddingTarget",e[e.SPIRVCrossDecorationInterfaceMemberIndex=4]="SPIRVCrossDecorationInterfaceMemberIndex",e[e.SPIRVCrossDecorationInterfaceOrigID=5]="SPIRVCrossDecorationInterfaceOrigID",e[e.SPIRVCrossDecorationResourceIndexPrimary=6]="SPIRVCrossDecorationResourceIndexPrimary",e[e.SPIRVCrossDecorationResourceIndexSecondary=7]="SPIRVCrossDecorationResourceIndexSecondary",e[e.SPIRVCrossDecorationResourceIndexTertiary=8]="SPIRVCrossDecorationResourceIndexTertiary",e[e.SPIRVCrossDecorationResourceIndexQuaternary=9]="SPIRVCrossDecorationResourceIndexQuaternary",e[e.ExplicitOffset=10]="ExplicitOffset",e[e.BuiltInDispatchBase=11]="BuiltInDispatchBase",e[e.DynamicImageSampler=12]="DynamicImageSampler",e[e.BuiltInStageInputSize=13]="BuiltInStageInputSize",e[e.TessIOOriginalInputTypeID=14]="TessIOOriginalInputTypeID",e[e.InterpolantComponentExpr=15]="InterpolantComponentExpr",e[e.Count=16]="Count"}(b||(b={}));var v,S=function(){function e(){this.flags=new y,this.values=new Uint32Array(b.Count)}return e.prototype.clone=function(){return f(e,this)},e}(),I=function(){function e(){this.alias="",this.qualified_alias="",this.hlsl_semantic="",this.decoration_flags=new y,this.builtin_type=m.Max,this.location=0,this.component=0,this.set=0,this.binding=0,this.offset=0,this.xfb_buffer=0,this.xfb_stride=0,this.stream=0,this.array_stride=0,this.matrix_stride=0,this.input_attachment=0,this.spec_id=0,this.index=0,this.fp_rounding_mode=g.Max,this.builtin=!1,this.extended=new S}return e.prototype.clone=function(){return f(e,this)},e}(),x=function(){this.decoration=new I,this.members=[],this.decoration_word_offset=[],this.hlsl_is_magic_counter_buffer=!1,this.hlsl_magic_counter_buffer=0},k=function(){function e(e,t){this.owner=e,this.propName=t}return e.prototype.get=function(){return this.owner[this.propName]},e.prototype.set=function(e){this.owner[this.propName]=e},e}(),w=function(){function e(){this.self=0}return e.prototype.clone=function(e){var t=e.allocate(this);return h(this,t),t},e}();!function(e){e[e.UniformConstant=0]="UniformConstant",e[e.Input=1]="Input",e[e.Uniform=2]="Uniform",e[e.Output=3]="Output",e[e.Workgroup=4]="Workgroup",e[e.CrossWorkgroup=5]="CrossWorkgroup",e[e.Private=6]="Private",e[e.Function=7]="Function",e[e.Generic=8]="Generic",e[e.PushConstant=9]="PushConstant",e[e.AtomicCounter=10]="AtomicCounter",e[e.Image=11]="Image",e[e.StorageBuffer=12]="StorageBuffer",e[e.CallableDataKHR=5328]="CallableDataKHR",e[e.CallableDataNV=5328]="CallableDataNV",e[e.IncomingCallableDataKHR=5329]="IncomingCallableDataKHR",e[e.IncomingCallableDataNV=5329]="IncomingCallableDataNV",e[e.RayPayloadKHR=5338]="RayPayloadKHR",e[e.RayPayloadNV=5338]="RayPayloadNV",e[e.HitAttributeKHR=5339]="HitAttributeKHR",e[e.HitAttributeNV=5339]="HitAttributeNV",e[e.IncomingRayPayloadKHR=5342]="IncomingRayPayloadKHR",e[e.IncomingRayPayloadNV=5342]="IncomingRayPayloadNV",e[e.ShaderRecordBufferKHR=5343]="ShaderRecordBufferKHR",e[e.ShaderRecordBufferNV=5343]="ShaderRecordBufferNV",e[e.PhysicalStorageBuffer=5349]="PhysicalStorageBuffer",e[e.PhysicalStorageBufferEXT=5349]="PhysicalStorageBufferEXT",e[e.CodeSectionINTEL=5605]="CodeSectionINTEL",e[e.Max=2147483647]="Max"}(v||(v={}));var E,T=function(e){function r(t,i,a,s){void 0===i&&(i=0),void 0===a&&(a=0),void 0===s&&(s=0);var o=e.call(this)||this;return o.basetype=0,o.storage=v.Generic,o.decoration=0,o.initializer=0,o.basevariable=0,o.compat_builtin=!1,o.statically_assigned=!1,o.static_expression=0,o.dependees=[],o.forwardable=!0,o.deferred_declaration=!1,o.phi_variable=!1,o.allocate_temporary_copy=!1,o.remapped_variable=!1,o.remapped_components=0,o.dominator=0,o.loop_variable=!1,o.loop_variable_enable=!1,o.parameter=null,t instanceof r?h(t,o):(o.basetype=t,o.storage=i,o.initializer=a,o.basevariable=s),o}return a(r,e),r.type=t.Variable,r}(w);!function(e){e[e.Unknown=0]="Unknown",e[e.Void=1]="Void",e[e.Boolean=2]="Boolean",e[e.SByte=3]="SByte",e[e.UByte=4]="UByte",e[e.Short=5]="Short",e[e.UShort=6]="UShort",e[e.Int=7]="Int",e[e.UInt=8]="UInt",e[e.Int64=9]="Int64",e[e.UInt64=10]="UInt64",e[e.AtomicCounter=11]="AtomicCounter",e[e.Half=12]="Half",e[e.Float=13]="Float",e[e.Double=14]="Double",e[e.Struct=15]="Struct",e[e.Image=16]="Image",e[e.SampledImage=17]="SampledImage",e[e.Sampler=18]="Sampler",e[e.AccelerationStructure=19]="AccelerationStructure",e[e.RayQuery=20]="RayQuery",e[e.ControlPointArray=21]="ControlPointArray",e[e.Interpolant=22]="Interpolant",e[e.Char=23]="Char"}(E||(E={}));var L=function(){function e(){}return e.prototype.clone=function(){return f(e,this)},e.prototype.equals=function(e){return this.type===e.type&&this.dim===e.dim&&this.depth===e.depth&&this.arrayed===e.arrayed&&this.ms===e.ms&&this.sampled===e.sampled&&this.format===e.format&&this.access===e.access},e}(),R=function(e){function r(t){var r=e.call(this)||this;return r.basetype=E.Unknown,r.width=0,r.vecsize=1,r.columns=1,r.array=[],r.array_size_literal=[],r.pointer_depth=0,r.pointer=!1,r.forward_pointer=!1,r.storage=v.Generic,r.member_types=[],r.member_type_index_redirection=[],r.image=new L,r.type_alias=0,r.parent_type=0,r.member_name_cache=new Set,t&&h(t,r),r}return a(r,e),r.type=t.Type,r}(w),N=new Uint32Array(1);function A(e){return N[0]=e,N[0]}var C,P,M,D,B,z=new DataView(new ArrayBuffer(4)),U=function(){function e(){this.value=new ArrayBuffer(16),this._dataView=new DataView(this.value)}return Object.defineProperty(e.prototype,"u32",{get:function(){return this._dataView.getUint32(0)},set:function(e){this._dataView.setUint32(0,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"i32",{get:function(){return this._dataView.getInt32(0)},set:function(e){this._dataView.setInt32(0,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f32",{get:function(){return this._dataView.getFloat32(0)},set:function(e){this._dataView.setFloat32(0,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"u64",{get:function(){return this._dataView.getBigUint64(0)},set:function(e){this._dataView.setBigUint64(0,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"i64",{get:function(){return this._dataView.getBigInt64(0)},set:function(e){this._dataView.setBigInt64(0,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"f64",{get:function(){return this._dataView.getFloat64(0)},set:function(e){this._dataView.setFloat64(0,e)},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return f(e,this)},e}(),G=function(){function e(){this.vecsize=1,this.r=o(4,(function(){return new U})),this.id=o(4,(function(){return 0}))}return e.prototype.clone=function(){return f(e,this)},e}(),F=function(){function e(){this.columns=1,this.c=o(4,(function(){return new G})),this.id=o(4,(function(){return 0}))}return e.prototype.clone=function(){return f(e,this)},e}(),O=function(e){function r(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var a=e.call(this)||this;return a.constant_type=0,a.m=new F,a.specialization=!1,a.is_used_as_array_length=!1,a.is_used_as_lut=!1,a.subconstants=new Uint32Array,a.specialization_constant_macro_name="",0===t.length||(1===t.length?t[0]instanceof r?h(t[0],a):a._construct(t[0]):"bigint"==typeof t[1]?a._constructScalar64(t[0],t[1],t[2]):"number"==typeof t[1]?a._constructScalar32(t[0],t[1],t[2]):"number"==typeof t[1][0]?a._constructArray(t[0],t[1],t[2],t[3]):a._constructVecMat(t[0],t[1],t[2],t[3])),a}return a(r,e),r.prototype.f16_to_f32=function(e){var t=e>>15&1,r=e>>10&31,i=e>>0&1023;if(0===r){if(0===i)return z.setUint32(0,t<<31),z.getFloat32(0);for(;0==(1024&i);)i<<=1,r--;r++,i=A(i&A(-1025))}else if(31===r)return 0===i?(z.setUint32(0,t<<31|2139095040),z.getFloat32(0)):(z.setUint32(0,t<<31|2139095040|i<<13),z.getFloat32(0));return r+=112,i<<=13,z.setUint32(0,t<<31|r<<23|i),z.getFloat32(0)},r.prototype.specialization_constant_id=function(e,t){return void 0===t?this.m.id[e]:this.m.c[e].id[t]},r.prototype.scalar=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.m.c[e].r[t].u32},r.prototype.scalar_i16=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),65535&this.m.c[e].r[t].u32},r.prototype.scalar_u16=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),65535&this.m.c[e].r[t].u32},r.prototype.scalar_i8=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),255&this.m.c[e].r[t].u32},r.prototype.scalar_u8=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),255&this.m.c[e].r[t].u32},r.prototype.scalar_f16=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.f16_to_f32(this.scalar_u16(e,t))},r.prototype.scalar_f32=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.m.c[e].r[t].f32},r.prototype.scalar_i32=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.m.c[e].r[t].i32},r.prototype.scalar_f64=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.m.c[e].r[t].f64},r.prototype.scalar_i64=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.m.c[e].r[t].i64},r.prototype.scalar_u64=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.m.c[e].r[t].u64},r.prototype.vector=function(){return this.m.c[0]},r.prototype.vector_size=function(){return this.m.c[0].vecsize},r.prototype.columns=function(){return this.m.columns},r.prototype.make_null=function(e){this.m=new F,this.m.columns=e.columns;for(var t=0,r=this.m.c;t<r.length;t++){r[t].vecsize=e.vecsize}},r.prototype.constant_is_null=function(){if(this.specialization)return!1;if(0!==this.subconstants.length)return!1;for(var e=0;e<this.columns();e++)for(var t=0;t<this.vector_size();t++)if(this.scalar_u64(e,t)!==BigInt(0))return!1;return!0},r.prototype._construct=function(e){this.constant_type=e},r.prototype._constructArray=function(e,t,r,i){this.constant_type=e,this.specialization=i,this.subconstants=t.slice()},r.prototype._constructScalar32=function(e,t,r){this.constant_type=e,this.specialization=r,this.m.c[0].r[0].u32=t,this.m.c[0].vecsize=1,this.m.columns=1},r.prototype._constructScalar64=function(e,t,r){this.constant_type=e,this.specialization=r,this.m.c[0].r[0].u64=t,this.m.c[0].vecsize=1,this.m.columns=1},r.prototype._constructVecMat=function(e,t,r,i){if(this.constant_type=e,this.specialization=i,t[0].m.c[0].vecsize>1){this.m.columns=r;for(var a=0;a<r;a++)this.m.c[a]=t[a].m.c[0],t[a].specialization&&(this.m.id[a]=t[a].self)}else{this.m.c[0].vecsize=r,this.m.columns=1;for(a=0;a<r;a++)this.m.c[0].r[a]=t[a].m.c[0].r[0],t[a].specialization&&(this.m.c[0].id[a]=t[a].self)}},r.type=t.Constant,r}(w),V=function(e){function r(t,i,a){var s=e.call(this)||this;return s.arguments=[],t instanceof r?h(t,s):(s.basetype=t,s.opcode=i,s.arguments=a.slice()),s}return a(r,e),r.type=t.ConstantOp,r}(w),H=function(e){function t(t){var r=e.call(this)||this;return r.classRef=t,r}return a(t,e),t.prototype.allocate=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new((e=this.classRef).bind.apply(e,s([void 0],t,!1)))},t.prototype.deallocate=function(e){},t.prototype.deallocate_opaque=function(e){this.deallocate(e)},t.prototype.clear=function(){},t}((function(){})),q=function(){function e(e,t,r,i,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=!1),this.type=e,this.id=t,this.read_count=r,this.write_count=i,this.alias_global_variable=a}return e.prototype.clone=function(){return f(e,this)},e}(),X=function(){function e(e,t,r,i,a,s){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),this.id=e,this.image_id=t,this.sampler_id=r,this.global_image=i,this.global_sampler=a,this.depth=s}return e.prototype.clone=function(){return f(e,this)},e}(),K=function(){function e(){this.file_id=0,this.line_literal=0}return e.prototype.clone=function(){return f(e,this)},e}(),j=function(e){function r(t,i){var a=e.call(this)||this;return a.arguments=[],a.shadow_arguments=[],a.local_variables=[],a.entry_block=0,a.blocks=[],a.combined_parameters=[],a.entry_line=new K,a.fixup_hooks_out=[],a.fixup_hooks_in=[],a.constant_arrays_needed_on_stack=[],a.active=!1,a.flush_undeclared=!0,a.do_combined_parameters=!0,t instanceof r?h(t,a):(a.return_type=t,a.function_type=i),a}return a(r,e),r.prototype.add_local_variable=function(e){this.local_variables.push(e)},r.prototype.add_parameter=function(e,t,r){void 0===r&&(r=!1),this.arguments.push(new q(e,t,0,0,r))},r.type=t.Function,r}(w),W=function(e){function r(t){var i=e.call(this)||this;return i.parameter_types=[],t instanceof r?h(t,i):i.return_type=t,i}return a(r,e),r.type=t.FunctionPrototype,r}(w);!function(e){e[e.Unknown=0]="Unknown",e[e.Direct=1]="Direct",e[e.Select=2]="Select",e[e.MultiSelect=3]="MultiSelect",e[e.Return=4]="Return",e[e.Unreachable=5]="Unreachable",e[e.Kill=6]="Kill",e[e.IgnoreIntersection=7]="IgnoreIntersection",e[e.TerminateRay=8]="TerminateRay"}(C||(C={})),function(e){e[e.None=0]="None",e[e.Loop=1]="Loop",e[e.Selection=2]="Selection"}(P||(P={})),function(e){e[e.None=0]="None",e[e.Unroll=1]="Unroll",e[e.DontUnroll=2]="DontUnroll",e[e.Flatten=3]="Flatten",e[e.DontFlatten=4]="DontFlatten"}(M||(M={})),function(e){e[e.MergeToSelectForLoop=0]="MergeToSelectForLoop",e[e.MergeToDirectForLoop=1]="MergeToDirectForLoop",e[e.MergeToSelectContinueForLoop=2]="MergeToSelectContinueForLoop"}(D||(D={})),function(e){e[e.ContinueNone=0]="ContinueNone",e[e.ForLoop=1]="ForLoop",e[e.WhileLoop=2]="WhileLoop",e[e.DoWhileLoop=3]="DoWhileLoop",e[e.ComplexLoop=4]="ComplexLoop"}(B||(B={}));var Q,Z=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.local_variable=e,this.parent=t,this.function_variable=r}return e.prototype.clone=function(){return f(e,this)},e}(),Y=function(){function e(e,t){void 0===e&&(e=BigInt(0)),void 0===t&&(t=0),this.value=e,this.block=t}return e.prototype.clone=function(){return f(e,this)},e}(),J=function(e){function r(t){var r=e.call(this)||this;return r.terminator=C.Unknown,r.merge=P.None,r.hint=M.None,r.next_block=0,r.merge_block=0,r.continue_block=0,r.return_value=0,r.condition=0,r.true_block=0,r.false_block=0,r.default_block=0,r.ops=[],r.phi_variables=[],r.declare_temporary=[],r.potential_declare_temporary=[],r.cases_32bit=[],r.cases_64bit=[],r.disable_block_optimization=!1,r.complex_continue=!1,r.need_ladder_break=!1,r.ignore_phi_from_block=0,r.loop_dominator=0,r.dominated_variables=[],r.loop_variables=[],r.invalidate_expressions=[],t&&h(t,r),r}return a(r,e),r.type=t.Block,r.NoDominator=4294967295,r}(w);!function(e){e[e.Unsupported=0]="Unsupported",e[e.GLSL=1]="GLSL",e[e.SPV_debug_info=2]="SPV_debug_info",e[e.SPV_AMD_shader_ballot=3]="SPV_AMD_shader_ballot",e[e.SPV_AMD_shader_explicit_vertex_parameter=4]="SPV_AMD_shader_explicit_vertex_parameter",e[e.SPV_AMD_shader_trinary_minmax=5]="SPV_AMD_shader_trinary_minmax",e[e.SPV_AMD_gcn_shader=6]="SPV_AMD_gcn_shader"}(Q||(Q={}));var $,ee,te,re,ie=function(e){function r(t){var i=e.call(this)||this;return t instanceof r?h(t,i):i.ext=t,i}return a(r,e),r.type=t.Extension,r}(w),ae=function(e){function r(t,i,a){void 0===t&&(t="");var s=e.call(this)||this;return s.base_expression=0,s.expression="",s.expression_type=0,s.loaded_from=0,s.immutable=!1,s.need_transpose=!1,s.access_chain=!1,s.expression_dependencies=[],s.implied_read_expressions=[],s.emitted_loop_level=0,t instanceof r?h(t,s):(s.expression=t,s.expression_type=i,s.immutable=a),s}return a(r,e),r.type=t.Expression,r}(w),se=function(e){function r(t,i,a){var s=e.call(this)||this;return t instanceof r?h(t,s):(s.combined_type=t,s.image=i,s.sampler=a),s}return a(r,e),r.type=t.CombinedImageSampler,r}(w),oe=function(e){function r(t,i,a,s,o){void 0===t&&(t=0);var n=e.call(this)||this;return n.loaded_from=0,n.matrix_stride=0,n.array_stride=0,n.row_major_matrix=!1,n.immutable=!1,n.implied_read_expressions=[],t instanceof r?h(t,n):(n.basetype=t,n.storage=i,n.base=a,n.dynamic_index=s,n.static_index=o),n}return a(r,e),r.type=t.AccessChain,r}(w),ne=function(e){function r(t){var i=e.call(this)||this;return t instanceof r?h(t,i):i.basetype=t,i}return a(r,e),r.type=t.Undef,r}(w),_e=function(e){function r(t){var i=e.call(this)||this;return t instanceof r?h(t,i):i.str=t,i}return a(r,e),r.type=t.String,r}(w);function ce(e,t,r){return e.substring(0,t)+r+e.substring(t+1)}function le(e,t,r){return void 0===t?e.toString():e.toString()+(r?"ll":"l")}!function(e){e[e.Logical=0]="Logical",e[e.Physical32=1]="Physical32",e[e.Physical64=2]="Physical64",e[e.PhysicalStorageBuffer64=5348]="PhysicalStorageBuffer64",e[e.PhysicalStorageBuffer64EXT=5348]="PhysicalStorageBuffer64EXT",e[e.Max=2147483647]="Max"}($||($={})),function(e){e[e.Simple=0]="Simple",e[e.GLSL450=1]="GLSL450",e[e.OpenCL=2]="OpenCL",e[e.Vulkan=3]="Vulkan",e[e.VulkanKHR=3]="VulkanKHR",e[e.Max=2147483647]="Max"}(ee||(ee={})),function(e){e[e.RelaxedPrecision=0]="RelaxedPrecision",e[e.SpecId=1]="SpecId",e[e.Block=2]="Block",e[e.BufferBlock=3]="BufferBlock",e[e.RowMajor=4]="RowMajor",e[e.ColMajor=5]="ColMajor",e[e.ArrayStride=6]="ArrayStride",e[e.MatrixStride=7]="MatrixStride",e[e.GLSLShared=8]="GLSLShared",e[e.GLSLPacked=9]="GLSLPacked",e[e.CPacked=10]="CPacked",e[e.BuiltIn=11]="BuiltIn",e[e.NoPerspective=13]="NoPerspective",e[e.Flat=14]="Flat",e[e.Patch=15]="Patch",e[e.Centroid=16]="Centroid",e[e.Sample=17]="Sample",e[e.Invariant=18]="Invariant",e[e.Restrict=19]="Restrict",e[e.Aliased=20]="Aliased",e[e.Volatile=21]="Volatile",e[e.Constant=22]="Constant",e[e.Coherent=23]="Coherent",e[e.NonWritable=24]="NonWritable",e[e.NonReadable=25]="NonReadable",e[e.Uniform=26]="Uniform",e[e.UniformId=27]="UniformId",e[e.SaturatedConversion=28]="SaturatedConversion",e[e.Stream=29]="Stream",e[e.Location=30]="Location",e[e.Component=31]="Component",e[e.Index=32]="Index",e[e.Binding=33]="Binding",e[e.DescriptorSet=34]="DescriptorSet",e[e.Offset=35]="Offset",e[e.XfbBuffer=36]="XfbBuffer",e[e.XfbStride=37]="XfbStride",e[e.FuncParamAttr=38]="FuncParamAttr",e[e.FPRoundingMode=39]="FPRoundingMode",e[e.FPFastMathMode=40]="FPFastMathMode",e[e.LinkageAttributes=41]="LinkageAttributes",e[e.NoContraction=42]="NoContraction",e[e.InputAttachmentIndex=43]="InputAttachmentIndex",e[e.Alignment=44]="Alignment",e[e.MaxByteOffset=45]="MaxByteOffset",e[e.AlignmentId=46]="AlignmentId",e[e.MaxByteOffsetId=47]="MaxByteOffsetId",e[e.NoSignedWrap=4469]="NoSignedWrap",e[e.NoUnsignedWrap=4470]="NoUnsignedWrap",e[e.ExplicitInterpAMD=4999]="ExplicitInterpAMD",e[e.OverrideCoverageNV=5248]="OverrideCoverageNV",e[e.PassthroughNV=5250]="PassthroughNV",e[e.ViewportRelativeNV=5252]="ViewportRelativeNV",e[e.SecondaryViewportRelativeNV=5256]="SecondaryViewportRelativeNV",e[e.PerPrimitiveNV=5271]="PerPrimitiveNV",e[e.PerViewNV=5272]="PerViewNV",e[e.PerTaskNV=5273]="PerTaskNV",e[e.PerVertexNV=5285]="PerVertexNV",e[e.NonUniform=5300]="NonUniform",e[e.NonUniformEXT=5300]="NonUniformEXT",e[e.RestrictPointer=5355]="RestrictPointer",e[e.RestrictPointerEXT=5355]="RestrictPointerEXT",e[e.AliasedPointer=5356]="AliasedPointer",e[e.AliasedPointerEXT=5356]="AliasedPointerEXT",e[e.ReferencedIndirectlyINTEL=5602]="ReferencedIndirectlyINTEL",e[e.CounterBuffer=5634]="CounterBuffer",e[e.HlslCounterBufferGOOGLE=5634]="HlslCounterBufferGOOGLE",e[e.HlslSemanticGOOGLE=5635]="HlslSemanticGOOGLE",e[e.UserSemantic=5635]="UserSemantic",e[e.UserTypeGOOGLE=5636]="UserTypeGOOGLE",e[e.RegisterINTEL=5825]="RegisterINTEL",e[e.MemoryINTEL=5826]="MemoryINTEL",e[e.NumbanksINTEL=5827]="NumbanksINTEL",e[e.BankwidthINTEL=5828]="BankwidthINTEL",e[e.MaxPrivateCopiesINTEL=5829]="MaxPrivateCopiesINTEL",e[e.SinglepumpINTEL=5830]="SinglepumpINTEL",e[e.DoublepumpINTEL=5831]="DoublepumpINTEL",e[e.MaxReplicatesINTEL=5832]="MaxReplicatesINTEL",e[e.SimpleDualPortINTEL=5833]="SimpleDualPortINTEL",e[e.MergeINTEL=5834]="MergeINTEL",e[e.BankBitsINTEL=5835]="BankBitsINTEL",e[e.ForcePow2DepthINTEL=5836]="ForcePow2DepthINTEL",e[e.Max=2147483647]="Max"}(te||(te={})),function(e){e[e.Nop=0]="Nop",e[e.Undef=1]="Undef",e[e.SourceContinued=2]="SourceContinued",e[e.Source=3]="Source",e[e.SourceExtension=4]="SourceExtension",e[e.Name=5]="Name",e[e.MemberName=6]="MemberName",e[e.String=7]="String",e[e.Line=8]="Line",e[e.Extension=10]="Extension",e[e.ExtInstImport=11]="ExtInstImport",e[e.ExtInst=12]="ExtInst",e[e.MemoryModel=14]="MemoryModel",e[e.EntryPoint=15]="EntryPoint",e[e.ExecutionMode=16]="ExecutionMode",e[e.Capability=17]="Capability",e[e.TypeVoid=19]="TypeVoid",e[e.TypeBool=20]="TypeBool",e[e.TypeInt=21]="TypeInt",e[e.TypeFloat=22]="TypeFloat",e[e.TypeVector=23]="TypeVector",e[e.TypeMatrix=24]="TypeMatrix",e[e.TypeImage=25]="TypeImage",e[e.TypeSampler=26]="TypeSampler",e[e.TypeSampledImage=27]="TypeSampledImage",e[e.TypeArray=28]="TypeArray",e[e.TypeRuntimeArray=29]="TypeRuntimeArray",e[e.TypeStruct=30]="TypeStruct",e[e.TypeOpaque=31]="TypeOpaque",e[e.TypePointer=32]="TypePointer",e[e.TypeFunction=33]="TypeFunction",e[e.TypeEvent=34]="TypeEvent",e[e.TypeDeviceEvent=35]="TypeDeviceEvent",e[e.TypeReserveId=36]="TypeReserveId",e[e.TypeQueue=37]="TypeQueue",e[e.TypePipe=38]="TypePipe",e[e.TypeForwardPointer=39]="TypeForwardPointer",e[e.ConstantTrue=41]="ConstantTrue",e[e.ConstantFalse=42]="ConstantFalse",e[e.Constant=43]="Constant",e[e.ConstantComposite=44]="ConstantComposite",e[e.ConstantSampler=45]="ConstantSampler",e[e.ConstantNull=46]="ConstantNull",e[e.SpecConstantTrue=48]="SpecConstantTrue",e[e.SpecConstantFalse=49]="SpecConstantFalse",e[e.SpecConstant=50]="SpecConstant",e[e.SpecConstantComposite=51]="SpecConstantComposite",e[e.SpecConstantOp=52]="SpecConstantOp",e[e.Function=54]="Function",e[e.FunctionParameter=55]="FunctionParameter",e[e.FunctionEnd=56]="FunctionEnd",e[e.FunctionCall=57]="FunctionCall",e[e.Variable=59]="Variable",e[e.ImageTexelPointer=60]="ImageTexelPointer",e[e.Load=61]="Load",e[e.Store=62]="Store",e[e.CopyMemory=63]="CopyMemory",e[e.CopyMemorySized=64]="CopyMemorySized",e[e.AccessChain=65]="AccessChain",e[e.InBoundsAccessChain=66]="InBoundsAccessChain",e[e.PtrAccessChain=67]="PtrAccessChain",e[e.ArrayLength=68]="ArrayLength",e[e.GenericPtrMemSemantics=69]="GenericPtrMemSemantics",e[e.InBoundsPtrAccessChain=70]="InBoundsPtrAccessChain",e[e.Decorate=71]="Decorate",e[e.MemberDecorate=72]="MemberDecorate",e[e.DecorationGroup=73]="DecorationGroup",e[e.GroupDecorate=74]="GroupDecorate",e[e.GroupMemberDecorate=75]="GroupMemberDecorate",e[e.VectorExtractDynamic=77]="VectorExtractDynamic",e[e.VectorInsertDynamic=78]="VectorInsertDynamic",e[e.VectorShuffle=79]="VectorShuffle",e[e.CompositeConstruct=80]="CompositeConstruct",e[e.CompositeExtract=81]="CompositeExtract",e[e.CompositeInsert=82]="CompositeInsert",e[e.CopyObject=83]="CopyObject",e[e.Transpose=84]="Transpose",e[e.SampledImage=86]="SampledImage",e[e.ImageSampleImplicitLod=87]="ImageSampleImplicitLod",e[e.ImageSampleExplicitLod=88]="ImageSampleExplicitLod",e[e.ImageSampleDrefImplicitLod=89]="ImageSampleDrefImplicitLod",e[e.ImageSampleDrefExplicitLod=90]="ImageSampleDrefExplicitLod",e[e.ImageSampleProjImplicitLod=91]="ImageSampleProjImplicitLod",e[e.ImageSampleProjExplicitLod=92]="ImageSampleProjExplicitLod",e[e.ImageSampleProjDrefImplicitLod=93]="ImageSampleProjDrefImplicitLod",e[e.ImageSampleProjDrefExplicitLod=94]="ImageSampleProjDrefExplicitLod",e[e.ImageFetch=95]="ImageFetch",e[e.ImageGather=96]="ImageGather",e[e.ImageDrefGather=97]="ImageDrefGather",e[e.ImageRead=98]="ImageRead",e[e.ImageWrite=99]="ImageWrite",e[e.Image=100]="Image",e[e.ImageQueryFormat=101]="ImageQueryFormat",e[e.ImageQueryOrder=102]="ImageQueryOrder",e[e.ImageQuerySizeLod=103]="ImageQuerySizeLod",e[e.ImageQuerySize=104]="ImageQuerySize",e[e.ImageQueryLod=105]="ImageQueryLod",e[e.ImageQueryLevels=106]="ImageQueryLevels",e[e.ImageQuerySamples=107]="ImageQuerySamples",e[e.ConvertFToU=109]="ConvertFToU",e[e.ConvertFToS=110]="ConvertFToS",e[e.ConvertSToF=111]="ConvertSToF",e[e.ConvertUToF=112]="ConvertUToF",e[e.UConvert=113]="UConvert",e[e.SConvert=114]="SConvert",e[e.FConvert=115]="FConvert",e[e.QuantizeToF16=116]="QuantizeToF16",e[e.ConvertPtrToU=117]="ConvertPtrToU",e[e.SatConvertSToU=118]="SatConvertSToU",e[e.SatConvertUToS=119]="SatConvertUToS",e[e.ConvertUToPtr=120]="ConvertUToPtr",e[e.PtrCastToGeneric=121]="PtrCastToGeneric",e[e.GenericCastToPtr=122]="GenericCastToPtr",e[e.GenericCastToPtrExplicit=123]="GenericCastToPtrExplicit",e[e.Bitcast=124]="Bitcast",e[e.SNegate=126]="SNegate",e[e.FNegate=127]="FNegate",e[e.IAdd=128]="IAdd",e[e.FAdd=129]="FAdd",e[e.ISub=130]="ISub",e[e.FSub=131]="FSub",e[e.IMul=132]="IMul",e[e.FMul=133]="FMul",e[e.UDiv=134]="UDiv",e[e.SDiv=135]="SDiv",e[e.FDiv=136]="FDiv",e[e.UMod=137]="UMod",e[e.SRem=138]="SRem",e[e.SMod=139]="SMod",e[e.FRem=140]="FRem",e[e.FMod=141]="FMod",e[e.VectorTimesScalar=142]="VectorTimesScalar",e[e.MatrixTimesScalar=143]="MatrixTimesScalar",e[e.VectorTimesMatrix=144]="VectorTimesMatrix",e[e.MatrixTimesVector=145]="MatrixTimesVector",e[e.MatrixTimesMatrix=146]="MatrixTimesMatrix",e[e.OuterProduct=147]="OuterProduct",e[e.Dot=148]="Dot",e[e.IAddCarry=149]="IAddCarry",e[e.ISubBorrow=150]="ISubBorrow",e[e.UMulExtended=151]="UMulExtended",e[e.SMulExtended=152]="SMulExtended",e[e.Any=154]="Any",e[e.All=155]="All",e[e.IsNan=156]="IsNan",e[e.IsInf=157]="IsInf",e[e.IsFinite=158]="IsFinite",e[e.IsNormal=159]="IsNormal",e[e.SignBitSet=160]="SignBitSet",e[e.LessOrGreater=161]="LessOrGreater",e[e.Ordered=162]="Ordered",e[e.Unordered=163]="Unordered",e[e.LogicalEqual=164]="LogicalEqual",e[e.LogicalNotEqual=165]="LogicalNotEqual",e[e.LogicalOr=166]="LogicalOr",e[e.LogicalAnd=167]="LogicalAnd",e[e.LogicalNot=168]="LogicalNot",e[e.Select=169]="Select",e[e.IEqual=170]="IEqual",e[e.INotEqual=171]="INotEqual",e[e.UGreaterThan=172]="UGreaterThan",e[e.SGreaterThan=173]="SGreaterThan",e[e.UGreaterThanEqual=174]="UGreaterThanEqual",e[e.SGreaterThanEqual=175]="SGreaterThanEqual",e[e.ULessThan=176]="ULessThan",e[e.SLessThan=177]="SLessThan",e[e.ULessThanEqual=178]="ULessThanEqual",e[e.SLessThanEqual=179]="SLessThanEqual",e[e.FOrdEqual=180]="FOrdEqual",e[e.FUnordEqual=181]="FUnordEqual",e[e.FOrdNotEqual=182]="FOrdNotEqual",e[e.FUnordNotEqual=183]="FUnordNotEqual",e[e.FOrdLessThan=184]="FOrdLessThan",e[e.FUnordLessThan=185]="FUnordLessThan",e[e.FOrdGreaterThan=186]="FOrdGreaterThan",e[e.FUnordGreaterThan=187]="FUnordGreaterThan",e[e.FOrdLessThanEqual=188]="FOrdLessThanEqual",e[e.FUnordLessThanEqual=189]="FUnordLessThanEqual",e[e.FOrdGreaterThanEqual=190]="FOrdGreaterThanEqual",e[e.FUnordGreaterThanEqual=191]="FUnordGreaterThanEqual",e[e.ShiftRightLogical=194]="ShiftRightLogical",e[e.ShiftRightArithmetic=195]="ShiftRightArithmetic",e[e.ShiftLeftLogical=196]="ShiftLeftLogical",e[e.BitwiseOr=197]="BitwiseOr",e[e.BitwiseXor=198]="BitwiseXor",e[e.BitwiseAnd=199]="BitwiseAnd",e[e.Not=200]="Not",e[e.BitFieldInsert=201]="BitFieldInsert",e[e.BitFieldSExtract=202]="BitFieldSExtract",e[e.BitFieldUExtract=203]="BitFieldUExtract",e[e.BitReverse=204]="BitReverse",e[e.BitCount=205]="BitCount",e[e.DPdx=207]="DPdx",e[e.DPdy=208]="DPdy",e[e.Fwidth=209]="Fwidth",e[e.DPdxFine=210]="DPdxFine",e[e.DPdyFine=211]="DPdyFine",e[e.FwidthFine=212]="FwidthFine",e[e.DPdxCoarse=213]="DPdxCoarse",e[e.DPdyCoarse=214]="DPdyCoarse",e[e.FwidthCoarse=215]="FwidthCoarse",e[e.EmitVertex=218]="EmitVertex",e[e.EndPrimitive=219]="EndPrimitive",e[e.EmitStreamVertex=220]="EmitStreamVertex",e[e.EndStreamPrimitive=221]="EndStreamPrimitive",e[e.ControlBarrier=224]="ControlBarrier",e[e.MemoryBarrier=225]="MemoryBarrier",e[e.AtomicLoad=227]="AtomicLoad",e[e.AtomicStore=228]="AtomicStore",e[e.AtomicExchange=229]="AtomicExchange",e[e.AtomicCompareExchange=230]="AtomicCompareExchange",e[e.AtomicCompareExchangeWeak=231]="AtomicCompareExchangeWeak",e[e.AtomicIIncrement=232]="AtomicIIncrement",e[e.AtomicIDecrement=233]="AtomicIDecrement",e[e.AtomicIAdd=234]="AtomicIAdd",e[e.AtomicISub=235]="AtomicISub",e[e.AtomicSMin=236]="AtomicSMin",e[e.AtomicUMin=237]="AtomicUMin",e[e.AtomicSMax=238]="AtomicSMax",e[e.AtomicUMax=239]="AtomicUMax",e[e.AtomicAnd=240]="AtomicAnd",e[e.AtomicOr=241]="AtomicOr",e[e.AtomicXor=242]="AtomicXor",e[e.Phi=245]="Phi",e[e.LoopMerge=246]="LoopMerge",e[e.SelectionMerge=247]="SelectionMerge",e[e.Label=248]="Label",e[e.Branch=249]="Branch",e[e.BranchConditional=250]="BranchConditional",e[e.Switch=251]="Switch",e[e.Kill=252]="Kill",e[e.Return=253]="Return",e[e.ReturnValue=254]="ReturnValue",e[e.Unreachable=255]="Unreachable",e[e.LifetimeStart=256]="LifetimeStart",e[e.LifetimeStop=257]="LifetimeStop",e[e.GroupAsyncCopy=259]="GroupAsyncCopy",e[e.GroupWaitEvents=260]="GroupWaitEvents",e[e.GroupAll=261]="GroupAll",e[e.GroupAny=262]="GroupAny",e[e.GroupBroadcast=263]="GroupBroadcast",e[e.GroupIAdd=264]="GroupIAdd",e[e.GroupFAdd=265]="GroupFAdd",e[e.GroupFMin=266]="GroupFMin",e[e.GroupUMin=267]="GroupUMin",e[e.GroupSMin=268]="GroupSMin",e[e.GroupFMax=269]="GroupFMax",e[e.GroupUMax=270]="GroupUMax",e[e.GroupSMax=271]="GroupSMax",e[e.ReadPipe=274]="ReadPipe",e[e.WritePipe=275]="WritePipe",e[e.ReservedReadPipe=276]="ReservedReadPipe",e[e.ReservedWritePipe=277]="ReservedWritePipe",e[e.ReserveReadPipePackets=278]="ReserveReadPipePackets",e[e.ReserveWritePipePackets=279]="ReserveWritePipePackets",e[e.CommitReadPipe=280]="CommitReadPipe",e[e.CommitWritePipe=281]="CommitWritePipe",e[e.IsValidReserveId=282]="IsValidReserveId",e[e.GetNumPipePackets=283]="GetNumPipePackets",e[e.GetMaxPipePackets=284]="GetMaxPipePackets",e[e.GroupReserveReadPipePackets=285]="GroupReserveReadPipePackets",e[e.GroupReserveWritePipePackets=286]="GroupReserveWritePipePackets",e[e.GroupCommitReadPipe=287]="GroupCommitReadPipe",e[e.GroupCommitWritePipe=288]="GroupCommitWritePipe",e[e.EnqueueMarker=291]="EnqueueMarker",e[e.EnqueueKernel=292]="EnqueueKernel",e[e.GetKernelNDrangeSubGroupCount=293]="GetKernelNDrangeSubGroupCount",e[e.GetKernelNDrangeMaxSubGroupSize=294]="GetKernelNDrangeMaxSubGroupSize",e[e.GetKernelWorkGroupSize=295]="GetKernelWorkGroupSize",e[e.GetKernelPreferredWorkGroupSizeMultiple=296]="GetKernelPreferredWorkGroupSizeMultiple",e[e.RetainEvent=297]="RetainEvent",e[e.ReleaseEvent=298]="ReleaseEvent",e[e.CreateUserEvent=299]="CreateUserEvent",e[e.IsValidEvent=300]="IsValidEvent",e[e.SetUserEventStatus=301]="SetUserEventStatus",e[e.CaptureEventProfilingInfo=302]="CaptureEventProfilingInfo",e[e.GetDefaultQueue=303]="GetDefaultQueue",e[e.BuildNDRange=304]="BuildNDRange",e[e.ImageSparseSampleImplicitLod=305]="ImageSparseSampleImplicitLod",e[e.ImageSparseSampleExplicitLod=306]="ImageSparseSampleExplicitLod",e[e.ImageSparseSampleDrefImplicitLod=307]="ImageSparseSampleDrefImplicitLod",e[e.ImageSparseSampleDrefExplicitLod=308]="ImageSparseSampleDrefExplicitLod",e[e.ImageSparseSampleProjImplicitLod=309]="ImageSparseSampleProjImplicitLod",e[e.ImageSparseSampleProjExplicitLod=310]="ImageSparseSampleProjExplicitLod",e[e.ImageSparseSampleProjDrefImplicitLod=311]="ImageSparseSampleProjDrefImplicitLod",e[e.ImageSparseSampleProjDrefExplicitLod=312]="ImageSparseSampleProjDrefExplicitLod",e[e.ImageSparseFetch=313]="ImageSparseFetch",e[e.ImageSparseGather=314]="ImageSparseGather",e[e.ImageSparseDrefGather=315]="ImageSparseDrefGather",e[e.ImageSparseTexelsResident=316]="ImageSparseTexelsResident",e[e.NoLine=317]="NoLine",e[e.AtomicFlagTestAndSet=318]="AtomicFlagTestAndSet",e[e.AtomicFlagClear=319]="AtomicFlagClear",e[e.ImageSparseRead=320]="ImageSparseRead",e[e.SizeOf=321]="SizeOf",e[e.TypePipeStorage=322]="TypePipeStorage",e[e.ConstantPipeStorage=323]="ConstantPipeStorage",e[e.CreatePipeFromPipeStorage=324]="CreatePipeFromPipeStorage",e[e.GetKernelLocalSizeForSubgroupCount=325]="GetKernelLocalSizeForSubgroupCount",e[e.GetKernelMaxNumSubgroups=326]="GetKernelMaxNumSubgroups",e[e.TypeNamedBarrier=327]="TypeNamedBarrier",e[e.NamedBarrierInitialize=328]="NamedBarrierInitialize",e[e.MemoryNamedBarrier=329]="MemoryNamedBarrier",e[e.ModuleProcessed=330]="ModuleProcessed",e[e.ExecutionModeId=331]="ExecutionModeId",e[e.DecorateId=332]="DecorateId",e[e.GroupNonUniformElect=333]="GroupNonUniformElect",e[e.GroupNonUniformAll=334]="GroupNonUniformAll",e[e.GroupNonUniformAny=335]="GroupNonUniformAny",e[e.GroupNonUniformAllEqual=336]="GroupNonUniformAllEqual",e[e.GroupNonUniformBroadcast=337]="GroupNonUniformBroadcast",e[e.GroupNonUniformBroadcastFirst=338]="GroupNonUniformBroadcastFirst",e[e.GroupNonUniformBallot=339]="GroupNonUniformBallot",e[e.GroupNonUniformInverseBallot=340]="GroupNonUniformInverseBallot",e[e.GroupNonUniformBallotBitExtract=341]="GroupNonUniformBallotBitExtract",e[e.GroupNonUniformBallotBitCount=342]="GroupNonUniformBallotBitCount",e[e.GroupNonUniformBallotFindLSB=343]="GroupNonUniformBallotFindLSB",e[e.GroupNonUniformBallotFindMSB=344]="GroupNonUniformBallotFindMSB",e[e.GroupNonUniformShuffle=345]="GroupNonUniformShuffle",e[e.GroupNonUniformShuffleXor=346]="GroupNonUniformShuffleXor",e[e.GroupNonUniformShuffleUp=347]="GroupNonUniformShuffleUp",e[e.GroupNonUniformShuffleDown=348]="GroupNonUniformShuffleDown",e[e.GroupNonUniformIAdd=349]="GroupNonUniformIAdd",e[e.GroupNonUniformFAdd=350]="GroupNonUniformFAdd",e[e.GroupNonUniformIMul=351]="GroupNonUniformIMul",e[e.GroupNonUniformFMul=352]="GroupNonUniformFMul",e[e.GroupNonUniformSMin=353]="GroupNonUniformSMin",e[e.GroupNonUniformUMin=354]="GroupNonUniformUMin",e[e.GroupNonUniformFMin=355]="GroupNonUniformFMin",e[e.GroupNonUniformSMax=356]="GroupNonUniformSMax",e[e.GroupNonUniformUMax=357]="GroupNonUniformUMax",e[e.GroupNonUniformFMax=358]="GroupNonUniformFMax",e[e.GroupNonUniformBitwiseAnd=359]="GroupNonUniformBitwiseAnd",e[e.GroupNonUniformBitwiseOr=360]="GroupNonUniformBitwiseOr",e[e.GroupNonUniformBitwiseXor=361]="GroupNonUniformBitwiseXor",e[e.GroupNonUniformLogicalAnd=362]="GroupNonUniformLogicalAnd",e[e.GroupNonUniformLogicalOr=363]="GroupNonUniformLogicalOr",e[e.GroupNonUniformLogicalXor=364]="GroupNonUniformLogicalXor",e[e.GroupNonUniformQuadBroadcast=365]="GroupNonUniformQuadBroadcast",e[e.GroupNonUniformQuadSwap=366]="GroupNonUniformQuadSwap",e[e.CopyLogical=400]="CopyLogical",e[e.PtrEqual=401]="PtrEqual",e[e.PtrNotEqual=402]="PtrNotEqual",e[e.PtrDiff=403]="PtrDiff",e[e.TerminateInvocation=4416]="TerminateInvocation",e[e.SubgroupBallotKHR=4421]="SubgroupBallotKHR",e[e.SubgroupFirstInvocationKHR=4422]="SubgroupFirstInvocationKHR",e[e.SubgroupAllKHR=4428]="SubgroupAllKHR",e[e.SubgroupAnyKHR=4429]="SubgroupAnyKHR",e[e.SubgroupAllEqualKHR=4430]="SubgroupAllEqualKHR",e[e.SubgroupReadInvocationKHR=4432]="SubgroupReadInvocationKHR",e[e.TraceRayKHR=4445]="TraceRayKHR",e[e.ExecuteCallableKHR=4446]="ExecuteCallableKHR",e[e.ConvertUToAccelerationStructureKHR=4447]="ConvertUToAccelerationStructureKHR",e[e.IgnoreIntersectionKHR=4448]="IgnoreIntersectionKHR",e[e.TerminateRayKHR=4449]="TerminateRayKHR",e[e.TypeRayQueryKHR=4472]="TypeRayQueryKHR",e[e.RayQueryInitializeKHR=4473]="RayQueryInitializeKHR",e[e.RayQueryTerminateKHR=4474]="RayQueryTerminateKHR",e[e.RayQueryGenerateIntersectionKHR=4475]="RayQueryGenerateIntersectionKHR",e[e.RayQueryConfirmIntersectionKHR=4476]="RayQueryConfirmIntersectionKHR",e[e.RayQueryProceedKHR=4477]="RayQueryProceedKHR",e[e.RayQueryGetIntersectionTypeKHR=4479]="RayQueryGetIntersectionTypeKHR",e[e.GroupIAddNonUniformAMD=5e3]="GroupIAddNonUniformAMD",e[e.GroupFAddNonUniformAMD=5001]="GroupFAddNonUniformAMD",e[e.GroupFMinNonUniformAMD=5002]="GroupFMinNonUniformAMD",e[e.GroupUMinNonUniformAMD=5003]="GroupUMinNonUniformAMD",e[e.GroupSMinNonUniformAMD=5004]="GroupSMinNonUniformAMD",e[e.GroupFMaxNonUniformAMD=5005]="GroupFMaxNonUniformAMD",e[e.GroupUMaxNonUniformAMD=5006]="GroupUMaxNonUniformAMD",e[e.GroupSMaxNonUniformAMD=5007]="GroupSMaxNonUniformAMD",e[e.FragmentMaskFetchAMD=5011]="FragmentMaskFetchAMD",e[e.FragmentFetchAMD=5012]="FragmentFetchAMD",e[e.ReadClockKHR=5056]="ReadClockKHR",e[e.ImageSampleFootprintNV=5283]="ImageSampleFootprintNV",e[e.GroupNonUniformPartitionNV=5296]="GroupNonUniformPartitionNV",e[e.WritePackedPrimitiveIndices4x8NV=5299]="WritePackedPrimitiveIndices4x8NV",e[e.ReportIntersectionKHR=5334]="ReportIntersectionKHR",e[e.ReportIntersectionNV=5334]="ReportIntersectionNV",e[e.IgnoreIntersectionNV=5335]="IgnoreIntersectionNV",e[e.TerminateRayNV=5336]="TerminateRayNV",e[e.TraceNV=5337]="TraceNV",e[e.TypeAccelerationStructureKHR=5341]="TypeAccelerationStructureKHR",e[e.TypeAccelerationStructureNV=5341]="TypeAccelerationStructureNV",e[e.ExecuteCallableNV=5344]="ExecuteCallableNV",e[e.TypeCooperativeMatrixNV=5358]="TypeCooperativeMatrixNV",e[e.CooperativeMatrixLoadNV=5359]="CooperativeMatrixLoadNV",e[e.CooperativeMatrixStoreNV=5360]="CooperativeMatrixStoreNV",e[e.CooperativeMatrixMulAddNV=5361]="CooperativeMatrixMulAddNV",e[e.CooperativeMatrixLengthNV=5362]="CooperativeMatrixLengthNV",e[e.BeginInvocationInterlockEXT=5364]="BeginInvocationInterlockEXT",e[e.EndInvocationInterlockEXT=5365]="EndInvocationInterlockEXT",e[e.DemoteToHelperInvocationEXT=5380]="DemoteToHelperInvocationEXT",e[e.IsHelperInvocationEXT=5381]="IsHelperInvocationEXT",e[e.SubgroupShuffleINTEL=5571]="SubgroupShuffleINTEL",e[e.SubgroupShuffleDownINTEL=5572]="SubgroupShuffleDownINTEL",e[e.SubgroupShuffleUpINTEL=5573]="SubgroupShuffleUpINTEL",e[e.SubgroupShuffleXorINTEL=5574]="SubgroupShuffleXorINTEL",e[e.SubgroupBlockReadINTEL=5575]="SubgroupBlockReadINTEL",e[e.SubgroupBlockWriteINTEL=5576]="SubgroupBlockWriteINTEL",e[e.SubgroupImageBlockReadINTEL=5577]="SubgroupImageBlockReadINTEL",e[e.SubgroupImageBlockWriteINTEL=5578]="SubgroupImageBlockWriteINTEL",e[e.SubgroupImageMediaBlockReadINTEL=5580]="SubgroupImageMediaBlockReadINTEL",e[e.SubgroupImageMediaBlockWriteINTEL=5581]="SubgroupImageMediaBlockWriteINTEL",e[e.UCountLeadingZerosINTEL=5585]="UCountLeadingZerosINTEL",e[e.UCountTrailingZerosINTEL=5586]="UCountTrailingZerosINTEL",e[e.AbsISubINTEL=5587]="AbsISubINTEL",e[e.AbsUSubINTEL=5588]="AbsUSubINTEL",e[e.IAddSatINTEL=5589]="IAddSatINTEL",e[e.UAddSatINTEL=5590]="UAddSatINTEL",e[e.IAverageINTEL=5591]="IAverageINTEL",e[e.UAverageINTEL=5592]="UAverageINTEL",e[e.IAverageRoundedINTEL=5593]="IAverageRoundedINTEL",e[e.UAverageRoundedINTEL=5594]="UAverageRoundedINTEL",e[e.ISubSatINTEL=5595]="ISubSatINTEL",e[e.USubSatINTEL=5596]="USubSatINTEL",e[e.IMul32x16INTEL=5597]="IMul32x16INTEL",e[e.UMul32x16INTEL=5598]="UMul32x16INTEL",e[e.FunctionPointerINTEL=5600]="FunctionPointerINTEL",e[e.FunctionPointerCallINTEL=5601]="FunctionPointerCallINTEL",e[e.DecorateString=5632]="DecorateString",e[e.DecorateStringGOOGLE=5632]="DecorateStringGOOGLE",e[e.MemberDecorateString=5633]="MemberDecorateString",e[e.MemberDecorateStringGOOGLE=5633]="MemberDecorateStringGOOGLE",e[e.VmeImageINTEL=5699]="VmeImageINTEL",e[e.TypeVmeImageINTEL=5700]="TypeVmeImageINTEL",e[e.TypeAvcImePayloadINTEL=5701]="TypeAvcImePayloadINTEL",e[e.TypeAvcRefPayloadINTEL=5702]="TypeAvcRefPayloadINTEL",e[e.TypeAvcSicPayloadINTEL=5703]="TypeAvcSicPayloadINTEL",e[e.TypeAvcMcePayloadINTEL=5704]="TypeAvcMcePayloadINTEL",e[e.TypeAvcMceResultINTEL=5705]="TypeAvcMceResultINTEL",e[e.TypeAvcImeResultINTEL=5706]="TypeAvcImeResultINTEL",e[e.TypeAvcImeResultSingleReferenceStreamoutINTEL=5707]="TypeAvcImeResultSingleReferenceStreamoutINTEL",e[e.TypeAvcImeResultDualReferenceStreamoutINTEL=5708]="TypeAvcImeResultDualReferenceStreamoutINTEL",e[e.TypeAvcImeSingleReferenceStreaminINTEL=5709]="TypeAvcImeSingleReferenceStreaminINTEL",e[e.TypeAvcImeDualReferenceStreaminINTEL=5710]="TypeAvcImeDualReferenceStreaminINTEL",e[e.TypeAvcRefResultINTEL=5711]="TypeAvcRefResultINTEL",e[e.TypeAvcSicResultINTEL=5712]="TypeAvcSicResultINTEL",e[e.SubgroupAvcMceGetDefaultInterBaseMultiReferencePenaltyINTEL=5713]="SubgroupAvcMceGetDefaultInterBaseMultiReferencePenaltyINTEL",e[e.SubgroupAvcMceSetInterBaseMultiReferencePenaltyINTEL=5714]="SubgroupAvcMceSetInterBaseMultiReferencePenaltyINTEL",e[e.SubgroupAvcMceGetDefaultInterShapePenaltyINTEL=5715]="SubgroupAvcMceGetDefaultInterShapePenaltyINTEL",e[e.SubgroupAvcMceSetInterShapePenaltyINTEL=5716]="SubgroupAvcMceSetInterShapePenaltyINTEL",e[e.SubgroupAvcMceGetDefaultInterDirectionPenaltyINTEL=5717]="SubgroupAvcMceGetDefaultInterDirectionPenaltyINTEL",e[e.SubgroupAvcMceSetInterDirectionPenaltyINTEL=5718]="SubgroupAvcMceSetInterDirectionPenaltyINTEL",e[e.SubgroupAvcMceGetDefaultIntraLumaShapePenaltyINTEL=5719]="SubgroupAvcMceGetDefaultIntraLumaShapePenaltyINTEL",e[e.SubgroupAvcMceGetDefaultInterMotionVectorCostTableINTEL=5720]="SubgroupAvcMceGetDefaultInterMotionVectorCostTableINTEL",e[e.SubgroupAvcMceGetDefaultHighPenaltyCostTableINTEL=5721]="SubgroupAvcMceGetDefaultHighPenaltyCostTableINTEL",e[e.SubgroupAvcMceGetDefaultMediumPenaltyCostTableINTEL=5722]="SubgroupAvcMceGetDefaultMediumPenaltyCostTableINTEL",e[e.SubgroupAvcMceGetDefaultLowPenaltyCostTableINTEL=5723]="SubgroupAvcMceGetDefaultLowPenaltyCostTableINTEL",e[e.SubgroupAvcMceSetMotionVectorCostFunctionINTEL=5724]="SubgroupAvcMceSetMotionVectorCostFunctionINTEL",e[e.SubgroupAvcMceGetDefaultIntraLumaModePenaltyINTEL=5725]="SubgroupAvcMceGetDefaultIntraLumaModePenaltyINTEL",e[e.SubgroupAvcMceGetDefaultNonDcLumaIntraPenaltyINTEL=5726]="SubgroupAvcMceGetDefaultNonDcLumaIntraPenaltyINTEL",e[e.SubgroupAvcMceGetDefaultIntraChromaModeBasePenaltyINTEL=5727]="SubgroupAvcMceGetDefaultIntraChromaModeBasePenaltyINTEL",e[e.SubgroupAvcMceSetAcOnlyHaarINTEL=5728]="SubgroupAvcMceSetAcOnlyHaarINTEL",e[e.SubgroupAvcMceSetSourceInterlacedFieldPolarityINTEL=5729]="SubgroupAvcMceSetSourceInterlacedFieldPolarityINTEL",e[e.SubgroupAvcMceSetSingleReferenceInterlacedFieldPolarityINTEL=5730]="SubgroupAvcMceSetSingleReferenceInterlacedFieldPolarityINTEL",e[e.SubgroupAvcMceSetDualReferenceInterlacedFieldPolaritiesINTEL=5731]="SubgroupAvcMceSetDualReferenceInterlacedFieldPolaritiesINTEL",e[e.SubgroupAvcMceConvertToImePayloadINTEL=5732]="SubgroupAvcMceConvertToImePayloadINTEL",e[e.SubgroupAvcMceConvertToImeResultINTEL=5733]="SubgroupAvcMceConvertToImeResultINTEL",e[e.SubgroupAvcMceConvertToRefPayloadINTEL=5734]="SubgroupAvcMceConvertToRefPayloadINTEL",e[e.SubgroupAvcMceConvertToRefResultINTEL=5735]="SubgroupAvcMceConvertToRefResultINTEL",e[e.SubgroupAvcMceConvertToSicPayloadINTEL=5736]="SubgroupAvcMceConvertToSicPayloadINTEL",e[e.SubgroupAvcMceConvertToSicResultINTEL=5737]="SubgroupAvcMceConvertToSicResultINTEL",e[e.SubgroupAvcMceGetMotionVectorsINTEL=5738]="SubgroupAvcMceGetMotionVectorsINTEL",e[e.SubgroupAvcMceGetInterDistortionsINTEL=5739]="SubgroupAvcMceGetInterDistortionsINTEL",e[e.SubgroupAvcMceGetBestInterDistortionsINTEL=5740]="SubgroupAvcMceGetBestInterDistortionsINTEL",e[e.SubgroupAvcMceGetInterMajorShapeINTEL=5741]="SubgroupAvcMceGetInterMajorShapeINTEL",e[e.SubgroupAvcMceGetInterMinorShapeINTEL=5742]="SubgroupAvcMceGetInterMinorShapeINTEL",e[e.SubgroupAvcMceGetInterDirectionsINTEL=5743]="SubgroupAvcMceGetInterDirectionsINTEL",e[e.SubgroupAvcMceGetInterMotionVectorCountINTEL=5744]="SubgroupAvcMceGetInterMotionVectorCountINTEL",e[e.SubgroupAvcMceGetInterReferenceIdsINTEL=5745]="SubgroupAvcMceGetInterReferenceIdsINTEL",e[e.SubgroupAvcMceGetInterReferenceInterlacedFieldPolaritiesINTEL=5746]="SubgroupAvcMceGetInterReferenceInterlacedFieldPolaritiesINTEL",e[e.SubgroupAvcImeInitializeINTEL=5747]="SubgroupAvcImeInitializeINTEL",e[e.SubgroupAvcImeSetSingleReferenceINTEL=5748]="SubgroupAvcImeSetSingleReferenceINTEL",e[e.SubgroupAvcImeSetDualReferenceINTEL=5749]="SubgroupAvcImeSetDualReferenceINTEL",e[e.SubgroupAvcImeRefWindowSizeINTEL=5750]="SubgroupAvcImeRefWindowSizeINTEL",e[e.SubgroupAvcImeAdjustRefOffsetINTEL=5751]="SubgroupAvcImeAdjustRefOffsetINTEL",e[e.SubgroupAvcImeConvertToMcePayloadINTEL=5752]="SubgroupAvcImeConvertToMcePayloadINTEL",e[e.SubgroupAvcImeSetMaxMotionVectorCountINTEL=5753]="SubgroupAvcImeSetMaxMotionVectorCountINTEL",e[e.SubgroupAvcImeSetUnidirectionalMixDisableINTEL=5754]="SubgroupAvcImeSetUnidirectionalMixDisableINTEL",e[e.SubgroupAvcImeSetEarlySearchTerminationThresholdINTEL=5755]="SubgroupAvcImeSetEarlySearchTerminationThresholdINTEL",e[e.SubgroupAvcImeSetWeightedSadINTEL=5756]="SubgroupAvcImeSetWeightedSadINTEL",e[e.SubgroupAvcImeEvaluateWithSingleReferenceINTEL=5757]="SubgroupAvcImeEvaluateWithSingleReferenceINTEL",e[e.SubgroupAvcImeEvaluateWithDualReferenceINTEL=5758]="SubgroupAvcImeEvaluateWithDualReferenceINTEL",e[e.SubgroupAvcImeEvaluateWithSingleReferenceStreaminINTEL=5759]="SubgroupAvcImeEvaluateWithSingleReferenceStreaminINTEL",e[e.SubgroupAvcImeEvaluateWithDualReferenceStreaminINTEL=5760]="SubgroupAvcImeEvaluateWithDualReferenceStreaminINTEL",e[e.SubgroupAvcImeEvaluateWithSingleReferenceStreamoutINTEL=5761]="SubgroupAvcImeEvaluateWithSingleReferenceStreamoutINTEL",e[e.SubgroupAvcImeEvaluateWithDualReferenceStreamoutINTEL=5762]="SubgroupAvcImeEvaluateWithDualReferenceStreamoutINTEL",e[e.SubgroupAvcImeEvaluateWithSingleReferenceStreaminoutINTEL=5763]="SubgroupAvcImeEvaluateWithSingleReferenceStreaminoutINTEL",e[e.SubgroupAvcImeEvaluateWithDualReferenceStreaminoutINTEL=5764]="SubgroupAvcImeEvaluateWithDualReferenceStreaminoutINTEL",e[e.SubgroupAvcImeConvertToMceResultINTEL=5765]="SubgroupAvcImeConvertToMceResultINTEL",e[e.SubgroupAvcImeGetSingleReferenceStreaminINTEL=5766]="SubgroupAvcImeGetSingleReferenceStreaminINTEL",e[e.SubgroupAvcImeGetDualReferenceStreaminINTEL=5767]="SubgroupAvcImeGetDualReferenceStreaminINTEL",e[e.SubgroupAvcImeStripSingleReferenceStreamoutINTEL=5768]="SubgroupAvcImeStripSingleReferenceStreamoutINTEL",e[e.SubgroupAvcImeStripDualReferenceStreamoutINTEL=5769]="SubgroupAvcImeStripDualReferenceStreamoutINTEL",e[e.SubgroupAvcImeGetStreamoutSingleReferenceMajorShapeMotionVectorsINTEL=5770]="SubgroupAvcImeGetStreamoutSingleReferenceMajorShapeMotionVectorsINTEL",e[e.SubgroupAvcImeGetStreamoutSingleReferenceMajorShapeDistortionsINTEL=5771]="SubgroupAvcImeGetStreamoutSingleReferenceMajorShapeDistortionsINTEL",e[e.SubgroupAvcImeGetStreamoutSingleReferenceMajorShapeReferenceIdsINTEL=5772]="SubgroupAvcImeGetStreamoutSingleReferenceMajorShapeReferenceIdsINTEL",e[e.SubgroupAvcImeGetStreamoutDualReferenceMajorShapeMotionVectorsINTEL=5773]="SubgroupAvcImeGetStreamoutDualReferenceMajorShapeMotionVectorsINTEL",e[e.SubgroupAvcImeGetStreamoutDualReferenceMajorShapeDistortionsINTEL=5774]="SubgroupAvcImeGetStreamoutDualReferenceMajorShapeDistortionsINTEL",e[e.SubgroupAvcImeGetStreamoutDualReferenceMajorShapeReferenceIdsINTEL=5775]="SubgroupAvcImeGetStreamoutDualReferenceMajorShapeReferenceIdsINTEL",e[e.SubgroupAvcImeGetBorderReachedINTEL=5776]="SubgroupAvcImeGetBorderReachedINTEL",e[e.SubgroupAvcImeGetTruncatedSearchIndicationINTEL=5777]="SubgroupAvcImeGetTruncatedSearchIndicationINTEL",e[e.SubgroupAvcImeGetUnidirectionalEarlySearchTerminationINTEL=5778]="SubgroupAvcImeGetUnidirectionalEarlySearchTerminationINTEL",e[e.SubgroupAvcImeGetWeightingPatternMinimumMotionVectorINTEL=5779]="SubgroupAvcImeGetWeightingPatternMinimumMotionVectorINTEL",e[e.SubgroupAvcImeGetWeightingPatternMinimumDistortionINTEL=5780]="SubgroupAvcImeGetWeightingPatternMinimumDistortionINTEL",e[e.SubgroupAvcFmeInitializeINTEL=5781]="SubgroupAvcFmeInitializeINTEL",e[e.SubgroupAvcBmeInitializeINTEL=5782]="SubgroupAvcBmeInitializeINTEL",e[e.SubgroupAvcRefConvertToMcePayloadINTEL=5783]="SubgroupAvcRefConvertToMcePayloadINTEL",e[e.SubgroupAvcRefSetBidirectionalMixDisableINTEL=5784]="SubgroupAvcRefSetBidirectionalMixDisableINTEL",e[e.SubgroupAvcRefSetBilinearFilterEnableINTEL=5785]="SubgroupAvcRefSetBilinearFilterEnableINTEL",e[e.SubgroupAvcRefEvaluateWithSingleReferenceINTEL=5786]="SubgroupAvcRefEvaluateWithSingleReferenceINTEL",e[e.SubgroupAvcRefEvaluateWithDualReferenceINTEL=5787]="SubgroupAvcRefEvaluateWithDualReferenceINTEL",e[e.SubgroupAvcRefEvaluateWithMultiReferenceINTEL=5788]="SubgroupAvcRefEvaluateWithMultiReferenceINTEL",e[e.SubgroupAvcRefEvaluateWithMultiReferenceInterlacedINTEL=5789]="SubgroupAvcRefEvaluateWithMultiReferenceInterlacedINTEL",e[e.SubgroupAvcRefConvertToMceResultINTEL=5790]="SubgroupAvcRefConvertToMceResultINTEL",e[e.SubgroupAvcSicInitializeINTEL=5791]="SubgroupAvcSicInitializeINTEL",e[e.SubgroupAvcSicConfigureSkcINTEL=5792]="SubgroupAvcSicConfigureSkcINTEL",e[e.SubgroupAvcSicConfigureIpeLumaINTEL=5793]="SubgroupAvcSicConfigureIpeLumaINTEL",e[e.SubgroupAvcSicConfigureIpeLumaChromaINTEL=5794]="SubgroupAvcSicConfigureIpeLumaChromaINTEL",e[e.SubgroupAvcSicGetMotionVectorMaskINTEL=5795]="SubgroupAvcSicGetMotionVectorMaskINTEL",e[e.SubgroupAvcSicConvertToMcePayloadINTEL=5796]="SubgroupAvcSicConvertToMcePayloadINTEL",e[e.SubgroupAvcSicSetIntraLumaShapePenaltyINTEL=5797]="SubgroupAvcSicSetIntraLumaShapePenaltyINTEL",e[e.SubgroupAvcSicSetIntraLumaModeCostFunctionINTEL=5798]="SubgroupAvcSicSetIntraLumaModeCostFunctionINTEL",e[e.SubgroupAvcSicSetIntraChromaModeCostFunctionINTEL=5799]="SubgroupAvcSicSetIntraChromaModeCostFunctionINTEL",e[e.SubgroupAvcSicSetBilinearFilterEnableINTEL=5800]="SubgroupAvcSicSetBilinearFilterEnableINTEL",e[e.SubgroupAvcSicSetSkcForwardTransformEnableINTEL=5801]="SubgroupAvcSicSetSkcForwardTransformEnableINTEL",e[e.SubgroupAvcSicSetBlockBasedRawSkipSadINTEL=5802]="SubgroupAvcSicSetBlockBasedRawSkipSadINTEL",e[e.SubgroupAvcSicEvaluateIpeINTEL=5803]="SubgroupAvcSicEvaluateIpeINTEL",e[e.SubgroupAvcSicEvaluateWithSingleReferenceINTEL=5804]="SubgroupAvcSicEvaluateWithSingleReferenceINTEL",e[e.SubgroupAvcSicEvaluateWithDualReferenceINTEL=5805]="SubgroupAvcSicEvaluateWithDualReferenceINTEL",e[e.SubgroupAvcSicEvaluateWithMultiReferenceINTEL=5806]="SubgroupAvcSicEvaluateWithMultiReferenceINTEL",e[e.SubgroupAvcSicEvaluateWithMultiReferenceInterlacedINTEL=5807]="SubgroupAvcSicEvaluateWithMultiReferenceInterlacedINTEL",e[e.SubgroupAvcSicConvertToMceResultINTEL=5808]="SubgroupAvcSicConvertToMceResultINTEL",e[e.SubgroupAvcSicGetIpeLumaShapeINTEL=5809]="SubgroupAvcSicGetIpeLumaShapeINTEL",e[e.SubgroupAvcSicGetBestIpeLumaDistortionINTEL=5810]="SubgroupAvcSicGetBestIpeLumaDistortionINTEL",e[e.SubgroupAvcSicGetBestIpeChromaDistortionINTEL=5811]="SubgroupAvcSicGetBestIpeChromaDistortionINTEL",e[e.SubgroupAvcSicGetPackedIpeLumaModesINTEL=5812]="SubgroupAvcSicGetPackedIpeLumaModesINTEL",e[e.SubgroupAvcSicGetIpeChromaModeINTEL=5813]="SubgroupAvcSicGetIpeChromaModeINTEL",e[e.SubgroupAvcSicGetPackedSkcLumaCountThresholdINTEL=5814]="SubgroupAvcSicGetPackedSkcLumaCountThresholdINTEL",e[e.SubgroupAvcSicGetPackedSkcLumaSumThresholdINTEL=5815]="SubgroupAvcSicGetPackedSkcLumaSumThresholdINTEL",e[e.SubgroupAvcSicGetInterRawSadsINTEL=5816]="SubgroupAvcSicGetInterRawSadsINTEL",e[e.LoopControlINTEL=5887]="LoopControlINTEL",e[e.ReadPipeBlockingINTEL=5946]="ReadPipeBlockingINTEL",e[e.WritePipeBlockingINTEL=5947]="WritePipeBlockingINTEL",e[e.FPGARegINTEL=5949]="FPGARegINTEL",e[e.RayQueryGetRayTMinKHR=6016]="RayQueryGetRayTMinKHR",e[e.RayQueryGetRayFlagsKHR=6017]="RayQueryGetRayFlagsKHR",e[e.RayQueryGetIntersectionTKHR=6018]="RayQueryGetIntersectionTKHR",e[e.RayQueryGetIntersectionInstanceCustomIndexKHR=6019]="RayQueryGetIntersectionInstanceCustomIndexKHR",e[e.RayQueryGetIntersectionInstanceIdKHR=6020]="RayQueryGetIntersectionInstanceIdKHR",e[e.RayQueryGetIntersectionInstanceShaderBindingTableRecordOffsetKHR=6021]="RayQueryGetIntersectionInstanceShaderBindingTableRecordOffsetKHR",e[e.RayQueryGetIntersectionGeometryIndexKHR=6022]="RayQueryGetIntersectionGeometryIndexKHR",e[e.RayQueryGetIntersectionPrimitiveIndexKHR=6023]="RayQueryGetIntersectionPrimitiveIndexKHR",e[e.RayQueryGetIntersectionBarycentricsKHR=6024]="RayQueryGetIntersectionBarycentricsKHR",e[e.RayQueryGetIntersectionFrontFaceKHR=6025]="RayQueryGetIntersectionFrontFaceKHR",e[e.RayQueryGetIntersectionCandidateAABBOpaqueKHR=6026]="RayQueryGetIntersectionCandidateAABBOpaqueKHR",e[e.RayQueryGetIntersectionObjectRayDirectionKHR=6027]="RayQueryGetIntersectionObjectRayDirectionKHR",e[e.RayQueryGetIntersectionObjectRayOriginKHR=6028]="RayQueryGetIntersectionObjectRayOriginKHR",e[e.RayQueryGetWorldRayDirectionKHR=6029]="RayQueryGetWorldRayDirectionKHR",e[e.RayQueryGetWorldRayOriginKHR=6030]="RayQueryGetWorldRayOriginKHR",e[e.RayQueryGetIntersectionObjectToWorldKHR=6031]="RayQueryGetIntersectionObjectToWorldKHR",e[e.RayQueryGetIntersectionWorldToObjectKHR=6032]="RayQueryGetIntersectionWorldToObjectKHR",e[e.AtomicFAddEXT=6035]="AtomicFAddEXT",e[e.Max=2147483647]="Max"}(re||(re={}));var pe=function(){this.version=0,this.es=!1,this.known=!1,this.hlsl=!1},ue=function(){function e(e){this.lock=e,this.lock.set(this.lock.get()+1)}return e.prototype.dispose=function(){this.lock.set(this.lock.get()-1)},e}(),he=function(){function e(){this.ids=[],this.meta=[],this.ids_for_type=new Array(t.Count),this.ids_for_constant_or_type=[],this.ids_for_constant_or_variable=[],this.load_type_width=[],this.declared_capabilities=[],this.declared_extensions=[],this.block_meta=[],this.continue_block_to_loop_header=[],this.entry_points=[],this.default_entry_point=0,this.source=new pe,this.addressing_model=$.Max,this.memory_model=ee.Max,this.loop_iteration_depth_hard=0,this.loop_iteration_depth_soft=0,this.empty_string="",this.cleared_bitset=new y,this.meta_needing_name_fixup=new Set;for(var e=0;e<this.ids_for_type.length;++e)this.ids_for_type[e]=[];this.pool_group=new u,this.pool_group.pools[t.Type]=new H(R),this.pool_group.pools[t.Variable]=new H(T),this.pool_group.pools[t.Constant]=new H(O),this.pool_group.pools[t.Function]=new H(j),this.pool_group.pools[t.FunctionPrototype]=new H(W),this.pool_group.pools[t.Block]=new H(J),this.pool_group.pools[t.Extension]=new H(ie),this.pool_group.pools[t.Expression]=new H(ae),this.pool_group.pools[t.ConstantOp]=new H(V),this.pool_group.pools[t.CombinedImageSampler]=new H(se),this.pool_group.pools[t.AccessChain]=new H(oe),this.pool_group.pools[t.Undef]=new H(ne),this.pool_group.pools[t.String]=new H(_e)}return e.prototype.set_id_bounds=function(e){var t=this;this.ids=o(e,(function(){return new c(t.pool_group)})),this.block_meta=o(e,(function(){return 0}))},e.prototype.set_name=function(e,t){this.get_meta(e).decoration.alias=t,me(t)&&!be(t,!1,!1)||this.meta_needing_name_fixup.add(e)},e.prototype.get_name=function(e){var t=this.find_meta(e);return t?t.decoration.alias:this.empty_string},e.prototype.set_decoration=function(e,t,r){void 0===r&&(r=0);var i=this.get_meta(e).decoration;switch(i.decoration_flags.set(t),t){case te.BuiltIn:i.builtin=!0,i.builtin_type=r;break;case te.Location:i.location=r;break;case te.Component:i.component=r;break;case te.Offset:i.offset=r;break;case te.XfbBuffer:i.xfb_buffer=r;break;case te.XfbStride:i.xfb_stride=r;break;case te.Stream:i.stream=r;break;case te.ArrayStride:i.array_stride=r;break;case te.MatrixStride:i.matrix_stride=r;break;case te.Binding:i.binding=r;break;case te.DescriptorSet:i.set=r;break;case te.InputAttachmentIndex:i.input_attachment=r;break;case te.SpecId:i.spec_id=r;break;case te.Index:i.index=r;break;case te.HlslCounterBufferGOOGLE:this.get_meta(e).hlsl_magic_counter_buffer=r,this.meta[r].hlsl_is_magic_counter_buffer=!0;break;case te.FPRoundingMode:i.fp_rounding_mode=r}},e.prototype.set_decoration_string=function(e,t,r){var i=this.get_meta(e).decoration;if(i.decoration_flags.set(t),t===te.HlslSemanticGOOGLE)i.hlsl_semantic=r},e.prototype.has_decoration=function(e,t){return this.get_decoration_bitset(e).get(t)},e.prototype.get_decoration=function(e,t){var r=this.find_meta(e);if(!r)return 0;var i=r.decoration;if(!i.decoration_flags.get(t))return 0;switch(t){case te.BuiltIn:return i.builtin_type;case te.Location:return i.location;case te.Component:return i.component;case te.Offset:return i.offset;case te.XfbBuffer:return i.xfb_buffer;case te.XfbStride:return i.xfb_stride;case te.Stream:return i.stream;case te.Binding:return i.binding;case te.DescriptorSet:return i.set;case te.InputAttachmentIndex:return i.input_attachment;case te.SpecId:return i.spec_id;case te.ArrayStride:return i.array_stride;case te.MatrixStride:return i.matrix_stride;case te.Index:return i.index;case te.FPRoundingMode:return i.fp_rounding_mode;default:return 1}},e.prototype.get_decoration_string=function(e,t){var r=this.find_meta(e);if(!r)return this.empty_string;var i=r.decoration;return i.decoration_flags.get(t)&&t===te.HlslSemanticGOOGLE?i.hlsl_semantic:this.empty_string},e.prototype.get_decoration_bitset=function(e){var t=this.find_meta(e);return t?t.decoration.decoration_flags:this.cleared_bitset},e.prototype.unset_decoration=function(e,t){var r=this.get_meta(e).decoration;switch(r.decoration_flags.clear(t),t){case te.BuiltIn:r.builtin=!1;break;case te.Location:r.location=0;break;case te.Component:r.component=0;break;case te.Offset:r.offset=0;break;case te.XfbBuffer:r.xfb_buffer=0;break;case te.XfbStride:r.xfb_stride=0;break;case te.Stream:r.stream=0;break;case te.Binding:r.binding=0;break;case te.DescriptorSet:r.set=0;break;case te.InputAttachmentIndex:r.input_attachment=0;break;case te.SpecId:r.spec_id=0;break;case te.HlslSemanticGOOGLE:r.hlsl_semantic="";break;case te.FPRoundingMode:r.fp_rounding_mode=g.Max;break;case te.HlslCounterBufferGOOGLE:var i=this.get_meta(e),a=i.hlsl_magic_counter_buffer;a&&(this.meta[a].hlsl_is_magic_counter_buffer=!1,i.hlsl_magic_counter_buffer=0)}},e.prototype.resize_members=function(e,t){var r=e.length;e.length=t;for(var i=r;i<t;++i)e[i]=new I},e.prototype.set_member_name=function(e,t,r){var i=this.get_meta(e);this.resize_members(i.members,Math.max(i.members.length,t+1)),i.members[t].alias=r,me(r)&&!be(r,!0,!1)||this.meta_needing_name_fixup.add(e)},e.prototype.get_member_name=function(e,t){var r=this.find_meta(e);return r?t>=r.members.length?this.empty_string:r.members[t].alias:this.empty_string},e.prototype.set_member_decoration=function(e,t,r,i){void 0===i&&(i=0);var a=this.get_meta(e);this.resize_members(a.members,Math.max(a.members.length,t+1));var s=a.members[t];switch(s.decoration_flags.set(r),r){case te.BuiltIn:s.builtin=!0,s.builtin_type=i;break;case te.Location:s.location=i;break;case te.Component:s.component=i;break;case te.Binding:s.binding=i;break;case te.Offset:s.offset=i;break;case te.XfbBuffer:s.xfb_buffer=i;break;case te.XfbStride:s.xfb_stride=i;break;case te.Stream:s.stream=i;break;case te.SpecId:s.spec_id=i;break;case te.MatrixStride:s.matrix_stride=i;break;case te.Index:s.index=i}},e.prototype.set_member_decoration_string=function(e,t,r,i){var a=this.get_meta(e);this.resize_members(a.members,Math.max(a.members.length,t+1));var s=a.members[t];if(s.decoration_flags.set(r),r===te.HlslSemanticGOOGLE)s.hlsl_semantic=i},e.prototype.get_member_decoration=function(e,t,r){var i=this.find_meta(e);if(!i)return 0;if(t>=i.members.length)return 0;var a=i.members[t];if(!a.decoration_flags.get(r))return 0;switch(r){case te.BuiltIn:return a.builtin_type;case te.Location:return a.location;case te.Component:return a.component;case te.Binding:return a.binding;case te.Offset:return a.offset;case te.XfbBuffer:return a.xfb_buffer;case te.XfbStride:return a.xfb_stride;case te.Stream:return a.stream;case te.SpecId:return a.spec_id;case te.Index:return a.index;default:return 1}},e.prototype.get_member_decoration_string=function(e,t,r){var i=this.find_meta(e);if(i){if(!this.has_member_decoration(e,t,r))return this.empty_string;var a=i.members[t];return r===te.HlslSemanticGOOGLE?a.hlsl_semantic:this.empty_string}return this.empty_string},e.prototype.has_member_decoration=function(e,t,r){return this.get_member_decoration_bitset(e,t).get(r)},e.prototype.get_member_decoration_bitset=function(e,t){var r=this.find_meta(e);return r?t>=r.members.length?this.cleared_bitset.clone():r.members[t].decoration_flags:this.cleared_bitset.clone()},e.prototype.unset_member_decoration=function(e,t,r){var i=this.get_meta(e);if(!(t>=i.members.length)){var a=i.members[t];switch(a.decoration_flags.clear(r),r){case te.BuiltIn:a.builtin=!1;break;case te.Location:a.location=0;break;case te.Component:a.component=0;break;case te.Offset:a.offset=0;break;case te.XfbBuffer:a.xfb_buffer=0;break;case te.XfbStride:a.xfb_stride=0;break;case te.Stream:a.stream=0;break;case te.SpecId:a.spec_id=0;break;case te.HlslSemanticGOOGLE:a.hlsl_semantic=""}}},e.prototype.mark_used_as_array_length=function(e){switch(this.ids[e].get_type()){case t.Constant:this.get(O,e).is_used_as_array_length=!0;break;case t.ConstantOp:var r=this.get(V,e);if(r.opcode===re.CompositeExtract)this.mark_used_as_array_length(r.arguments[0]);else if(r.opcode===re.CompositeInsert)this.mark_used_as_array_length(r.arguments[0]),this.mark_used_as_array_length(r.arguments[1]);else for(var i=0,a=r.arguments;i<a.length;i++){var s=a[i];this.mark_used_as_array_length(s)}break;case t.Undef:break;default:throw new Error("Shouldn't reach this branch")}},e.prototype.get_buffer_block_flags=function(e){var t,r=this.get(R,e.basetype);if(r.basetype!==E.Struct)throw new Error("Assertion failure");var i=this.find_meta(e.self);if(t=i?i.decoration.decoration_flags.clone():new y,0===r.member_types.length)return(null==t?void 0:t.clone())||new y;var a=this.get_buffer_block_type_flags(r);return t.merge_or(a),t},e.prototype.get_buffer_block_type_flags=function(e){if(0===e.member_types.length)return new y;for(var t=this.get_member_decoration_bitset(e.self,0).clone(),r=1;r<e.member_types.length;r++)t.merge_and(this.get_member_decoration_bitset(e.self,r));return t},e.prototype.add_typed_id=function(e,r){if(0!==this.loop_iteration_depth_hard)throw new Error("Cannot add typed ID while looping over it.");var i=this.ids[r];if(0!==this.loop_iteration_depth_soft&&!i.empty())throw new Error("Cannot override IDs when loop is soft locked.");if(i.empty()||i.get_type()!==e)switch(e){case t.Constant:this.ids_for_constant_or_variable.push(r),this.ids_for_constant_or_type.push(r);break;case t.Variable:this.ids_for_constant_or_variable.push(r);break;case t.Type:case t.ConstantOp:this.ids_for_constant_or_type.push(r)}i.empty()?this.ids_for_type[e].push(r):i.get_type()!==e&&(this.remove_typed_id(i.get_type(),r),this.ids_for_type[e].push(r))},e.prototype.remove_typed_id=function(e,t){!function(e,t){for(var r=e.indexOf(t);r>=0;r=e.indexOf(t))e.splice(r,1)}(this.ids_for_type[e],t)},e.prototype.create_loop_hard_lock=function(){return new ue(new k(this,"loop_iteration_depth_hard"))},e.prototype.create_loop_soft_lock=function(){return new ue(new k(this,"loop_iteration_depth_soft"))},e.prototype.for_each_typed_id=function(e,t){for(var r=this.create_loop_hard_lock(),i=0,a=this.ids_for_type[e.type];i<a.length;i++){var s=a[i];this.ids[s].get_type()===e.type&&t(s,this.get(e,s))}r.dispose()},e.prototype.reset_all_of_type=function(e){if("number"==typeof e){for(var t=0,r=this.ids_for_type[e];t<r.length;t++){var i=r[t];this.ids[i].get_type()===e&&this.ids[i].reset()}this.ids_for_type[e]=[]}else this.reset_all_of_type(e.type)},e.prototype.get_meta=function(e){return this.meta[e]||(this.meta[e]=new x),this.meta[e]},e.prototype.find_meta=function(e){return this.meta[e]},e.prototype.get_empty_string=function(){return this.empty_string},e.prototype.make_constant_null=function(e,r,i){var a=this.get(R,r);if(a.pointer)i&&this.add_typed_id(t.Constant,e),(c=p(O,this.ids[e],r)).self=e,c.make_null(a);else if(0!==a.array.length){console.assert(a.parent_type);var s=this.increase_bound_by(1);this.make_constant_null(s,a.parent_type,i);for(var o=[],n=0;n<a.array.length;n++)o[n]=s;i&&this.add_typed_id(t.Constant,e),p(O,this.ids[e],r,o,o.length,!1).self=e}else if(0!==a.member_types.length){var _=this.increase_bound_by(a.member_types.length);for(o=[],n=0;n<a.member_types.length;n++)this.make_constant_null(_+n,a.member_types[n],i),o[n]=_+n;i&&this.add_typed_id(t.Constant,e),p(O,this.ids[e],r,o,o.length,!1).self=e}else{var c;i&&this.add_typed_id(t.Constant,e),(c=p(O,this.ids[e],r)).self=e,c.make_null(a)}},e.prototype.fixup_reserved_names=function(){for(var t=this.meta_needing_name_fixup.values(),r=null;r=t.next().value;){var i=this.get_meta(r);i.decoration.alias=e.sanitize_identifier(i.decoration.alias,!1,!1);for(var a=0,s=i.members;a<s.length;a++){var o=s[a];o.alias=e.sanitize_identifier(o.alias,!0,!1)}}this.meta_needing_name_fixup.clear()},e.sanitize_identifier=function(e,t,r){return me(e)||(e=ye(e)),be(e,t,r)&&(e=function(e){return ge(e)?"_RESERVED_IDENTIFIER_FIXUP_"+e:"_RESERVED_IDENTIFIER_FIXUP"+e}(e)),e},e.sanitize_underscores=function(e){return e.replace(/_+/g,"_")},e.is_globally_reserved_identifier=function(e,t){return be(e,!1,t)},e.prototype.increase_bound_by=function(e){var t=this.ids.length,r=t+e;this.ids.length+=e;for(var i=0;i<e;i++)this.ids[i]=new c(this.pool_group);return this.block_meta.length=r,t},e.prototype.get_spirv_version=function(){return this.spirv[1]},e.prototype.get=function(e,t){return l(e,this.ids[t])},e}();function fe(e){return e>="0"&&e<="9"}function de(e){return function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}(e)||fe(e)}function me(e){if(""===e)return!0;if(fe(e[0]))return!1;for(var t=0;t<e.length;++t){if(!de(i=e.charAt(t))&&"_"!==i)return!1}var r=!1;for(t=0;t<e.length;++t){var i,a="_"===(i=e.charAt(t));if(a&&r)return!1;r=a}return!0}function ge(e){var t=e.substring(0,3);return"gl_"===t||"spv"===t}function be(e,t,r){if(!r&&ge(e))return!0;if(t){if(e.length<3)return!1;if("_m"===e.substring(0,2))return!1;for(var i=2;i<e.length&&fe(e[i]);)i++;return i===e.length}if(e.length<2)return!1;if("_"!==e.charAt(0)||!fe(e.charAt(1)))return!1;for(i=2;i<e.length&&fe(e[i]);)i++;return i===e.length||i<e.length&&"_"===e[i]}function ye(e){var t=e.substring(0,e.indexOf("("));if(0===t.length)return t;fe(t.charAt(0))&&(t="_"+t.substring(1));for(var r=0;r<t.length;++r){var i=t.charAt(r);de(i)||"_"===i||(t=ce(t,r,"_"))}return he.sanitize_underscores(t)}var ve,Se=function(){function e(){this.op=0,this.count=0,this.offset=0,this.length=0}return e.prototype.is_embedded=function(){return 0===this.offset},e}(),Ie=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.ops=[],t}return a(t,e),t}(Se),xe=function(){function e(e,t){this.first=e,this.second=t}return e.prototype.equals=function(e){return this.first===e.first&&this.second===e.second},e.prototype.clone=function(){var t=new e;return h(this,t),t},e}();!function(e){e[e.Vertex=0]="Vertex",e[e.TessellationControl=1]="TessellationControl",e[e.TessellationEvaluation=2]="TessellationEvaluation",e[e.Geometry=3]="Geometry",e[e.Fragment=4]="Fragment",e[e.GLCompute=5]="GLCompute",e[e.Kernel=6]="Kernel",e[e.TaskNV=5267]="TaskNV",e[e.MeshNV=5268]="MeshNV",e[e.RayGenerationKHR=5313]="RayGenerationKHR",e[e.RayGenerationNV=5313]="RayGenerationNV",e[e.IntersectionKHR=5314]="IntersectionKHR",e[e.IntersectionNV=5314]="IntersectionNV",e[e.AnyHitKHR=5315]="AnyHitKHR",e[e.AnyHitNV=5315]="AnyHitNV",e[e.ClosestHitKHR=5316]="ClosestHitKHR",e[e.ClosestHitNV=5316]="ClosestHitNV",e[e.MissKHR=5317]="MissKHR",e[e.MissNV=5317]="MissNV",e[e.CallableKHR=5318]="CallableKHR",e[e.CallableNV=5318]="CallableNV",e[e.Max=2147483647]="Max"}(ve||(ve={}));var ke,we,Ee,Te,Le,Re,Ne,Ae=function(){function e(){this.x=0,this.y=0,this.z=0,this.id_x=0,this.id_y=0,this.id_z=0,this.constant=0}return e.prototype.clone=function(){return f(e,this)},e}(),Ce=function e(t,r,i){this.self=0,this.interface_variables=[],this.flags=new y,this.workgroup_size=new Ae,this.invocations=0,this.output_vertices=0,this.model=ve.Max,this.geometry_passthrough=!1,t instanceof e?h(t,this):(this.self=t,this.name=i,this.orig_name=i,this.model=r)},Pe=119734787;!function(e){e[e.Unknown=0]="Unknown",e[e.ESSL=1]="ESSL",e[e.GLSL=2]="GLSL",e[e.OpenCL_C=3]="OpenCL_C",e[e.OpenCL_CPP=4]="OpenCL_CPP",e[e.HLSL=5]="HLSL",e[e.Max=2147483647]="Max"}(ke||(ke={})),function(e){e[e.Matrix=0]="Matrix",e[e.Shader=1]="Shader",e[e.Geometry=2]="Geometry",e[e.Tessellation=3]="Tessellation",e[e.Addresses=4]="Addresses",e[e.Linkage=5]="Linkage",e[e.Kernel=6]="Kernel",e[e.Vector16=7]="Vector16",e[e.Float16Buffer=8]="Float16Buffer",e[e.Float16=9]="Float16",e[e.Float64=10]="Float64",e[e.Int64=11]="Int64",e[e.Int64Atomics=12]="Int64Atomics",e[e.ImageBasic=13]="ImageBasic",e[e.ImageReadWrite=14]="ImageReadWrite",e[e.ImageMipmap=15]="ImageMipmap",e[e.Pipes=17]="Pipes",e[e.Groups=18]="Groups",e[e.DeviceEnqueue=19]="DeviceEnqueue",e[e.LiteralSampler=20]="LiteralSampler",e[e.AtomicStorage=21]="AtomicStorage",e[e.Int16=22]="Int16",e[e.TessellationPointSize=23]="TessellationPointSize",e[e.GeometryPointSize=24]="GeometryPointSize",e[e.ImageGatherExtended=25]="ImageGatherExtended",e[e.StorageImageMultisample=27]="StorageImageMultisample",e[e.UniformBufferArrayDynamicIndexing=28]="UniformBufferArrayDynamicIndexing",e[e.SampledImageArrayDynamicIndexing=29]="SampledImageArrayDynamicIndexing",e[e.StorageBufferArrayDynamicIndexing=30]="StorageBufferArrayDynamicIndexing",e[e.StorageImageArrayDynamicIndexing=31]="StorageImageArrayDynamicIndexing",e[e.ClipDistance=32]="ClipDistance",e[e.CullDistance=33]="CullDistance",e[e.ImageCubeArray=34]="ImageCubeArray",e[e.SampleRateShading=35]="SampleRateShading",e[e.ImageRect=36]="ImageRect",e[e.SampledRect=37]="SampledRect",e[e.GenericPointer=38]="GenericPointer",e[e.Int8=39]="Int8",e[e.InputAttachment=40]="InputAttachment",e[e.SparseResidency=41]="SparseResidency",e[e.MinLod=42]="MinLod",e[e.Sampled1D=43]="Sampled1D",e[e.Image1D=44]="Image1D",e[e.SampledCubeArray=45]="SampledCubeArray",e[e.SampledBuffer=46]="SampledBuffer",e[e.ImageBuffer=47]="ImageBuffer",e[e.ImageMSArray=48]="ImageMSArray",e[e.StorageImageExtendedFormats=49]="StorageImageExtendedFormats",e[e.ImageQuery=50]="ImageQuery",e[e.DerivativeControl=51]="DerivativeControl",e[e.InterpolationFunction=52]="InterpolationFunction",e[e.TransformFeedback=53]="TransformFeedback",e[e.GeometryStreams=54]="GeometryStreams",e[e.StorageImageReadWithoutFormat=55]="StorageImageReadWithoutFormat",e[e.StorageImageWriteWithoutFormat=56]="StorageImageWriteWithoutFormat",e[e.MultiViewport=57]="MultiViewport",e[e.SubgroupDispatch=58]="SubgroupDispatch",e[e.NamedBarrier=59]="NamedBarrier",e[e.PipeStorage=60]="PipeStorage",e[e.GroupNonUniform=61]="GroupNonUniform",e[e.GroupNonUniformVote=62]="GroupNonUniformVote",e[e.GroupNonUniformArithmetic=63]="GroupNonUniformArithmetic",e[e.GroupNonUniformBallot=64]="GroupNonUniformBallot",e[e.GroupNonUniformShuffle=65]="GroupNonUniformShuffle",e[e.GroupNonUniformShuffleRelative=66]="GroupNonUniformShuffleRelative",e[e.GroupNonUniformClustered=67]="GroupNonUniformClustered",e[e.GroupNonUniformQuad=68]="GroupNonUniformQuad",e[e.ShaderLayer=69]="ShaderLayer",e[e.ShaderViewportIndex=70]="ShaderViewportIndex",e[e.FragmentShadingRateKHR=4422]="FragmentShadingRateKHR",e[e.SubgroupBallotKHR=4423]="SubgroupBallotKHR",e[e.DrawParameters=4427]="DrawParameters",e[e.SubgroupVoteKHR=4431]="SubgroupVoteKHR",e[e.StorageBuffer16BitAccess=4433]="StorageBuffer16BitAccess",e[e.StorageUniformBufferBlock16=4433]="StorageUniformBufferBlock16",e[e.StorageUniform16=4434]="StorageUniform16",e[e.UniformAndStorageBuffer16BitAccess=4434]="UniformAndStorageBuffer16BitAccess",e[e.StoragePushConstant16=4435]="StoragePushConstant16",e[e.StorageInputOutput16=4436]="StorageInputOutput16",e[e.DeviceGroup=4437]="DeviceGroup",e[e.MultiView=4439]="MultiView",e[e.VariablePointersStorageBuffer=4441]="VariablePointersStorageBuffer",e[e.VariablePointers=4442]="VariablePointers",e[e.AtomicStorageOps=4445]="AtomicStorageOps",e[e.SampleMaskPostDepthCoverage=4447]="SampleMaskPostDepthCoverage",e[e.StorageBuffer8BitAccess=4448]="StorageBuffer8BitAccess",e[e.UniformAndStorageBuffer8BitAccess=4449]="UniformAndStorageBuffer8BitAccess",e[e.StoragePushConstant8=4450]="StoragePushConstant8",e[e.DenormPreserve=4464]="DenormPreserve",e[e.DenormFlushToZero=4465]="DenormFlushToZero",e[e.SignedZeroInfNanPreserve=4466]="SignedZeroInfNanPreserve",e[e.RoundingModeRTE=4467]="RoundingModeRTE",e[e.RoundingModeRTZ=4468]="RoundingModeRTZ",e[e.RayQueryProvisionalKHR=4471]="RayQueryProvisionalKHR",e[e.RayQueryKHR=4472]="RayQueryKHR",e[e.RayTraversalPrimitiveCullingKHR=4478]="RayTraversalPrimitiveCullingKHR",e[e.RayTracingKHR=4479]="RayTracingKHR",e[e.Float16ImageAMD=5008]="Float16ImageAMD",e[e.ImageGatherBiasLodAMD=5009]="ImageGatherBiasLodAMD",e[e.FragmentMaskAMD=5010]="FragmentMaskAMD",e[e.StencilExportEXT=5013]="StencilExportEXT",e[e.ImageReadWriteLodAMD=5015]="ImageReadWriteLodAMD",e[e.Int64ImageEXT=5016]="Int64ImageEXT",e[e.ShaderClockKHR=5055]="ShaderClockKHR",e[e.SampleMaskOverrideCoverageNV=5249]="SampleMaskOverrideCoverageNV",e[e.GeometryShaderPassthroughNV=5251]="GeometryShaderPassthroughNV",e[e.ShaderViewportIndexLayerEXT=5254]="ShaderViewportIndexLayerEXT",e[e.ShaderViewportIndexLayerNV=5254]="ShaderViewportIndexLayerNV",e[e.ShaderViewportMaskNV=5255]="ShaderViewportMaskNV",e[e.ShaderStereoViewNV=5259]="ShaderStereoViewNV",e[e.PerViewAttributesNV=5260]="PerViewAttributesNV",e[e.FragmentFullyCoveredEXT=5265]="FragmentFullyCoveredEXT",e[e.MeshShadingNV=5266]="MeshShadingNV",e[e.ImageFootprintNV=5282]="ImageFootprintNV",e[e.FragmentBarycentricNV=5284]="FragmentBarycentricNV",e[e.ComputeDerivativeGroupQuadsNV=5288]="ComputeDerivativeGroupQuadsNV",e[e.FragmentDensityEXT=5291]="FragmentDensityEXT",e[e.ShadingRateNV=5291]="ShadingRateNV",e[e.GroupNonUniformPartitionedNV=5297]="GroupNonUniformPartitionedNV",e[e.ShaderNonUniform=5301]="ShaderNonUniform",e[e.ShaderNonUniformEXT=5301]="ShaderNonUniformEXT",e[e.RuntimeDescriptorArray=5302]="RuntimeDescriptorArray",e[e.RuntimeDescriptorArrayEXT=5302]="RuntimeDescriptorArrayEXT",e[e.InputAttachmentArrayDynamicIndexing=5303]="InputAttachmentArrayDynamicIndexing",e[e.InputAttachmentArrayDynamicIndexingEXT=5303]="InputAttachmentArrayDynamicIndexingEXT",e[e.UniformTexelBufferArrayDynamicIndexing=5304]="UniformTexelBufferArrayDynamicIndexing",e[e.UniformTexelBufferArrayDynamicIndexingEXT=5304]="UniformTexelBufferArrayDynamicIndexingEXT",e[e.StorageTexelBufferArrayDynamicIndexing=5305]="StorageTexelBufferArrayDynamicIndexing",e[e.StorageTexelBufferArrayDynamicIndexingEXT=5305]="StorageTexelBufferArrayDynamicIndexingEXT",e[e.UniformBufferArrayNonUniformIndexing=5306]="UniformBufferArrayNonUniformIndexing",e[e.UniformBufferArrayNonUniformIndexingEXT=5306]="UniformBufferArrayNonUniformIndexingEXT",e[e.SampledImageArrayNonUniformIndexing=5307]="SampledImageArrayNonUniformIndexing",e[e.SampledImageArrayNonUniformIndexingEXT=5307]="SampledImageArrayNonUniformIndexingEXT",e[e.StorageBufferArrayNonUniformIndexing=5308]="StorageBufferArrayNonUniformIndexing",e[e.StorageBufferArrayNonUniformIndexingEXT=5308]="StorageBufferArrayNonUniformIndexingEXT",e[e.StorageImageArrayNonUniformIndexing=5309]="StorageImageArrayNonUniformIndexing",e[e.StorageImageArrayNonUniformIndexingEXT=5309]="StorageImageArrayNonUniformIndexingEXT",e[e.InputAttachmentArrayNonUniformIndexing=5310]="InputAttachmentArrayNonUniformIndexing",e[e.InputAttachmentArrayNonUniformIndexingEXT=5310]="InputAttachmentArrayNonUniformIndexingEXT",e[e.UniformTexelBufferArrayNonUniformIndexing=5311]="UniformTexelBufferArrayNonUniformIndexing",e[e.UniformTexelBufferArrayNonUniformIndexingEXT=5311]="UniformTexelBufferArrayNonUniformIndexingEXT",e[e.StorageTexelBufferArrayNonUniformIndexing=5312]="StorageTexelBufferArrayNonUniformIndexing",e[e.StorageTexelBufferArrayNonUniformIndexingEXT=5312]="StorageTexelBufferArrayNonUniformIndexingEXT",e[e.RayTracingNV=5340]="RayTracingNV",e[e.VulkanMemoryModel=5345]="VulkanMemoryModel",e[e.VulkanMemoryModelKHR=5345]="VulkanMemoryModelKHR",e[e.VulkanMemoryModelDeviceScope=5346]="VulkanMemoryModelDeviceScope",e[e.VulkanMemoryModelDeviceScopeKHR=5346]="VulkanMemoryModelDeviceScopeKHR",e[e.PhysicalStorageBufferAddresses=5347]="PhysicalStorageBufferAddresses",e[e.PhysicalStorageBufferAddressesEXT=5347]="PhysicalStorageBufferAddressesEXT",e[e.ComputeDerivativeGroupLinearNV=5350]="ComputeDerivativeGroupLinearNV",e[e.RayTracingProvisionalKHR=5353]="RayTracingProvisionalKHR",e[e.CooperativeMatrixNV=5357]="CooperativeMatrixNV",e[e.FragmentShaderSampleInterlockEXT=5363]="FragmentShaderSampleInterlockEXT",e[e.FragmentShaderShadingRateInterlockEXT=5372]="FragmentShaderShadingRateInterlockEXT",e[e.ShaderSMBuiltinsNV=5373]="ShaderSMBuiltinsNV",e[e.FragmentShaderPixelInterlockEXT=5378]="FragmentShaderPixelInterlockEXT",e[e.DemoteToHelperInvocationEXT=5379]="DemoteToHelperInvocationEXT",e[e.SubgroupShuffleINTEL=5568]="SubgroupShuffleINTEL",e[e.SubgroupBufferBlockIOINTEL=5569]="SubgroupBufferBlockIOINTEL",e[e.SubgroupImageBlockIOINTEL=5570]="SubgroupImageBlockIOINTEL",e[e.SubgroupImageMediaBlockIOINTEL=5579]="SubgroupImageMediaBlockIOINTEL",e[e.IntegerFunctions2INTEL=5584]="IntegerFunctions2INTEL",e[e.FunctionPointersINTEL=5603]="FunctionPointersINTEL",e[e.IndirectReferencesINTEL=5604]="IndirectReferencesINTEL",e[e.SubgroupAvcMotionEstimationINTEL=5696]="SubgroupAvcMotionEstimationINTEL",e[e.SubgroupAvcMotionEstimationIntraINTEL=5697]="SubgroupAvcMotionEstimationIntraINTEL",e[e.SubgroupAvcMotionEstimationChromaINTEL=5698]="SubgroupAvcMotionEstimationChromaINTEL",e[e.FPGAMemoryAttributesINTEL=5824]="FPGAMemoryAttributesINTEL",e[e.UnstructuredLoopControlsINTEL=5886]="UnstructuredLoopControlsINTEL",e[e.FPGALoopControlsINTEL=5888]="FPGALoopControlsINTEL",e[e.KernelAttributesINTEL=5892]="KernelAttributesINTEL",e[e.FPGAKernelAttributesINTEL=5897]="FPGAKernelAttributesINTEL",e[e.BlockingPipesINTEL=5945]="BlockingPipesINTEL",e[e.FPGARegINTEL=5948]="FPGARegINTEL",e[e.AtomicFloat32AddEXT=6033]="AtomicFloat32AddEXT",e[e.AtomicFloat64AddEXT=6034]="AtomicFloat64AddEXT",e[e.Max=2147483647]="Max"}(we||(we={})),function(e){e[e.Invocations=0]="Invocations",e[e.SpacingEqual=1]="SpacingEqual",e[e.SpacingFractionalEven=2]="SpacingFractionalEven",e[e.SpacingFractionalOdd=3]="SpacingFractionalOdd",e[e.VertexOrderCw=4]="VertexOrderCw",e[e.VertexOrderCcw=5]="VertexOrderCcw",e[e.PixelCenterInteger=6]="PixelCenterInteger",e[e.OriginUpperLeft=7]="OriginUpperLeft",e[e.OriginLowerLeft=8]="OriginLowerLeft",e[e.EarlyFragmentTests=9]="EarlyFragmentTests",e[e.PointMode=10]="PointMode",e[e.Xfb=11]="Xfb",e[e.DepthReplacing=12]="DepthReplacing",e[e.DepthGreater=14]="DepthGreater",e[e.DepthLess=15]="DepthLess",e[e.DepthUnchanged=16]="DepthUnchanged",e[e.LocalSize=17]="LocalSize",e[e.LocalSizeHint=18]="LocalSizeHint",e[e.InputPoints=19]="InputPoints",e[e.InputLines=20]="InputLines",e[e.InputLinesAdjacency=21]="InputLinesAdjacency",e[e.Triangles=22]="Triangles",e[e.InputTrianglesAdjacency=23]="InputTrianglesAdjacency",e[e.Quads=24]="Quads",e[e.Isolines=25]="Isolines",e[e.OutputVertices=26]="OutputVertices",e[e.OutputPoints=27]="OutputPoints",e[e.OutputLineStrip=28]="OutputLineStrip",e[e.OutputTriangleStrip=29]="OutputTriangleStrip",e[e.VecTypeHint=30]="VecTypeHint",e[e.ContractionOff=31]="ContractionOff",e[e.Initializer=33]="Initializer",e[e.Finalizer=34]="Finalizer",e[e.SubgroupSize=35]="SubgroupSize",e[e.SubgroupsPerWorkgroup=36]="SubgroupsPerWorkgroup",e[e.SubgroupsPerWorkgroupId=37]="SubgroupsPerWorkgroupId",e[e.LocalSizeId=38]="LocalSizeId",e[e.LocalSizeHintId=39]="LocalSizeHintId",e[e.PostDepthCoverage=4446]="PostDepthCoverage",e[e.DenormPreserve=4459]="DenormPreserve",e[e.DenormFlushToZero=4460]="DenormFlushToZero",e[e.SignedZeroInfNanPreserve=4461]="SignedZeroInfNanPreserve",e[e.RoundingModeRTE=4462]="RoundingModeRTE",e[e.RoundingModeRTZ=4463]="RoundingModeRTZ",e[e.StencilRefReplacingEXT=5027]="StencilRefReplacingEXT",e[e.OutputLinesNV=5269]="OutputLinesNV",e[e.OutputPrimitivesNV=5270]="OutputPrimitivesNV",e[e.DerivativeGroupQuadsNV=5289]="DerivativeGroupQuadsNV",e[e.DerivativeGroupLinearNV=5290]="DerivativeGroupLinearNV",e[e.OutputTrianglesNV=5298]="OutputTrianglesNV",e[e.PixelInterlockOrderedEXT=5366]="PixelInterlockOrderedEXT",e[e.PixelInterlockUnorderedEXT=5367]="PixelInterlockUnorderedEXT",e[e.SampleInterlockOrderedEXT=5368]="SampleInterlockOrderedEXT",e[e.SampleInterlockUnorderedEXT=5369]="SampleInterlockUnorderedEXT",e[e.ShadingRateInterlockOrderedEXT=5370]="ShadingRateInterlockOrderedEXT",e[e.ShadingRateInterlockUnorderedEXT=5371]="ShadingRateInterlockUnorderedEXT",e[e.MaxWorkgroupSizeINTEL=5893]="MaxWorkgroupSizeINTEL",e[e.MaxWorkDimINTEL=5894]="MaxWorkDimINTEL",e[e.NoGlobalOffsetINTEL=5895]="NoGlobalOffsetINTEL",e[e.NumSIMDWorkitemsINTEL=5896]="NumSIMDWorkitemsINTEL",e[e.Max=2147483647]="Max"}(Ee||(Ee={})),function(e){e[e.ReadOnly=0]="ReadOnly",e[e.WriteOnly=1]="WriteOnly",e[e.ReadWrite=2]="ReadWrite",e[e.Max=2147483647]="Max"}(Te||(Te={})),function(e){e[e.None=0]="None",e[e.Flatten=1]="Flatten",e[e.DontFlatten=2]="DontFlatten"}(Le||(Le={})),function(e){e[e.None=0]="None",e[e.Unroll=1]="Unroll",e[e.DontUnroll=2]="DontUnroll",e[e.DependencyInfinite=4]="DependencyInfinite",e[e.DependencyLength=8]="DependencyLength",e[e.MinIterations=16]="MinIterations",e[e.MaxIterations=32]="MaxIterations",e[e.IterationMultiple=64]="IterationMultiple",e[e.PeelCount=128]="PeelCount",e[e.PartialCount=256]="PartialCount",e[e.InitiationIntervalINTEL=65536]="InitiationIntervalINTEL",e[e.MaxConcurrencyINTEL=131072]="MaxConcurrencyINTEL",e[e.DependencyArrayINTEL=262144]="DependencyArrayINTEL",e[e.PipelineEnableINTEL=524288]="PipelineEnableINTEL",e[e.LoopCoalesceINTEL=1048576]="LoopCoalesceINTEL",e[e.MaxInterleavingINTEL=2097152]="MaxInterleavingINTEL",e[e.SpeculatedIterationsINTEL=4194304]="SpeculatedIterationsINTEL"}(Re||(Re={})),function(e){e[e.LOOP_HEADER_BIT=1]="LOOP_HEADER_BIT",e[e.CONTINUE_BIT=2]="CONTINUE_BIT",e[e.LOOP_MERGE_BIT=4]="LOOP_MERGE_BIT",e[e.SELECTION_MERGE_BIT=8]="SELECTION_MERGE_BIT",e[e.MULTISELECT_MERGE_BIT=16]="MULTISELECT_MERGE_BIT"}(Ne||(Ne={}));var Me=function(){function e(e){this.ir=new he,this.global_struct_cache=[],this.forward_pointer_fixups=[],this.ir.spirv=e}return e.prototype.get_parsed_ir=function(){return this.ir},e.prototype.parse=function(){var e=this,t=this.ir.spirv,r=t.length;if(r<5)throw new Error("SPIRV file too small.");var i=t;if(i[0]===De(Pe)&&function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=e.length);for(var a=r;a<i;++a)e[a]=t[a]}(i,(function(e){return De(e)})),i[0]!==Pe||!function(e){switch(e){case 99:case 65536:case 65792:case 66048:case 66304:case 66560:case 66816:return!0;default:return!1}}(i[1]))throw new Error("Invalid SPIRV format.");var a=i[3];if(a>4194303)throw new Error("ID bound exceeds limit of 0x3fffff.");this.ir.set_id_bounds(a);for(var s=5,o=[];s<r;){var n=new Se;if(n.op=65535&t[s],n.count=t[s]>>16&65535,0===n.count)throw new Error("SPIR-V instructions cannot consume 0 words. Invalid SPIR-V file.");if(n.offset=s+1,n.length=n.count-1,(s+=n.count)>t.length)throw new Error("SPIR-V instruction goes out of bounds.");o.push(n)}if(o.forEach((function(t){return e.parseInstruction(t)})),this.forward_pointer_fixups.forEach((function(t){var r=e.get(R,t.first),i=e.get(R,t.second);r.member_types=i.member_types,r.basetype=i.basetype,r.self=i.self})),this.forward_pointer_fixups=[],this.current_function)throw new Error("Function was not terminated.");if(this.current_block)throw new Error("Block was not terminated.");if(0===this.ir.default_entry_point)throw new Error("There is no entry point in the SPIR-V module.")},e.prototype.parseInstruction=function(e){var t=this.stream(e),r=e.op,i=this.ir,a=e.length;switch(r){case re.SourceContinued:case re.SourceExtension:case re.Nop:case re.ModuleProcessed:break;case re.String:this.set(_e,t[0],Be(i.spirv,e.offset+1));break;case re.MemoryModel:i.addressing_model=t[0],i.memory_model=t[1];break;case re.Source:switch(t[0]){case ke.ESSL:i.source.es=!0,i.source.version=t[1],i.source.known=!0,i.source.hlsl=!1;break;case ke.GLSL:i.source.es=!1,i.source.version=t[1],i.source.known=!0,i.source.hlsl=!1;break;case ke.HLSL:i.source.es=!1,i.source.version=450,i.source.known=!0,i.source.hlsl=!0;break;default:i.source.known=!1}break;case re.Undef:var s=t[0],n=t[1];this.set(ne,n,s),this.current_block&&this.current_block.ops.push(e);break;case re.Capability:if(t[0]===we.Kernel)throw new Error("Kernel capability not supported.");i.declared_capabilities.push(t[0]);break;case re.Extension:var _=Be(i.spirv,e.offset);i.declared_extensions.push(_);break;case re.ExtInstImport:n=t[0];"GLSL.std.450"===(_=Be(i.spirv,e.offset+1))?this.set(ie,n,Q.GLSL):"DebugInfo"===_?this.set(ie,n,Q.SPV_debug_info):"SPV_AMD_shader_ballot"===_?this.set(ie,n,Q.SPV_AMD_shader_ballot):"SPV_AMD_shader_explicit_vertex_parameter"===_?this.set(ie,n,Q.SPV_AMD_shader_explicit_vertex_parameter):"SPV_AMD_shader_trinary_minmax"===_?this.set(ie,n,Q.SPV_AMD_shader_trinary_minmax):"SPV_AMD_gcn_shader"===_?this.set(ie,n,Q.SPV_AMD_gcn_shader):this.set(ie,n,Q.Unsupported);break;case re.ExtInst:this.current_block&&this.current_block.ops.push(e);break;case re.EntryPoint:var c=new Ce(t[1],t[0],Be(i.spirv,e.offset+2));i.entry_points[t[1]]=c;for(var l=(c.name.length+1+3>>2)+2;l<e.length;l++)c.interface_variables.push(t[l]);i.set_name(t[1],c.name),i.default_entry_point||(i.default_entry_point=t[1]);break;case re.ExecutionMode:var p=i.entry_points[t[0]],u=t[1];switch(p.flags.set(u),u){case Ee.Invocations:p.invocations=t[2];break;case Ee.LocalSize:p.workgroup_size.x=t[2],p.workgroup_size.y=t[3],p.workgroup_size.z=t[4];break;case Ee.OutputVertices:p.output_vertices=t[2]}break;case re.Name:n=t[0];i.set_name(n,Be(i.spirv,e.offset+1));break;case re.MemberName:n=t[0];var f=t[1];i.set_member_name(n,f,Be(i.spirv,e.offset+2));break;case re.DecorationGroup:break;case re.GroupDecorate:var d=t[0],m=i.get_meta(d).decoration.decoration_flags,g=function(e){var r=t[e];m.for_each_bit((function(e){var t=e;ze(t)?i.set_decoration_string(r,t,i.get_decoration_string(d,t)):(i.get_meta(r).decoration_word_offset[t]=i.get_meta(d).decoration_word_offset[t],i.set_decoration(r,t,i.get_decoration(d,t)))}))};for(l=1;l<a;l++)g(l);break;case re.GroupMemberDecorate:var b=t[0],y=(m=i.get_meta(b).decoration.decoration_flags,function(e){var r=t[e],a=t[e+1];m.for_each_bit((function(e){var t=e;ze(t)?i.set_member_decoration_string(r,a,t,i.get_decoration_string(b,t)):i.set_member_decoration(r,a,t,i.get_decoration(b,t))}))});for(l=1;l+1<a;l+=2)y(l);break;case re.Decorate:case re.DecorateId:n=t[0];var S=t[1];a>=3?(i.get_meta(n).decoration_word_offset[S]=e.offset+2,i.set_decoration(n,S,t[2])):i.set_decoration(n,S);break;case re.DecorateStringGOOGLE:n=t[0],S=t[1];i.set_decoration_string(n,S,Be(i.spirv,e.offset+2));break;case re.MemberDecorate:n=t[0],f=t[1],S=t[2];a>=4?i.set_member_decoration(n,f,S,t[3]):i.set_member_decoration(n,f,S);break;case re.MemberDecorateStringGOOGLE:n=t[0],f=t[1],S=t[2];i.set_member_decoration_string(n,f,S,Be(i.spirv,e.offset+3));break;case re.TypeVoid:n=t[0];(x=this.set(R,n)).basetype=E.Void;break;case re.TypeBool:n=t[0];(x=this.set(R,n)).basetype=E.Boolean,x.width=1;break;case re.TypeFloat:n=t[0];var I=t[1],x=this.set(R,n);if(64===I)x.basetype=E.Double;else if(32===I)x.basetype=E.Float;else{if(16!==I)throw new Error("Unrecognized bit-width of floating point type.");x.basetype=E.Half}x.width=I;break;case re.TypeInt:n=t[0],I=t[1];var k=0!==t[2];(x=this.set(R,n)).basetype=k?function(e){switch(e){case 8:return E.SByte;case 16:return E.Short;case 32:return E.Int;case 64:return E.Int64;default:throw new Error("Invalid bit width.")}}(I):function(e){switch(e){case 8:return E.UByte;case 16:return E.UShort;case 32:return E.UInt;case 64:return E.UInt64;default:throw new Error("Invalid bit width.")}}(I),x.width=I;break;case re.TypeVector:n=t[0];var w=t[2],L=this.get(R,t[1]),N=this.set(R,n);h(L,N),N.vecsize=w,N.self=n,N.parent_type=t[1];break;case re.TypeMatrix:n=t[0];var A=t[2],D=(L=this.get(R,t[1]),this.set(R,n));h(L,D),D.columns=A,D.self=n,D.parent_type=t[1];break;case re.TypeArray:n=t[0];var B=this.set(R,n),z=t[1];h(L=this.get(R,z),B),B.parent_type=z;var U=t[2];i.mark_used_as_array_length(U);var G=(le=this.maybe_get(O,U))&&!le.specialization;L.forward_pointer&&this.forward_pointer_fixups.push(new xe(n,z)),B.array_size_literal.push(G),B.array.push(G?le.scalar():U);break;case re.TypeRuntimeArray:n=t[0],L=this.get(R,t[1]),B=this.set(R,n);L.forward_pointer&&this.forward_pointer_fixups.push(new xe(n,t[1])),h(L,B),B.array.push(0),B.array_size_literal.push(!0),B.parent_type=t[1];break;case re.TypeImage:n=t[0];(x=this.set(R,n)).basetype=E.Image,x.image.type=t[1],x.image.dim=t[2],x.image.depth=1===t[3],x.image.arrayed=0!==t[4],x.image.ms=0!==t[5],x.image.sampled=t[6],x.image.format=t[7],x.image.access=a>=9?t[8]:Te.Max;break;case re.TypeSampledImage:n=t[0];var F=t[1];x=this.set(R,n);h(this.get(R,F),x),x.basetype=E.SampledImage,x.self=n;break;case re.TypeSampler:n=t[0];(x=this.set(R,n)).basetype=E.Sampler;break;case re.TypePointer:n=t[0],L=this.maybe_get(R,t[2]);var H=this.set(R,n);L&&h(L,H),H.pointer=!0,H.pointer_depth++,H.storage=t[1],H.storage===v.AtomicCounter&&(H.basetype=E.AtomicCounter),L&&L.forward_pointer&&this.forward_pointer_fixups.push(new xe(n,t[2])),H.parent_type=t[2];break;case re.TypeForwardPointer:n=t[0];(H=this.set(R,n)).pointer=!0,H.pointer_depth++,H.storage=t[1],H.forward_pointer=!0,H.storage===v.AtomicCounter&&(H.basetype=E.AtomicCounter);break;case re.TypeStruct:n=t[0];(x=this.set(R,n)).basetype=E.Struct;for(l=1;l<a;l++)x.member_types.push(t[l]);if(0!==i.get_name(x.self).length){for(var q=0,X=this.global_struct_cache;q<X.length;q++){var K=X[q];if(i.get_name(x.self)===i.get_name(K)&&this.types_are_logically_equivalent(x,this.get(R,K))){x.type_alias=K;break}}0===x.type_alias&&this.global_struct_cache.push(n)}break;case re.TypeFunction:n=t[0];var $=t[1],ee=this.set(W,n,$);for(l=2;l<a;l++)ee.parameter_types.push(t[l]);break;case re.TypeAccelerationStructureKHR:n=t[0];(x=this.set(R,n)).basetype=E.AccelerationStructure;break;case re.TypeRayQueryKHR:n=t[0];(x=this.set(R,n)).basetype=E.RayQuery;break;case re.Variable:x=t[0],n=t[1];var te=t[2],ae=4===a?t[3]:0;if(te===v.Function){if(!this.current_function)throw new Error("No function currently in scope");this.current_function.add_local_variable(n)}this.set(T,n,x,te,ae);break;case re.Phi:if(!this.current_function)throw new Error("No function currently in scope");if(!this.current_block)throw new Error("No block currently in scope");s=t[0],n=t[1];this.set(T,n,s,v.Function).phi_variable=!0,this.current_function.add_local_variable(n);for(l=2;l+2<=a;l+=2)this.current_block.phi_variables.push(new Z(t[l],t[l+1],n));break;case re.SpecConstant:case re.Constant:n=t[1];(x=this.get(R,t[0])).width>32?this.set(O,n,t[0],bigintFrom(t[3],t[2]),r===re.SpecConstant):this.set(O,n,t[0],t[2],r===re.SpecConstant);break;case re.SpecConstantFalse:case re.ConstantFalse:this.set(O,t[1],t[0],0,r===re.SpecConstantFalse);break;case re.SpecConstantTrue:case re.ConstantTrue:this.set(O,t[1],t[0],1,r===re.SpecConstantTrue);break;case re.ConstantNull:i.make_constant_null(t[1],t[0],!0);break;case re.SpecConstantComposite:case re.ConstantComposite:n=t[1],x=t[0];var se=this.get(R,x);if(se.basetype===E.Struct||0!==se.array.length){var oe=t.slice(2);this.set(O,n,x,oe,a-2,r===re.SpecConstantComposite)}else{if((oe=a-2)>4)throw new Error("OpConstantComposite only supports 1, 2, 3 and 4 elements.");var ce=o(4,(function(){return new O})),le=new Array(4);for(l=0;l<oe;l++){var pe=this.maybe_get(V,t[2+l]),ue=this.maybe_get(ne,t[2+l]);if(pe){if(r===re.ConstantComposite)throw new Error("Specialization constant operation used in OpConstantComposite.");ce[l].make_null(this.get(R,pe.basetype)),ce[l].self=pe.self,ce[l].constant_type=pe.basetype,ce[l].specialization=!0,le[l]=ce[l]}else ue?(ce[l].make_null(this.get(R,ue.basetype)),ce[l].constant_type=ue.basetype,le[l]=ce[l]):le[l]=this.get(O,t[2+l])}this.set(O,n,x,le,oe,r===re.SpecConstantComposite)}break;case re.Function:var he=t[0];n=t[1],x=t[3];if(this.current_function)throw new Error("Must end a function before starting a new one!");this.current_function=this.set(j,n,he,x);break;case re.FunctionParameter:x=t[0],n=t[1];if(!this.current_function)throw new Error("Must be in a function!");this.current_function.add_parameter(x,n),this.set(T,n,x,v.Function);break;case re.FunctionEnd:if(this.current_block)throw new Error("Cannot end a function before ending the current block.\nLikely cause: If this SPIR-V was created from glslang HLSL, make sure the entry point is valid.");this.current_function=null;break;case re.Label:if(!this.current_function)throw new Error("Blocks cannot exist outside functions!");n=t[0];if(this.current_function.blocks.push(n),this.current_function.entry_block||(this.current_function.entry_block=n),this.current_block)throw new Error("Cannot start a block before ending the current block.");this.current_block=this.set(J,n);break;case re.Branch:if(!this.current_block)throw new Error("Trying to end a non-existing block.");var fe=t[0];(be=this.current_block).terminator=C.Direct,be.next_block=fe,this.current_block=null;break;case re.BranchConditional:if(!this.current_block)throw new Error("Trying to end a non-existing block.");if((be=this.current_block).condition=t[0],be.true_block=t[1],be.false_block=t[2],be.terminator=C.Select,be.true_block===be.false_block)if(be.true_block!==be.next_block&&be.merge===P.Selection){var de=i.increase_bound_by(2);(x=new R).basetype=E.Int,x.width=32,this.set(R,de,x);le=this.set(O,de+1,de);be.condition=le.self,be.default_block=be.true_block,be.terminator=C.MultiSelect,i.block_meta[be.next_block]=i.block_meta[be.next_block]||0,i.block_meta[be.next_block]&=~Ne.SELECTION_MERGE_BIT,i.block_meta[be.next_block]|=Ne.MULTISELECT_MERGE_BIT}else i.block_meta[be.next_block]=i.block_meta[be.next_block]||0,i.block_meta[be.next_block]&=~Ne.SELECTION_MERGE_BIT,be.next_block=be.true_block,be.condition=0,be.true_block=0,be.false_block=0,be.merge_block=0,be.merge=P.None,be.terminator=C.Direct;this.current_block=null;break;case re.Switch:if(!(be=this.current_block))throw new Error("Trying to end a non-existing block.");be.terminator=C.MultiSelect,be.condition=t[0],be.default_block=t[1];var me=a-2;if(me%2==0)for(l=2;l+2<=a;l+=2)be.cases_32bit.push(new Y(BigInt(t[l]),t[l+1]));if(me%3==0)for(l=2;l+3<=a;l+=3)be.cases_64bit.push(new Y(bigintFrom(t[l+1],t[l]),t[l+2]));i.block_meta[be.next_block]=i.block_meta[be.next_block]||0,i.block_meta[be.next_block]|=Ne.MULTISELECT_MERGE_BIT,this.current_block=null;break;case re.Kill:if(!this.current_block)throw new Error("Trying to end a non-existing block.");this.current_block.terminator=C.Kill,this.current_block=null;break;case re.TerminateRayKHR:if(!this.current_block)throw new Error("Trying to end a non-existing block.");this.current_block.terminator=C.TerminateRay,this.current_block=null;break;case re.IgnoreIntersectionKHR:if(!this.current_block)throw new Error("Trying to end a non-existing block.");this.current_block.terminator=C.IgnoreIntersection,this.current_block=null;break;case re.Return:if(!this.current_block)throw new Error("Trying to end a non-existing block.");this.current_block.terminator=C.Return,this.current_block=null;break;case re.ReturnValue:if(!(be=this.current_block))throw new Error("Trying to end a non-existing block.");be.terminator=C.Return,be.return_value=t[0],this.current_block=null;break;case re.Unreachable:if(!this.current_block)throw new Error("Trying to end a non-existing block.");this.current_block.terminator=C.Unreachable,this.current_block=null;break;case re.SelectionMerge:if(!(be=this.current_block))throw new Error("Trying to modify a non-existing block.");be.next_block=t[0],be.merge=P.Selection,i.block_meta[be.next_block]=i.block_meta[be.next_block]||0,i.block_meta[be.next_block]|=Ne.SELECTION_MERGE_BIT,a>=2&&(t[1]&Le.Flatten?be.hint=M.Flatten:t[1]&Le.DontFlatten&&(be.hint=M.DontFlatten));break;case re.LoopMerge:if(!(be=this.current_block))throw new Error("Trying to modify a non-existing block.");be.merge_block=t[0],be.continue_block=t[1],be.merge=P.Loop,i.block_meta[be.self]=i.block_meta[be.self]||0,i.block_meta[be.self]|=Ne.LOOP_HEADER_BIT,i.block_meta[be.merge_block]=i.block_meta[be.merge_block]||0,i.block_meta[be.merge_block]|=Ne.LOOP_MERGE_BIT,i.continue_block_to_loop_header[be.continue_block]=be.self,be.continue_block!==be.self&&(i.block_meta[be.continue_block]=i.block_meta[be.continue_block]||0,i.block_meta[be.continue_block]|=Ne.CONTINUE_BIT),a>=3&&(t[2]&Re.Unroll?be.hint=M.Unroll:t[2]&Re.DontUnroll&&(be.hint=M.DontUnroll));break;case re.SpecConstantOp:if(a<3)throw new Error("OpSpecConstantOp not enough arguments.");s=t[0],n=t[1];var ge=t[2];this.set(V,n,s,ge,t.slice(3));break;case re.Line:var be;(be=this.current_block)&&be.ops.push(e);var ye=this.current_function;ye&&0===ye.entry_line.file_id&&(ye.entry_line.file_id=t[0],ye.entry_line.line_literal=t[1]);break;case re.NoLine:this.current_block&&this.current_block.ops.push(e);break;default:if(a>=2)(x=this.maybe_get(R,t[0]))&&(i.load_type_width[t[1]]=x.width);if(!this.current_block)throw new Error("Currently no block to insert opcode.");this.current_block.ops.push(e)}},e.prototype.stream=function(e){if(0===e.length)return null;if(e.offset+e.length>this.ir.spirv.length)throw new Error("Compiler::stream() out of range.");return this.ir.spirv.slice(e.offset,e.offset+e.length)},e.prototype.set=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this.ir.add_typed_id(e.type,t);var a=p.apply(void 0,s([e,this.ir.ids[t]],r,!1));return a.self=t,a},e.prototype.get=function(e,t){return l(e,this.ir.ids[t])},e.prototype.maybe_get=function(e,t){return this.ir.ids[t].get_type()===e.type?this.get(e,t):null},e.prototype.types_are_logically_equivalent=function(e,t){if(e.basetype!==t.basetype)return!1;if(e.width!==t.width)return!1;if(e.vecsize!==t.vecsize)return!1;if(e.columns!==t.columns)return!1;if(!n(e.array,t.array))return!1;if((e.basetype===E.Image||e.basetype===E.SampledImage)&&!e.image.equals(t.image))return!1;if(!n(e.member_types,t.member_types))return!1;for(var r=e.member_types.length,i=0;i<r;i++)if(!this.types_are_logically_equivalent(this.get(R,e.member_types[i]),this.get(R,t.member_types[i])))return!1;return!0},e}();function De(e){return e>>24&255|e>>8&65280|e<<8&16711680|e<<24&4278190080}function Be(e,t){for(var r="",i=t;i<e.length;i++)for(var a=e[i],s=0;s<4;s++,a>>=8){var o=255&a;if(0===o)return r;r+=String.fromCharCode(o)}throw new Error("String was not terminated before EOF")}function ze(e){return e===te.HlslSemanticGOOGLE}var Ue,Ge=function(e,t){this.name=e,this.execution_model=t},Fe=function(){function e(){}return e.prototype.handle_terminator=function(e){return!0},e.prototype.follow_function_call=function(e){return!0},e.prototype.set_current_block=function(e){},e.prototype.rearm_current_block=function(e){},e.prototype.begin_function_scope=function(e,t){return!0},e.prototype.end_function_scope=function(e,t){return!0},e}();!function(e){e[e.Dim1D=0]="Dim1D",e[e.Dim2D=1]="Dim2D",e[e.Dim3D=2]="Dim3D",e[e.Cube=3]="Cube",e[e.Rect=4]="Rect",e[e.Buffer=5]="Buffer",e[e.SubpassData=6]="SubpassData",e[e.Max=2147483647]="Max"}(Ue||(Ue={}));var Oe,Ve,He=function(e){function t(t){var r=e.call(this)||this;return r.need_dummy_sampler=!1,r.compiler=t,r}return a(t,e),t.prototype.handle=function(e,t,r){if(this.need_dummy_sampler)return!1;var i=this.compiler;switch(e){case re.Load:if(r<3)return!1;var a=t[0];if(!((_=i.get(R,a)).basetype===E.Image&&1===_.image.sampled&&_.image.dim!==Ue.Buffer))return!0;var s=t[1],o=t[2];i.set(ae,s,"",a,!0),i.register_read(s,o,!0);break;case re.ImageFetch:case re.ImageQuerySizeLod:case re.ImageQuerySize:case re.ImageQueryLevels:case re.ImageQuerySamples:var n=i.maybe_get_backing_variable(t[2]);if(n)(_=i.get(R,n.basetype)).basetype===E.Image&&1===_.image.sampled&&_.image.dim!==Ue.Buffer&&(this.need_dummy_sampler=!0);break;case re.InBoundsAccessChain:case re.AccessChain:case re.PtrAccessChain:if(r<3)return!1;var _;a=t[0];if(!((_=i.get(R,a)).basetype===E.Image&&1===_.image.sampled&&_.image.dim!==Ue.Buffer))return!0;s=t[1],o=t[2];i.set(ae,s,"",a,!0),i.register_read(s,o,!0),i.ir.ids[s].set_allow_type_rewrite()}return!0},t}(Fe);!function(e){e[e.Bad=0]="Bad",e[e.Round=1]="Round",e[e.RoundEven=2]="RoundEven",e[e.Trunc=3]="Trunc",e[e.FAbs=4]="FAbs",e[e.SAbs=5]="SAbs",e[e.FSign=6]="FSign",e[e.SSign=7]="SSign",e[e.Floor=8]="Floor",e[e.Ceil=9]="Ceil",e[e.Fract=10]="Fract",e[e.Radians=11]="Radians",e[e.Degrees=12]="Degrees",e[e.Sin=13]="Sin",e[e.Cos=14]="Cos",e[e.Tan=15]="Tan",e[e.Asin=16]="Asin",e[e.Acos=17]="Acos",e[e.Atan=18]="Atan",e[e.Sinh=19]="Sinh",e[e.Cosh=20]="Cosh",e[e.Tanh=21]="Tanh",e[e.Asinh=22]="Asinh",e[e.Acosh=23]="Acosh",e[e.Atanh=24]="Atanh",e[e.Atan2=25]="Atan2",e[e.Pow=26]="Pow",e[e.Exp=27]="Exp",e[e.Log=28]="Log",e[e.Exp2=29]="Exp2",e[e.Log2=30]="Log2",e[e.Sqrt=31]="Sqrt",e[e.InverseSqrt=32]="InverseSqrt",e[e.Determinant=33]="Determinant",e[e.MatrixInverse=34]="MatrixInverse",e[e.Modf=35]="Modf",e[e.ModfStruct=36]="ModfStruct",e[e.FMin=37]="FMin",e[e.UMin=38]="UMin",e[e.SMin=39]="SMin",e[e.FMax=40]="FMax",e[e.UMax=41]="UMax",e[e.SMax=42]="SMax",e[e.FClamp=43]="FClamp",e[e.UClamp=44]="UClamp",e[e.SClamp=45]="SClamp",e[e.FMix=46]="FMix",e[e.IMix=47]="IMix",e[e.Step=48]="Step",e[e.SmoothStep=49]="SmoothStep",e[e.Fma=50]="Fma",e[e.Frexp=51]="Frexp",e[e.FrexpStruct=52]="FrexpStruct",e[e.Ldexp=53]="Ldexp",e[e.PackSnorm4x8=54]="PackSnorm4x8",e[e.PackUnorm4x8=55]="PackUnorm4x8",e[e.PackSnorm2x16=56]="PackSnorm2x16",e[e.PackUnorm2x16=57]="PackUnorm2x16",e[e.PackHalf2x16=58]="PackHalf2x16",e[e.PackDouble2x32=59]="PackDouble2x32",e[e.UnpackSnorm2x16=60]="UnpackSnorm2x16",e[e.UnpackUnorm2x16=61]="UnpackUnorm2x16",e[e.UnpackHalf2x16=62]="UnpackHalf2x16",e[e.UnpackSnorm4x8=63]="UnpackSnorm4x8",e[e.UnpackUnorm4x8=64]="UnpackUnorm4x8",e[e.UnpackDouble2x32=65]="UnpackDouble2x32",e[e.Length=66]="Length",e[e.Distance=67]="Distance",e[e.Cross=68]="Cross",e[e.Normalize=69]="Normalize",e[e.FaceForward=70]="FaceForward",e[e.Reflect=71]="Reflect",e[e.Refract=72]="Refract",e[e.FindILsb=73]="FindILsb",e[e.FindSMsb=74]="FindSMsb",e[e.FindUMsb=75]="FindUMsb",e[e.InterpolateAtCentroid=76]="InterpolateAtCentroid",e[e.InterpolateAtSample=77]="InterpolateAtSample",e[e.InterpolateAtOffset=78]="InterpolateAtOffset",e[e.NMin=79]="NMin",e[e.NMax=80]="NMax",e[e.NClamp=81]="NClamp",e[e.Count=82]="Count"}(Oe||(Oe={})),function(e){e[e.None=0]="None",e[e.R11FG11FB10F=1]="R11FG11FB10F",e[e.R32F=2]="R32F",e[e.RG16F=3]="RG16F",e[e.RGB10A2=4]="RGB10A2",e[e.RGBA8=5]="RGBA8",e[e.RG16=6]="RG16",e[e.RGBA8I=7]="RGBA8I",e[e.RG16I=8]="RG16I",e[e.RGB10A2UI=9]="RGB10A2UI",e[e.RGBA8UI=10]="RGBA8UI",e[e.RG16UI=11]="RG16UI",e[e.R32UI=12]="R32UI"}(Ve||(Ve={}));var qe=function(){this.discard_literal="discard",this.demote_literal="demote",this.null_pointer_literal="",this.float_literal_suffix=!1,this.double_literal_suffix=!0,this.uint32_t_literal_suffix=!0,this.long_long_literal_suffix=!1,this.basic_int_type="int",this.basic_uint_type="uint",this.basic_int8_type="int8_t",this.basic_uint8_type="uint8_t",this.basic_int16_type="int16_t",this.basic_uint16_type="uint16_t",this.int16_t_literal_suffix="s",this.uint16_t_literal_suffix="us",this.nonuniform_qualifier="nonuniformEXT",this.swizzle_is_function=!1,this.shared_is_implied=!1,this.unsized_array_supported=!0,this.explicit_struct_type=!1,this.use_initializer_list=!1,this.use_typed_initializer_list=!1,this.can_declare_struct_inline=!0,this.can_declare_arrays_inline=!0,this.native_row_major_matrix=!0,this.use_constructor_splatting=!0,this.allow_precision_qualifiers=!1,this.can_swizzle_scalar=!1,this.force_gl_in_out_block=!1,this.can_return_array=!0,this.allow_truncated_access_chain=!1,this.supports_extensions=!1,this.supports_empty_struct=!1,this.array_is_value_type=!0,this.buffer_offset_array_is_value_type=!0,this.comparison_image_samples_scalar=!1,this.native_pointers=!1,this.support_small_type_sampling_result=!1,this.support_case_fallthrough=!0,this.use_array_constructor=!1,this.needs_row_major_load_workaround=!1,this.support_pointer_to_pointer=!1,this.support_precise_qualifier=!1,this.support_64bit_switch=!1,this.workgroup_size_is_hidden=!1},Xe=function(e){function t(t,r){var i=e.call(this)||this;return i.compiler=t,i.variables=r,i}return a(t,e),t.prototype.handle=function(e,t,r){var i=this.compiler,a=this.variables,s=0,o=0;switch(e){default:break;case re.FunctionCall:if(r<3)return!1;var n=r-3;o+=3;for(var _=0;_<n;_++){(c=i.maybe_get(T,t[o+_]))&&Ke(c.storage)&&a.add(t[o+_])}break;case re.Select:if(r<5)return!1;n=r-3;o+=3;for(_=0;_<n;_++){(c=i.maybe_get(T,t[o+_]))&&Ke(c.storage)&&a.add(t[o+_])}break;case re.Phi:if(r<2)return!1;n=r-2;o+=2;for(_=0;_<n;_+=2){(c=i.maybe_get(T,t[o+_]))&&Ke(c.storage)&&a.add(t[o+_])}break;case re.AtomicStore:case re.Store:if(r<1)return!1;s=t[o];break;case re.CopyMemory:if(r<2)return!1;(c=i.maybe_get(T,t[o]))&&Ke(c.storage)&&a.add(t[o]),(c=i.maybe_get(T,t[o+1]))&&Ke(c.storage)&&a.add(t[o+1]);break;case re.ExtInst:if(r<5)return!1;switch(i.get(ie,t[o+2]).ext){case Q.GLSL:switch(t[o+3]){case Oe.InterpolateAtCentroid:case Oe.InterpolateAtSample:case Oe.InterpolateAtOffset:case Oe.Modf:case Oe.Fract:(c=i.maybe_get(T,t[o+4]))&&Ke(c.storage)&&a.add(t[o+4])}break;case Q.SPV_AMD_shader_explicit_vertex_parameter:var c;if(1===t[o+3])(c=i.maybe_get(T,t[o+4]))&&Ke(c.storage)&&a.add(t[o+4])}break;case re.AccessChain:case re.InBoundsAccessChain:case re.PtrAccessChain:case re.Load:case re.CopyObject:case re.ImageTexelPointer:case re.AtomicLoad:case re.AtomicExchange:case re.AtomicCompareExchange:case re.AtomicCompareExchangeWeak:case re.AtomicIIncrement:case re.AtomicIDecrement:case re.AtomicIAdd:case re.AtomicISub:case re.AtomicSMin:case re.AtomicUMin:case re.AtomicSMax:case re.AtomicUMax:case re.AtomicAnd:case re.AtomicOr:case re.AtomicXor:case re.ArrayLength:if(r<3)return!1;s=t[o+2]}s&&((c=i.maybe_get(T,s))&&Ke(c.storage)&&a.add(s));return!0},t}(Fe);function Ke(e){switch(e){case v.Input:case v.Output:case v.Uniform:case v.UniformConstant:case v.AtomicCounter:case v.PushConstant:case v.StorageBuffer:return!0;default:return!1}}var je=function(e,t,r,i){this.name="",this.id=e,this.type_id=t,this.base_type_id=r,this.name=i},We=function(){},Qe=function(){this.uniform_buffers=[],this.storage_buffers=[],this.stage_inputs=[],this.stage_outputs=[],this.subpass_inputs=[],this.storage_images=[],this.sampled_images=[],this.atomic_counters=[],this.acceleration_structures=[],this.push_constant_buffers=[],this.separate_images=[],this.separate_samplers=[],this.builtin_inputs=[],this.builtin_outputs=[]},Ze=function(e,t,r){this.combined_id=e,this.image_id=t,this.sampler_id=r},Ye=function(e){function t(t){var r=e.call(this)||this;return r.parameter_remapping=[],r.functions=[],r.compiler=t,r}return a(t,e),t.prototype.handle=function(e,t,r){var i=this.compiler,a=!1;switch(e){case re.Load:if(r<3)return!1;var s=t[0],o=(L=i.get(R,s)).basetype===E.Image&&1===L.image.sampled,n=L.basetype===E.Sampler;if(!o&&!n)return!0;var _=t[1],c=t[2];return i.set(ae,_,"",s,!0),i.register_read(_,c,!0),!0;case re.InBoundsAccessChain:case re.AccessChain:case re.PtrAccessChain:if(r<3)return!1;s=t[0],o=(L=i.get(R,s)).basetype===E.Image&&1===L.image.sampled;if(n=L.basetype===E.Sampler)throw new Error("Attempting to use arrays or structs of separate samplers. This is not possible to statically remap to plain GLSL.");if(o){_=t[1],c=t[2];i.set(ae,_,"",s,!0),i.register_read(_,c,!0)}return!0;case re.ImageFetch:case re.ImageQuerySizeLod:case re.ImageQuerySize:case re.ImageQueryLevels:case re.ImageQuerySamples:if(!(k=i.maybe_get_backing_variable(t[2])))return!0;if((L=i.get(R,k.basetype)).basetype===E.Image&&1===L.image.sampled&&L.image.dim!==Ue.Buffer){if(0===i.dummy_sampler_id)throw new Error("texelFetch without sampler was found, but no dummy sampler has been created with build_dummy_sampler_for_combined_images().");a=!0;break}return!0;case re.SampledImage:break;default:return!0}if(0!==this.functions.length){var l=this.functions[this.functions.length-1];if(l.do_combined_parameters){var p=t[2],u=i.maybe_get_backing_variable(p);u&&(p=u.self);var f=a?i.dummy_sampler_id:t[3],d=i.maybe_get_backing_variable(f);d&&(f=d.self);var m=t[1],g=i.get(R,t[0]);this.register_combined_image_sampler(l,m,p,f,g.image.depth)}}var b=this.remap_parameter(t[2]),y=a?i.dummy_sampler_id:this.remap_parameter(t[3]);if(!i.combined_image_samplers.find((function(e){return e.image_id===b&&e.sampler_id===y}))){var S=void 0,I=void 0;if(a){S=i.ir.increase_bound_by(1);var x=i.set(R,S);h(i.expression_type(t[2]),x),x.self=S,x.basetype=E.SampledImage,x.image.depth=!1,I=0}else S=t[0],I=t[1];var k,w=(_=i.ir.increase_bound_by(2))+0,L=(m=_+1,i.set(R,w));if(h(i.get(R,S),L),L.pointer=!0,L.storage=v.UniformConstant,L.parent_type=w,i.set(T,m,w,v.UniformConstant,0),(y&&i.has_decoration(y,te.RelaxedPrecision)||b&&i.has_decoration(b,te.RelaxedPrecision)||I&&i.has_decoration(I,te.RelaxedPrecision))&&i.set_decoration(m,te.RelaxedPrecision),k=i.maybe_get_backing_variable(b)){var N=i.get(R,k.basetype);L.array=N.array,L.array_size_literal=N.array_size_literal}i.combined_image_samplers.push(new Ze(m,b,y))}return!0},t.prototype.begin_function_scope=function(e,t){if(t<3)return!1;var r=this.compiler.get(j,e[2]);return e=e.slice(3),t-=3,this.push_remap_parameters(r,e,t),this.functions.push(r),!0},t.prototype.end_function_scope=function(e,t){if(t<3)return!1;var r=this.functions,i=this.compiler,a=i.get(j,e[2]);e=e.slice(3),this.pop_remap_parameters(),a.do_combined_parameters=!1;var s=r.pop().combined_parameters;if(0===r.length)return!0;var o=r[r.length-1];if(o.do_combined_parameters)for(var n=0,_=s;n<_.length;n++){var c=_[n],l=c.global_image?c.image_id:e[c.image_id],p=c.global_sampler?c.sampler_id:e[c.sampler_id],u=i.maybe_get_backing_variable(l),h=i.maybe_get_backing_variable(p);u&&(l=u.self),h&&(p=h.self),this.register_combined_image_sampler(o,0,l,p,c.depth)}return!0},t.prototype.remap_parameter=function(e){var t=this.compiler.maybe_get_backing_variable(e);t&&(e=t.self);var r=this.parameter_remapping;if(0===r.length)return e;var i=r[r.length-1][e];return void 0!==i?i:e},t.prototype.push_remap_parameters=function(e,t,r){for(var i=[],a=0;a<r;a++)i[e.arguments[a].id]=this.remap_parameter(t[a]);this.parameter_remapping.push(i)},t.prototype.pop_remap_parameters=function(){this.parameter_remapping.pop()},t.prototype.register_combined_image_sampler=function(e,t,r,i,a){var s=new X(0,r,i,!0,!0,a),o=e.arguments.find((function(e){return e.id===r})),n=e.arguments.find((function(e){return e.id===i}));if(o&&(s.global_image=!1,s.image_id=e.arguments.indexOf(o)),n&&(s.global_sampler=!1,s.sampler_id=e.arguments.indexOf(n)),!s.global_image||!s.global_sampler){var _=e.combined_parameters.find((function(e){return s.image_id===e.image_id&&s.sampler_id===e.sampler_id&&s.global_image===e.global_image&&s.global_sampler===e.global_sampler})),c=this.compiler;if(!_){var l=c.ir.increase_bound_by(3),p=l,u=l+1,f=l+2,d=c.expression_type(r),m=c.set(R,p),g=c.set(R,u);h(d,m),m.self=p,m.basetype=E.SampledImage,m.pointer=!1,m.storage=v.Generic,m.image.depth=a,h(m,g),g.pointer=!0,g.storage=v.UniformConstant,g.parent_type=p,c.set(T,f,u,v.Function,0),(c.has_decoration(i,te.RelaxedPrecision)||c.has_decoration(r,te.RelaxedPrecision)||t&&c.has_decoration(t,te.RelaxedPrecision))&&c.set_decoration(f,te.RelaxedPrecision),s.id=f,c.set_name(f,"SPIRV_Cross_Combined"+c.to_name(r)+c.to_name(i)),e.combined_parameters.push(s),e.shadow_arguments.push(new q(u,f,0,0,!0))}}},t}(Fe),Je=function(){function e(){this.v=-1}return e.prototype.get=function(){return this.v},e.prototype.set=function(e){this.v=e},e}(),$e=function(){function e(e){this.dominator=0,this.cfg=e}return e.prototype.add_block=function(e){this.cfg.get_immediate_dominator(e)&&(this.dominator?e!==this.dominator&&(this.dominator=this.cfg.find_common_dominator(e,this.dominator)):this.dominator=e)},e.prototype.get_dominator=function(){return this.dominator},e.prototype.lift_continue_block_dominator=function(){if(this.dominator){var e=this.cfg,t=e.get_compiler().get(J,this.dominator),r=e.get_visit_order(this.dominator),i=!1;switch(t.terminator){case C.Direct:e.get_visit_order(t.next_block)>r&&(i=!0);break;case C.Select:e.get_visit_order(t.true_block)>r&&(i=!0),e.get_visit_order(t.false_block)>r&&(i=!0);break;case C.MultiSelect:for(var a=0,s=e.get_compiler().get_case_list(t);a<s.length;a++){var o=s[a];e.get_visit_order(o.block)>r&&(i=!0)}t.default_block&&e.get_visit_order(t.default_block)>r&&(i=!0)}i&&(this.dominator=e.get_function().entry_block)}},e}();function et(e,t,r){return t[r]||(t[r]="number"==typeof e||"string"==typeof e?e:new e),t[r]}var tt,rt=function(){function e(e,t){this.preceding_edges=[],this.succeeding_edges=[],this.immediate_dominators=[],this.visit_order=[],this.post_order=[],this.empty_vector=[],this.visit_count=0,this.compiler=e,this.func=t,this.build_post_order_visit_order(),this.build_immediate_dominators()}return e.prototype.get_compiler=function(){return this.compiler},e.prototype.get_function=function(){return this.func},e.prototype.get_immediate_dominator=function(e){var t=this.immediate_dominators[e];return t||0},e.prototype.get_visit_order=function(e){var t=this.visit_order[e];console.assert(t);var r=t.get();return console.assert(r>0),r},e.prototype.find_common_dominator=function(e,t){for(;e!==t;)this.get_visit_order(e)<this.get_visit_order(t)?e=this.get_immediate_dominator(e):t=this.get_immediate_dominator(t);return e},e.prototype.get_preceding_edges=function(e){return this.preceding_edges[e]||this.empty_vector},e.prototype.get_succeeding_edges=function(e){return this.succeeding_edges[e]||this.empty_vector},e.prototype.walk_from=function(e,t,r){if(!e.has(t)&&(e.add(t),r(t)))for(var i=0,a=this.get_succeeding_edges(t);i<a.length;i++){var s=a[i];this.walk_from(e,s,r)}},e.prototype.find_loop_dominator=function(e){for(;e!==J.NoDominator;){var t=this.preceding_edges[e];if(!t)return J.NoDominator;if(0===t.length)return J.NoDominator;for(var r=J.NoDominator,i=!1,a=0,s=t;a<s.length;a++){var o=s[a],n=this.compiler.get(J,o);if(n.merge===P.Loop&&n.merge_block===e){r=o,i=!0;break}if(n.merge===P.Selection&&n.next_block===e){r=o;break}}if(r===J.NoDominator&&(r=t[0]),e=r,!i&&e)if(this.compiler.get(J,e).merge===P.Loop)return e}return e},e.prototype.node_terminates_control_flow_in_sub_graph=function(e,t){var r=this.compiler,i=r.get(J,e),a=0;for(i.merge===P.Loop&&(a=i.merge_block);t!==e;){var s=this.preceding_edges[t];if(!s)return!1;for(var o=new $e(this),n=0,_=s;n<_.length;n++){var c=_[n];o.add_block(c)}var l=o.get_dominator();if(0===l)return!1;var p=r.get(J,l),u=!1,h=!1;if(a&&p.terminator===C.Select){var f=r.get(J,p.true_block),d=r.get(J,p.false_block),m=r.get(J,a);u=r.execution_is_branchless(f,m),h=r.execution_is_branchless(d,m)}if(!(p.merge===P.Selection&&p.next_block===t||p.merge===P.Loop&&p.merge_block===t||p.terminator===C.Direct&&p.next_block===t||p.terminator===C.Select&&p.true_block===t&&h||p.terminator===C.Select&&p.false_block===t&&u))return!1;t=l}return!0},e.prototype.add_branch=function(e,t){var r=function(e,t){e.indexOf(t)<0&&e.push(t)};r(et(Array,this.preceding_edges,t),e),r(et(Array,this.succeeding_edges,e),t)},e.prototype.build_post_order_visit_order=function(){var e=this.func.entry_block;this.visit_count=0,this.visit_order=[],this.post_order=[],this.post_order_visit(e)},e.prototype.build_immediate_dominators=function(){this.immediate_dominators=[],this.immediate_dominators[this.func.entry_block]=this.func.entry_block;for(var e=this.post_order.length;e;e--){var t=this.post_order[e-1],r=et(Array,this.preceding_edges,t);if(0!==r.length)for(var i=0,a=r;i<a.length;i++){var s=a[i];et(0,this.immediate_dominators,t)?(console.assert(et(0,this.immediate_dominators,s)),this.immediate_dominators[t]=this.find_common_dominator(this.immediate_dominators[t],s)):this.immediate_dominators[t]=s}}},e.prototype.post_order_visit=function(e){if(this.has_visited_forward_edge(e))return!0;if(this.is_back_edge(e))return!1;et(Je,this.visit_order,e).set(0);var t=this.compiler.get(J,e);switch(t.merge===P.Loop&&this.post_order_visit(t.merge_block)&&this.add_branch(e,t.merge_block),t.terminator){case C.Direct:this.post_order_visit(t.next_block)&&this.add_branch(e,t.next_block);break;case C.Select:this.post_order_visit(t.true_block)&&this.add_branch(e,t.true_block),this.post_order_visit(t.false_block)&&this.add_branch(e,t.false_block);break;case C.MultiSelect:for(var r=0,i=this.compiler.get_case_list(t);r<i.length;r++){var a=i[r];this.post_order_visit(a.block)&&this.add_branch(e,a.block)}t.default_block&&this.post_order_visit(t.default_block)&&this.add_branch(e,t.default_block)}if(t.merge===P.Selection&&this.post_order_visit(t.next_block))if(this.preceding_edges.hasOwnProperty(t.next_block)){var s=this.preceding_edges[t.next_block],o=0;this.succeeding_edges.hasOwnProperty(e)&&(o=this.succeeding_edges[e].length),t.terminator===C.MultiSelect&&1===o?0===s.length&&this.add_branch(e,t.next_block):1===s.length&&s[0]!==e&&this.add_branch(e,t.next_block)}else this.add_branch(e,t.next_block);return et(Je,this.visit_order,e).set(++this.visit_count),this.post_order.push(e),!0},e.prototype.is_back_edge=function(e){return this.visit_order.hasOwnProperty(e)&&0===this.visit_order[e].get()},e.prototype.has_visited_forward_edge=function(e){return this.visit_order.hasOwnProperty(e)&&this.visit_order[e].get()>0},e}(),it=function(e){function t(t){var r=e.call(this)||this;return r.function_cfgs=[],r.compiler=t,r}return a(t,e),t.prototype.handle=function(e,t,r){return!0},t.prototype.follow_function_call=function(e){return!this.function_cfgs.hasOwnProperty(e.self)&&(this.function_cfgs[e.self]=new rt(this.compiler,e),!0)},t}(Fe),at=function(e){function r(t,r){var i=e.call(this)||this;return i.accessed_variables_to_block=[],i.accessed_temporaries_to_block=[],i.result_id_to_type=[],i.complete_write_variables_to_block=[],i.partial_write_variables_to_block=[],i.access_chain_expressions=new Set,i.access_chain_children=[],i.current_block=null,i.compiler=t,i.entry=r,i}return a(r,e),r.prototype.follow_function_call=function(e){return!1},r.prototype.set_current_block=function(e){var t=this,r=this.compiler;this.current_block=e;var i=function(i){for(var a=r.get(J,i),s=0,o=a.phi_variables;s<o.length;s++){var n=o[s];n.parent===e.self&&(et(Set,t.accessed_variables_to_block,n.function_variable).add(e.self),et(Set,t.accessed_variables_to_block,n.function_variable).add(a.self),t.notify_variable_access(n.local_variable,e.self))}};switch(e.terminator){case C.Direct:this.notify_variable_access(e.condition,e.self),i(e.next_block);break;case C.Select:this.notify_variable_access(e.condition,e.self),i(e.true_block),i(e.false_block);break;case C.MultiSelect:this.notify_variable_access(e.condition,e.self);for(var a=0,s=r.get_case_list(e);a<s.length;a++){i(s[a].block)}e.default_block&&i(e.default_block)}},r.prototype.notify_variable_access=function(e,t){var r=this;if(0!==e){if(this.access_chain_children.hasOwnProperty(e))this.access_chain_children[e].forEach((function(e){return r.notify_variable_access(e,t)}));this.id_is_phi_variable(e)?et(Set,this.accessed_variables_to_block,e).add(t):this.id_is_potential_temporary(e)&&et(Set,this.accessed_temporaries_to_block,e).add(t)}},r.prototype.id_is_phi_variable=function(e){if(e>=this.compiler.get_current_id_bound())return!1;var t=this.compiler.maybe_get(T,e);return!!t&&t.phi_variable},r.prototype.id_is_potential_temporary=function(e){return!(e>=this.compiler.get_current_id_bound())&&(this.compiler.ir.ids[e].empty()||this.compiler.ir.ids[e].get_type()===t.Expression)},r.prototype.handle=function(e,t,r){var i=this.compiler,a=i.instruction_to_result_type(e,t,r);switch(a&&(this.result_id_to_type[a.result_id]=a.result_type),e){case re.Store:if(r<2)return!1;var s=t[0];(u=i.maybe_get_backing_variable(s))&&(et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),u.self===s?et(Set,this.complete_write_variables_to_block,u.self).add(this.current_block.self):et(Set,this.partial_write_variables_to_block,u.self).add(this.current_block.self)),this.notify_variable_access(t[0],this.current_block.self),this.notify_variable_access(t[1],this.current_block.self);break;case re.AccessChain:case re.InBoundsAccessChain:case re.PtrAccessChain:if(r<3)return!1;s=t[2];(u=this.compiler.maybe_get(T,s))&&(et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),et(Set,this.access_chain_children,t[1]).add(u.self));for(var o=2;o<r;o++)this.notify_variable_access(t[o],this.current_block.self),et(Set,this.access_chain_children,t[1]).add(t[o]);this.notify_variable_access(t[1],this.current_block.self);var n=i.set(ae,t[1],"",t[0],!0),_=i.maybe_get_backing_variable(s);n.loaded_from=_?_.self:0,i.ir.ids[t[1]].set_allow_type_rewrite(),this.access_chain_expressions.add(t[1]);break;case re.CopyMemory:if(r<2)return!1;var c=t[0],l=t[1];(u=i.maybe_get_backing_variable(c))&&(et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),u.self===c?et(Set,this.complete_write_variables_to_block,u.self).add(this.current_block.self):et(Set,this.partial_write_variables_to_block,u.self).add(this.current_block.self));for(o=0;o<2;o++)this.notify_variable_access(t[o],this.current_block.self);(u=i.maybe_get_backing_variable(l))&&et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self);break;case re.CopyObject:if(r<3)return!1;(u=i.maybe_get_backing_variable(t[2]))&&et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),this.notify_variable_access(t[1],this.current_block.self),this.access_chain_expressions.has(t[2])&&this.access_chain_expressions.add(t[1]),this.notify_variable_access(t[2],this.current_block.self);break;case re.Load:if(r<3)return!1;s=t[2];(u=i.maybe_get_backing_variable(s))&&et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),this.notify_variable_access(t[1],this.current_block.self),this.notify_variable_access(t[2],this.current_block.self);break;case re.FunctionCall:if(r<3)return!1;i.get_type(t[0]).basetype!==E.Void&&this.notify_variable_access(t[1],this.current_block.self),r-=3,t=t.slice(3);for(o=0;o<r;o++){(u=i.maybe_get_backing_variable(t[o]))&&(et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),et(Set,this.partial_write_variables_to_block,u.self).add(this.current_block.self)),this.notify_variable_access(t[o],this.current_block.self)}break;case re.Select:for(o=1;o<r;o++){if(o>=3)(u=i.maybe_get_backing_variable(t[o]))&&(et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),et(Set,this.partial_write_variables_to_block,u.self).add(this.current_block.self));this.notify_variable_access(t[o],this.current_block.self)}break;case re.ExtInst:for(o=4;o<r;o++)this.notify_variable_access(t[o],this.current_block.self);this.notify_variable_access(t[1],this.current_block.self);var p=t[2];if(i.get(ie,p).ext===Q.GLSL)switch(t[3]){case Oe.Modf:case Oe.Frexp:var u;s=t[5];(u=i.maybe_get_backing_variable(s))&&(et(Set,this.accessed_variables_to_block,u.self).add(this.current_block.self),u.self===s?et(Set,this.complete_write_variables_to_block,u.self).add(this.current_block.self):et(Set,this.partial_write_variables_to_block,u.self).add(this.current_block.self))}break;case re.ArrayLength:this.notify_variable_access(t[1],this.current_block.self);break;case re.Line:case re.NoLine:break;case re.CompositeInsert:case re.VectorShuffle:for(o=1;o<4;o++)this.notify_variable_access(t[o],this.current_block.self);break;case re.CompositeExtract:for(o=1;o<3;o++)this.notify_variable_access(t[o],this.current_block.self);break;case re.ImageWrite:for(o=0;o<r;o++)3!==o&&this.notify_variable_access(t[o],this.current_block.self);break;case re.ImageSampleImplicitLod:case re.ImageSampleExplicitLod:case re.ImageSparseSampleImplicitLod:case re.ImageSparseSampleExplicitLod:case re.ImageSampleProjImplicitLod:case re.ImageSampleProjExplicitLod:case re.ImageSparseSampleProjImplicitLod:case re.ImageSparseSampleProjExplicitLod:case re.ImageFetch:case re.ImageSparseFetch:case re.ImageRead:case re.ImageSparseRead:for(o=1;o<r;o++)4!==o&&this.notify_variable_access(t[o],this.current_block.self);break;case re.ImageSampleDrefImplicitLod:case re.ImageSampleDrefExplicitLod:case re.ImageSparseSampleDrefImplicitLod:case re.ImageSparseSampleDrefExplicitLod:case re.ImageSampleProjDrefImplicitLod:case re.ImageSampleProjDrefExplicitLod:case re.ImageSparseSampleProjDrefImplicitLod:case re.ImageSparseSampleProjDrefExplicitLod:case re.ImageGather:case re.ImageSparseGather:case re.ImageDrefGather:case re.ImageSparseDrefGather:for(o=1;o<r;o++)5!==o&&this.notify_variable_access(t[o],this.current_block.self);break;default:for(o=0;o<r;o++)this.notify_variable_access(t[o],this.current_block.self)}return!0},r.prototype.handle_terminator=function(e){switch(e.terminator){case C.Return:e.return_value&&this.notify_variable_access(e.return_value,e.self);break;case C.Select:case C.MultiSelect:this.notify_variable_access(e.condition,e.self)}return!0},r}(Fe),st=function(e){function t(t,r){var i=e.call(this)||this;return i.static_expression=0,i.write_count=0,i.variable_id=r,i}return a(t,e),t.prototype.follow_function_call=function(e){return!1},t.prototype.handle=function(e,t,r){switch(e){case re.Store:if(r<2)return!1;t[0]===this.variable_id&&(this.static_expression=t[1],this.write_count++);break;case re.Load:if(r<3)return!1;if(t[2]===this.variable_id&&0===this.static_expression)return!1;break;case re.AccessChain:case re.InBoundsAccessChain:case re.PtrAccessChain:if(r<3)return!1;if(t[2]===this.variable_id)return!1}return!0},t}(Fe),ot=function(e){function t(t){var r=e.call(this)||this;return r.compiler=t,r}return a(t,e),t.prototype.handle=function(e,t,r){return!1},t.prototype.handle_builtin=function(e,t,r){if(t===m.ClipDistance){if(!e.array_size_literal[0])throw new Error("Array size for ClipDistance must be a literal.");if(0===(i=e.array[0]))throw new Error("Array size for ClipDistance must not be unsized.");this.compiler.clip_distance_count=i}else if(t===m.CullDistance){if(!e.array_size_literal[0])throw new Error("Array size for CullDistance must be a literal.");var i;if(0===(i=e.array[0]))throw new Error("Array size for CullDistance must not be unsized.");this.compiler.cull_distance_count=i}else t===m.Position&&r.get(te.Invariant)&&(this.compiler.position_invariant=!0)},t.prototype.add_if_builtin_or_block=function(e){this.add_if_builtin(e,!0)},t.prototype.add_if_builtin=function(e,t){void 0===t&&(t=!1);var r=this.compiler,i=r.maybe_get(T,e),a=r.ir.find_meta(e);if(i&&a){var s=r.get(R,i.basetype),o=a.decoration,n=s.storage===v.Input?r.active_input_builtins:r.active_output_builtins;if(o.builtin)n.set(o.builtin_type),this.handle_builtin(s,o.builtin_type,o.decoration_flags);else if(t&&r.has_decoration(s.self,te.Block))for(var _=s.member_types.length,c=0;c<_;c++)if(r.has_member_decoration(s.self,c,te.BuiltIn)){var l=r.get(R,s.member_types[c]),p=r.get_member_decoration(s.self,c,te.BuiltIn);n.set(p),this.handle_builtin(l,p,r.get_member_decoration_bitset(s.self,c))}}},t}(Fe),nt=function(e){function t(t){var r=e.call(this)||this;return r.dref_combined_samplers=new Set,r.compiler=t,r}return a(t,e),t.prototype.handle=function(e,t,r){switch(e){case re.ImageSampleDrefExplicitLod:case re.ImageSampleDrefImplicitLod:case re.ImageSampleProjDrefExplicitLod:case re.ImageSampleProjDrefImplicitLod:case re.ImageSparseSampleProjDrefImplicitLod:case re.ImageSparseSampleDrefImplicitLod:case re.ImageSparseSampleProjDrefExplicitLod:case re.ImageSparseSampleDrefExplicitLod:case re.ImageDrefGather:case re.ImageSparseDrefGather:return this.dref_combined_samplers.add(t[2]),!0}return!0},t}(Fe),_t=function(e){function t(t,r){var i=e.call(this)||this;return i.dref_combined_samplers=new Set,i.dependency_hierarchy=[],i.comparison_ids=new Set,i.need_subpass_input=!1,i.compiler=t,i.dref_combined_samplers=r,i}return a(t,e),t.prototype.begin_function_scope=function(e,t){if(t<3)return!1;var r=this.compiler.get(j,e[2]);t-=3;for(var i=0;i<t;i++){var a=r.arguments[i];this.add_dependency(a.id,e[3+i])}return!0},t.prototype.handle=function(e,t,r){switch(e){case re.ImageSampleDrefExplicitLod:case re.ImageSampleDrefImplicitLod:case re.ImageSampleProjDrefExplicitLod:case re.ImageSampleProjDrefImplicitLod:case re.ImageSparseSampleProjDrefImplicitLod:case re.ImageSparseSampleDrefImplicitLod:case re.ImageSparseSampleProjDrefExplicitLod:case re.ImageSparseSampleDrefExplicitLod:case re.ImageDrefGather:case re.ImageSparseDrefGather:return this.dref_combined_samplers.add(t[2]),!0}return!0},t.prototype.add_hierarchy_to_comparison_ids=function(e){var t=this;this.comparison_ids.add(e),et(Set,this.dependency_hierarchy,e).forEach((function(e){return t.add_hierarchy_to_comparison_ids(e)}))},t.prototype.add_dependency=function(e,t){et(Set,this.dependency_hierarchy,e).add(t),this.comparison_ids.has(t)&&this.comparison_ids.add(e)},t}(Fe),ct=function(e){function t(t,r){var i=e.call(this)||this;return i.interlock_function_id=0,i.current_block_id=0,i.split_function_case=!1,i.control_flow_interlock=!1,i.call_stack=[],i.compiler=t,i.call_stack.push(r),i}return a(t,e),t.prototype.rearm_current_block=function(e){this.current_block_id=e.self},t.prototype.begin_function_scope=function(e,t){return!(t<3)&&(this.call_stack.push(e[2]),!0)},t.prototype.end_function_scope=function(e,t){return this.call_stack.pop(),!0},t.prototype.handle=function(e,t,r){if(e===re.BeginInvocationInterlockEXT||e===re.EndInvocationInterlockEXT){if(0!==this.interlock_function_id&&this.interlock_function_id!==this.call_stack[this.call_stack.length-1])return this.split_function_case=!0,!1;var i=this.compiler;this.interlock_function_id=this.call_stack[this.call_stack.length-1];var a=i.get_cfg_for_function(this.interlock_function_id),s=i.get(j,this.interlock_function_id).entry_block;a.node_terminates_control_flow_in_sub_graph(s,this.current_block_id)||(this.control_flow_interlock=!0)}return!0},t}(Fe),lt=function(e){function t(t,r){var i=e.call(this)||this;return i.in_crit_sec=!1,i.interlock_function_id=0,i.split_function_case=!1,i.control_flow_interlock=!1,i.use_critical_section=!1,i.call_stack_is_interlocked=!1,i.call_stack=[],i.compiler=t,i.call_stack.push(r),i}return a(t,e),t.prototype.handle=function(e,t,r){if(this.use_critical_section){if(e===re.BeginInvocationInterlockEXT)return this.in_crit_sec=!0,!0;if(e===re.EndInvocationInterlockEXT)return!1}var i=this.compiler;switch(e){case re.Load:if(r<3)return!1;var a=t[2];if(!(h=this.compiler.maybe_get_backing_variable(a)))break;switch(h.storage){default:break;case v.UniformConstant:var s=t[0],o=t[1];i.set(ae,o,"",s,!0),i.register_read(o,a,!0);break;case v.Uniform:if(!i.has_decoration(i.get(R,h.basetype).self,te.BufferBlock))break;case v.StorageBuffer:this.access_potential_resource(h.self)}break;case re.InBoundsAccessChain:case re.AccessChain:case re.PtrAccessChain:if(r<3)return!1;s=t[0];var n=i.get(R,s);if(n.storage===v.Uniform||n.storage===v.UniformConstant||n.storage===v.StorageBuffer){o=t[1],a=t[2];i.set(ae,o,"",s,!0),i.register_read(o,a,!0),i.ir.ids[o].set_allow_type_rewrite()}break;case re.ImageTexelPointer:if(r<3)return!1;s=t[0],o=t[1],a=t[2];var _=i.set(ae,o,"",s,!0);(h=i.maybe_get_backing_variable(a))&&(_.loaded_from=h.self);break;case re.Store:case re.ImageWrite:case re.AtomicStore:if(r<1)return!1;a=t[0];!(h=i.maybe_get_backing_variable(a))||h.storage!==v.Uniform&&h.storage!==v.UniformConstant&&h.storage!==v.StorageBuffer||this.access_potential_resource(h.self);break;case re.CopyMemory:if(r<2)return!1;var c=t[0],l=t[1],p=i.maybe_get_backing_variable(c),u=i.maybe_get_backing_variable(l);if(!p||p.storage!==v.Uniform&&p.storage!==v.StorageBuffer||this.access_potential_resource(p.self),u){if(u.storage!==v.Uniform&&u.storage!==v.StorageBuffer)break;if(u.storage===v.Uniform&&!i.has_decoration(i.get(R,u.basetype).self,te.BufferBlock))break;this.access_potential_resource(u.self)}break;case re.ImageRead:case re.AtomicLoad:if(r<3)return!1;a=t[2];if(!(h=i.maybe_get_backing_variable(a)))break;switch(h.storage){default:break;case v.Uniform:if(!i.has_decoration(i.get(R,h.basetype).self,te.BufferBlock))break;case v.UniformConstant:case v.StorageBuffer:this.access_potential_resource(h.self)}break;case re.AtomicExchange:case re.AtomicCompareExchange:case re.AtomicIIncrement:case re.AtomicIDecrement:case re.AtomicIAdd:case re.AtomicISub:case re.AtomicSMin:case re.AtomicUMin:case re.AtomicSMax:case re.AtomicUMax:case re.AtomicAnd:case re.AtomicOr:case re.AtomicXor:if(r<3)return!1;var h;a=t[2];!(h=i.maybe_get_backing_variable(a))||h.storage!==v.Uniform&&h.storage!==v.UniformConstant&&h.storage!==v.StorageBuffer||this.access_potential_resource(h.self)}return!0},t.prototype.begin_function_scope=function(e,t){return!(t<3)&&(e[2]===this.interlock_function_id&&(this.call_stack_is_interlocked=!0),this.call_stack.push(e[2]),!0)},t.prototype.end_function_scope=function(e,t){return this.call_stack[this.call_stack.length-1]===this.interlock_function_id&&(this.call_stack_is_interlocked=!1),this.call_stack.pop(),!0},t.prototype.access_potential_resource=function(e){(this.use_critical_section&&this.in_crit_sec||this.control_flow_interlock&&this.call_stack_is_interlocked||this.split_function_case)&&this.compiler.interlocked_resources.add(e)},t}(Fe),pt=function(){this.alignment=0};!function(e){e[e.None=0]="None",e[e.Volatile=1]="Volatile",e[e.Aligned=2]="Aligned",e[e.Nontemporal=4]="Nontemporal",e[e.MakePointerAvailable=8]="MakePointerAvailable",e[e.MakePointerAvailableKHR=8]="MakePointerAvailableKHR",e[e.MakePointerVisible=16]="MakePointerVisible",e[e.MakePointerVisibleKHR=16]="MakePointerVisibleKHR",e[e.NonPrivatePointer=32]="NonPrivatePointer",e[e.NonPrivatePointerKHR=32]="NonPrivatePointerKHR"}(tt||(tt={}));var ut,ht=function(e){function t(t){var r=e.call(this)||this;return r.non_block_types=new Set,r.physical_block_type_meta=[],r.access_chain_to_physical_block=[],r.compiler=t,r}return a(t,e),t.prototype.handle=function(e,t,r){switch(e){case re.ConvertUToPtr:case re.Bitcast:case re.CompositeExtract:this.setup_meta_chain(t[0],t[1]);break;case re.AccessChain:case re.InBoundsAccessChain:case re.PtrAccessChain:case re.CopyObject:var i=this.access_chain_to_physical_block[t[2]];i&&(this.access_chain_to_physical_block[t[1]]=i);break;case re.Load:this.setup_meta_chain(t[0],t[1]),r>=4&&this.mark_aligned_access(t[2],t.slice(3),r-3);break;case re.Store:r>=3&&this.mark_aligned_access(t[0],t.slice(3),r-2)}return!0},t.prototype.mark_aligned_access=function(e,t,r){var i=t[0],a=0;if(--r&&0!=(i&tt.Volatile)&&(a++,r--),r&&0!=(i&tt.Aligned)){var s=t[a],o=this.find_block_meta(e);o&&s>o.alignment&&(o.alignment=s)}},t.prototype.find_block_meta=function(e){return this.access_chain_to_physical_block[e]||null},t.prototype.type_is_bda_block_entry=function(e){var t=this.compiler.get(R,e);return t.storage===v.PhysicalStorageBufferEXT&&t.pointer&&1===t.pointer_depth&&!this.compiler.type_is_array_of_pointers(t)},t.prototype.setup_meta_chain=function(e,t){if(this.type_is_bda_block_entry(e)){var r=et(pt,this.physical_block_type_meta,e);this.access_chain_to_physical_block[t]=r;var i=this.compiler.get(R,e);i.basetype!==E.Struct&&this.non_block_types.add(e),0===r.alignment&&(r.alignment=this.get_minimum_scalar_alignment(this.compiler.get_pointee_type(i)))}},t.prototype.get_minimum_scalar_alignment=function(e){if(e.storage===v.PhysicalStorageBufferEXT)return 8;if(e.basetype===E.Struct){for(var t=0,r=0,i=e.member_types;r<i.length;r++){var a=i[r],s=this.get_minimum_scalar_alignment(this.compiler.get(R,a));s>t&&(t=s)}return t}return e.width/8},t.prototype.analyze_non_block_types_from_block=function(e){for(var t=0,r=e.member_types;t<r.length;t++){var i=r[t],a=this.compiler.get(R,i);a.basetype!==E.Struct&&a.pointer&&a.storage===v.PhysicalStorageBufferEXT?this.non_block_types.add(this.get_base_non_block_type_id(i)):a.basetype!==E.Struct||a.pointer||this.analyze_non_block_types_from_block(a)}},t.prototype.get_base_non_block_type_id=function(e){for(var t=this.compiler.get(R,e);t.pointer&&t.storage===v.PhysicalStorageBufferEXT&&!this.type_is_bda_block_entry(e);)e=t.parent_type,t=this.compiler.get(R,e);return console.assert(this.type_is_bda_block_entry(e)),e},t}(Fe);!function(e){e[e.Unknown=0]="Unknown",e[e.Rgba32f=1]="Rgba32f",e[e.Rgba16f=2]="Rgba16f",e[e.R32f=3]="R32f",e[e.Rgba8=4]="Rgba8",e[e.Rgba8Snorm=5]="Rgba8Snorm",e[e.Rg32f=6]="Rg32f",e[e.Rg16f=7]="Rg16f",e[e.R11fG11fB10f=8]="R11fG11fB10f",e[e.R16f=9]="R16f",e[e.Rgba16=10]="Rgba16",e[e.Rgb10A2=11]="Rgb10A2",e[e.Rg16=12]="Rg16",e[e.Rg8=13]="Rg8",e[e.R16=14]="R16",e[e.R8=15]="R8",e[e.Rgba16Snorm=16]="Rgba16Snorm",e[e.Rg16Snorm=17]="Rg16Snorm",e[e.Rg8Snorm=18]="Rg8Snorm",e[e.R16Snorm=19]="R16Snorm",e[e.R8Snorm=20]="R8Snorm",e[e.Rgba32i=21]="Rgba32i",e[e.Rgba16i=22]="Rgba16i",e[e.Rgba8i=23]="Rgba8i",e[e.R32i=24]="R32i",e[e.Rg32i=25]="Rg32i",e[e.Rg16i=26]="Rg16i",e[e.Rg8i=27]="Rg8i",e[e.R16i=28]="R16i",e[e.R8i=29]="R8i",e[e.Rgba32ui=30]="Rgba32ui",e[e.Rgba16ui=31]="Rgba16ui",e[e.Rgba8ui=32]="Rgba8ui",e[e.R32ui=33]="R32ui",e[e.Rgb10a2ui=34]="Rgb10a2ui",e[e.Rg32ui=35]="Rg32ui",e[e.Rg16ui=36]="Rg16ui",e[e.Rg8ui=37]="Rg8ui",e[e.R16ui=38]="R16ui",e[e.R8ui=39]="R8ui",e[e.R64ui=40]="R64ui",e[e.R64i=41]="R64i",e[e.Max=2147483647]="Max"}(ut||(ut={}));var ft=function(){function e(e){this.global_variables=[],this.aliased_variables=[],this.current_loop_level=0,this.active_interface_variables=new Set,this.check_active_interface_variables=!1,this.invalid_expressions=new Set,this.is_force_recompile=!1,this.combined_image_samplers=[],this.forced_temporaries=new Set,this.forwarded_temporaries=new Set,this.suppressed_usage_tracking=new Set,this.hoisted_temporaries=new Set,this.forced_invariant_temporaries=new Set,this.active_input_builtins=new y,this.active_output_builtins=new y,this.clip_distance_count=0,this.cull_distance_count=0,this.position_invariant=!1,this.comparison_ids=new Set,this.need_subpass_input=!1,this.physical_storage_non_block_pointer_types=[],this.physical_storage_type_to_alignment=[],this.interlocked_resources=new Set,this.interlocked_is_complex=!1,this.declared_block_names=[],this.set_ir(e)}return e.prototype.get_name=function(e){return this.ir.get_name(e)},e.prototype.set_decoration=function(e,t,r){void 0===r&&(r=0),this.ir.set_decoration(e,t,r)},e.prototype.set_decoration_string=function(e,t,r){this.ir.set_decoration_string(e,t,r)},e.prototype.set_name=function(e,t){this.ir.set_name(e,t)},e.prototype.get_decoration_bitset=function(e){return this.ir.get_decoration_bitset(e)},e.prototype.get_declared_struct_member_size=function(e,t){if(0===e.member_types.length)throw new Error("Declared struct in block cannot be empty.");var r=this.get_member_decoration_bitset(e.self,t),i=this.get(R,e.member_types[t]);switch(i.basetype){case E.Unknown:case E.Void:case E.Boolean:case E.AtomicCounter:case E.Image:case E.SampledImage:case E.Sampler:throw new Error("Querying size for object with opaque size.")}if(i.pointer&&i.storage===v.PhysicalStorageBuffer&&i.pointer_depth>this.get(R,i.parent_type).pointer_depth)return 8;if(i.array.length>0){var a=i.array_size_literal[i.array_size_literal.length-1]?i.array[i.array.length-1]:this.evaluate_constant_u32(i.array[i.array.length-1]);return this.type_struct_member_array_stride(e,t)*a}if(i.basetype===E.Struct)return this.get_declared_struct_size(i);var s=i.vecsize,o=i.columns;if(1===o)return s*(i.width/8);var n=this.type_struct_member_matrix_stride(e,t);if(r.get(te.RowMajor))return n*s;if(r.get(te.ColMajor))return n*o;throw new Error("Either row-major or column-major must be declared for matrices.")},e.prototype.get_active_interface_variables=function(){var e=this,t=this.ir,r=new Set,i=new Xe(this,r);return this.traverse_all_reachable_opcodes(this.get(j,t.default_entry_point),i),t.for_each_typed_id(T,(function(t,i){i.storage===v.Output&&e.interface_variable_exists_in_entry_point(i.self)&&(0===i.initializer&&e.get_execution_model()===ve.Fragment||r.add(i.self))})),this.dummy_sampler_id&&r.add(this.dummy_sampler_id),r},e.prototype.set_enabled_interface_variables=function(e){this.active_interface_variables=e,this.check_active_interface_variables=!0},e.prototype.get_shader_resources=function(e){var t=this,r=new Qe,i=this.ir,a=this.reflection_ssbo_instance_name_is_significant();return i.for_each_typed_id(T,(function(s,o){var n=t.get(R,o.basetype);if(o.storage!==v.Function&&n.pointer&&(!e||e.has(o.self))){var _=!0;if(i.get_spirv_version()<66560&&o.storage!==v.Input&&o.storage!==v.Output||(_=t.interface_variable_exists_in_entry_point(o.self)),_)if(t.is_builtin_variable(o)){if(o.storage!==v.Input&&o.storage!==v.Output)return;var c=o.storage===v.Input?r.builtin_inputs:r.builtin_outputs,l=new We;if(t.has_decoration(n.self,te.Block)){l.resource=new je(o.self,o.basetype,n.self,t.get_remapped_declared_block_name(o.self,!1));for(var p=0;p<n.member_types.length;p++)l.value_type_id=n.member_types[p],l.builtin=t.get_member_decoration(n.self,p,te.BuiltIn),c.push(l)}else{var u=!t.has_decoration(o.self,te.Patch)&&(t.get_execution_model()===ve.TessellationControl||t.get_execution_model()===ve.TessellationEvaluation&&o.storage===v.Input);l.resource=new je(o.self,o.basetype,n.self,t.get_name(o.self)),u&&n.array.length>0?l.value_type_id=t.get_variable_data_type(o).parent_type:l.value_type_id=t.get_variable_data_type_id(o),console.assert(l.value_type_id),l.builtin=t.get_decoration(o.self,te.BuiltIn),c.push(l)}}else o.storage===v.Input?t.has_decoration(n.self,te.Block)?r.stage_inputs.push(new je(o.self,o.basetype,n.self,t.get_remapped_declared_block_name(o.self,!1))):r.stage_inputs.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):o.storage===v.UniformConstant&&n.image.dim===Ue.SubpassData?r.subpass_inputs.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):o.storage===v.Output?t.has_decoration(n.self,te.Block)?r.stage_outputs.push(new je(o.self,o.basetype,n.self,t.get_remapped_declared_block_name(o.self,!1))):r.stage_outputs.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.Uniform&&t.has_decoration(n.self,te.Block)?r.uniform_buffers.push(new je(o.self,o.basetype,n.self,t.get_remapped_declared_block_name(o.self,!1))):n.storage===v.Uniform&&t.has_decoration(n.self,te.BufferBlock)||n.storage===v.StorageBuffer?r.storage_buffers.push(new je(o.self,o.basetype,n.self,t.get_remapped_declared_block_name(o.self,a))):n.storage===v.PushConstant?r.push_constant_buffers.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.UniformConstant&&n.basetype===E.Image&&2===n.image.sampled?r.storage_images.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.UniformConstant&&n.basetype===E.Image&&1===n.image.sampled?r.separate_images.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.UniformConstant&&n.basetype===E.Sampler?r.separate_samplers.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.UniformConstant&&n.basetype===E.SampledImage?r.sampled_images.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.AtomicCounter?r.atomic_counters.push(new je(o.self,o.basetype,n.self,t.get_name(o.self))):n.storage===v.UniformConstant&&n.basetype===E.AccelerationStructure&&r.acceleration_structures.push(new je(o.self,o.basetype,n.self,t.get_name(o.self)))}})),r},e.prototype.get_common_basic_type=function(e){if(e.basetype===E.Struct){for(var t=E.Unknown,r=0,i=e.member_types;r<i.length;r++){var a=i[r],s=this.get_common_basic_type(this.get(R,a));if(void 0===s)return;if(t===E.Unknown)t=s;else if(t!==s)return}return t}return e.basetype},e.prototype.set_remapped_variable_state=function(e,t){this.get(T,e).remapped_variable=t},e.prototype.get_remapped_variable_state=function(e){return this.get(T,e).remapped_variable},e.prototype.set_subpass_input_remapped_components=function(e,t){this.get(T,e).remapped_components=t},e.prototype.get_subpass_input_remapped_components=function(e){return this.get(T,e).remapped_components},e.prototype.get_entry_points_and_stages=function(){var e=[];return this.ir.entry_points.forEach((function(t){return e.push(new Ge(t.orig_name,t.model))})),e},e.prototype.set_entry_point=function(e,t){var r=this.get_entry_point(e,t);this.ir.default_entry_point=r.self},e.prototype.rename_entry_point=function(e,t,r){var i=this.get_entry_point(e,r);i.orig_name=t,i.name=t},e.prototype.get_entry_point=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.ir;if(0===e.length)return r.entry_points[r.default_entry_point];var i=r.entry_points.find((function(t){return t.orig_name===e[0]&&t.model===e[1]}));if(!i)throw new Error("Entry point does not exist.");return i},e.prototype.update_active_builtins=function(){var e=this,t=this.ir;this.active_input_builtins.reset(),this.active_output_builtins.reset(),this.cull_distance_count=0,this.clip_distance_count=0;var r=new ot(this);this.traverse_all_reachable_opcodes(this.get(j,t.default_entry_point),r),t.for_each_typed_id(T,(function(t,i){i.storage===v.Output&&e.interface_variable_exists_in_entry_point(i.self)&&0!==i.initializer&&r.add_if_builtin_or_block(i.self)}))},e.prototype.has_active_builtin=function(e,t){var r;switch(t){case v.Input:r=this.active_input_builtins;break;case v.Output:r=this.active_output_builtins;break;default:return!1}return r.get(e)},e.prototype.get_execution_model=function(){return this.get_entry_point().model},e.prototype.get_work_group_size_specialization_constants=function(e,t,r){var i=this.get_entry_point();if(e.constant_id=t.constant_id=r.constant_id=0,e.id=t.id=r.id=0,0!==i.workgroup_size.constant){var a=this.get(O,i.workgroup_size.constant);0!==a.m.c[0].id[0]&&(e.id=a.m.c[0].id[0],e.constant_id=this.get_decoration(a.m.c[0].id[0],te.SpecId)),0!==a.m.c[0].id[1]&&(t.id=a.m.c[0].id[1],t.constant_id=this.get_decoration(a.m.c[0].id[1],te.SpecId)),0!==a.m.c[0].id[2]&&(r.id=a.m.c[0].id[2],r.constant_id=this.get_decoration(a.m.c[0].id[2],te.SpecId))}else if(i.flags.get(Ee.LocalSizeId)){this.get(O,i.workgroup_size.id_x).specialization&&(e.id=i.workgroup_size.id_x,e.constant_id=this.get_decoration(i.workgroup_size.id_x,te.SpecId)),this.get(O,i.workgroup_size.id_y).specialization&&(t.id=i.workgroup_size.id_y,t.constant_id=this.get_decoration(i.workgroup_size.id_y,te.SpecId)),this.get(O,i.workgroup_size.id_z).specialization&&(r.id=i.workgroup_size.id_z,r.constant_id=this.get_decoration(i.workgroup_size.id_z,te.SpecId))}return i.workgroup_size.constant},e.prototype.build_dummy_sampler_for_combined_images=function(){var e=new He(this);this.traverse_all_reachable_opcodes(this.get(j,this.ir.default_entry_point),e);var t=this.ir;if(e.need_dummy_sampler){var r=t.increase_bound_by(3),i=r,a=r+1,s=r+2,o=this.set(R,i);o.basetype=E.Sampler;var n=this.set(R,a);return h(o,n),n.self=i,n.storage=v.UniformConstant,n.pointer=!0,n.parent_type=i,this.set(T,s,a,v.UniformConstant,0),this.set_name(s,"SPIRV_Cross_DummySampler"),this.dummy_sampler_id=s,s}return 0},e.prototype.build_combined_image_samplers=function(){this.ir.for_each_typed_id(j,(function(e,t){t.combined_parameters=[],t.shadow_arguments=[],t.do_combined_parameters=!0})),this.combined_image_samplers=[];var e=new Ye(this);this.traverse_all_reachable_opcodes(this.get(j,this.ir.default_entry_point),e)},e.prototype.get_combined_image_samplers=function(){return this.combined_image_samplers},e.prototype.set_variable_type_remap_callback=function(e){this.variable_remap_callback=e},e.prototype.get_current_id_bound=function(){return this.ir.ids.length},e.prototype.stream=function(e){if(!e.length)return null;if(e.is_embedded()){var t=e;return console.assert(t.ops.length===e.length),new Uint32Array(t.ops)}if(e.offset+e.length>this.ir.spirv.length)throw new Error("Compiler::stream() out of range.");return this.ir.spirv.slice(e.offset,e.offset+e.length)},e.prototype.execution_is_branchless=function(e,t){for(var r=e;;){if(r.self===t.self)return!0;if(r.terminator!==C.Direct||r.merge!==P.None)return!1;r=this.get(J,r.next_block)}},e.prototype.execution_is_direct_branch=function(e,t){return e.terminator===C.Direct&&e.merge===P.None&&e.next_block===t.self},e.prototype.is_break=function(e){return this.ir.block_meta[e]=this.ir.block_meta[e]||0,0!=(this.ir.block_meta[e]&(Ne.LOOP_MERGE_BIT|Ne.MULTISELECT_MERGE_BIT))},e.prototype.is_loop_break=function(e){return this.ir.block_meta[e]=this.ir.block_meta[e]||0,0!=(this.ir.block_meta[e]&Ne.LOOP_MERGE_BIT)},e.prototype.is_conditional=function(e){return this.ir.block_meta[e]=this.ir.block_meta[e]||0,0!=(this.ir.block_meta[e]&(Ne.SELECTION_MERGE_BIT|Ne.MULTISELECT_MERGE_BIT))},e.prototype.flush_dependees=function(e){for(var t=0,r=e.dependees;t<r.length;t++){var i=r[t];this.invalid_expressions.add(i)}e.dependees=[]},e.prototype.flush_all_active_variables=function(){for(var e=0,t=this.current_function.local_variables;e<t.length;e++){var r=t[e];this.flush_dependees(this.get(T,r))}for(var i=0,a=this.current_function.arguments;i<a.length;i++){var s=a[i];this.flush_dependees(this.get(T,s.id))}for(var o=0,n=this.global_variables;o<n.length;o++){var _=n[o];this.flush_dependees(this.get(T,_))}this.flush_all_aliased_variables()},e.prototype.flush_all_aliased_variables=function(){for(var e=0,t=this.aliased_variables;e<t.length;e++){var r=t[e];this.flush_dependees(this.get(T,r))}},e.prototype.flush_control_dependent_expressions=function(e){for(var t=this.get(J,e),r=0,i=t.invalidate_expressions;r<i.length;r++){var a=i[r];this.invalid_expressions.add(a)}t.invalidate_expressions=[]},e.prototype.register_global_read_dependencies=function(e,t){if(e instanceof j)for(var r=0,i=e.blocks;r<i.length;r++){var a=i[r];this.register_global_read_dependencies(this.get(J,a),t)}else for(var s=0,o=e.ops;s<o.length;s++){var n=o[s],_=this.stream(n);switch(n.op){case re.FunctionCall:var c=_[2];this.register_global_read_dependencies(this.get(j,c),t);break;case re.Load:case re.ImageRead:var l=this.maybe_get_backing_variable(_[2]);if(l&&l.storage!==v.Function){var p=this.get(R,l.basetype);p.basetype!==E.Image&&p.image.dim!==Ue.SubpassData&&l.dependees.push(t)}}}},e.prototype.update_name_cache=function(e,t,r){if(!r)return r=t,t=e,this.update_name_cache(e,t,r);if(""===r)return r;var i=function(r){return!!e.has(r)||!(e===t||!t.has(r))},a=function(t){e.add(t)};if(!i(r))return a(r),r;var s=0,o=r,n=!0;"_"===o?o+="0":"_"===o.charAt(o.length-1)&&(n=!1);do{r=o+(n?"_":"")+le(++s)}while(i(r));return a(r),r},e.prototype.function_is_pure=function(e){for(var t=0,r=e.blocks;t<r.length;t++){var i=r[t];if(!this.block_is_pure(this.get(J,i)))return!1}return!0},e.prototype.block_is_pure=function(e){if(e.terminator===C.Kill||e.terminator===C.TerminateRay||e.terminator===C.IgnoreIntersection)return!1;for(var t=0,r=e.ops;t<r.length;t++){var i=r[t],a=this.stream(i);switch(i.op){case re.FunctionCall:var s=a[2];if(!this.function_is_pure(this.get(j,s)))return!1;break;case re.CopyMemory:case re.Store:if(this.expression_type(a[0]).storage!==v.Function)return!1;break;case re.ImageWrite:case re.ControlBarrier:case re.MemoryBarrier:case re.DemoteToHelperInvocationEXT:return!1;case re.ExtInst:var o=a[2];if(this.get(ie,o).ext===Q.GLSL)switch(a[3]){case Oe.Modf:case Oe.Frexp:if(this.expression_type(a[5]).storage!==v.Function)return!1}}}return!0},e.prototype.execution_is_noop=function(e,t){if(!this.execution_is_branchless(e,t))return!1;for(var r=e;;){if(r.self===t.self)return!0;if(r.ops.length>0)return!1;for(var i=this.get(J,r.next_block),a=0,s=i.phi_variables;a<s.length;a++){if(s[a].parent===r.self)return!1}r=i}},e.prototype.continue_block_type=function(e){if(e.complex_continue)return B.ComplexLoop;if(e.merge===P.Loop)return B.WhileLoop;if(e.loop_dominator===J.NoDominator)return B.ComplexLoop;var t=this.get(J,e.loop_dominator);if(this.execution_is_noop(e,t))return B.WhileLoop;if(this.execution_is_branchless(e,t))return B.ForLoop;var r=this.maybe_get(J,e.false_block),i=this.maybe_get(J,e.true_block),a=this.maybe_get(J,t.merge_block),s=r&&this.flush_phi_required(e.self,e.false_block),o=i&&this.flush_phi_required(e.self,e.true_block);if(s||o)return B.ComplexLoop;var n=e.true_block===t.self&&(e.false_block===t.merge_block||r&&a&&this.execution_is_noop(r,a)),_=e.false_block===t.self&&(e.true_block===t.merge_block||i&&a&&this.execution_is_noop(i,a));return e.merge===P.None&&e.terminator===C.Select&&(n||_)?B.DoWhileLoop:B.ComplexLoop},e.prototype.force_recompile=function(){this.is_force_recompile=!0},e.prototype.is_forcing_recompilation=function(){return this.is_force_recompile},e.prototype.block_is_loop_candidate=function(e,t){if(e.disable_block_optimization||e.complex_continue)return!1;if(t===D.MergeToSelectForLoop||t===D.MergeToSelectContinueForLoop){var r=this.maybe_get(J,e.false_block),i=this.maybe_get(J,e.true_block),a=this.maybe_get(J,e.merge_block),s=e.false_block===e.merge_block||r&&a&&this.execution_is_noop(r,a),o=e.true_block===e.merge_block||i&&a&&this.execution_is_noop(i,a),n=e.true_block!==e.merge_block&&e.true_block!==e.self&&s,_=e.false_block!==e.merge_block&&e.false_block!==e.self&&o;if((h=e.terminator===C.Select&&e.merge===P.Loop&&(n||_))&&n&&t===D.MergeToSelectContinueForLoop?h=e.true_block===e.continue_block:h&&_&&t===D.MergeToSelectContinueForLoop&&(h=e.false_block===e.continue_block),h){for(var c=0,l=e.phi_variables;c<l.length;c++){if((I=l[c]).parent===e.self)return!1}if(y=this.maybe_get(J,e.merge_block))for(var p=0,u=y.phi_variables;p<u.length;p++){if((I=u[p]).parent===e.self)return!1}}return h}if(t===D.MergeToDirectForLoop){var h;if(!(h=e.terminator===C.Direct&&e.merge===P.Loop&&0===e.ops.length))return!1;var f=this.get(J,e.next_block);r=this.maybe_get(J,f.false_block),i=this.maybe_get(J,f.true_block),a=this.maybe_get(J,e.merge_block),s=f.false_block===e.merge_block||r&&a&&this.execution_is_noop(r,a),o=f.true_block===e.merge_block||i&&a&&this.execution_is_noop(i,a),n=f.true_block!==e.merge_block&&f.true_block!==e.self&&s,_=f.false_block!==e.merge_block&&f.false_block!==e.self&&o;if(h=f.terminator===C.Select&&f.merge===P.None&&(n||_)){for(var d=0,m=e.phi_variables;d<m.length;d++){if((I=m[d]).parent===e.self||I.parent===f.self)return!1}for(var g=0,b=f.phi_variables;g<b.length;g++){if((I=b[g]).parent===e.self)return!1}var y;if(y=this.maybe_get(J,e.merge_block))for(var v=0,S=y.phi_variables;v<S.length;v++){var I;if((I=S[v]).parent===e.self||I.parent===f.false_block)return!1}}return h}return!1},e.prototype.inherit_expression_dependencies=function(e,t){if(this.forwarded_temporaries.has(e)&&!this.forced_temporaries.has(e)){var r=this.get(ae,e),i=this.maybe_get(T,t);(null==i?void 0:i.phi_variable)&&i.dependees.push(e);var a=this.maybe_get(ae,t);if(a){var s,o,n,_,c=r.expression_dependencies,l=a.expression_dependencies;c.push(t),c.push.apply(c,l),r.expression_dependencies=(s=c,void 0===o&&(o=!1),o&&(s=s.concat()),_=n?function(e,t){return!t||n(s[t],s[t-1])}:function(e,t){return!t||e!==s[t-1]},s.sort(n).filter(_))}}},e.prototype.add_implied_read_expression=function(e,t){e.implied_read_expressions.indexOf(t)<0&&e.implied_read_expressions.push(t)},e.prototype.clear_force_recompile=function(){this.is_force_recompile=!1},e.prototype.interface_variable_exists_in_entry_point=function(e){var t=this.get(T,e),r=this.ir;if(r.get_spirv_version()<66560){if(t.storage!==v.Input&&t.storage!==v.Output&&t.storage!==v.UniformConstant)throw new Error("Only Input, Output variables and Uniform constants are part of a shader linking interface.");if(_(r.entry_points)<=1)return!0}return this.get_entry_point().interface_variables.indexOf(e)>=0},e.prototype.remap_variable_type_name=function(e,t,r){return this.variable_remap_callback?this.variable_remap_callback(e,t,r):r},e.prototype.set_ir=function(e){this.ir=e,this.parse_fixup()},e.prototype.parse_fixup=function(){for(var e=this.ir,r=0,i=e.ids_for_constant_or_variable;r<i.length;r++){var a=i[r],s=e.ids[a];if(s.get_type()===t.Constant){var o=s.get(O);if(e.get_meta(o.self).decoration.builtin&&e.get_meta(o.self).decoration.builtin_type===m.WorkgroupSize)for(var n=0,_=e.entry_points;n<_.length;n++){var c=_[n];c.workgroup_size.constant=o.self,c.workgroup_size.x=o.scalar(0,0),c.workgroup_size.y=o.scalar(0,1),c.workgroup_size.z=o.scalar(0,2)}}else if(s.get_type()===t.Variable){var l=s.get(T);l.storage!==v.Private&&l.storage!==v.Workgroup&&l.storage!==v.Output||this.global_variables.push(l.self),this.variable_storage_is_aliased(l)&&this.aliased_variables.push(l.self)}}},e.prototype.variable_storage_is_aliased=function(e){var t=this.get(R,e.basetype),r=e.storage===v.StorageBuffer||this.ir.get_meta(t.self).decoration.decoration_flags.get(te.BufferBlock),i=t.basetype===E.Image,a=t.basetype===E.AtomicCounter,s=t.storage===v.PhysicalStorageBufferEXT;return!(r?this.ir.get_buffer_block_flags(e).get(te.Restrict):this.has_decoration(e.self,te.Restrict))&&(r||i||a||s)},e.prototype.add_loop_level=function(){this.current_loop_level++},e.prototype.set_initializers=function(e){e instanceof ae&&(e.emitted_loop_level=this.current_loop_level)},e.prototype.set=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];this.ir.add_typed_id(e.type,t);var a=p.apply(void 0,s([e,this.ir.ids[t]],r,!1));return a.self=t,this.set_initializers(a),a},e.prototype.get=function(e,t){return l(e,this.ir.ids[t])},e.prototype.has_decoration=function(e,t){return this.ir.has_decoration(e,t)},e.prototype.get_decoration=function(e,t){return this.ir.get_decoration(e,t)},e.prototype.get_decoration_string=function(e,t){return this.ir.get_decoration_string(e,t)},e.prototype.unset_decoration=function(e,t){this.ir.unset_decoration(e,t)},e.prototype.get_type=function(e){return this.get(R,e)},e.prototype.get_fallback_name=function(e){return"_"+e},e.prototype.get_block_fallback_name=function(e){var t=this.get(T,e);return""===this.get_name(e)?"_"+this.get(R,t.basetype).self+"_"+e:this.get_name(e)},e.prototype.get_member_name=function(e,t){return this.ir.get_member_name(e,t)},e.prototype.get_member_decoration=function(e,t,r){return this.ir.get_member_decoration(e,t,r)},e.prototype.get_member_decoration_string=function(e,t,r){return this.ir.get_member_decoration_string(e,t,r)},e.prototype.set_member_name=function(e,t,r){this.ir.set_member_name(e,t,r)},e.prototype.get_member_qualified_name=function(e,t){var r=this.ir.find_meta(e);return r&&t<r.members.length?r.members[t].qualified_alias:this.ir.get_empty_string()},e.prototype.get_member_decoration_bitset=function(e,t){return this.ir.get_member_decoration_bitset(e,t)},e.prototype.has_member_decoration=function(e,t,r){return this.ir.has_member_decoration(e,t,r)},e.prototype.set_member_decoration=function(e,t,r,i){void 0===i&&(i=0),this.ir.set_member_decoration(e,t,r,i)},e.prototype.set_member_decoration_string=function(e,t,r,i){this.ir.set_member_decoration_string(e,t,r,i)},e.prototype.unset_member_decoration=function(e,t,r){this.ir.unset_member_decoration(e,t,r)},e.prototype.get_fallback_member_name=function(e){return"_"+e},e.prototype.get_declared_struct_size=function(e){if(0===e.member_types.length)throw new Error("Declared struct in block cannot be empty.");for(var t=0,r=0,i=0;i<e.member_types.length;i++){var a=this.type_struct_member_offset(e,i);a>r&&(r=a,t=i)}return r+this.get_declared_struct_member_size(e,t)},e.prototype.maybe_get=function(e,t){var r=this.ir;return t>=r.ids.length?null:r.ids[t].get_type()===e.type?this.get(e,t):null},e.prototype.get_pointee_type_id=function(e){var t=this.get(R,e);return t.pointer&&(console.assert(t.parent_type),e=t.parent_type),e},e.prototype.get_pointee_type=function(e){if("number"==typeof e)return this.get_pointee_type(this.get(R,e));var t=e;return t.pointer&&(console.assert(t.parent_type),t=this.get(R,t.parent_type)),t},e.prototype.get_variable_data_type_id=function(e){return e.phi_variable?e.basetype:this.get_pointee_type_id(e.basetype)},e.prototype.get_variable_data_type=function(e){return this.get(R,this.get_variable_data_type_id(e))},e.prototype.is_immutable=function(e){var r=this.ir;if(r.ids[e].get_type()===t.Variable){var i=this.get(T,e);return i.storage===v.UniformConstant||i.phi_variable||!this.expression_is_lvalue(e)}return r.ids[e].get_type()===t.AccessChain?this.get(oe,e).immutable:r.ids[e].get_type()===t.Expression?this.get(ae,e).immutable:r.ids[e].get_type()===t.Constant||r.ids[e].get_type()===t.ConstantOp||r.ids[e].get_type()===t.Undef},e.prototype.maybe_get_backing_variable=function(e){var t=this.maybe_get(T,e);if(!t){var r=this.maybe_get(ae,e);r&&(t=this.maybe_get(T,r.loaded_from));var i=this.maybe_get(oe,e);i&&(t=this.maybe_get(T,i.loaded_from))}return t},e.prototype.to_name=function(e,r){void 0===r&&(r=!0);var i=this.ir;if(r&&i.ids[e].get_type()===t.Type){var a=this.get(R,e);if(a.type_alias&&!this.has_extended_decoration(a.type_alias,b.BufferBlockRepacked))return this.to_name(a.type_alias)}var s=i.get_name(e);return s&&""!==s?s:"_"+e},e.prototype.is_builtin_variable=function(e){var t=this.ir.find_meta(e.self);return!!(e.compat_builtin||t&&t.decoration.builtin)||this.is_builtin_type(this.get(R,e.basetype))},e.prototype.is_builtin_type=function(e){var t=this.ir.find_meta(e.self);if(t)for(var r=0,i=t.members;r<i.length;r++){if(i[r].builtin)return!0}return!1},e.prototype.is_hidden_variable=function(e,t){return void 0===t&&(t=!1),!!(this.is_builtin_variable(e)&&!t||e.remapped_variable)||!this.combined_image_samplers.find((function(t){return t.combined_id===e.self}))&&(this.ir.get_spirv_version()>=66560&&e.storage!==v.Generic&&e.storage!==v.Function&&!this.interface_variable_exists_in_entry_point(e.self)||this.check_active_interface_variables&&function(e){switch(e){case v.Input:case v.Output:case v.Uniform:case v.UniformConstant:case v.AtomicCounter:case v.PushConstant:case v.StorageBuffer:return!0;default:return!1}}(e.storage)&&!this.active_interface_variables.has(e.self))},e.prototype.is_member_builtin=function(e,t){var r=this.ir.find_meta(e.self);if(r){var i=r.members;if(t<i.length&&i[t].builtin)return i[t].builtin_type}},e.prototype.is_scalar=function(e){return e.basetype!==E.Struct&&1===e.vecsize&&1===e.columns},e.prototype.is_vector=function(e){return e.vecsize>1&&1===e.columns},e.prototype.is_matrix=function(e){return e.vecsize>1&&e.columns>1},e.prototype.is_array=function(e){return e.array.length>0},e.prototype.expression_type_id=function(e){switch(this.ir.ids[e].get_type()){case t.Variable:return this.get(T,e).basetype;case t.Expression:return this.get(ae,e).expression_type;case t.Constant:return this.get(O,e).constant_type;case t.ConstantOp:return this.get(V,e).basetype;case t.Undef:return this.get(ne,e).basetype;case t.CombinedImageSampler:return this.get(se,e).combined_type;case t.AccessChain:return this.get(oe,e).basetype;default:throw new Error("Cannot resolve expression type.")}},e.prototype.expression_type=function(e){return this.get(R,this.expression_type_id(e))},e.prototype.expression_is_lvalue=function(e){switch(this.expression_type(e).basetype){case E.SampledImage:case E.Image:case E.Sampler:return!1;default:return!0}},e.prototype.register_read=function(e,t,r){var i=this.get(ae,e),a=this.maybe_get_backing_variable(t);a&&(i.loaded_from=a.self,r&&!this.is_immutable(a.self)&&a.dependees.push(i.self),a&&a.parameter&&a.parameter.read_count++)},e.prototype.register_write=function(e){var t=this.maybe_get(T,e);if(!t){var r=this.maybe_get(ae,e);r&&r.loaded_from&&(t=this.maybe_get(T,r.loaded_from));var i=this.maybe_get(oe,e);i&&i.loaded_from&&(t=this.maybe_get(T,i.loaded_from))}var a=this.expression_type(e);if(t){var s=!0,o=this.expression_type(e);this.get_variable_data_type(t).pointer&&(this.flush_all_active_variables(),1===o.pointer_depth&&(s=!1)),o.storage===v.PhysicalStorageBufferEXT||this.variable_storage_is_aliased(t)?this.flush_all_aliased_variables():t&&this.flush_dependees(t),s&&t.parameter&&0===t.parameter.write_count&&(t.parameter.write_count++,this.force_recompile())}else a.pointer&&this.flush_all_active_variables()},e.prototype.is_continue=function(e){return this.ir.block_meta[e]=this.ir.block_meta[e]||0,0!=(this.ir.block_meta[e]&Ne.CONTINUE_BIT)},e.prototype.is_single_block_loop=function(e){var t=this.get(J,e);return t.merge===P.Loop&&t.continue_block===e},e.prototype.traverse_all_reachable_opcodes=function(e,t){if(e instanceof j){for(var r=0,i=e.blocks;r<i.length;r++){var a=i[r];if(!this.traverse_all_reachable_opcodes(this.get(J,a),t))return!1}return!0}var s=e;t.set_current_block(s),t.rearm_current_block(s);for(var o=0,n=s.ops;o<n.length;o++){var _=n[o],c=this.stream(_),l=_.op;if(!t.handle(l,c,_.length))return!1;if(l===re.FunctionCall){var p=this.get(j,c[2]);if(t.follow_function_call(p)){if(!t.begin_function_scope(c,_.length))return!1;if(!this.traverse_all_reachable_opcodes(this.get(j,c[2]),t))return!1;if(!t.end_function_scope(c,_.length))return!1;t.rearm_current_block(s)}}}return!!t.handle_terminator(s)},e.prototype.analyze_image_and_sampler_usage=function(){var e=this.ir,t=new nt(this);this.traverse_all_reachable_opcodes(this.get(j,e.default_entry_point),t);var r=new _t(this,t.dref_combined_samplers);this.traverse_all_reachable_opcodes(this.get(j,e.default_entry_point),r),r.dependency_hierarchy=[],this.traverse_all_reachable_opcodes(this.get(j,e.default_entry_point),r),this.comparison_ids=r.comparison_ids,this.need_subpass_input=r.need_subpass_input;for(var i=0,a=this.combined_image_samplers;i<a.length;i++){var s=a[i];this.comparison_ids.has(s.sampler_id)&&this.comparison_ids.add(s.combined_id)}},e.prototype.build_function_control_flow_graphs_and_analyze=function(){var e=this,t=this.ir,r=new it(this);r.function_cfgs[t.default_entry_point]=new rt(this,this.get(j,t.default_entry_point)),this.traverse_all_reachable_opcodes(this.get(j,t.default_entry_point),r),this.function_cfgs=r.function_cfgs;var i=_(this.function_cfgs)<=1;this.function_cfgs.forEach((function(t,r){var a=e.get(j,r),s=new at(e,a);e.analyze_variable_scope(a,s),e.find_function_local_luts(a,s,i);for(var o=0,n=a.blocks;o<n.length;o++){var _=n[o],c=e.get(J,_);if(!(c.loop_variables.length<2)){for(var l=e.get_decoration_bitset(c.loop_variables[0]),p=e.get(T,c.loop_variables[0]).basetype,u=!1,h=0,f=c.loop_variables;h<f.length;h++){var d=f[h];if(l!==e.get_decoration_bitset(d)||p!==e.get(T,c.loop_variables[0]).basetype){u=!0;break}}if(u){for(var m=0,g=c.loop_variables;m<g.length;m++){d=g[m];e.get(T,d).loop_variable=!1}c.loop_variables=[]}}}}))},e.prototype.get_cfg_for_current_function=function(){return console.assert(this.current_function),this.get_cfg_for_function(this.current_function.self)},e.prototype.get_cfg_for_function=function(e){var t=this.function_cfgs[e];return console.assert(t),t},e.prototype.analyze_parameter_preservation=function(e,t,r,i){for(var a=0,s=e.arguments;a<s.length;a++){var o=s[a],n=this.get(R,o.type);if(n.pointer){var _=void 0;switch(n.basetype){case E.Sampler:case E.Image:case E.SampledImage:case E.AtomicCounter:_=!1;break;default:_=!0}if(_&&r.hasOwnProperty(o.id))if(i.hasOwnProperty(o.id)){var c=i[o.id],l=new Set;dt(t,e.entry_block,c,l)&&o.read_count++}else o.read_count++}}},e.prototype.analyze_non_block_pointer_types=function(){var e=this,t=this.ir,r=new ht(this);this.traverse_all_reachable_opcodes(this.get(j,t.default_entry_point),r),t.for_each_typed_id(R,(function(t,i){(e.has_decoration(i.self,te.Block)||e.has_decoration(i.self,te.BufferBlock))&&r.analyze_non_block_types_from_block(i)})),r.non_block_types.forEach((function(t){return e.physical_storage_non_block_pointer_types.push(t)})),this.physical_storage_non_block_pointer_types.sort(),this.physical_storage_type_to_alignment=r.physical_block_type_meta},e.prototype.analyze_variable_scope=function(e,t){var r=this;this.traverse_all_reachable_opcodes(e,t);var i=this.ir,a=et(rt,this.function_cfgs,e.self);this.analyze_parameter_preservation(e,a,t.accessed_variables_to_block,t.complete_write_variables_to_block);for(var s=[],o=0,n=e.blocks;o<n.length;o++){var _=n[o],c=this.get(J,_),l=i.continue_block_to_loop_header[_];if(l&&l!==_)c.loop_dominator=l;else{var p=a.find_loop_dominator(_);c.loop_dominator=p!==_?p:J.NoDominator}}t.accessed_variables_to_block.forEach((function(t,o){if(!(e.local_variables.indexOf(o)<0)){var n=new $e(a),_=t,c=r.expression_type(o);_.forEach((function(e){if(r.is_continue(e)&&(n.add_block(et(0,i.continue_block_to_loop_header,e)),1===c.vecsize&&1===c.columns&&c.basetype!==E.Struct&&0===c.array.length)){var t=et(0,s,o);s[o]=0===t?e:4294967295}n.add_block(e)})),n.lift_continue_block_dominator();var l=n.get_dominator();if(l)if(!r.get(T,o).phi_variable){var p=r.get(J,l);if(r.may_read_undefined_variable_in_block(p,o)){for(;p.loop_dominator!==J.NoDominator;)p=r.get(J,p.loop_dominator);p.self!==l&&(n.add_block(p.self),l=n.get_dominator())}}if(l)(p=r.get(J,l)).dominated_variables.push(o),r.get(T,o).dominator=l}})),t.accessed_temporaries_to_block.forEach((function(e,s){if(t.result_id_to_type.hasOwnProperty(s)){var o=t.result_id_to_type[s],n=r.get(R,o);if(!r.type_is_opaque_value(n)){var _=new $e(a),c=!1,l=!1,p=e;p.forEach((function(e){if(_.add_block(e),1!==p.size&&r.is_continue(e)){var t=r.get(J,et(0,i.continue_block_to_loop_header,e));console.assert(t.merge===P.Loop),_.add_block(t.self),l=!0}}));var u=_.get_dominator();if(1!==p.size&&r.is_single_block_loop(u)&&(c=!0),u)if(!p.has(u)||c)if(t.access_chain_expressions.has(s)){if(l){var h=r.get(J,u);console.assert(h.merge===P.Loop),h.complex_continue=!0}}else r.hoisted_temporaries.add(s),r.forced_temporaries.add(s),r.get(J,u).declare_temporary.push(new xe(et(0,t.result_id_to_type,s),s));else if(p.size>1){r.get(J,u).potential_declare_temporary.push(new xe(et(0,t.result_id_to_type,s),s))}}}}));var u=new Set;s.forEach((function(e,s){var o=r.get(T,s).dominator,n=e;if(4294967295!==n&&0!==n&&0!==o){var _=0;i.continue_block_to_loop_header.hasOwnProperty(n)?_=i.continue_block_to_loop_header[n]:r.get(J,n).continue_block===n&&(_=n),console.assert(_);for(var c=r.get(J,_),l=et(Set,t.accessed_variables_to_block,s),p=l.has(_),h=!0;o!==_;){l.has(o)&&(p=!0);var f=a.get_succeeding_edges(o);if(1!==f.length){h=!1;break}var d=a.get_preceding_edges(f[0]);if(1!==d.length||d[0]!==o){h=!1;break}o=f[0]}h&&p&&(u.clear(),a.walk_from(u,c.merge_block,(function(e){return l.has(e)&&(h=!1),!0})),h&&(c.loop_variables.push(s),c.loop_variables.sort(),r.get(T,s).loop_variable=!0))}}))},e.prototype.find_function_local_luts=function(e,r,i){var a=this,s=et(rt,this.function_cfgs,e.self),o=this.ir;r.accessed_variables_to_block.forEach((function(e,n){var _=e,c=a.get(T,n),l=a.expression_type(n);if((c.storage===v.Function||i&&c.storage===v.Private)&&!c.phi_variable&&0!==l.array.length){var p=0;if(c.initializer){if(o.ids[c.initializer].get_type()!==t.Constant)return;if(p=c.initializer,r.complete_write_variables_to_block.hasOwnProperty(c.self)||r.partial_write_variables_to_block.hasOwnProperty(c.self))return}else{if(r.partial_write_variables_to_block.hasOwnProperty(c.self))return;if(!r.complete_write_variables_to_block.hasOwnProperty(c.self))return;var u=r.complete_write_variables_to_block[c.self];if(1!==u.size)return;var h=new $e(s);_.forEach((function(e){return h.add_block(e)}));var f=h.get_dominator();if(u.has(f))return;var d=new st(a,c.self);if(a.traverse_all_reachable_opcodes(a.get(J,f),d),1!==d.write_count||0===d.static_expression)return;if(o.ids[d.static_expression].get_type()!==t.Constant)return;p=d.static_expression}a.get(O,p).is_used_as_lut=!0,c.static_expression=p,c.statically_assigned=!0,c.remapped_variable=!0}}))},e.prototype.may_read_undefined_variable_in_block=function(e,t){for(var r=0,i=e.ops;r<i.length;r++){var a=i[r],s=this.stream(a);switch(a.op){case re.Store:case re.CopyMemory:if(s[0]===t)return!1;break;case re.AccessChain:case re.InBoundsAccessChain:case re.PtrAccessChain:if(s[2]===t)return!0;break;case re.Select:if(s[3]===t||s[4]===t)return!0;break;case re.Phi:if(a.length<2)break;for(var o=a.length-2,n=0;n<o;n+=2)if(s[n+2]===t)return!0;break;case re.CopyObject:case re.Load:if(s[2]===t)return!0;break;case re.FunctionCall:if(a.length<3)break;var _=a.length-3;for(n=0;n<_;n++)if(s[n+3]===t)return!0}}return!0},e.prototype.analyze_interlocked_resource_usage=function(){if(this.get_execution_model()===ve.Fragment&&(this.get_entry_point().flags.get(Ee.PixelInterlockOrderedEXT)||this.get_entry_point().flags.get(Ee.PixelInterlockUnorderedEXT)||this.get_entry_point().flags.get(Ee.SampleInterlockOrderedEXT)||this.get_entry_point().flags.get(Ee.SampleInterlockUnorderedEXT))){var e=this.ir,t=new ct(this,e.default_entry_point);this.traverse_all_reachable_opcodes(this.get(j,e.default_entry_point),t);var r=new lt(this,e.default_entry_point);r.interlock_function_id=t.interlock_function_id,r.split_function_case=t.split_function_case,r.control_flow_interlock=t.control_flow_interlock,r.use_critical_section=!r.split_function_case&&!r.control_flow_interlock,this.traverse_all_reachable_opcodes(this.get(j,e.default_entry_point),r),this.interlocked_is_complex=!r.use_critical_section||r.interlock_function_id!==e.default_entry_point}},e.prototype.instruction_to_result_type=function(e,t,r){switch(e){case re.Store:case re.CopyMemory:case re.CopyMemorySized:case re.ImageWrite:case re.AtomicStore:case re.AtomicFlagClear:case re.EmitStreamVertex:case re.EndStreamPrimitive:case re.ControlBarrier:case re.MemoryBarrier:case re.GroupWaitEvents:case re.RetainEvent:case re.ReleaseEvent:case re.SetUserEventStatus:case re.CaptureEventProfilingInfo:case re.CommitReadPipe:case re.CommitWritePipe:case re.GroupCommitReadPipe:case re.GroupCommitWritePipe:case re.Line:case re.NoLine:return null;default:return r>1&&null!==this.maybe_get(R,t[0])?{result_type:t[0],result_id:t[1]}:null}},e.prototype.combined_decoration_for_member=function(e,t){var r=new y,i=this.ir.find_meta(e.self);if(i){var a=i.members;if(t>=a.length)return r;var s=a[t];r.merge_or(s.decoration_flags);for(var o=this.get(R,e.member_types[t]),n=o.member_types,_=0;_<n.length;_++){this.get(R,n[_]).pointer||r.merge_or(this.combined_decoration_for_member(o,_))}}return r},e.prototype.is_desktop_only_format=function(e){switch(e){case ut.R11fG11fB10f:case ut.R16f:case ut.Rgb10A2:case ut.R8:case ut.Rg8:case ut.R16:case ut.Rg16:case ut.Rgba16:case ut.R16Snorm:case ut.Rg16Snorm:case ut.Rgba16Snorm:case ut.R8Snorm:case ut.Rg8Snorm:case ut.R8ui:case ut.Rg8ui:case ut.R16ui:case ut.Rgb10a2ui:case ut.R8i:case ut.Rg8i:case ut.R16i:return!0}return!1},e.prototype.set_extended_decoration=function(e,t,r){void 0===r&&(r=0);var i=et(x,this.ir.meta,e).decoration;i.extended.flags.set(t),i.extended.values[t]=r},e.prototype.get_extended_decoration=function(e,t){var r=this.ir.find_meta(e);if(!r)return 0;var i=r.decoration;return i.extended.flags.get(t)?i.extended.values[t]:mt(t)},e.prototype.has_extended_decoration=function(e,t){var r=this.ir.find_meta(e);return!!r&&r.decoration.extended.flags.get(t)},e.prototype.unset_extended_decoration=function(e,t){var r=et(x,this.ir.meta,e).decoration;r.extended.flags.clear(t),r.extended.values[t]=0},e.prototype.set_extended_member_decoration=function(e,t,r,i){void 0===i&&(i=0);var a=et(x,this.ir.meta,e).members;t===a.length&&a.push(new I);var s=a[t];s.extended.flags.set(r),s.extended.values[r]=i},e.prototype.get_extended_member_decoration=function(e,t,r){var i=this.ir.find_meta(e);if(!i)return 0;if(t>=i.members.length)return 0;var a=i.members[t];return a.extended.flags.get(r)?a.extended.values[r]:mt(r)},e.prototype.has_extended_member_decoration=function(e,t,r){var i=this.ir.find_meta(e);return!!i&&(!(t>=i.members.length)&&i.members[t].extended.flags.get(r))},e.prototype.unset_extended_member_decoration=function(e,t,r){var i=et(x,this.ir.meta,e).members;t===i.length&&i.push(new I);var a=i[t];a.extended.flags.clear(r),a.extended.values[r]=0},e.prototype.type_is_array_of_pointers=function(e){return!!e.pointer&&e.pointer_depth===this.get(R,e.parent_type).pointer_depth},e.prototype.type_is_opaque_value=function(e){return!e.pointer&&(e.basetype===E.SampledImage||e.basetype===E.Image||e.basetype===E.Sampler)},e.prototype.is_depth_image=function(e,t){return e.image.depth&&e.image.format===ut.Unknown||this.comparison_ids.has(t)},e.prototype.reflection_ssbo_instance_name_is_significant=function(){var e=this,t=this.ir;if(t.source.known)return t.source.hlsl;var r=new Set,i=!1;return t.for_each_typed_id(T,(function(t,a){var s=e.get(R,a.basetype);s.pointer&&a.storage!==v.Function&&((a.storage===v.StorageBuffer||a.storage===v.Uniform&&e.has_decoration(s.self,te.BufferBlock))&&(r.has(s.self)?i=!0:r.add(s.self)))})),i},e.prototype.type_struct_member_offset=function(e,t){var r=this.ir.find_meta(e.self);if(r){var i=r.members[t];if(i.decoration_flags.get(te.Offset))return i.offset;throw new Error("Struct member does not have Offset set.")}throw new Error("Struct member does not have Offset set.")},e.prototype.type_struct_member_array_stride=function(e,t){var r=this.ir.find_meta(e.member_types[t]);if(r){var i=r.decoration;if(i.decoration_flags.get(te.ArrayStride))return i.array_stride;throw new Error("Struct member does not have ArrayStride set.")}throw new Error("Struct member does not have ArrayStride set.")},e.prototype.type_struct_member_matrix_stride=function(e,t){var r=this.ir.find_meta(e.self);if(r){var i=r.members[t];if(i.decoration_flags.get(te.MatrixStride))return i.matrix_stride;throw new Error("Struct member does not have MatrixStride set.")}throw new Error("Struct member does not have MatrixStride set.")},e.prototype.get_remapped_declared_block_name=function(e,t){var r=this.declared_block_names[e];if(r)return r;var i=this.get(T,e);if(t)return this.to_name(i.self);var a=this.get(R,i.basetype),s=this.ir.find_meta(a.self),o=s?s.decoration.alias:null;return o&&""!==o?o:this.get_block_fallback_name(e)},e.prototype.type_is_block_like=function(e){if(e.basetype!==E.Struct)return!1;if(this.has_decoration(e.self,te.Block)||this.has_decoration(e.self,te.BufferBlock))return!0;for(var t=0;t<e.member_types.length;t++)if(this.has_member_decoration(e.self,t,te.Offset))return!0;return!1},e.prototype.flush_phi_required=function(e,t){for(var r=0,i=this.get(J,t).phi_variables;r<i.length;r++){if(i[r].parent===e)return!0}return!1},e.prototype.evaluate_spec_constant_u32=function(e){var t=this,r=this.get(R,e.basetype);if(r.basetype!==E.UInt&&r.basetype!==E.Int&&r.basetype!==E.Boolean)throw new Error("Only 32-bit integers and booleans are currently supported when evaluating specialization constants.");if(!this.is_scalar(r))throw new Error("Spec constant evaluation must be a scalar.\n");var i=0,a=function(e){var r=t.expression_type(e);if(r.basetype!==E.UInt&&r.basetype!==E.Int&&r.basetype!==E.Boolean)throw new Error("Only 32-bit integers and booleans are currently supported when evaluating specialization constants.");if(!t.is_scalar(r))throw new Error("Spec constant evaluation must be a scalar.");var i=t.maybe_get(O,e);return i?i.scalar():t.evaluate_spec_constant_u32(t.get(V,e))};switch(e.opcode){case re.IAdd:i=a(e.arguments[0])+a(e.arguments[1]);break;case re.ISub:i=a(e.arguments[0])-a(e.arguments[1]);break;case re.IMul:i=a(e.arguments[0])*a(e.arguments[1]);break;case re.BitwiseAnd:i=a(e.arguments[0])&a(e.arguments[1]);break;case re.BitwiseOr:i=a(e.arguments[0])|a(e.arguments[1]);break;case re.BitwiseXor:i=a(e.arguments[0])^a(e.arguments[1]);break;case re.LogicalAnd:i=a(e.arguments[0])&a(e.arguments[1]);break;case re.LogicalOr:i=a(e.arguments[0])|a(e.arguments[1]);break;case re.ShiftLeftLogical:i=a(e.arguments[0])<<a(e.arguments[1]);break;case re.ShiftRightLogical:case re.ShiftRightArithmetic:i=a(e.arguments[0])>>a(e.arguments[1]);break;case re.LogicalEqual:case re.IEqual:i=a(e.arguments[0])===a(e.arguments[1])?1:0;break;case re.LogicalNotEqual:case re.INotEqual:i=a(e.arguments[0])!==a(e.arguments[1])?1:0;break;case re.ULessThan:case re.SLessThan:i=a(e.arguments[0])<a(e.arguments[1])?1:0;break;case re.ULessThanEqual:case re.SLessThanEqual:i=a(e.arguments[0])<=a(e.arguments[1])?1:0;break;case re.UGreaterThan:case re.SGreaterThan:i=a(e.arguments[0])>a(e.arguments[1])?1:0;break;case re.UGreaterThanEqual:case re.SGreaterThanEqual:i=a(e.arguments[0])>=a(e.arguments[1])?1:0;break;case re.LogicalNot:i=a(e.arguments[0])?0:1;break;case re.Not:i=~a(e.arguments[0]);break;case re.SNegate:i=-a(e.arguments[0]);break;case re.Select:i=a(e.arguments[0])?a(e.arguments[1]):a(e.arguments[2]);break;case re.UMod:case re.SMod:case re.SRem:var s=a(e.arguments[0]);if(0===(o=a(e.arguments[1])))throw new Error("Undefined behavior in Mod, b === 0.\n");i=s%o;break;case re.UDiv:case re.SDiv:var o;s=a(e.arguments[0]);if(0===(o=a(e.arguments[1])))throw new Error("Undefined behavior in Div, b === 0.\n");i=s/o;break;default:throw new Error("Unsupported spec constant opcode for evaluation.\n")}return i},e.prototype.evaluate_constant_u32=function(e){var t=this.maybe_get(O,e);return t?t.scalar():this.evaluate_spec_constant_u32(this.get(V,e))},e.prototype.is_vertex_like_shader=function(){var e=this.get_execution_model();return e===ve.Vertex||e===ve.Geometry||e===ve.TessellationControl||e===ve.TessellationEvaluation},e.prototype.get_case_list=function(e){var t,r,i=this.ir,a=0;if(t=this.maybe_get(O,e.condition))a=this.get(R,t.constant_type).width;else if(r=this.maybe_get(T,e.condition)){a=this.get(R,r.basetype).width}else{var s=i.load_type_width[e.condition];if(s)throw new Error("Use of undeclared variable on a switch statement.");a=s}return a>32?e.cases_64bit:e.cases_32bit},e}();function dt(e,t,r,i){if(r.has(t))return!1;if(0===e.get_succeeding_edges(t).length)return!0;for(var a=0,s=e.get_succeeding_edges(t);a<s.length;a++){var o=s[a];if(!i.has(o)){if(dt(e,o,r,i))return!0;i.add(o)}}return!1}function mt(e){switch(e){case b.SPIRVCrossDecorationResourceIndexPrimary:case b.SPIRVCrossDecorationResourceIndexSecondary:case b.SPIRVCrossDecorationResourceIndexTertiary:case b.SPIRVCrossDecorationResourceIndexQuaternary:case b.SPIRVCrossDecorationInterfaceMemberIndex:return 4294967295;default:return 0}}function gt(e){return e.basetype===E.Half||e.basetype===E.Float||e.basetype===E.Double}function bt(e){return e.basetype===E.SByte||e.basetype===E.UByte||e.basetype===E.Short||e.basetype===E.UShort||e.basetype===E.Int||e.basetype===E.UInt||e.basetype===E.Int64||e.basetype===E.UInt64}function yt(e){switch(e){case re.IEqual:case re.INotEqual:case re.ISub:case re.IAdd:case re.IMul:case re.ShiftLeftLogical:case re.BitwiseOr:case re.BitwiseXor:case re.BitwiseAnd:return!0;default:return!1}}function vt(e){switch(e){case 8:return E.SByte;case 16:return E.Short;case 32:return E.Int;case 64:return E.Int64;default:throw new Error("Invalid bit width.")}}function St(e){switch(e){case 8:return E.UByte;case 16:return E.UShort;case 32:return E.UInt;case 64:return E.UInt64;default:throw new Error("Invalid bit width.")}}var It,xt=function(e,t){this.location=e,this.component=t},kt=function(){this.fixup_clipspace=!1,this.flip_vert_y=!1,this.support_nonzero_base_instance=!0};!function(e){e[e.DontCare=0]="DontCare",e[e.Lowp=1]="Lowp",e[e.Mediump=2]="Mediump",e[e.Highp=3]="Highp"}(It||(It={}));var wt,Et,Tt=function(){this.default_float_precision=It.Mediump,this.default_int_precision=It.Highp},Lt=function(){this.version=450,this.specialization_constant_prefix="SPIRV_CROSS_CONSTANT_ID_",this.force_temporary=!1,this.separate_shader_objects=!1,this.flatten_multidimensional_arrays=!1,this.enable_420pack_extension=!0,this.emit_push_constant_as_uniform_buffer=!1,this.emit_uniform_buffer_as_plain_uniforms=!1,this.emit_line_directives=!1,this.enable_storage_image_qualifier_deduction=!0,this.force_zero_initialized_variables=!1,this.force_flattened_io_blocks=!1,this.keep_unnamed_ubos=!1,this.ovr_multiview_view_count=0,this.vertex=new kt,this.fragment=new Tt,this.remove_attribute_layouts=!1},Rt=function(){function e(){this._str=""}return e.prototype.str=function(){return this._str},e.prototype.append=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this._str=(e=this._str).concat.apply(e,t)},e.prototype.reset=function(){this._str=""},e}(),Nt=function(){this.storage_physical_type=0,this.need_transpose=!1,this.storage_is_packed=!1,this.storage_is_invariant=!1,this.flattened_struct=!1};!function(e){e[e.INDEX_IS_LITERAL_BIT=1]="INDEX_IS_LITERAL_BIT",e[e.CHAIN_ONLY_BIT=2]="CHAIN_ONLY_BIT",e[e.PTR_CHAIN_BIT=4]="PTR_CHAIN_BIT",e[e.SKIP_REGISTER_EXPRESSION_READ_BIT=8]="SKIP_REGISTER_EXPRESSION_READ_BIT",e[e.LITERAL_MSB_FORCE_ID=16]="LITERAL_MSB_FORCE_ID",e[e.FLATTEN_ALL_MEMBERS_BIT=32]="FLATTEN_ALL_MEMBERS_BIT",e[e.FORCE_COMPOSITE_BIT=64]="FORCE_COMPOSITE_BIT"}(wt||(wt={})),function(e){e[e.Std140=0]="Std140",e[e.Std430=1]="Std430",e[e.Std140EnhancedLayout=2]="Std140EnhancedLayout",e[e.Std430EnhancedLayout=3]="Std430EnhancedLayout",e[e._HLSLCbuffer=4]="_HLSLCbuffer",e[e._HLSLCbufferPackOffset=5]="_HLSLCbufferPackOffset",e[e.PackingScalar=6]="PackingScalar",e[e.PackingScalarEnhancedLayout=7]="PackingScalarEnhancedLayout"}(Et||(Et={}));var At,Ct,Pt=function(){function e(){this.h=BigInt(0xcbf29ce484222000)}return e.prototype.u32=function(e){this.h=this.h*BigInt(1099511628211)^BigInt(e)},e.prototype.get=function(){return this.h},e}(),Mt=function(){function e(e,t){this.saved=e[t],this.targetObject=e,this.propName=t}return Object.defineProperty(e.prototype,"current",{get:function(){return this.targetObject[this.propName]},set:function(e){this.targetObject[this.propName]=e},enumerable:!1,configurable:!0}),e.prototype.release=function(){this.targetObject[this.propName]=this.saved},e}(),Dt=function(){this.img=0,this.is_fetch=!1,this.is_gather=!1,this.is_proj=!1},Bt=function(){this.base=new Dt,this.has_array_offsets=!1,this.has_offset=!1,this.has_grad=!1,this.has_dref=!1,this.is_sparse_feedback=!1,this.has_min_lod=!1,this.lod=0},zt=function(){this.base=new Dt,this.coord=0,this.coord_components=0,this.dref=0,this.grad_x=0,this.grad_y=0,this.lod=0,this.coffset=0,this.offset=0,this.bias=0,this.component=0,this.sample=0,this.sparse_texel=0,this.min_lod=0,this.nonuniform_expression=!1};!function(e){e[e.None=0]="None",e[e.Bias=1]="Bias",e[e.Lod=2]="Lod",e[e.Grad=4]="Grad",e[e.ConstOffset=8]="ConstOffset",e[e.Offset=16]="Offset",e[e.ConstOffsets=32]="ConstOffsets",e[e.Sample=64]="Sample",e[e.MinLod=128]="MinLod",e[e.MakeTexelAvailable=256]="MakeTexelAvailable",e[e.MakeTexelAvailableKHR=256]="MakeTexelAvailableKHR",e[e.MakeTexelVisible=512]="MakeTexelVisible",e[e.MakeTexelVisibleKHR=512]="MakeTexelVisibleKHR",e[e.NonPrivateTexel=1024]="NonPrivateTexel",e[e.NonPrivateTexelKHR=1024]="NonPrivateTexelKHR",e[e.VolatileTexel=2048]="VolatileTexel",e[e.VolatileTexelKHR=2048]="VolatileTexelKHR",e[e.SignExtend=4096]="SignExtend",e[e.ZeroExtend=8192]="ZeroExtend"}(At||(At={})),function(e){e[e.STREAM_OFFSET=268435456]="STREAM_OFFSET",e[e.TYPE_AUX=536870912]="TYPE_AUX"}(Ct||(Ct={}));var Ut=function(){},Gt=[[".x",".y",".z",".w"],[".xy",".yz",".zw"],[".xyz",".yzw"],[""]],Ft=[];Ft[re.SNegate]="-",Ft[re.Not]="~",Ft[re.IAdd]="+",Ft[re.ISub]="-",Ft[re.IMul]="*",Ft[re.SDiv]="/",Ft[re.UDiv]="/",Ft[re.UMod]="%",Ft[re.SMod]="%",Ft[re.ShiftRightLogical]=">>",Ft[re.ShiftRightArithmetic]=">>",Ft[re.ShiftLeftLogical]=">>",Ft[re.BitwiseOr]="|",Ft[re.BitwiseXor]="^",Ft[re.BitwiseAnd]="&",Ft[re.LogicalOr]="||",Ft[re.LogicalAnd]="&&",Ft[re.LogicalNot]="!",Ft[re.LogicalEqual]="==",Ft[re.LogicalNotEqual]="!=",Ft[re.IEqual]="==",Ft[re.INotEqual]="!=",Ft[re.ULessThan]="<",Ft[re.SLessThan]="<",Ft[re.ULessThanEqual]="<=",Ft[re.SLessThanEqual]="<=",Ft[re.UGreaterThan]=">",Ft[re.SGreaterThan]=">",Ft[re.SGreaterThanEqual]=">=",Ft[re.SGreaterThanEqual]=">=";var Ot=["x","y","z","w"],Vt=new Set(["abs","acos","acosh","all","any","asin","asinh","atan","atanh","atomicAdd","atomicCompSwap","atomicCounter","atomicCounterDecrement","atomicCounterIncrement","atomicExchange","atomicMax","atomicMin","atomicOr","atomicXor","bitCount","bitfieldExtract","bitfieldInsert","bitfieldReverse","ceil","cos","cosh","cross","degrees","dFdx","dFdxCoarse","dFdxFine","dFdy","dFdyCoarse","dFdyFine","distance","dot","EmitStreamVertex","EmitVertex","EndPrimitive","EndStreamPrimitive","equal","exp","exp2","faceforward","findLSB","findMSB","float16BitsToInt16","float16BitsToUint16","floatBitsToInt","floatBitsToUint","floor","fma","fract","frexp","fwidth","fwidthCoarse","fwidthFine","greaterThan","greaterThanEqual","groupMemoryBarrier","imageAtomicAdd","imageAtomicAnd","imageAtomicCompSwap","imageAtomicExchange","imageAtomicMax","imageAtomicMin","imageAtomicOr","imageAtomicXor","imageLoad","imageSamples","imageSize","imageStore","imulExtended","int16BitsToFloat16","intBitsToFloat","interpolateAtOffset","interpolateAtCentroid","interpolateAtSample","inverse","inversesqrt","isinf","isnan","ldexp","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","memoryBarrier","memoryBarrierAtomicCounter","memoryBarrierBuffer","memoryBarrierImage","memoryBarrierShared","min","mix","mod","modf","noise","noise1","noise2","noise3","noise4","normalize","not","notEqual","outerProduct","packDouble2x32","packHalf2x16","packInt2x16","packInt4x16","packSnorm2x16","packSnorm4x8","packUint2x16","packUint4x16","packUnorm2x16","packUnorm4x8","pow","radians","reflect","refract","round","roundEven","sign","sin","sinh","smoothstep","sqrt","step","tan","tanh","texelFetch","texelFetchOffset","texture","textureGather","textureGatherOffset","textureGatherOffsets","textureGrad","textureGradOffset","textureLod","textureLodOffset","textureOffset","textureProj","textureProjGrad","textureProjGradOffset","textureProjLod","textureProjLodOffset","textureProjOffset","textureQueryLevels","textureQueryLod","textureSamples","textureSize","transpose","trunc","uaddCarry","uint16BitsToFloat16","uintBitsToFloat","umulExtended","unpackDouble2x32","unpackHalf2x16","unpackInt2x16","unpackInt4x16","unpackSnorm2x16","unpackSnorm4x8","unpackUint2x16","unpackUint4x16","unpackUnorm2x16","unpackUnorm4x8","usubBorrow","active","asm","atomic_uint","attribute","bool","break","buffer","bvec2","bvec3","bvec4","case","cast","centroid","class","coherent","common","const","continue","default","discard","dmat2","dmat2x2","dmat2x3","dmat2x4","dmat3","dmat3x2","dmat3x3","dmat3x4","dmat4","dmat4x2","dmat4x3","dmat4x4","do","double","dvec2","dvec3","dvec4","else","enum","extern","external","false","filter","fixed","flat","float","for","fvec2","fvec3","fvec4","goto","half","highp","hvec2","hvec3","hvec4","if","iimage1D","iimage1DArray","iimage2D","iimage2DArray","iimage2DMS","iimage2DMSArray","iimage2DRect","iimage3D","iimageBuffer","iimageCube","iimageCubeArray","image1D","image1DArray","image2D","image2DArray","image2DMS","image2DMSArray","image2DRect","image3D","imageBuffer","imageCube","imageCubeArray","in","inline","inout","input","int","interface","invariant","isampler1D","isampler1DArray","isampler2D","isampler2DArray","isampler2DMS","isampler2DMSArray","isampler2DRect","isampler3D","isamplerBuffer","isamplerCube","isamplerCubeArray","ivec2","ivec3","ivec4","layout","long","lowp","mat2","mat2x2","mat2x3","mat2x4","mat3","mat3x2","mat3x3","mat3x4","mat4","mat4x2","mat4x3","mat4x4","mediump","namespace","noinline","noperspective","out","output","packed","partition","patch","precise","precision","public","readonly","resource","restrict","return","sample","sampler1D","sampler1DArray","sampler1DArrayShadow","sampler1DShadow","sampler2D","sampler2DArray","sampler2DArrayShadow","sampler2DMS","sampler2DMSArray","sampler2DRect","sampler2DRectShadow","sampler2DShadow","sampler3D","sampler3DRect","samplerBuffer","samplerCube","samplerCubeArray","samplerCubeArrayShadow","samplerCubeShadow","shared","short","sizeof","smooth","static","struct","subroutine","superp","switch","template","this","true","typedef","uimage1D","uimage1DArray","uimage2D","uimage2DArray","uimage2DMS","uimage2DMSArray","uimage2DRect","uimage3D","uimageBuffer","uimageCube","uimageCubeArray","uint","uniform","union","unsigned","usampler1D","usampler1DArray","usampler2D","usampler2DArray","usampler2DMS","usampler2DMSArray","usampler2DRect","usampler3D","usamplerBuffer","usamplerCube","usamplerCubeArray","using","uvec2","uvec3","uvec4","varying","vec2","vec3","vec4","void","volatile","while","writeonly"]);function Ht(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function qt(e){return e===m.Position||e===m.PointSize||e===m.ClipDistance||e===m.CullDistance}var Xt=function(e){function r(t){var r=e.call(this,t)||this;return r.current_emitting_block=null,r.current_emitting_switch=null,r.current_emitting_switch_fallthrough=!1,r.buffer=new Rt,r.redirect_statement=null,r.current_continue_block=null,r.options=new Lt,r.local_variable_names=new Set,r.resource_names=new Set,r.block_input_names=new Set,r.block_output_names=new Set,r.block_ubo_names=new Set,r.block_ssbo_names=new Set,r.block_names=new Set,r.function_overloads={},r.preserved_aliases=[],r.processing_entry_point=!1,r.backend=new qe,r.indent=0,r.flushed_phi_variables=new Set,r.flattened_buffer_blocks=new Set,r.flattened_structs=[],r.expression_usage_counts=[],r.forced_extensions=[],r.header_lines=[],r.extra_sub_expressions=[],r.workaround_ubo_load_overload_types=[],r.statement_count=0,r.requires_transpose_2x2=!1,r.requires_transpose_3x3=!1,r.requires_transpose_4x4=!1,r.subpass_to_framebuffer_fetch_attachment=[],r.inout_color_attachments=[],r.masked_output_locations=new Set,r.masked_output_builtins=new Set,r.removed_structs=new Set,r.init(),r}return a(r,e),r.prototype.remap_pixel_local_storage=function(e,t){this.pls_inputs=e,this.pls_outputs=t,this.remap_pls_variables()},r.prototype.remap_ext_framebuffer_fetch=function(e,t,r){this.subpass_to_framebuffer_fetch_attachment.push(new xe(e,t)),this.inout_color_attachments.push(new xe(t,r))},r.prototype.get_common_options=function(){return this.options},r.prototype.require_extension=function(e){this.has_extension(e)||this.forced_extensions.push(e)},r.prototype.flatten_buffer_block=function(e){var t=this.get(T,e),r=this.get(R,t.basetype),i=this.to_name(r.self,!1),a=et(x,this.ir.meta,r.self).decoration.decoration_flags;if(r.array.length>0)throw new Error(i+" is an array of UBOs.");if(r.basetype!==E.Struct)throw new Error(i+" is not a struct.");if(!a.get(te.Block))throw new Error(i+" is not a block.");if(0===r.member_types.length)throw new Error(i+" is an empty struct.");this.flattened_buffer_blocks.add(e)},r.prototype.mask_stage_output_by_location=function(e,t){for(var r=this.masked_output_locations,i=r.values(),a=null;a=i.next().value;)if(a.location===e&&a.component===t)return;r.add(new xt(e,t))},r.prototype.mask_stage_output_by_builtin=function(e){this.masked_output_builtins.add(e)},r.prototype.reset=function(){this.clear_force_recompile(),this.invalid_expressions.clear(),this.current_function=null,this.removed_structs.clear(),this.expression_usage_counts=[],this.forwarded_temporaries.clear(),this.suppressed_usage_tracking.clear(),this.flushed_phi_variables.clear(),this.reset_name_caches();var e=this.ir;e.for_each_typed_id(j,(function(e,t){t.active=!1,t.flush_undeclared=!0})),e.for_each_typed_id(T,(function(e,t){return t.dependees=[]})),e.reset_all_of_type(ae),e.reset_all_of_type(oe),this.statement_count=0,this.indent=0,this.current_loop_level=0},r.prototype.emit_function_prototype=function(e,t){var r=this.ir;e.self!==r.default_entry_point&&this.add_function_overload(e),this.local_variable_names=new Set(this.resource_names);var i="",a=this.get(R,e.return_type);i+=this.flags_to_qualifiers_glsl(a,t),i+=this.type_to_glsl(a),i+=this.type_to_array_glsl(a),i+=" ",e.self===r.default_entry_point?(this.interlocked_is_complex?i+="spvMainInterlockedBody":i+="main",this.processing_entry_point=!0):i+=this.to_name(e.self),i+="(";for(var s=[],o=0,n=e.arguments;o<n.length;o++){var _=n[o];if(!this.skip_argument(_.id))this.add_local_variable_name(_.id),s.push(this.argument_decl(_)),(p=this.maybe_get(T,_.id))&&(p.parameter=_)}for(var c=0,l=e.shadow_arguments;c<l.length;c++){var p;_=l[c];this.add_local_variable_name(_.id),s.push(this.argument_decl(_)),(p=this.maybe_get(T,_.id))&&(p.parameter=_)}i+=s.join(", "),i+=")",this.statement(i)},r.prototype.emit_function=function(e,t){if(!e.active){e.active=!0;for(var r=this.ir,i=0,a=e.blocks;i<a.length;i++)for(var s=a[i],o=0,n=this.get(J,s).ops;o<n.length;o++){var _=n[o],c=this.stream(_);if(_.op===re.FunctionCall){var l=c[2];this.emit_function(this.get(j,l),et(x,r.meta,c[1]).decoration.decoration_flags)}}0!==e.entry_line.file_id&&this.emit_line_directive(e.entry_line.file_id,e.entry_line.line_literal),this.emit_function_prototype(e,t),this.begin_scope(),e.self===r.default_entry_point&&this.emit_entry_point_declarations(),this.current_function=e;var p=this.get(J,e.entry_block);e.constant_arrays_needed_on_stack.sort();for(var u=0,h=e.constant_arrays_needed_on_stack;u<h.length;u++){var f=h[u],d=this.get(O,f),m=this.get(R,d.constant_type);this.statement(this.variable_decl(m,"_".concat(f,"_array_copy"))," = ",this.constant_expression(d),";")}for(var g=0,b=e.local_variables;g<b.length;g++){var y=b[g];if((A=this.get(T,y)).deferred_declaration=!1,this.variable_decl_is_remapped_storage(A,v.Workgroup))this.add_local_variable_name(A.self),this.statement(this.variable_decl(A),";"),A.deferred_declaration=!1;else if(A.storage===v.Private){if(this.add_local_variable_name(A.self),A.initializer)this.statement(this.variable_decl(A),";"),A.deferred_declaration=!1;else p.dominated_variables.indexOf(A.self)<0&&p.dominated_variables.push(A.self),A.deferred_declaration=!0}else A.storage===v.Function&&A.remapped_variable&&A.static_expression?A.deferred_declaration=!1:this.expression_is_lvalue(y)?(this.add_local_variable_name(A.self),A.initializer&&!A.loop_variable?this.statement(this.variable_decl_function_local(A),";"):A.deferred_declaration=!0):A.statically_assigned=!0;A.loop_variable_enable=!1,A.loop_variable&&(A.deferred_declaration=!1)}for(var S=0,I=e.blocks;S<I.length;S++){var k=I[S];(s=this.get(J,k)).dominated_variables.sort()}for(var w=0,E=this.current_function.fixup_hooks_in;w<E.length;w++){(0,E[w])()}this.emit_block_chain(p),this.end_scope(),this.processing_entry_point=!1,this.statement("");for(var L=0,N=e.local_variables;L<N.length;L++){var A;y=N[L];(A=this.get(T,y)).deferred_declaration=!1}}},r.prototype.has_extension=function(e){return this.forced_extensions.indexOf(e)>=0},r.prototype.require_extension_internal=function(e){this.backend.supports_extensions&&!this.has_extension(e)&&(this.forced_extensions.push(e),this.force_recompile())},r.prototype.emit_instruction=function(e){var r=this.stream(e),i=e.op,a=e.length,s=this.get_integer_width_for_instruction(e),o=vt(s),n=St(s),_=this,c=_.backend,l=_.options,p=_.ir;switch(i){case re.Load:var u=r[0],h=r[1],d=r[2];this.flush_variable_declaration(d);var m=this.should_forward(d)&&!this.forced_temporaries.has(h),g=!1,y=!1,S=this.maybe_get(ae,d);m&&(S&&S.need_transpose?(y=!0,S.need_transpose=!1,g=!0):this.is_non_native_row_major_matrix(d)&&(g=!0));var I=void 0,k=this.has_extended_decoration(d,b.PhysicalTypePacked),w=this.has_extended_decoration(d,b.PhysicalTypeID);I=m||!k&&!w?this.to_dereferenced_expression(d,!1):this.to_unpacked_expression(d);var L=this.get(R,u);this.expression_type(d).vecsize>L.vecsize&&(I=this.enclose_expression(I+this.vector_swizzle(L.vecsize,0))),I=this.cast_from_variable_load(d,I,L),I=this.unroll_array_from_complex_load(h,d,I),!this.type_is_opaque_value(L)&&this.has_decoration(d,te.NonUniform)&&(I=this.convert_non_uniform_expression(I,d)),m&&S&&(S.need_transpose=y);var N=S&&this.flattened_buffer_blocks.has(S.loaded_from);!c.needs_row_major_load_workaround||this.is_non_native_row_major_matrix(d)||N||(I=this.rewrite_load_for_wrapped_row_major(I,u,d));var A=N&&(L.basetype===E.Struct||L.columns>1),C=void 0;!m&&this.expression_is_non_value_type_array(d)?(C=this.emit_uninitialized_temporary_expression(u,h),this.emit_array_copy(this.to_expression(h),h,d,v.Function,this.get_expression_effective_storage_class(d))):C=this.emit_op(u,h,I,m,!A),C.need_transpose=g,this.register_read(h,d,m),m?(this.has_extended_decoration(d,b.PhysicalTypePacked)&&this.set_extended_decoration(h,b.PhysicalTypePacked),this.has_extended_decoration(d,b.PhysicalTypeID)&&this.set_extended_decoration(h,b.PhysicalTypeID,this.get_extended_decoration(d,b.PhysicalTypeID))):(this.unset_extended_decoration(h,b.PhysicalTypePacked),this.unset_extended_decoration(h,b.PhysicalTypeID)),this.inherit_expression_dependencies(h,d),m&&this.add_implied_read_expression(C,d);break;case re.InBoundsAccessChain:case re.AccessChain:case re.PtrAccessChain:(Re=this.maybe_get(T,r[2]))&&this.flush_variable_declaration(Re.self);var P=new Nt,M=i===re.PtrAccessChain,D=(C=this.access_chain(r[2],r,3,a-3,this.get(R,r[0]),P,M),I=this.set(ae,r[1],C,r[0],this.should_forward(r[2])),this.maybe_get_backing_variable(r[2]));I.loaded_from=D?D.self:r[2],I.need_transpose=P.need_transpose,I.access_chain=!0,P.storage_is_packed&&this.set_extended_decoration(r[1],b.PhysicalTypePacked),0!==P.storage_physical_type&&this.set_extended_decoration(r[1],b.PhysicalTypeID,P.storage_physical_type),P.storage_is_invariant&&this.set_decoration(r[1],te.Invariant),P.flattened_struct&&(this.flattened_structs[r[1]]=!0),this.forwarded_temporaries.add(r[1]),this.suppressed_usage_tracking.add(r[1]);for(var B=2;B<a;B++)this.inherit_expression_dependencies(r[1],r[B]),this.add_implied_read_expression(I,r[B]);0===I.expression_dependencies.length&&this.forwarded_temporaries.delete(r[1]);break;case re.Store:(Re=this.maybe_get(T,r[0]))&&Re.statically_assigned||Re&&Re.loop_variable&&!Re.loop_variable_enable?Re.static_expression=r[1]:Re&&Re.remapped_variable&&Re.static_expression||(this.flattened_structs.hasOwnProperty(r[0])?(this.store_flattened_struct(r[0],r[1]),this.register_write(r[0])):this.emit_store_statement(r[0],r[1])),this.expression_type(r[1]).pointer&&this.register_write(r[1]);break;case re.ArrayLength:u=r[0],h=r[1],C=this.access_chain_internal(r[2],r,3,a-3,wt.INDEX_IS_LITERAL_BIT,null);this.has_decoration(r[2],te.NonUniform)&&(C=this.convert_non_uniform_expression(C,r[2])),this.set(ae,h,this.type_to_glsl(this.get(R,u)),"("+C+".length())",u,!0);break;case re.FunctionCall:u=r[0],h=r[1];var z=r[2];a-=3;var U=this.get(j,z),G=this.get(R,U.return_type),F=this.function_is_pure(U),V=!1,H=!1;for(B=0;B<a;B++)U.arguments[B].write_count&&(this.register_call_out_argument(r[B+3]),V=!0),this.flush_variable_declaration(r[B+3]);G.array.length>0&&!c.can_return_array&&(V=!0,H=!0),F||this.register_impure_function_call();var q="",X=[];q+=this.to_name(z)+"(",H&&(this.statement(this.type_to_glsl(G)," ",this.to_name(h),this.type_to_array_glsl(G),";"),X.push(this.to_name(h)));for(B=0;B<a;B++)this.skip_argument(r[B+3])||X.push(this.to_func_call_arg(U.arguments[B],r[B+3]));for(var K=0,W=U.combined_parameters;K<W.length;K++){var Z=W[K],Y=Z.global_image?Z.image_id:r[3+Z.image_id],J=Z.global_sampler?Z.sampler_id:r[3+Z.sampler_id];X.push(this.to_combined_image_sampler(Y,J))}if(this.append_global_func_args(U,a,X),q+=X.join(", "),q+=")",this.check_function_call_constraints(r,3,a),G.basetype!==E.Void){m=this.args_will_forward(h,r,3,a,F)&&!V&&F&&!this.forced_temporaries.has(h);H?(this.statement(q,";"),this.set(ae,h,this.to_name(h),u,!0)):this.emit_op(u,h,q,m);for(B=0;B<a;B++)this.register_read(h,r[B+3],m);m&&this.register_global_read_dependencies(U,h)}else this.statement(q,";");break;case re.CompositeConstruct:u=r[0],h=r[1];a-=2;for(m=!0,B=0;B<a;B++)m=m&&this.should_forward(r[B+2]);var $=this.get(R,u),ee=a>0?this.expression_type(r[2]):null,ne=$.array.length>0||$.basetype===E.Struct,_e=!1,ce=!1;if(ee&&(_e=1===ee.vecsize&&1===ee.columns&&!ne&&c.use_constructor_splatting,ce=1===ee.vecsize&&1===ee.columns&&c.can_swizzle_scalar,p.ids[r[2]].get_type()!==t.Constant||gt(ee)||(ce=!1)),_e||ce){var le=r[2];for(B=0;B<a;B++)le!==r[B+2]&&(_e=!1,ce=!1)}$.basetype!==E.Struct||c.can_declare_struct_inline||(m=!1),$.array.length>0&&!c.can_declare_arrays_inline&&(m=!1),this.type_is_empty($)&&!c.supports_empty_struct&&(m=!1);var pe="";if(c.use_initializer_list&&ne){var ue=!1;c.use_typed_initializer_list&&$.basetype===E.Struct&&0===$.array.length?pe+=this.type_to_glsl_constructor(this.get(R,u)):c.use_typed_initializer_list&&c.array_is_value_type&&$.array.length>0&&(pe+=this.type_to_glsl_constructor(this.get(R,u))+"(",ue=!0),pe+="{ ",this.type_is_empty($)&&!c.supports_empty_struct?pe+="0":pe+=_e?this.to_unpacked_expression(r[2]):this.build_composite_combiner(u,r,2,a),pe+=" }",ue&&(pe+=")")}else ce&&!ne?pe=this.remap_swizzle(this.get(R,u),1,this.to_unpacked_expression(r[2])):(pe=this.type_to_glsl_constructor(this.get(R,u))+"(",this.type_is_empty($)&&!c.supports_empty_struct?pe+="0":pe+=_e?this.to_unpacked_expression(r[2]):this.build_composite_combiner(u,r,2,a),pe+=")");if(""!==pe){this.emit_op(u,h,pe,m);for(B=0;B<a;B++)this.inherit_expression_dependencies(h,r[B+2])}break;case re.VectorInsertDynamic:u=r[0],h=r[1];var he=r[2],fe=r[3];this.flush_variable_declaration(he),this.statement(this.declare_temporary(u,h),this.to_expression(he),";"),this.set(ae,h,this.to_name(h),u,!0);var de=this.access_chain_internal(h,r,4,1,0,null);this.statement(de," = ",this.to_unpacked_expression(fe),";");break;case re.VectorExtractDynamic:u=r[0],h=r[1],I=this.access_chain_internal(r[2],r,3,1,0,null);this.emit_op(u,h,I,this.should_forward(r[2])),this.inherit_expression_dependencies(h,r[2]),this.inherit_expression_dependencies(h,r[3]);break;case re.CompositeExtract:u=r[0],h=r[1];a-=3;L=this.get(R,u);var me=!this.forced_temporaries.has(h),ge=this.expression_type(r[2]),be=ge.basetype===E.Struct||ge.array.length>0;be&&(me=!1),(this.has_extended_decoration(r[2],b.PhysicalTypePacked)||this.has_extended_decoration(r[2],b.PhysicalTypeID))&&(me=!1),this.is_non_native_row_major_matrix(r[2])&&(me=!1);P=new Nt,C=null;if(!(Ge=this.maybe_get(O,r[2]))||Ge.specialization||be)if(me&&this.should_forward(r[2])&&1===L.vecsize&&1===L.columns&&1===a){I=this.access_chain_internal(r[2],r,3,a,wt.INDEX_IS_LITERAL_BIT|wt.CHAIN_ONLY_BIT|wt.FORCE_COMPOSITE_BIT,P);C=this.emit_op(u,h,I,!0,this.should_suppress_usage_tracking(r[2])),this.inherit_expression_dependencies(h,r[2]),C.base_expression=r[2]}else{I=this.access_chain_internal(r[2],r,3,a,wt.INDEX_IS_LITERAL_BIT|wt.FORCE_COMPOSITE_BIT,P);C=this.emit_op(u,h,I,this.should_forward(r[2]),this.should_suppress_usage_tracking(r[2])),this.inherit_expression_dependencies(h,r[2])}else{var I=this.to_extract_constant_composite_expression(u,Ge,r,3,a);C=this.emit_op(u,h,I,!0,!0)}C.need_transpose=P.need_transpose,P.storage_is_packed&&this.set_extended_decoration(h,b.PhysicalTypePacked),0!==P.storage_physical_type&&this.set_extended_decoration(h,b.PhysicalTypeID,P.storage_physical_type),P.storage_is_invariant&&this.set_decoration(h,te.Invariant);break;case re.CompositeInsert:u=r[0],h=r[1];var ye=r[2];ne=r[3];a-=4,this.flush_variable_declaration(ne),this.statement(this.declare_temporary(u,h),this.to_expression(ne),";"),this.set(ae,h,this.to_name(h),u,!0);de=this.access_chain_internal(h,r,4,a,wt.INDEX_IS_LITERAL_BIT,null);this.statement(de," = ",this.to_unpacked_expression(ye),";");break;case re.CopyMemory:var ve=r[0];if(ve!==(Ee=r[1])){var Se=et(0,this.extra_sub_expressions,e.offset|Ct.STREAM_OFFSET);Se||(Se=p.increase_bound_by(1));var xe=this.expression_type(Ee).parent_type,ke=new Ie,we=new Ie;ke.op=re.Load,ke.length=3,ke.ops.push(xe),ke.ops.push(Se),ke.ops.push(Ee),we.op=re.Store,we.length=2,we.ops.push(ve),we.ops.push(Se),this.emit_instruction(ke),this.emit_instruction(we)}break;case re.CopyLogical:u=r[0],h=r[1];var Ee=r[2];this.emit_uninitialized_temporary_expression(u,h),this.emit_copy_logical_type(h,u,Ee,this.expression_type_id(Ee),[]);break;case re.CopyObject:u=r[0],h=r[1],Ee=r[2];var Te=this.get(R,u).pointer,Le=(de=this.maybe_get(oe,Ee),this.maybe_get(se,Ee));if(de)(C=this.set(oe,h,de)).self=h;else if(Le){(C=this.set(se,h,Le)).self=h}else if(this.expression_is_lvalue(Ee)&&!Te)this.statement(this.declare_temporary(u,h),this.to_unpacked_expression(Ee),";"),this.set(ae,h,this.to_name(h),u,!0);else{C=this.set(ae,h,this.to_expression(Ee),u,!0);if(Te){var Re=this.maybe_get_backing_variable(Ee);C.loaded_from=Re?Re.self:0}var Ne=this.maybe_get(ae,Ee);Ne&&(C.implied_read_expressions=Ne.implied_read_expressions,C.expression_dependencies=Ne.expression_dependencies)}break;case re.VectorShuffle:u=r[0],h=r[1];var Ae=r[2],Ce=r[3];a-=4;var Pe=this.expression_type(Ae),Me=!1;for(B=0;B<a;B++)(r[B+4]>=Pe.vecsize||4294967295===r[B+4])&&(Me=!0);!Me&&this.has_extended_decoration(Ae,b.PhysicalTypePacked)&&(Me=!0);I="";var De=!1,Be=!1;if(Me){De=this.should_forward(Ae)&&this.should_forward(Ce),Be=this.should_suppress_usage_tracking(Ae)&&this.should_suppress_usage_tracking(Ce);var ze=[];for(B=0;B<a;B++){var Ge;if(4294967295===r[B+4])(Ge=new O).constant_type=Pe.parent_type,console.assert(0!==Pe.parent_type),ze.push(this.constant_expression(Ge));else r[B+4]>=Pe.vecsize?ze.push(this.to_extract_component_expression(Ce,r[B+4]-Pe.vecsize)):ze.push(this.to_extract_component_expression(Ae,r[B+4]))}I+=this.type_to_glsl_constructor(this.get(R,u))+"("+ze.join(", ")+")"}else{De=this.should_forward(Ae),Be=this.should_suppress_usage_tracking(Ae),I+=this.to_enclosed_unpacked_expression(Ae),I+=".";for(B=0;B<a;B++)console.assert(4294967295!==r[B+4]),I+=this.index_to_swizzle(r[B+4]);c.swizzle_is_function&&a>1&&(I+="()")}this.emit_op(u,h,I,De,Be),this.inherit_expression_dependencies(h,Ae),Ae!==Ce&&this.inherit_expression_dependencies(h,Ce);break;case re.IsNan:case re.IsInf:this.emit_unary_func_op(r[0],r[1],r[2],"isnan");break;case re.SNegate:case re.FNegate:this.emit_unary_op(r[0],r[1],r[2],"-");break;case re.IAdd:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"+",L,yt(i));break;case re.FAdd:this.emit_binary_op(r[0],r[1],r[2],r[3],"+");break;case re.ISub:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"-",L,yt(i));break;case re.FSub:this.emit_binary_op(r[0],r[1],r[2],r[3],"-");break;case re.IMul:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"*",L,yt(i));break;case re.VectorTimesMatrix:case re.MatrixTimesVector:if((C=this.maybe_get(ae,r[i===re.MatrixTimesVector?2:3]))&&C.need_transpose){C.need_transpose=!1;I="";I=i===re.MatrixTimesVector?this.to_enclosed_unpacked_expression(r[3])+" * "+this.enclose_expression(this.to_unpacked_row_major_matrix_expression(r[2])):this.enclose_expression(this.to_unpacked_row_major_matrix_expression(r[3]))+" * "+this.to_enclosed_unpacked_expression(r[2]);m=this.should_forward(r[2])&&this.should_forward(r[3]);this.emit_op(r[0],r[1],I,m),C.need_transpose=!0,this.inherit_expression_dependencies(r[1],r[2]),this.inherit_expression_dependencies(r[1],r[3])}else this.emit_binary_op(r[0],r[1],r[2],r[3],"*");break;case re.MatrixTimesMatrix:var Fe=this.maybe_get(ae,r[2]),Oe=this.maybe_get(ae,r[3]);if(Fe&&Oe&&Fe.need_transpose&&Oe.need_transpose){Fe.need_transpose=!1,Oe.need_transpose=!1;I=this.enclose_expression(this.to_unpacked_row_major_matrix_expression(r[3]))+" * "+this.enclose_expression(this.to_unpacked_row_major_matrix_expression(r[2])),m=this.should_forward(r[2])&&this.should_forward(r[3]);(C=this.emit_op(r[0],r[1],I,m)).need_transpose=!0,Fe.need_transpose=!0,Oe.need_transpose=!0,this.inherit_expression_dependencies(r[1],r[2]),this.inherit_expression_dependencies(r[1],r[3])}else this.emit_binary_op(r[0],r[1],r[2],r[3],"*");break;case re.FMul:case re.MatrixTimesScalar:case re.VectorTimesScalar:this.emit_binary_op(r[0],r[1],r[2],r[3],"*");break;case re.OuterProduct:this.emit_binary_func_op(r[0],r[1],r[2],r[3],"outerProduct");break;case re.Dot:this.emit_binary_func_op(r[0],r[1],r[2],r[3],"dot");break;case re.Transpose:if(l.version<120){u=r[0];var Ve=r[1],He=(le=r[2],g=!1,this.maybe_get(ae,le));if(He){var qe=g;g=He.need_transpose,He.need_transpose=qe}m=this.should_forward(le);(C=this.emit_op(u,Ve,this.to_expression(le),m)).need_transpose=!g,He&&(He.need_transpose=g)}else this.emit_unary_func_op(r[0],r[1],r[2],"transpose");break;case re.SRem:u=r[0],Ve=r[1];var Xe=r[2],Ke=r[3];m=this.should_forward(Xe)&&this.should_forward(Ke),I=this.to_enclosed_expression(Xe)+" - "+this.to_enclosed_expression(Ke)+" * ("+this.to_enclosed_expression(Xe)+" / "+this.to_enclosed_expression(Ke)+")";this.emit_op(u,Ve,I,m),this.inherit_expression_dependencies(Ve,Xe),this.inherit_expression_dependencies(Ve,Ke);break;case re.SDiv:this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"/",o,yt(i));break;case re.UDiv:this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"/",n,yt(i));break;case re.FDiv:this.emit_binary_op(r[0],r[1],r[2],r[3],"/");break;case re.ShiftRightLogical:this.emit_binary_op_cast(r[0],r[1],r[2],r[3],">>",n,yt(i));break;case re.ShiftRightArithmetic:this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"+",o,yt(i));break;case re.ShiftLeftLogical:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"<<",L,yt(i));break;case re.BitwiseOr:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"|",L,yt(i));break;case re.BitwiseXor:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"^",L,yt(i));break;case re.BitwiseAnd:L=this.get(R,r[0]).basetype;this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"&",L,yt(i));break;case re.Not:this.emit_unary_op(r[0],r[1],r[2],"~");break;case re.UMod:this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"%",n,yt(i));break;case re.SMod:this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"%",o,yt(i));break;case re.FMod:this.emit_binary_func_op(r[0],r[1],r[2],r[3],"mod");break;case re.FRem:if(this.is_legacy())throw new Error("OpFRem requires trunc() and is only supported on non-legacy targets. A workaround is needed for legacy.");u=r[0],Ve=r[1],Xe=r[2],Ke=r[3],m=this.should_forward(Xe)&&this.should_forward(Ke),I=this.to_enclosed_expression(Xe)+" - "+this.to_enclosed_expression(Ke)+" * trunc("+this.to_enclosed_expression(Xe)+" / "+this.to_enclosed_expression(Ke)+")";this.emit_op(u,Ve,I,m),this.inherit_expression_dependencies(Ve,Xe),this.inherit_expression_dependencies(Ve,Ke);break;case re.Any:this.emit_unary_func_op(r[0],r[1],r[2],"any");break;case re.All:this.emit_unary_func_op(r[0],r[1],r[2],"all");break;case re.Select:this.emit_mix_op(r[0],r[1],r[4],r[3],r[2]);break;case re.LogicalOr:u=r[0],h=r[1];(L=this.get(R,u)).vecsize>1?this.emit_unrolled_binary_op(u,h,r[2],r[3],"||",!1,E.Unknown):this.emit_binary_op(r[0],r[1],r[2],r[3],"||");break;case re.LogicalAnd:u=r[0],h=r[1];(L=this.get(R,u)).vecsize>1?this.emit_unrolled_binary_op(u,h,r[2],r[3],"&&",!1,E.Unknown):this.emit_binary_op(r[0],r[1],r[2],r[3],"&&");break;case re.LogicalNot:(L=this.get(R,r[0])).vecsize>1?this.emit_unary_func_op(r[0],r[1],r[2],"not "):this.emit_unary_op(r[0],r[1],r[2],"!");break;case re.IEqual:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op_cast(r[0],r[1],r[2],r[3],"equal",o,yt(i)):this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"==",o,yt(i));break;case re.LogicalEqual:case re.FOrdEqual:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op(r[0],r[1],r[2],r[3],"equal"):this.emit_binary_op(r[0],r[1],r[2],r[3],"==");break;case re.INotEqual:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op_cast(r[0],r[1],r[2],r[3],"notEqual",o,yt(i)):this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"!=",o,yt(i));break;case re.LogicalNotEqual:case re.FOrdNotEqual:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op(r[0],r[1],r[2],r[3],"notEqual"):this.emit_binary_op(r[0],r[1],r[2],r[3],"!=");break;case re.UGreaterThan:case re.SGreaterThan:L=i===re.UGreaterThan?n:o;this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op_cast(r[0],r[1],r[2],r[3],"greaterThan",L,yt(i)):this.emit_binary_op_cast(r[0],r[1],r[2],r[3],">",L,yt(i));break;case re.FOrdGreaterThan:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op(r[0],r[1],r[2],r[3],"greaterThan"):this.emit_binary_op(r[0],r[1],r[2],r[3],">");break;case re.UGreaterThanEqual:case re.SGreaterThanEqual:L=i===re.UGreaterThanEqual?n:o;this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op_cast(r[0],r[1],r[2],r[3],"greaterThanEqual",L,yt(i)):this.emit_binary_op_cast(r[0],r[1],r[2],r[3],">=",L,yt(i));break;case re.FOrdGreaterThanEqual:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op(r[0],r[1],r[2],r[3],"greaterThanEqual"):this.emit_binary_op(r[0],r[1],r[2],r[3],">=");break;case re.ULessThan:case re.SLessThan:L=i===re.ULessThan?n:o;this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op_cast(r[0],r[1],r[2],r[3],"lessThan",L,yt(i)):this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"<",L,yt(i));break;case re.FOrdLessThan:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op(r[0],r[1],r[2],r[3],"lessThan"):this.emit_binary_op(r[0],r[1],r[2],r[3],"<");break;case re.ULessThanEqual:case re.SLessThanEqual:L=i===re.ULessThanEqual?n:o;this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op_cast(r[0],r[1],r[2],r[3],"lessThanEqual",L,yt(i)):this.emit_binary_op_cast(r[0],r[1],r[2],r[3],"<=",L,yt(i));break;case re.FOrdLessThanEqual:this.expression_type(r[2]).vecsize>1?this.emit_binary_func_op(r[0],r[1],r[2],r[3],"lessThanEqual"):this.emit_binary_op(r[0],r[1],r[2],r[3],"<=");break;case re.SConvert:case re.ConvertSToF:case re.UConvert:case re.ConvertUToF:var je=i===re.SConvert||i===re.ConvertSToF?o:n,We=(u=r[0],h=r[1],L=this.get(R,u),this.expression_type(r[2]));z=this.type_to_glsl_constructor(L);We.width<L.width||gt(L)?this.emit_unary_func_op_cast(u,h,r[2],z,je,L.basetype):this.emit_unary_func_op(u,h,r[2],z);break;case re.ConvertFToU:case re.ConvertFToS:u=r[0],h=r[1],L=this.get(R,u);var Qe=f(R,L),Ze=this.expression_type(r[2]);Qe.basetype=i===re.ConvertFToS?vt(L.width):St(L.width);z=this.type_to_glsl_constructor(Qe);this.emit_unary_func_op_cast(u,h,r[2],z,Ze.basetype,Qe.basetype);break;case re.FConvert:u=r[0],h=r[1],z=this.type_to_glsl_constructor(this.get(R,u));this.emit_unary_func_op(u,h,r[2],z);break;case re.Bitcast:u=r[0],h=r[1];var Ye=r[2];if(!this.emit_complex_bitcast(u,h,Ye)){var Je=this.bitcast_glsl_op(this.get(R,u),this.expression_type(Ye));this.emit_unary_func_op(u,h,Ye,Je)}break;case re.QuantizeToF16:u=r[0],h=r[1],Ye=r[2],Je="";switch((L=this.get(R,u)).vecsize){case 1:Je="unpackHalf2x16(packHalf2x16(vec2("+this.to_expression(Ye)+"))).x";break;case 2:Je="unpackHalf2x16(packHalf2x16("+this.to_expression(Ye)+"))";break;case 3:Je="vec3("+(Xe="unpackHalf2x16(packHalf2x16("+this.to_expression(Ye)+".xy))")+", "+(Ke="unpackHalf2x16(packHalf2x16("+this.to_expression(Ye)+".zz)).x")+")";break;case 4:Je="vec4("+(Xe="unpackHalf2x16(packHalf2x16("+this.to_expression(Ye)+".xy))")+", "+(Ke="unpackHalf2x16(packHalf2x16("+this.to_expression(Ye)+".zw))")+")";break;default:throw new Error("Illegal argument to OpQuantizeToF16.")}this.emit_op(u,h,Je,this.should_forward(Ye)),this.inherit_expression_dependencies(h,Ye);break;case re.DPdx:this.emit_unary_func_op(r[0],r[1],r[2],"dFdx"),this.is_legacy_es()&&this.require_extension_internal("GL_OES_standard_derivatives"),this.register_control_dependent_expression(r[1]);break;case re.DPdy:this.emit_unary_func_op(r[0],r[1],r[2],"dFdy"),this.is_legacy_es()&&this.require_extension_internal("GL_OES_standard_derivatives"),this.register_control_dependent_expression(r[1]);break;case re.Fwidth:this.emit_unary_func_op(r[0],r[1],r[2],"fwidth"),this.is_legacy_es()&&this.require_extension_internal("GL_OES_standard_derivatives"),this.register_control_dependent_expression(r[1]);break;case re.BitFieldInsert:this.emit_bitfield_insert_op(r[0],r[1],r[2],r[3],r[4],r[5],"bitfieldInsert",E.Int);break;case re.BitFieldSExtract:this.emit_trinary_func_op_bitextract(r[0],r[1],r[2],r[3],r[4],"bitfieldExtract",o,o,E.Int,E.Int);break;case re.BitFieldUExtract:this.emit_trinary_func_op_bitextract(r[0],r[1],r[2],r[3],r[4],"bitfieldExtract",n,n,E.Int,E.Int);break;case re.BitReverse:this.emit_unary_func_op(r[0],r[1],r[2],"bitfieldReverse");break;case re.BitCount:var $e=this.expression_type(r[2]).basetype;this.emit_unary_func_op_cast(r[0],r[1],r[2],"bitCount",$e,o);break;case re.ImageSampleExplicitLod:case re.ImageSampleProjExplicitLod:case re.ImageSampleDrefExplicitLod:case re.ImageSampleProjDrefExplicitLod:case re.ImageSampleImplicitLod:case re.ImageSampleProjImplicitLod:case re.ImageSampleDrefImplicitLod:case re.ImageSampleProjDrefImplicitLod:case re.ImageFetch:case re.ImageGather:case re.ImageDrefGather:this.emit_texture_op(e,!1);break;case re.ImageSparseSampleExplicitLod:case re.ImageSparseSampleProjExplicitLod:case re.ImageSparseSampleDrefExplicitLod:case re.ImageSparseSampleProjDrefExplicitLod:case re.ImageSparseSampleImplicitLod:case re.ImageSparseSampleProjImplicitLod:case re.ImageSparseSampleDrefImplicitLod:case re.ImageSparseSampleProjDrefImplicitLod:case re.ImageSparseFetch:case re.ImageSparseGather:case re.ImageSparseDrefGather:this.emit_texture_op(e,!0);break;case re.Image:u=r[0],h=r[1],C=this.emit_op(u,h,this.to_expression(r[2]),!0,!0),Re=this.maybe_get_backing_variable(r[2]);C.loaded_from=Re?Re.self:0;break;case re.ImageQuerySamples:L=this.expression_type(r[2]),u=r[0],h=r[1],I=void 0;I=2===L.image.sampled?"imageSamples("+this.to_non_uniform_aware_expression(r[2])+")":"textureSamples("+this.convert_separate_image_to_expression(r[2])+")";var tt=this.get(R,r[0]);I=this.bitcast_expression(tt,E.Int,I),this.emit_op(u,h,I,!0);break;case re.SampledImage:u=r[0],h=r[1];this.emit_sampled_image_op(u,h,r[2],r[3]),this.inherit_expression_dependencies(h,r[2]),this.inherit_expression_dependencies(h,r[3]);break;case re.ImageQuerySizeLod:u=r[0],h=r[1];var rt=r[2],it="textureSize";if(this.is_legacy_es())throw new Error("textureSize is not supported in ESSL 100.");I=it+"("+this.convert_separate_image_to_expression(rt)+", "+this.bitcast_expression(E.Int,r[3])+")",tt=this.get(R,r[0]);I=this.bitcast_expression(tt,E.Int,I),this.emit_op(u,h,I,!0);break;case re.ImageRead:case re.ImageSparseRead:var at=this.maybe_get_backing_variable(r[2]);if(at)(ut=et(x,p.meta,at.self).decoration.decoration_flags).get(te.NonReadable)&&(ut.clear(te.NonReadable),this.force_recompile());u=r[0],h=r[1],F=!1;var st="";L=this.expression_type(r[2]);if(at&&at.remapped_variable){if(L.image.ms)throw new Error("Trying to remap multisampled image to variable, this is not possible.");var ot=this.pls_inputs.find((function(e){return e.id===at.self}));if(ot){var nt=Zt(ot.format);st=this.remap_swizzle(this.get(R,u),nt,this.to_expression(r[2]))}else{if(!at.remapped_components)throw new Error("subpassInput was remapped, but remap_components is not set correctly.");st=this.remap_swizzle(this.get(R,u),at.remapped_components,this.to_expression(r[2]))}F=!0}else if(L.image.dim===Ue.SubpassData){if(at&&this.subpass_input_is_framebuffer_fetch(at.self))st=this.to_expression(at.self);else if(L.image.ms){if(r[4]!==At.Sample||6!==a)throw new Error("Multisampled image used in OpImageRead, but unexpected operand mask was used.");var _t=r[5];st="texelFetch("+this.to_non_uniform_aware_expression(r[2])+", ivec2(gl_FragCoord.xy), "+this.to_expression(_t)+")"}else st="texelFetch("+this.to_non_uniform_aware_expression(r[2])+", ivec2(gl_FragCoord.xy), 0)";st=this.remap_swizzle(this.get(R,u),4,st),F=!0}else{var ct=i===re.ImageSparseRead,lt={sparse_code_id:0,sparse_texel_id:0};ct&&this.emit_sparse_feedback_temporaries(r[0],r[1],lt);var pt=this.to_expression(r[3]);if((dt=f(R,this.expression_type(r[3]))).basetype=E.Int,pt=this.bitcast_expression(dt,this.expression_type(r[3]).basetype,pt),ct){if(L.image.ms){if(r[4]!==At.Sample||6!==a)throw new Error("Multisampled image used in OpImageRead, but unexpected operand mask was used.");_t=r[5];this.statement(this.to_expression(lt.sparse_code_id)," = sparseImageLoadARB(",this.to_non_uniform_aware_expression(r[2]),", ",pt,", ",this.to_expression(_t),", ",this.to_expression(lt.sparse_texel_id),");")}else this.statement(this.to_expression(lt.sparse_code_id)," = sparseImageLoadARB(",this.to_non_uniform_aware_expression(r[2]),", ",pt,", ",this.to_expression(lt.sparse_texel_id),");");st=this.type_to_glsl(this.get(R,u))+"("+this.to_expression(lt.sparse_code_id)+", "+this.to_expression(lt.sparse_texel_id)+")"}else if(L.image.ms){if(r[4]!==At.Sample||6!==a)throw new Error("Multisampled image used in OpImageRead, but unexpected operand mask was used.");_t=r[5];st="imageLoad("+this.to_non_uniform_aware_expression(r[2])+", "+pt+", "+this.to_expression(_t)+")"}else st="imageLoad("+this.to_non_uniform_aware_expression(r[2])+", "+pt+")";ct||(st=this.remap_swizzle(this.get(R,u),4,st)),F=!1}if(at&&at.forwardable){m=!this.forced_temporaries.has(h),C=this.emit_op(u,h,st,m);F||(C.loaded_from=at.self,m&&at.dependees.push(h))}else this.emit_op(u,h,st,!1);this.inherit_expression_dependencies(h,r[2]),L.image.ms&&this.inherit_expression_dependencies(h,r[5]);break;case re.ImageTexelPointer:u=r[0],h=r[1],pt=this.to_expression(r[3]);(dt=f(R,this.expression_type(r[3]))).basetype=E.Int,pt=this.bitcast_expression(dt,this.expression_type(r[3]).basetype,pt);I=this.to_expression(r[2])+", "+pt,C=this.set(ae,h,I,u,!0),Re=this.maybe_get_backing_variable(r[2]);C.loaded_from=Re?Re.self:0,this.inherit_expression_dependencies(h,r[3]);break;case re.ImageWrite:var ut;if(Re=this.maybe_get_backing_variable(r[0]))(ut=et(x,p.meta,Re.self).decoration.decoration_flags).get(te.NonWritable)&&(ut.clear(te.NonWritable),this.force_recompile());L=this.expression_type(r[0]);var ht=this.expression_type(r[2]),ft=f(R,ht);ft.vecsize=4;var dt;pt=this.to_expression(r[1]);if((dt=f(R,this.expression_type(r[1]))).basetype=E.Int,pt=this.bitcast_expression(dt,this.expression_type(r[1]).basetype,pt),L.image.ms){if(r[3]!==At.Sample||5!==a)throw new Error("Multisampled image used in OpImageWrite, but unexpected operand mask was used.");_t=r[4];this.statement("imageStore(",this.to_non_uniform_aware_expression(r[0]),", ",pt,", ",this.to_expression(_t),", ",this.remap_swizzle(ft,ht.vecsize,this.to_expression(r[2])),");")}else this.statement("imageStore(",this.to_non_uniform_aware_expression(r[0]),", ",pt,", ",this.remap_swizzle(ft,ht.vecsize,this.to_expression(r[2])),");");Re&&this.variable_storage_is_aliased(Re)&&this.flush_all_aliased_variables();break;case re.ImageQuerySize:L=this.expression_type(r[2]),u=r[0],h=r[1];if(L.basetype!==E.Image)throw new Error("Invalid type for OpImageQuerySize.");I=void 0;if(2===L.image.sampled)throw new Error("At least ESSL 3.10 required for imageSize.");it="textureSize";if(this.is_legacy()){var mt=this.get(R,L.self);it=this.legacy_tex_op(it,mt,r[2])}I=it+"("+this.convert_separate_image_to_expression(r[2])+")";tt=this.get(R,r[0]);I=this.bitcast_expression(tt,E.Int,I),this.emit_op(u,h,I,!0);break;case re.ExtInst:var bt=r[2],It=this.get(ie,bt).ext;if(It!==Q.GLSL){if(It===Q.SPV_debug_info)break;this.statement("// unimplemented ext op ",e.op);break}this.emit_glsl_op(r[0],r[1],r[3],r,4,a-4);break;case re.FUnordEqual:case re.FUnordNotEqual:case re.FUnordLessThan:case re.FUnordGreaterThan:case re.FUnordLessThanEqual:case re.FUnordGreaterThanEqual:Xe=r[2],Ke=r[3],I=void 0;if(this.expression_type(Xe).vecsize>1){var xt=null;switch(i){case re.FUnordEqual:xt="notEqual";break;case re.FUnordNotEqual:xt="equal";break;case re.FUnordLessThan:xt="greaterThanEqual";break;case re.FUnordLessThanEqual:xt="greaterThan";break;case re.FUnordGreaterThan:xt="lessThanEqual";break;case re.FUnordGreaterThanEqual:xt="lessThan";break;default:console.assert(0)}I="not("+xt+"("+this.to_unpacked_expression(Xe)+", "+this.to_unpacked_expression(Ke)+"))"}else{xt=null;switch(i){case re.FUnordEqual:xt=" !== ";break;case re.FUnordNotEqual:xt=" === ";break;case re.FUnordLessThan:xt=" >= ";break;case re.FUnordLessThanEqual:xt=" > ";break;case re.FUnordGreaterThan:xt=" <= ";break;case re.FUnordGreaterThanEqual:xt=" < ";break;default:console.assert(0)}I="!("+this.to_enclosed_unpacked_expression(Xe)+xt+this.to_enclosed_unpacked_expression(Ke)+")"}this.emit_op(r[0],r[1],I,this.should_forward(Xe)&&this.should_forward(Ke)),this.inherit_expression_dependencies(r[1],Xe),this.inherit_expression_dependencies(r[1],Ke);break;case re.ConvertUToPtr:if((L=this.get(R,r[0])).storage!==v.PhysicalStorageBufferEXT)throw new Error("Only StorageClassPhysicalStorageBufferEXT is supported by OpConvertUToPtr.");2===(ee=this.expression_type(r[2])).vecsize&&this.require_extension_internal("GL_EXT_buffer_reference_uvec2");Je=this.type_to_glsl(L);this.emit_unary_func_op(r[0],r[1],r[2],Je);break;case re.ConvertPtrToU:L=this.get(R,r[0]);if(this.expression_type(r[2]).storage!==v.PhysicalStorageBufferEXT)throw new Error("Only StorageClassPhysicalStorageBufferEXT is supported by OpConvertPtrToU.");2===L.vecsize&&this.require_extension_internal("GL_EXT_buffer_reference_uvec2");Je=this.type_to_glsl(L);this.emit_unary_func_op(r[0],r[1],r[2],Je);break;case re.Undef:break;case re.Line:this.emit_line_directive(r[0],r[1]);break;case re.NoLine:break;case re.DemoteToHelperInvocationEXT:case re.IsHelperInvocationEXT:throw new Error("GL_EXT_demote_to_helper_invocation is only supported in Vulkan GLSL.");default:throw console.log("unimplemented op ",e.op),this.statement("// unimplemented op ",e.op),new Error("Unsupported op "+e.op)}},r.prototype.emit_block_instructions=function(e){this.current_emitting_block=e;for(var t=0,r=e.ops;t<r.length;t++){var i=r[t];this.emit_instruction(i)}this.current_emitting_block=null},r.prototype.emit_glsl_op=function(e,t,r,i,a,s){var o=r;if(this.is_legacy()&&function(e){switch(e){case Oe.UClamp:case Oe.UMin:case Oe.UMax:case Oe.FindUMsb:return!0;default:return!1}}(o))throw new Error("Unsigned integers are not supported on legacy GLSL targets.");var n=this.get_integer_width_for_glsl_instruction(o,i,a,s),_=vt(n),c=St(n),l=this.ir;switch(o){case Oe.Round:if(this.is_legacy()){var p=this.to_enclosed_expression(i[a]),u=this.expression_type(i[a]),h="floor("+p+" + "+this.type_to_glsl_constructor(u)+"(0.5))",d=this.should_forward(i[a]);this.emit_op(e,t,h,d),this.inherit_expression_dependencies(t,i[a])}else this.emit_unary_func_op(e,t,i[a],"round");break;case Oe.RoundEven:if(this.is_legacy())throw new Error("roundEven supported only in ESSL 300.");this.emit_unary_func_op(e,t,i[a],"roundEven");break;case Oe.Trunc:this.emit_unary_func_op(e,t,i[a],"trunc");break;case Oe.SAbs:this.emit_unary_func_op_cast(e,t,i[a],"abs",_,_);break;case Oe.FAbs:this.emit_unary_func_op(e,t,i[a],"abs");break;case Oe.SSign:this.emit_unary_func_op_cast(e,t,i[a],"sign",_,_);break;case Oe.FSign:this.emit_unary_func_op(e,t,i[a],"sign");break;case Oe.Floor:this.emit_unary_func_op(e,t,i[a],"floor");break;case Oe.Ceil:this.emit_unary_func_op(e,t,i[a],"ceil");break;case Oe.Fract:this.emit_unary_func_op(e,t,i[a],"fract");break;case Oe.Radians:this.emit_unary_func_op(e,t,i[a],"radians");break;case Oe.Degrees:this.emit_unary_func_op(e,t,i[a],"degrees");break;case Oe.Fma:h=this.to_enclosed_expression(i[a])+" * "+this.to_enclosed_expression(i[a+1])+" + "+this.to_enclosed_expression(i[a+2]);this.emit_op(e,t,h,this.should_forward(i[a])&&this.should_forward(i[a+1])&&this.should_forward(i[a+2]));for(var m=0;m<3;m++)this.inherit_expression_dependencies(t,i[m]);break;case Oe.Modf:this.register_call_out_argument(i[a+1]),this.forced_temporaries.add(t),this.emit_binary_func_op(e,t,i[a],i[a+1],"modf");break;case Oe.ModfStruct:var g=this.get(R,e);this.emit_uninitialized_temporary_expression(e,t),this.statement(this.to_expression(t),".",this.to_member_name(g,0)," = ","modf(",this.to_expression(i[a]),", ",this.to_expression(t),".",this.to_member_name(g,1),");");break;case Oe.UMin:this.emit_binary_func_op_cast(e,t,i[a],i[a+1],"min",c,!1);break;case Oe.SMin:this.emit_binary_func_op_cast(e,t,i[a],i[a+1],"min",_,!1);break;case Oe.FMin:this.emit_binary_func_op(e,t,i[a],i[a+1],"min");break;case Oe.FMax:this.emit_binary_func_op(e,t,i[a],i[a+1],"max");break;case Oe.UMax:this.emit_binary_func_op_cast(e,t,i[a],i[a+1],"max",c,!1);break;case Oe.SMax:this.emit_binary_func_op_cast(e,t,i[a],i[a+1],"max",_,!1);break;case Oe.FClamp:this.emit_trinary_func_op(e,t,i[a],i[a+1],i[a+2],"clamp");break;case Oe.UClamp:this.emit_trinary_func_op_cast(e,t,i[a],i[a+1],i[a+2],"clamp",c);break;case Oe.SClamp:this.emit_trinary_func_op_cast(e,t,i[a],i[a+1],i[a+2],"clamp",_);break;case Oe.Sin:this.emit_unary_func_op(e,t,i[a],"sin");break;case Oe.Cos:this.emit_unary_func_op(e,t,i[a],"cos");break;case Oe.Tan:this.emit_unary_func_op(e,t,i[a],"tan");break;case Oe.Asin:this.emit_unary_func_op(e,t,i[a],"asin");break;case Oe.Acos:this.emit_unary_func_op(e,t,i[a],"acos");break;case Oe.Atan:this.emit_unary_func_op(e,t,i[a],"atan");break;case Oe.Sinh:this.emit_unary_func_op(e,t,i[a],"sinh");break;case Oe.Cosh:this.emit_unary_func_op(e,t,i[a],"cosh");break;case Oe.Tanh:this.emit_unary_func_op(e,t,i[a],"tanh");break;case Oe.Asinh:this.emit_unary_func_op(e,t,i[a],"asinh");break;case Oe.Acosh:this.emit_unary_func_op(e,t,i[a],"acosh");break;case Oe.Atanh:this.emit_unary_func_op(e,t,i[a],"atanh");break;case Oe.Atan2:this.emit_binary_func_op(e,t,i[a],i[a+1],"atan");break;case Oe.Pow:this.emit_binary_func_op(e,t,i[a],i[a+1],"pow");break;case Oe.Exp:this.emit_unary_func_op(e,t,i[a],"exp");break;case Oe.Log:this.emit_unary_func_op(e,t,i[a],"log");break;case Oe.Exp2:this.emit_unary_func_op(e,t,i[a],"exp2");break;case Oe.Log2:this.emit_unary_func_op(e,t,i[a],"log2");break;case Oe.Sqrt:this.emit_unary_func_op(e,t,i[a],"sqrt");break;case Oe.InverseSqrt:this.emit_unary_func_op(e,t,i[a],"inversesqrt");break;case Oe.Determinant:this.emit_unary_func_op(e,t,i[a],"determinant");break;case Oe.MatrixInverse:this.emit_unary_func_op(e,t,i[a],"inverse");break;case Oe.FMix:case Oe.IMix:this.emit_mix_op(e,t,i[a],i[a+1],i[a+2]);break;case Oe.Step:this.emit_binary_func_op(e,t,i[a],i[a+1],"step");break;case Oe.SmoothStep:this.emit_trinary_func_op(e,t,i[a],i[a+1],i[a+2],"smoothstep");break;case Oe.Frexp:this.register_call_out_argument(i[a+1]),this.forced_temporaries.add(t),this.emit_binary_func_op(e,t,i[a],i[a+1],"frexp");break;case Oe.FrexpStruct:g=this.get(R,e);this.emit_uninitialized_temporary_expression(e,t),this.statement(this.to_expression(t),".",this.to_member_name(g,0)," = ","frexp(",this.to_expression(i[a]),", ",this.to_expression(t),".",this.to_member_name(g,1),");");break;case Oe.Ldexp:d=this.should_forward(i[a])&&this.should_forward(i[a+1]),p=this.to_unpacked_expression(i[a]);var b=this.to_unpacked_expression(i[a+1]),y=this.expression_type(i[a+1]);if(y.basetype!==E.Int){var v=f(R,y);v.basetype=E.Int,b=this.type_to_glsl_constructor(v)+"("+b+")"}h="ldexp("+p+", "+b+")";this.emit_op(e,t,h,d),this.inherit_expression_dependencies(t,i[a]),this.inherit_expression_dependencies(t,i[a+1]);break;case Oe.PackSnorm4x8:this.emit_unary_func_op(e,t,i[a],"packSnorm4x8");break;case Oe.PackUnorm4x8:this.emit_unary_func_op(e,t,i[a],"packUnorm4x8");break;case Oe.PackSnorm2x16:this.emit_unary_func_op(e,t,i[a],"packSnorm2x16");break;case Oe.PackUnorm2x16:this.emit_unary_func_op(e,t,i[a],"packUnorm2x16");break;case Oe.PackHalf2x16:this.emit_unary_func_op(e,t,i[a],"packHalf2x16");break;case Oe.UnpackSnorm4x8:this.emit_unary_func_op(e,t,i[a],"unpackSnorm4x8");break;case Oe.UnpackUnorm4x8:this.emit_unary_func_op(e,t,i[a],"unpackUnorm4x8");break;case Oe.UnpackSnorm2x16:this.emit_unary_func_op(e,t,i[a],"unpackSnorm2x16");break;case Oe.UnpackUnorm2x16:this.emit_unary_func_op(e,t,i[a],"unpackUnorm2x16");break;case Oe.UnpackHalf2x16:this.emit_unary_func_op(e,t,i[a],"unpackHalf2x16");break;case Oe.PackDouble2x32:this.emit_unary_func_op(e,t,i[a],"packDouble2x32");break;case Oe.UnpackDouble2x32:this.emit_unary_func_op(e,t,i[a],"unpackDouble2x32");break;case Oe.Length:this.emit_unary_func_op(e,t,i[a],"length");break;case Oe.Distance:this.emit_binary_func_op(e,t,i[a],i[a+1],"distance");break;case Oe.Cross:this.emit_binary_func_op(e,t,i[a],i[a+1],"cross");break;case Oe.Normalize:this.emit_unary_func_op(e,t,i[a],"normalize");break;case Oe.FaceForward:this.emit_trinary_func_op(e,t,i[a],i[a+1],i[a+2],"faceforward");break;case Oe.Reflect:this.emit_binary_func_op(e,t,i[a],i[a+1],"reflect");break;case Oe.Refract:this.emit_trinary_func_op(e,t,i[a],i[a+1],i[a+2],"refract");break;case Oe.FindILsb:this.emit_unary_func_op_cast(e,t,i[a],"findLSB",this.expression_type(i[a]).basetype,_);break;case Oe.FindSMsb:this.emit_unary_func_op_cast(e,t,i[a],"findMSB",_,_);break;case Oe.FindUMsb:this.emit_unary_func_op_cast(e,t,i[a],"findMSB",c,_);break;case Oe.InterpolateAtCentroid:this.emit_unary_func_op(e,t,i[a],"interpolateAtCentroid");break;case Oe.InterpolateAtSample:this.emit_binary_func_op(e,t,i[a],i[a+1],"interpolateAtSample");break;case Oe.InterpolateAtOffset:this.emit_binary_func_op(e,t,i[a],i[a+1],"interpolateAtOffset");break;case Oe.NMin:case Oe.NMax:this.emit_nminmax_op(e,t,i[a],i[a+1],o);break;case Oe.NClamp:var S=et(0,this.extra_sub_expressions,t|Ct.TYPE_AUX);S||(S=l.increase_bound_by(1)),l.meta[S]=f(x,l.meta[t]),this.emit_nminmax_op(e,S,i[a],i[a+1],Oe.NMax),this.emit_nminmax_op(e,t,S,i[a+2],Oe.NMin);break;default:this.statement("// unimplemented GLSL op ",r)}},r.prototype.emit_header=function(){var e=this.get_entry_point(),t=this.options;100!==t.version&&this.statement("#version ",t.version," es"),e.flags.get(Ee.PostDepthCoverage)&&this.require_extension_internal("GL_ARB_post_depth_coverage");var r=e.flags.get(Ee.PixelInterlockOrderedEXT)||e.flags.get(Ee.PixelInterlockUnorderedEXT)||e.flags.get(Ee.SampleInterlockOrderedEXT)||e.flags.get(Ee.SampleInterlockUnorderedEXT);if(r)throw new Error("At least ESSL 3.10 required for fragment shader interlock.");for(var i=0,a=this.forced_extensions;i<a.length;i++){var s=a[i];"GL_EXT_shader_explicit_arithmetic_types_float16"===s?(this.statement("#if defined(GL_AMD_gpu_shader_half_float)"),this.statement("#extension GL_AMD_gpu_shader_half_float : require"),this.statement("#elif defined(GL_NV_gpu_shader5)"),this.statement("#extension GL_NV_gpu_shader5 : require"),this.statement("#else"),this.statement("#error No extension available for FP16."),this.statement("#endif")):"GL_EXT_shader_explicit_arithmetic_types_int16"===s?(this.statement("#if defined(GL_AMD_gpu_shader_int16)"),this.statement("#extension GL_AMD_gpu_shader_int16 : require"),this.statement("#elif defined(GL_NV_gpu_shader5)"),this.statement("#extension GL_NV_gpu_shader5 : require"),this.statement("#else"),this.statement("#error No extension available for Int16."),this.statement("#endif")):"GL_ARB_post_depth_coverage"===s?this.statement("#extension GL_EXT_post_depth_coverage : require"):/*!options.vulkan_semantics &&*/"GL_ARB_shader_draw_parameters"===s?(this.statement("#ifdef ",s),this.statement("#extension ",s," : enable"),this.statement("#endif")):"GL_EXT_control_flow_attributes"===s?(this.statement("#if defined(GL_EXT_control_flow_attributes)"),this.statement("#extension GL_EXT_control_flow_attributes : require"),this.statement("#define SPIRV_CROSS_FLATTEN [[flatten]]"),this.statement("#define SPIRV_CROSS_BRANCH [[dont_flatten]]"),this.statement("#define SPIRV_CROSS_UNROLL [[unroll]]"),this.statement("#define SPIRV_CROSS_LOOP [[dont_unroll]]"),this.statement("#else"),this.statement("#define SPIRV_CROSS_FLATTEN"),this.statement("#define SPIRV_CROSS_BRANCH"),this.statement("#define SPIRV_CROSS_UNROLL"),this.statement("#define SPIRV_CROSS_LOOP"),this.statement("#endif")):"GL_NV_fragment_shader_interlock"===s?(this.statement("#extension GL_NV_fragment_shader_interlock : require"),this.statement("#define SPIRV_Cross_beginInvocationInterlock() beginInvocationInterlockNV()"),this.statement("#define SPIRV_Cross_endInvocationInterlock() endInvocationInterlockNV()")):"GL_ARB_fragment_shader_interlock"===s?(this.statement("#ifdef GL_ARB_fragment_shader_interlock"),this.statement("#extension GL_ARB_fragment_shader_interlock : enable"),this.statement("#define SPIRV_Cross_beginInvocationInterlock() beginInvocationInterlockARB()"),this.statement("#define SPIRV_Cross_endInvocationInterlock() endInvocationInterlockARB()"),this.statement("#elif defined(GL_INTEL_fragment_shader_ordering)"),this.statement("#extension GL_INTEL_fragment_shader_ordering : enable"),this.statement("#define SPIRV_Cross_beginInvocationInterlock() beginFragmentShaderOrderingINTEL()"),this.statement("#define SPIRV_Cross_endInvocationInterlock()"),this.statement("#endif")):this.statement("#extension ",s," : require")}for(var o=0,n=this.header_lines;o<n.length;o++){var _=n[o];this.statement(_)}var c=[];switch(e.model){case ve.Vertex:t.ovr_multiview_view_count&&c.push("num_views = "+t.ovr_multiview_view_count);break;case ve.Fragment:switch(t.fragment.default_float_precision){case It.Lowp:this.statement("precision lowp float;");break;case It.Mediump:this.statement("precision mediump float;");break;case It.Highp:this.statement("precision highp float;")}switch(t.fragment.default_int_precision){case It.Lowp:this.statement("precision lowp int;");break;case It.Mediump:this.statement("precision mediump int;");break;case It.Highp:this.statement("precision highp int;")}e.flags.get(Ee.EarlyFragmentTests)&&c.push("early_fragment_tests"),e.flags.get(Ee.PostDepthCoverage)&&c.push("post_depth_coverage"),r&&this.statement("#if defined(GL_ARB_fragment_shader_interlock)"),e.flags.get(Ee.PixelInterlockOrderedEXT)?this.statement("layout(pixel_interlock_ordered) in;"):e.flags.get(Ee.PixelInterlockUnorderedEXT)?this.statement("layout(pixel_interlock_unordered) in;"):e.flags.get(Ee.SampleInterlockOrderedEXT)?this.statement("layout(sample_interlock_ordered) in;"):e.flags.get(Ee.SampleInterlockUnorderedEXT)&&this.statement("layout(sample_interlock_unordered) in;"),r&&(this.statement("#elif !defined(GL_INTEL_fragment_shader_ordering)"),this.statement("#error Fragment Shader Interlock/Ordering extension missing!"),this.statement("#endif"))}c.length>0&&this.statement("layout(",c.join(", "),") in;"),this.statement("")},r.prototype.emit_sampled_image_op=function(e,t,r,i){this.emit_op(e,t,this.to_combined_image_sampler(r,i),!0,!0),this.forwarded_temporaries.delete(t)},r.prototype.emit_texture_op=function(e,t){var r=this.stream(e),i=e.op,a=[],s=r[0],o=r[1],n=this.get(R,s),_={sparse_code_id:0,sparse_texel_id:0};t&&this.emit_sparse_feedback_temporaries(s,o,_);var c={value:!1},l=this.to_texture_op(e,t,c,a);t&&(this.statement(this.to_expression(_.sparse_code_id)," = ",l,";"),l=this.type_to_glsl(n)+"("+this.to_expression(_.sparse_code_id)+", "+this.to_expression(_.sparse_texel_id)+")",c.value=!0,a=[]),this.emit_op(s,o,l,c.value);for(var p=0,u=a;p<u.length;p++){var h=u[p];this.inherit_expression_dependencies(o,h)}switch(i){case re.ImageSampleDrefImplicitLod:case re.ImageSampleImplicitLod:case re.ImageSampleProjImplicitLod:case re.ImageSampleProjDrefImplicitLod:this.register_control_dependent_expression(o)}},r.prototype.to_texture_op=function(e,t,r,i){var a,s=this.stream(e),o=e.op,n=e.length,_=s[0],c=s[2],l=s[3],p=0,u=!1,h=!1,f=!1,d=this.get(R,_),m=this.backend;switch(i.push(l),this.has_decoration(c,te.NonUniform)&&!this.maybe_get_backing_variable(c)&&(f=!0),o){case re.ImageSampleDrefImplicitLod:case re.ImageSampleDrefExplicitLod:case re.ImageSparseSampleDrefImplicitLod:case re.ImageSparseSampleDrefExplicitLod:p=s[4],a=5,n-=5;break;case re.ImageSampleProjDrefImplicitLod:case re.ImageSampleProjDrefExplicitLod:case re.ImageSparseSampleProjDrefImplicitLod:case re.ImageSparseSampleProjDrefExplicitLod:p=s[4],a=5,n-=5,u=!0;break;case re.ImageFetch:case re.ImageSparseFetch:case re.ImageRead:a=4,n-=4,h=!0;break;case re.ImageSampleProjImplicitLod:case re.ImageSampleProjExplicitLod:case re.ImageSparseSampleProjImplicitLod:case re.ImageSparseSampleProjExplicitLod:a=4,n-=4,u=!0;break;default:a=4,n-=4}var g,b=this.expression_type(c),y=this.get(R,b.self);switch(y.image.dim){case Ue.Dim1D:g=1;break;case Ue.Dim2D:g=2;break;case Ue.Dim3D:case Ue.Cube:g=3;break;case Ue.Buffer:g=1;break;default:g=2}p&&i.push(p),u&&g++,y.image.arrayed&&g++;var v=0;n&&(v=s[a++],n--);var S=function(e){var t=0;return n&&v&e&&(t=s[a++],i.push(t),n--),t},I=S(At.Bias),x=S(At.Lod),k=S(At.Grad),w=S(At.Grad),E=S(At.ConstOffset),T=S(At.Offset),L=S(At.ConstOffsets),N=S(At.Sample),A=S(At.MinLod),C=new Dt;C.img=c,C.imgtype=y,C.is_fetch=h,C.is_gather=!1,C.is_proj=u;var P="",M=new Bt;M.base=C,M.has_array_offsets=0!==L,M.has_offset=0!==E||0!==T,M.has_grad=0!==k||0!==w,M.has_dref=0!==p,M.is_sparse_feedback=t,M.has_min_lod=0!==A,M.lod=x,P+=this.to_function_name(M),P+="(";var D=0;t&&(D=this.get_sparse_feedback_texel_id(s[1]));var B=new zt;if(B.base=C,B.coord=l,B.coord_components=g,B.dref=p,B.grad_x=k,B.grad_y=w,B.lod=x,B.coffset=E,B.offset=T,B.bias=I,B.component=0,B.sample=N,B.sparse_texel=D,B.min_lod=A,B.nonuniform_expression=f,P+=this.to_function_args(B,r),P+=")",this.is_legacy()&&this.is_depth_image(y,c)&&(P+=".r"),m.comparison_image_samples_scalar&&function(e){switch(e){case re.ImageSampleExplicitLod:case re.ImageSampleImplicitLod:case re.ImageSampleProjExplicitLod:case re.ImageSampleProjImplicitLod:case re.ImageFetch:case re.ImageRead:case re.ImageSparseSampleExplicitLod:case re.ImageSparseSampleImplicitLod:case re.ImageSparseSampleProjExplicitLod:case re.ImageSparseSampleProjImplicitLod:case re.ImageSparseFetch:case re.ImageSparseRead:return!0;default:return!1}}(o)){var z=!1,U=this.maybe_get(se,c),G=U?U.image:c;(U&&this.is_depth_image(y,U.image)||this.is_depth_image(y,c))&&(z=!0);var F=this.maybe_get_backing_variable(G);F&&this.is_depth_image(this.get(R,F.basetype),F.self)&&(z=!0),z&&(P=this.remap_swizzle(d,1,P))}return!t&&!m.support_small_type_sampling_result&&d.width<32&&(P=this.type_to_glsl_constructor(d)+"("+P+")"),o===re.ImageRead&&(P=this.remap_swizzle(d,4,P)),P},r.prototype.emit_line_directive=function(e,t){this.redirect_statement||this.options.emit_line_directives&&(this.require_extension_internal("GL_GOOGLE_cpp_style_line_directive"),this.statement_no_indent("#line ",t,' "',this.get(_e,e).str,'"'))},r.prototype.emit_struct_member=function(e,t,r,i,a){void 0===i&&(i="");var s,o=this.get(R,t),n=this.ir,_=et(x,n.meta,e.self).members;s=r<_.length?_[r].decoration_flags:new y;var c="",l=et(x,n.meta,e.self).decoration.decoration_flags;(l.get(te.Block)||l.get(te.BufferBlock))&&(c=this.to_interpolation_qualifiers(s)),this.statement(this.layout_for_member(e,r),c,i,this.flags_to_qualifiers_glsl(o,s),this.variable_decl(o,this.to_member_name(e,r)),";")},r.prototype.emit_struct_padding_target=function(e){},r.prototype.to_function_name=function(e){if(e.has_min_lod)throw new Error("Sparse residency is not supported in ESSL.");var t="",r=e.base.imgtype,i=e.base.img,a=!1;if((r.image.arrayed&&r.image.dim===Ue.Dim2D||r.image.dim===Ue.Cube)&&this.is_depth_image(r,i)&&e.lod){if(!this.expression_is_constant_null(e.lod))throw new Error("textureLod on sampler2DArrayShadow is not constant 0.0. This cannot be expressed in GLSL.");a=!0}return e.is_sparse_feedback&&(t+="sparse"),e.base.is_fetch?t+=e.is_sparse_feedback?"TexelFetch":"texelFetch":(t+=e.is_sparse_feedback?"Texture":"texture",e.base.is_gather&&(t+="Gather"),e.has_array_offsets&&(t+="Offsets"),e.base.is_proj&&(t+="Proj"),(e.has_grad||a)&&(t+="Grad"),0===e.lod||a||(t+="Lod")),e.has_offset&&(t+="Offset"),e.has_min_lod&&(t+="Clamp"),(e.is_sparse_feedback||e.has_min_lod)&&(t+="ARB"),this.is_legacy()&&!e.base.is_gather?this.legacy_tex_op(t,r,i):t},r.prototype.to_function_args=function(e,t){var r,i=e.base.img,a=e.base.imgtype,s=this.backend;r=e.base.is_fetch?this.convert_separate_image_to_expression(i):this.to_non_uniform_aware_expression(i),e.nonuniform_expression&&r.indexOf("[")>=0&&(r=s.nonuniform_qualifier+"("+r+")");var o=s.swizzle_is_function,n=this.should_forward(e.coord),_=function(e,t){if(e===t)return"";switch(e){case 1:return".x";case 2:return o?".xy()":".xy";case 3:return o?".xyz()":".xyz";default:return""}}(e.coord_components,this.expression_type(e.coord).vecsize),c=""===_?this.to_expression(e.coord):this.to_enclosed_expression(e.coord)+_,l=this.expression_type(e.coord);if(l.basetype===E.UInt){var p=f(R,l);p.vecsize=e.coord_components,p.basetype=E.Int,c=this.bitcast_expression(p,l.basetype,c)}var u=(a.image.arrayed&&a.image.dim===Ue.Dim2D||a.image.dim===Ue.Cube)&&this.is_depth_image(a,i)&&0!==e.lod;if(e.dref)if(n=n&&this.should_forward(e.dref),e.base.is_gather||4===e.coord_components)r+=", ",r+=this.to_expression(e.coord),r+=", ",r+=this.to_expression(e.dref);else if(e.base.is_proj)if(r+=", vec4(",a.image.dim===Ue.Dim1D)r+=this.to_enclosed_expression(e.coord)+".x",r+=", ",r+="0.0, ",r+=this.to_expression(e.dref),r+=", ",r+=this.to_enclosed_expression(e.coord)+".y)";else{if(a.image.dim!==Ue.Dim2D)throw new Error("Invalid type for textureProj with shadow.");r+=this.to_enclosed_expression(e.coord)+(o?".xy()":".xy"),r+=", ",r+=this.to_expression(e.dref),r+=", ",r+=this.to_enclosed_expression(e.coord)+".z)"}else{var h=f(R,this.expression_type(e.coord));h.vecsize=e.coord_components+1,r+=", ",r+=this.type_to_glsl_constructor(h),r+="(",r+=c,r+=", ",r+=this.to_expression(e.dref),r+=")"}else r+=", ",r+=c;if((e.grad_x||e.grad_y)&&(n=(n=n&&this.should_forward(e.grad_x))&&this.should_forward(e.grad_y),r+=", ",r+=this.to_expression(e.grad_x),r+=", ",r+=this.to_expression(e.grad_y)),e.lod)if(u)a.image.dim===Ue.Dim2D?r+=", vec2(0.0), vec2(0.0)":a.image.dim===Ue.Cube&&(r+=", vec3(0.0), vec3(0.0)");else{n=n&&this.should_forward(e.lod),r+=", ";var d=this.expression_type(e.lod);e.base.is_fetch&&a.image.dim!==Ue.Buffer&&!a.image.ms&&d.basetype!==E.Int?r+="int("+this.to_expression(e.lod)+")":r+=this.to_expression(e.lod)}else e.base.is_fetch&&a.image.dim!==Ue.Buffer&&!a.image.ms&&(r+=", 0");(e.coffset?(n=n&&this.should_forward(e.coffset),r+=", ",r+=this.to_expression(e.coffset)):e.offset&&(n=n&&this.should_forward(e.offset),r+=", ",r+=this.to_expression(e.offset)),e.sample&&(r+=", ",r+=this.to_expression(e.sample)),e.min_lod&&(r+=", ",r+=this.to_expression(e.min_lod)),e.sparse_texel&&(r+=", ",r+=this.to_expression(e.sparse_texel)),e.bias&&(n=n&&this.should_forward(e.bias),r+=", ",r+=this.to_expression(e.bias)),e.component&&!this.expression_is_constant_null(e.component))&&(n=n&&this.should_forward(e.component),r+=", ",this.expression_type(e.component).basetype===E.Int?r+=this.to_expression(e.component):r+="int("+this.to_expression(e.component)+")");return t.value=n,r},r.prototype.emit_sparse_feedback_temporaries=function(e,t,r){throw new Error("Sparse texture feedback is not supported on ESSL.")},r.prototype.get_sparse_feedback_texel_id=function(e){return this.extra_sub_expressions[e]||0},r.prototype.emit_buffer_block=function(e){var t=this.get(R,e.basetype),r=e.storage===v.Uniform&&this.has_decoration(t.self,te.Block),i=this.options,a=this.ir;this.flattened_buffer_blocks.has(e.self)?this.emit_buffer_block_flattened(e):this.is_legacy()||r&&i.emit_uniform_buffer_as_plain_uniforms?""===a.get_name(e.self)&&i.keep_unnamed_ubos?(this.emit_buffer_block_global(e),this.removed_structs.add(e.self)):this.emit_buffer_block_legacy(e):this.emit_buffer_block_native(e)},r.prototype.emit_push_constant_block=function(e){var t=this.options;this.flattened_buffer_blocks.has(e.self)?this.emit_buffer_block_flattened(e):t.emit_push_constant_as_uniform_buffer?this.emit_buffer_block_native(e):this.emit_push_constant_block_glsl(e)},r.prototype.emit_buffer_block_legacy=function(e){var t=this.get(R,e.basetype),r=this.ir,i=et(x,r.meta,t.self);if(e.storage===v.StorageBuffer||i.decoration.decoration_flags.get(te.BufferBlock))throw new Error("SSBOs not supported in legacy targets.");var a=i.decoration.decoration_flags,s=a.get(te.Block);a.clear(te.Block),this.emit_struct(t),s&&a.set(te.Block),this.emit_uniform(e),this.statement("")},r.prototype.emit_buffer_block_flattened=function(e){var t=this.get(R,e.basetype),r=this.to_name(t.self,!1),i=(this.get_declared_struct_size(t)+15)/16,a=this.get_common_basic_type(t);if(void 0===a)throw new Error("All basic types in a flattened block must be the same.");var s=new R;if(s.basetype=a,s.vecsize=4,a!==E.Float&&a!==E.Int&&a!==E.UInt)throw new Error("Basic types in a flattened UBO must be float, int or uint.");var o=this.ir.get_buffer_block_flags(e);this.statement("uniform ",this.flags_to_qualifiers_glsl(s,o),this.type_to_glsl(s)," ",r,"[",i,"];")},r.prototype.emit_flattened_io_block=function(e,t){var r=this.get(R,e.basetype);if(r.array.length>0)throw new Error("Array of varying structs cannot be flattened to legacy-compatible varyings.");var i=r.type_alias?this.get(R,r.type_alias):r,a=this.ir,s=et(x,a.meta,i.self).decoration,o=s.decoration_flags.clone();s.decoration_flags.set(te.Block),i.member_name_cache.clear();var n=[];n.push(0);for(var _=this.to_name(e.self),c=0,l=0,p=i.member_types;l<p.length;l++){var u=p[l];this.add_member_name(i,c);var h=this.get(R,u);n[n.length-1]=c,h.basetype===E.Struct?this.emit_flattened_io_block_struct(_,i,t,n):this.emit_flattened_io_block_member(_,i,t,n),c++}s.decoration_flags=o,this.flattened_structs[e.self]=!0},r.prototype.emit_flattened_io_block_struct=function(e,t,r,i){var a=i.concat();a.push(0);for(var s=t,o=0,n=i;o<n.length;o++){var _=n[o];s=this.get(R,s.member_types[_])}if(console.assert(s.basetype===E.Struct),s.array.length>0)throw new Error("Cannot flatten array of structs in I/O blocks.");for(var c=0;c<s.member_types.length;c++)a[a.length-1]=c,this.get(R,s.member_types[c]).basetype===E.Struct?this.emit_flattened_io_block_struct(e,t,r,a):this.emit_flattened_io_block_member(e,t,r,a)},r.prototype.emit_flattened_io_block_member=function(e,t,r,i){for(var a=t.self,s=t,o=null,n=e,_=0,c=i;_<c.length;_++){var l=c[_];n+="_",n+=this.to_member_name(s,l),o=s,a=s.member_types[l],s=this.get(R,a)}console.assert(s.basetype!==E.Struct),o.type_alias&&(o=this.get(R,o.type_alias)),n=he.sanitize_underscores(n);var p=i[i.length-1],u=this.to_member_name(o,p);this.set_member_name(o.self,p,n),this.emit_struct_member(o,a,p,r),this.set_member_name(o.self,p,u)},r.prototype.emit_block_chain=function(e){var r=this,i=!1,a=!1,s=!1,o=!1,n=!1,_=new Mt(this,"current_loop_level"),c=this.backend,l=this.ir;e.merge===P.Loop&&this.add_loop_level(),this.emit_hoisted_temporaries(e.declare_temporary);var p=B.ContinueNone;e.continue_block&&(p=this.continue_block_type(this.get(J,e.continue_block)))===B.ComplexLoop&&(e.complex_continue=!0);for(var u=0,h=e.loop_variables;u<h.length;u++){var f=h[u];(g=this.get(T,f)).loop_variable_enable=!0,this.emit_variable_temporary_copies(g)}for(var d=[],m=0;m<e.dominated_variables.length;m++){f=e.dominated_variables[m];var g=this.get(T,f);d[m]=g.deferred_declaration}if(!this.is_legacy_es()&&this.block_is_loop_candidate(e,D.MergeToSelectContinueForLoop)?(this.flush_undeclared_variables(e),this.attempt_emit_loop_header(e,D.MergeToSelectContinueForLoop)&&(this.execution_is_noop(this.get(J,e.true_block),this.get(J,e.merge_block))?a=!0:i=!0,o=!0,n=!0)):this.block_is_loop_candidate(e,D.MergeToSelectForLoop)?(this.flush_undeclared_variables(e),this.attempt_emit_loop_header(e,D.MergeToSelectForLoop)&&(this.execution_is_noop(this.get(J,e.true_block),this.get(J,e.merge_block))?a=!0:i=!0,o=!0)):this.block_is_loop_candidate(e,D.MergeToDirectForLoop)?(this.flush_undeclared_variables(e),this.attempt_emit_loop_header(e,D.MergeToDirectForLoop)&&(s=!0,o=!0)):p===B.DoWhileLoop?(this.flush_undeclared_variables(e),this.emit_while_loop_initializers(e),o=!0,this.emit_hoisted_temporaries(e.potential_declare_temporary),this.statement("do"),this.begin_scope(),this.emit_block_instructions(e)):e.merge===P.Loop?(this.flush_undeclared_variables(e),this.emit_while_loop_initializers(e),o=!0,this.get(J,e.continue_block).complex_continue=!0,p=B.ComplexLoop,this.emit_hoisted_temporaries(e.potential_declare_temporary),this.emit_block_hints(e),this.statement("for (;;)"),this.begin_scope(),this.emit_block_instructions(e)):this.emit_block_instructions(e),!o&&e.loop_variables.length>0){this.force_recompile();for(var b=0,y=e.loop_variables;b<y.length;b++){g=y[b];this.get(T,g).loop_variable=!1}e.loop_variables=[]}this.flush_undeclared_variables(e);var S=!0;switch(e.terminator){case C.Direct:e.loop_dominator===e.next_block?(this.branch(e.self,e.next_block),S=!1):s?S=!1:(this.is_continue(e.next_block)||this.is_break(e.next_block)||this.is_conditional(e.next_block))&&(this.branch(e.self,e.next_block),S=!1);break;case C.Select:if(i)if(n){console.assert(e.true_block===e.continue_block);var I=(me=this.get(J,e.continue_block)).complex_continue;me.complex_continue=!0,this.branch(e.self,e.true_block),me.complex_continue=I}else this.branch(e.self,e.true_block);else if(a)if(n){console.assert(e.false_block===e.continue_block);I=(me=this.get(J,e.continue_block)).complex_continue;me.complex_continue=!0,this.branch(e.self,e.false_block),me.complex_continue=I}else this.branch(e.self,e.false_block);else this.branch(e.self,e.condition,e.true_block,e.false_block);break;case C.MultiSelect:var x=(fe=this.expression_type(e.condition)).basetype===E.UInt||fe.basetype===E.UShort||fe.basetype===E.UByte||fe.basetype===E.UInt64;if(e.merge===P.None)throw new Error("Switch statement is not structured");if(!c.support_64bit_switch&&(fe.basetype===E.UInt64||fe.basetype===E.Int64))throw new Error("Cannot use 64-bit switch selectors.");var k="";fe.basetype===E.UInt&&c.uint32_t_literal_suffix?k="u":fe.basetype===E.Int64&&c.support_64bit_switch?k="l":fe.basetype===E.UInt64&&c.support_64bit_switch?k="ul":fe.basetype===E.UShort?k=c.uint16_t_literal_suffix:fe.basetype===E.Short&&(k=c.int16_t_literal_suffix);var w=this.current_emitting_switch;this.current_emitting_switch=e,e.need_ladder_break&&this.statement("bool _",e.self,"_ladder_break = false;");for(var L=[],R=[],N=[],A=this.get_case_list(e),M=0,z=A;M<z.length;M++){var U=z[M];U.block!==e.next_block&&U.block!==e.default_block?(L.hasOwnProperty(U.block)||R.push(U.block),et(Array,L,U.block).push(U.value)):U.block===e.next_block&&e.default_block!==e.next_block&&N.push(U.value)}if(e.default_block!==e.next_block){var G=this.get(J,e.default_block),F=R.length,O=!1;for(m=0;m<F;m++){var V=this.get(J,R[m]);if(this.execution_is_direct_branch(V,G)){R.splice(m+1,0,e.default_block),O=!0;break}if(this.execution_is_direct_branch(G,V)){R.splice(m,0,e.default_block),O=!0;break}}if(O){if(this.is_legacy_es())throw new Error("Default case label fallthrough to other case label is not supported in ESSL 1.0.")}else R.push(e.default_block);L[e.default_block]=[]}var H=R.length,q=function(e,t,r){return le(r?e:t<=32?BigInt(Number(e)):BigInt(e))},X=function(e,t,i){for(var a="",s=t.length,o=0;o<s;o++)o&&(a+=" || "),a+=(s>1?"(":"")+r.to_enclosed_expression(e)+" === "+t[o]+i+(s>1?")":"");return a};for(m=1;c.support_case_fallthrough&&m<H;m++)if(this.flush_phi_required(e.self,R[m])&&this.flush_phi_required(R[m-1],R[m])){var K=R[m];if(this.get(J,K).ignore_phi_from_block=0,(ie=L[K]).length){Q=[];for(var j=0,W=ie;j<W.length;j++){ee=W[j];Q.push(this.to_enclosed_expression(e.condition)+" === "+q(ee,fe.width,x))}this.statement("if (",Q.join(" || "),")"),this.begin_scope(),this.flush_phi(e.self,K),this.end_scope()}else{for(var Q=[],Z=0;Z<H;Z++)for(var Y=0,$=et(Array,L,R[Z]);Y<$.length;Y++){var ee=$[Y];Q.push(this.to_enclosed_expression(e.condition)+" !== "+q(ee,fe.width,x))}this.statement("if (",Q.join(" && "),")"),this.begin_scope(),this.flush_phi(e.self,K),this.end_scope()}this.get(J,K).ignore_phi_from_block=e.self}var te=e.default_block!==e.merge_block&&!A.length;if(te||this.is_legacy_es())if(this.is_legacy_es()){var re=this.statement_count;this.statement("for (int spvDummy",re," = 0; spvDummy",re," < 1; spvDummy",re,"++)")}else this.statement("do");else this.emit_block_hints(e),this.statement("switch (",this.to_unpacked_expression(e.condition),")");this.begin_scope();for(m=0;m<H;m++){var ie;if((ie=L[K=R[m]]).length)if(this.is_legacy_es())this.statement(m?"else ":"","if (",X(e.condition,ie,k),")");else for(var ae=0,se=ie;ae<se.length;ae++){var oe=se[ae];this.statement("case ",q(oe,fe.width,x),k,":")}else te||(this.is_legacy_es()?this.statement("else"):this.statement("default:"));V=this.get(J,K);c.support_case_fallthrough&&m+1<H&&this.execution_is_direct_branch(V,this.get(J,R[m+1]))?this.current_emitting_switch_fallthrough=!0:this.current_emitting_switch_fallthrough=!1,te||this.begin_scope(),this.branch(e.self,K),te||this.end_scope(),this.current_emitting_switch_fallthrough=!1}var ne=this.flush_phi_required(e.self,e.next_block),_e=e.default_block===e.next_block||0!==N.length;if(ne&&_e||0!==N.length){for(var ce=0,pe=N;ce<pe.length;ce++){oe=pe[ce];this.statement("case ",q(oe,fe.width,x),k,":")}e.default_block===e.next_block&&(this.is_legacy_es()?this.statement("else"):this.statement("default:")),this.begin_scope(),this.flush_phi(e.self,e.next_block),this.statement("break;"),this.end_scope()}te&&!this.is_legacy_es()?this.end_scope_decl("while(false)"):this.end_scope(),e.need_ladder_break&&(this.statement("if (_",e.self,"_ladder_break)"),this.begin_scope(),this.statement("break;"),this.end_scope()),this.current_emitting_switch=w;break;case C.Return:for(var ue=0,he=this.current_function.fixup_hooks_out;ue<he.length;ue++){(0,he[ue])()}this.processing_entry_point&&this.emit_fixup();var fe,de=this.get_cfg_for_current_function();if(e.return_value)(fe=this.expression_type(e.return_value)).array.length&&!c.can_return_array?(l.ids[e.return_value].get_type()!==t.Undef&&this.emit_array_copy("spvReturnValue",0,e.return_value,v.Function,this.get_expression_effective_storage_class(e.return_value)),de.node_terminates_control_flow_in_sub_graph(this.current_function.entry_block,e.self)&&e.loop_dominator===J.NoDominator||this.statement("return;")):l.ids[e.return_value].get_type()!==t.Undef&&this.statement("return ",this.to_unpacked_expression(e.return_value),";");else de.node_terminates_control_flow_in_sub_graph(this.current_function.entry_block,e.self)&&e.loop_dominator===J.NoDominator||this.statement("return;");break;case C.Kill:this.statement(c.discard_literal,";"),e.return_value&&this.statement("return ",this.to_unpacked_expression(e.return_value),";");break;case C.Unreachable:S=!1;break;case C.IgnoreIntersection:this.statement("ignoreIntersectionEXT;");break;case C.TerminateRay:this.statement("terminateRayEXT;");break;default:throw new Error("Unimplemented block terminator.")}if(e.next_block&&S&&(e.merge!==P.Selection&&(this.flush_phi(e.self,e.next_block),this.get(J,e.next_block).invalidate_expressions=e.invalidate_expressions),this.current_emitting_switch_fallthrough||(this.is_loop_break(e.next_block)?(console.assert(e.merge===P.Selection),this.statement("break;")):this.is_continue(e.next_block)?(console.assert(e.merge===P.Selection),this.branch_to_continue(e.self,e.next_block)):e.self!==e.next_block&&this.emit_block_chain(this.get(J,e.next_block)))),e.merge===P.Loop){if(p===B.DoWhileLoop){var me=this.get(J,e.continue_block),ge=this.execution_is_noop(this.get(J,me.true_block),this.get(J,me.loop_dominator)),be=this.statement_count;this.emit_continue_block(e.continue_block,ge,!ge),this.statement_count!==be&&(this.get(J,e.continue_block).complex_continue=!0,this.force_recompile());var ye=this.to_expression(me.condition);ge||(ye="!"+this.enclose_expression(ye)),this.end_scope_decl("while ("+ye+")")}else this.end_scope();_.release(),this.is_continue(e.merge_block)?this.branch_to_continue(e.self,e.merge_block):this.emit_block_chain(this.get(J,e.merge_block))}e.invalidate_expressions=[],console.assert(d.length===e.dominated_variables.length);for(m=0;m<e.dominated_variables.length;m++){g=e.dominated_variables[m];this.get(T,g).deferred_declaration=d[m]}for(var ve=0,Se=e.loop_variables;ve<Se.length;ve++){f=Se[ve];this.get(T,f).loop_variable_enable=!1}_.release()},r.prototype.emit_hoisted_temporaries=function(e){e.sort((function(e,t){return e.second-t.second}));for(var t=this.ir,r=this.options,i=0,a=e;i<a.length;i++){var s=a[i];this.add_local_variable_name(s.second);var o=et(x,t.meta,s.second).decoration.decoration_flags,n=this.get(R,s.first),_="";r.force_zero_initialized_variables&&this.type_can_zero_initialize(n)&&(_=" = "+this.to_zero_initialized_expression(s.first)),this.statement(this.flags_to_qualifiers_glsl(n,o),this.variable_decl(n,this.to_name(s.second)),_,";"),this.hoisted_temporaries.add(s.second),this.forced_temporaries.add(s.second),this.set(ae,s.second,this.to_name(s.second),s.first,!0)}},r.prototype.emit_uniform=function(e){var t=this.get(R,e.basetype);if(t.basetype===E.Image&&2===t.image.sampled&&t.image.dim!==Ue.SubpassData)throw new Error("At least ESSL 3.10 required for shader image load store.");this.add_resource_name(e.self),this.statement(this.layout_for_variable(e),this.variable_decl(e),";")},r.prototype.unpack_expression_type=function(e,t,r,i,a){return e},r.prototype.builtin_translates_to_nonarray=function(e){return!1},r.prototype.emit_copy_logical_type=function(e,t,r,i,a){var s=this.get(R,t),o=this.get(R,i);if(s.array.length>0){var n=this.to_array_size_literal(s);a.push(0);for(var _=0;_<n;_++)a[a.length-1]=_,this.emit_copy_logical_type(e,s.parent_type,r,o.parent_type,a)}else if(s.basetype===E.Struct){a.push(0);var c=s.member_types.length;for(_=0;_<c;_++)a[a.length-1]=_,this.emit_copy_logical_type(e,s.member_types[_],r,o.member_types[_],a)}else{var l=new Nt,p=new Nt,u=this.access_chain_internal(e,a,0,a.length,wt.INDEX_IS_LITERAL_BIT,l),h=this.access_chain_internal(r,a,0,a.length,wt.INDEX_IS_LITERAL_BIT,p),f=this.ir.increase_bound_by(2);e=f,r=f+1,this.set(ae,e,u,t,!0).need_transpose=l.need_transpose,l.storage_is_packed&&this.set_extended_decoration(e,b.PhysicalTypePacked),0!==l.storage_physical_type&&this.set_extended_decoration(e,b.PhysicalTypeID,l.storage_physical_type),this.forwarded_temporaries.add(e),this.suppressed_usage_tracking.add(e),this.set(ae,r,h,i,!0).need_transpose=p.need_transpose,p.storage_is_packed&&this.set_extended_decoration(r,b.PhysicalTypePacked),0!==p.storage_physical_type&&this.set_extended_decoration(r,b.PhysicalTypeID,p.storage_physical_type),this.forwarded_temporaries.add(r),this.suppressed_usage_tracking.add(r),this.emit_store_statement(e,r)}},r.prototype.statement_inner=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r=0;r<e.length;++r)this.buffer.append(e[r]),this.statement_count++},r.prototype.type_to_glsl=function(e,t){if(void 0===t&&(t=0),e.pointer&&e.storage===v.PhysicalStorageBufferEXT&&e.basetype!==E.Struct){for(var r=this.type_to_glsl(this.get_pointee_type(e)),i=0;i<e.array.length;i++)e.array_size_literal[i]?r+=e.array[i]+"_":r+="id".concat(e.array[i],'_"');return r+="Pointer"}var a=this.backend;switch(e.basetype){case E.Struct:return a.explicit_struct_type?"struct "+this.to_name(e.self):this.to_name(e.self);case E.Image:case E.SampledImage:return this.image_type_glsl(e,t);case E.Sampler:return this.comparison_ids.has(t)?"samplerShadow":"sampler";case E.AccelerationStructure:case E.RayQuery:throw new Error("RayQuery is not supported");case E.Void:return"void"}if(e.basetype===E.UInt&&this.is_legacy())throw new Error("Unsigned integers are not supported on legacy targets.");if(1===e.vecsize&&1===e.columns)switch(e.basetype){case E.Boolean:return"bool";case E.SByte:return a.basic_int8_type;case E.UByte:return a.basic_uint8_type;case E.Short:return a.basic_int16_type;case E.UShort:return a.basic_uint16_type;case E.Int:return a.basic_int_type;case E.UInt:return a.basic_uint_type;case E.Half:return"float16_t";case E.Float:return"float";case E.Double:return"double";case E.Int64:return"int64_t";case E.UInt64:return"uint64_t";default:return"???"}else if(e.vecsize>1&&1===e.columns)switch(e.basetype){case E.Boolean:return"bvec"+e.vecsize;case E.SByte:return"i8vec"+e.vecsize;case E.UByte:return"u8vec"+e.vecsize;case E.Short:return"i16vec"+e.vecsize;case E.UShort:return"u16vec"+e.vecsize;case E.Int:return"ivec"+e.vecsize;case E.UInt:return"uvec"+e.vecsize;case E.Half:return"f16vec"+e.vecsize;case E.Float:return"vec"+e.vecsize;case E.Double:return"dvec"+e.vecsize;case E.Int64:return"i64vec"+e.vecsize;case E.UInt64:return"u64vec"+e.vecsize;default:return"???"}else if(e.vecsize===e.columns)switch(e.basetype){case E.Boolean:return"bmat"+e.vecsize;case E.Int:return"imat"+e.vecsize;case E.UInt:return"umat"+e.vecsize;case E.Half:return"f16mat"+e.vecsize;case E.Float:return"mat"+e.vecsize;case E.Double:return"dmat"+e.vecsize;default:return"???"}else switch(e.basetype){case E.Boolean:return"bmat".concat(e.columns,"x").concat(e.vecsize);case E.Int:return"imat".concat(e.columns,"x").concat(e.vecsize);case E.UInt:return"umat".concat(e.columns,"x").concat(e.vecsize);case E.Half:return"f16mat".concat(e.columns,"x").concat(e.vecsize);case E.Float:return"mat".concat(e.columns,"x").concat(e.vecsize);case E.Double:return"dmat".concat(e.columns,"x").concat(e.vecsize);default:return"???"}},r.prototype.builtin_to_glsl=function(e,t){var r=this.options;switch(e){case m.Position:return"gl_Position";case m.PointSize:return"gl_PointSize";case m.ClipDistance:return"gl_ClipDistance";case m.CullDistance:return"gl_CullDistance";case m.VertexId:return"gl_VertexID";case m.InstanceId:return"gl_InstanceID";case m.VertexIndex:return"gl_VertexID";case m.InstanceIndex:return r.vertex.support_nonzero_base_instance?(this.require_extension_internal("GL_ARB_shader_draw_parameters"),"(gl_InstanceID + SPIRV_Cross_BaseInstance)"):"gl_InstanceID";case m.PrimitiveId:return t===v.Input&&this.get_entry_point().model===ve.Geometry?"gl_PrimitiveIDIn":"gl_PrimitiveID";case m.InvocationId:return"gl_InvocationID";case m.Layer:return"gl_Layer";case m.ViewportIndex:return"gl_ViewportIndex";case m.TessLevelOuter:return"gl_TessLevelOuter";case m.TessLevelInner:return"gl_TessLevelInner";case m.TessCoord:return"gl_TessCoord";case m.FragCoord:return"gl_FragCoord";case m.PointCoord:return"gl_PointCoord";case m.FrontFacing:return"gl_FrontFacing";case m.FragDepth:return"gl_FragDepth";case m.NumWorkgroups:return"gl_NumWorkGroups";case m.WorkgroupSize:return"gl_WorkGroupSize";case m.WorkgroupId:return"gl_WorkGroupID";case m.LocalInvocationId:return"gl_LocalInvocationID";case m.GlobalInvocationId:return"gl_GlobalInvocationID";case m.LocalInvocationIndex:return"gl_LocalInvocationIndex";case m.HelperInvocation:return"gl_HelperInvocation";case m.BaseVertex:throw new Error("BaseVertex not supported in ES profile.");case m.BaseInstance:throw new Error("BaseInstance not supported in ES profile.");case m.DrawIndex:throw new Error("DrawIndex not supported in ES profile.");case m.SampleId:return this.require_extension_internal("GL_OES_sample_variables"),"gl_SampleID";case m.SampleMask:return this.require_extension_internal("GL_OES_sample_variables"),t===v.Input?"gl_SampleMaskIn":"gl_SampleMask";case m.SamplePosition:return this.require_extension_internal("GL_OES_sample_variables"),"gl_SamplePosition";case m.ViewIndex:return"gl_ViewID_OVR";case m.NumSubgroups:case m.SubgroupId:case m.SubgroupSize:case m.SubgroupLocalInvocationId:case m.SubgroupEqMask:case m.SubgroupGeMask:case m.SubgroupGtMask:case m.SubgroupLeMask:case m.SubgroupLtMask:throw new Error("Subgroups not supported");case m.LaunchIdKHR:case m.LaunchSizeKHR:case m.WorldRayOriginKHR:case m.WorldRayDirectionKHR:case m.ObjectRayOriginKHR:case m.ObjectRayDirectionKHR:case m.RayTminKHR:case m.RayTmaxKHR:case m.InstanceCustomIndexKHR:case m.ObjectToWorldKHR:case m.WorldToObjectKHR:case m.HitTNV:case m.HitKindKHR:case m.IncomingRayFlagsKHR:throw new Error("Raytracing not supported");case m.BaryCoordNV:throw new Error("gl_BaryCoordNV requires ESSL 320.");case m.BaryCoordNoPerspNV:throw new Error("gl_BaryCoordNoPerspNV requires ESSL 320.");case m.FragStencilRefEXT:throw new Error("Stencil export not supported in GLES.");case m.PrimitiveShadingRateKHR:throw new Error("Can only use PrimitiveShadingRateKHR in Vulkan GLSL.");case m.ShadingRateKHR:throw new Error("Can only use ShadingRateKHR in Vulkan GLSL.");case m.DeviceIndex:throw new Error("Need Vulkan semantics for device group support.");case m.FullyCoveredEXT:throw new Error("Need desktop GL to use GL_NV_conservative_raster_underestimation.");default:return"gl_BuiltIn_"+le(e)}},r.prototype.image_type_glsl=function(e,t){void 0===t&&(t=0);var r="";switch(this.get(R,e.image.type).basetype){case E.Int:case E.Short:case E.SByte:r="i";break;case E.UInt:case E.UShort:case E.UByte:r="u"}if(e.basetype===E.Image&&e.image.dim===Ue.SubpassData&&this.subpass_input_is_framebuffer_fetch(t)){var i=f(R,this.get(R,e.image.type));return i.vecsize=4,this.type_to_glsl(i)}switch(e.basetype===E.Image&&e.image.dim!==Ue.SubpassData?e.image.dim===Ue.Buffer&&1===e.image.sampled?r+="sampler":r+=2===e.image.sampled?"image":"texture":r+="sampler",e.image.dim){case Ue.Dim1D:r+="1D";break;case Ue.Dim2D:r+="2D";break;case Ue.Dim3D:r+="3D";break;case Ue.Cube:r+="Cube";break;case Ue.Rect:throw new Error("Rectangle textures are not supported on OpenGL ES.");case Ue.Buffer:this.require_extension_internal("GL_EXT_texture_buffer"),r+="Buffer";break;case Ue.SubpassData:r+="2D";break;default:throw new Error("Only 1D, 2D, 2DRect, 3D, Buffer, InputTarget and Cube textures supported.")}return e.image.ms&&(r+="MS"),e.image.arrayed&&(r+="Array"),e.basetype!==E.SampledImage&&e.basetype!==E.Sampler||!this.is_depth_image(e,t)||(r+="Shadow"),r},r.prototype.constant_expression=function(e){var t=this.get(R,e.constant_type),r=this.backend;if(t.pointer)return r.null_pointer_literal;if(e.subconstants.length>0){var i=void 0,a=!1;r.use_initializer_list&&r.use_typed_initializer_list&&t.basetype===E.Struct&&0===t.array.length?i=this.type_to_glsl_constructor(t)+"{ ":r.use_initializer_list&&r.use_typed_initializer_list&&r.array_is_value_type&&t.array.length>0?(i=this.type_to_glsl_constructor(t)+"({ ",a=!0):i=r.use_initializer_list?"{ ":this.type_to_glsl_constructor(t)+"(";for(var s=0;s<e.subconstants.length;++s){var o=e.subconstants[s],n=this.get(O,o);n.specialization?i+=this.to_name(o):i+=this.constant_expression(n),s!==e.subconstants.length-1&&(i+=", ")}return i+=r.use_initializer_list?" }":")",a&&(i+=")"),i}if(t.basetype===E.Struct&&0===t.member_types.length)return r.supports_empty_struct?"{ }":r.use_typed_initializer_list?this.type_to_glsl(this.get(R,e.constant_type))+"{ 0 }":r.use_initializer_list?"{ 0 }":this.type_to_glsl(this.get(R,e.constant_type))+"(0)";if(1===e.columns())return this.constant_expression_vector(e,0);i=this.type_to_glsl(this.get(R,e.constant_type))+"(";for(var _=0;_<e.columns();_++)0!==e.specialization_constant_id(_)?i+=this.to_name(e.specialization_constant_id(_)):i+=this.constant_expression_vector(e,_),_+1<e.columns()&&(i+=", ");return i+=")"},r.prototype.constant_op_expression=function(e){var t=this.get(R,e.basetype),r=!1,i=!1,a="";if(this.is_legacy()&&function(e){switch(e){case re.ShiftRightLogical:case re.UGreaterThan:case re.UGreaterThanEqual:case re.ULessThan:case re.ULessThanEqual:case re.UConvert:case re.UDiv:case re.UMod:case re.UMulExtended:case re.ConvertUToF:case re.ConvertFToU:return!0;default:return!1}}(e.opcode))throw new Error("Unsigned integers are not supported on legacy targets.");switch(e.opcode){case re.SConvert:case re.UConvert:case re.FConvert:a=this.type_to_glsl_constructor(t);break;case re.SNegate:case re.Not:case re.LogicalNot:i=!0,a=Ft[e.opcode];break;case re.IAdd:case re.ISub:case re.IMul:case re.SDiv:case re.UDiv:case re.UMod:case re.SMod:case re.ShiftRightLogical:case re.ShiftRightArithmetic:case re.ShiftLeftLogical:case re.BitwiseOr:case re.BitwiseXor:case re.BitwiseAnd:case re.LogicalOr:case re.LogicalAnd:case re.LogicalEqual:case re.LogicalNotEqual:case re.IEqual:case re.INotEqual:case re.ULessThan:case re.SLessThan:case re.ULessThanEqual:case re.SLessThanEqual:case re.UGreaterThan:case re.SGreaterThan:case re.UGreaterThanEqual:case re.SGreaterThanEqual:r=!0,a=Ft[e.opcode];break;case re.SRem:var s=e.arguments[0],o=e.arguments[1];return this.to_enclosed_expression(s)+" - "+this.to_enclosed_expression(o)+" * ("+this.to_enclosed_expression(s)+" / "+this.to_enclosed_expression(o)+")";case re.Select:if(e.arguments.length<3)throw new Error("Not enough arguments to OpSpecConstantOp.");var n=this.to_trivial_mix_op(t,e.arguments[2],e.arguments[1],e.arguments[0]);if(!n)return this.to_ternary_expression(t,e.arguments[0],e.arguments[1],e.arguments[2]);a=n;break;case re.VectorShuffle:var _=this.type_to_glsl_constructor(t);_+="(";for(var c=this.expression_type(e.arguments[0]).vecsize,l=this.to_enclosed_expression(e.arguments[0]),p=this.to_enclosed_expression(e.arguments[1]),u=2;u<e.arguments.length;u++){var h=e.arguments[u];_+=h>=c?p+"."+"xyzw"[h-c]:l+"."+"xyzw"[h],u+1<e.arguments.length&&(_+=", ")}return _+=")";case re.CompositeExtract:return this.access_chain_internal(e.arguments[0],e.arguments,1,e.arguments.length-1,wt.INDEX_IS_LITERAL_BIT,null);case re.CompositeInsert:throw new Error("OpCompositeInsert spec constant op is not supported.");default:throw new Error("Unimplemented spec constant op.")}var f,d=0;(i||r||e.opcode===re.SConvert||e.opcode===re.UConvert)&&(d=this.expression_type(e.arguments[0]).width);var m=yt(e.opcode);switch(e.opcode){case re.IEqual:case re.INotEqual:case re.SLessThan:case re.SLessThanEqual:case re.SGreaterThan:case re.SGreaterThanEqual:case re.SMod:case re.SDiv:case re.ShiftRightArithmetic:case re.SConvert:case re.SNegate:f=vt(d);break;case re.ULessThan:case re.ULessThanEqual:case re.UGreaterThan:case re.UGreaterThanEqual:case re.UMod:case re.UDiv:case re.ShiftRightLogical:case re.UConvert:f=St(d);break;default:f=t.basetype}if(r){if(e.arguments.length<2)throw new Error("Not enough arguments to OpSpecConstantOp.");var g={cast_op0:"",cast_op1:"",input_type:f},b=this.binary_op_bitcast_helper(g,e.arguments[0],e.arguments[1],m);if(f=g.input_type,t.basetype!==f&&t.basetype!==E.Boolean){b.basetype=f;_=this.bitcast_glsl_op(t,b);return _+="("+g.cast_op0+" "+a+" "+g.cast_op1+")"}return"("+g.cast_op0+" "+a+" "+g.cast_op1+")"}if(i){if(e.arguments.length<1)throw new Error("Not enough arguments to OpSpecConstantOp.");return"("+a+this.bitcast_glsl(t,e.arguments[0])+")"}if(e.opcode===re.SConvert||e.opcode===re.UConvert){if(e.arguments.length<1)throw new Error("Not enough arguments to OpSpecConstantOp.");var y=this.expression_type(e.arguments[0]);if(y.width<t.width&&f!==y.basetype){var v=y;return v.basetype=f,a+"("+this.bitcast_glsl(v,e.arguments[0])+")"}return a+"("+this.to_expression(e.arguments[0])+")"}if(e.arguments.length<1)throw new Error("Not enough arguments to OpSpecConstantOp.");return a+"("+this.to_expression(e.arguments[0])+")"},r.prototype.constant_expression_vector=function(e,t){var r=f(R,this.get(R,e.constant_type));r.columns=1;var i=f(R,r);i.vecsize=1;var a=this.backend,s="",o=a.use_constructor_splatting&&e.vector_size()>1,n=a.can_swizzle_scalar&&e.vector_size()>1;if(gt(r)||(n=!1),o||n)for(var _=0;_<e.vector_size();_++)if(0!==e.specialization_constant_id(t,_)){o=!1,n=!1;break}if(o||n)if(64===r.width){var c=e.scalar_u64(t,0);for(_=1;_<e.vector_size();_++)if(c!==e.scalar_u64(t,_)){o=!1,n=!1;break}}else for(c=e.scalar(t,0),_=1;_<e.vector_size();_++)c!==e.scalar(t,_)&&(o=!1,n=!1);switch(e.vector_size()>1&&!n&&(s+=this.type_to_glsl(r)+"("),r.basetype){case E.Half:if(o||n)s+=this.convert_half_to_string(e,t,0),n&&(s=this.remap_swizzle(this.get(R,e.constant_type),1,s));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):s+=this.convert_half_to_string(e,t,_),_+1<e.vector_size()&&(s+=", ");break;case E.Float:if(o||n)s+=this.convert_float_to_string(e,t,0),n&&(s=this.remap_swizzle(this.get(R,e.constant_type),1,s));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):s+=this.convert_float_to_string(e,t,_),_+1<e.vector_size()&&(s+=", ");break;case E.Double:if(o||n)s+=this.convert_double_to_string(e,t,0),n&&(s=this.remap_swizzle(this.get(R,e.constant_type),1,s));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):s+=this.convert_double_to_string(e,t,_),_+1<e.vector_size()&&(s+=", ");break;case E.Int64:var l=r;l.vecsize=1,l.columns=1;var p=this.type_to_glsl(l);if(o)s+=le(e.scalar_i64(t,0),p,a.long_long_literal_suffix);else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):s+=le(e.scalar_i64(t,_),p,a.long_long_literal_suffix),_+1<e.vector_size()&&(s+=", ");break;case E.UInt64:if(o)s+=le(e.scalar_u64(t,0)),a.long_long_literal_suffix?s+="ull":s+="ul";else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):(s+=le(e.scalar_u64(t,_)),a.long_long_literal_suffix?s+="ull":s+="ul"),_+1<e.vector_size()&&(s+=", ");break;case E.UInt:if(o)if(s+=le(e.scalar(t,0)),this.is_legacy()){if(e.scalar_i32(t,0)<0)throw new Error("Tried to convert uint literal into int, but this made the literal negative.")}else a.uint32_t_literal_suffix&&(s+="u");else for(_=0;_<e.vector_size();_++){if(e.vector_size()>1&&0!==e.specialization_constant_id(t,_))s+=this.to_expression(e.specialization_constant_id(t,_));else if(s+=le(e.scalar(t,_)),this.is_legacy()){if(e.scalar_i32(t,_)<0)throw new Error("Tried to convert uint literal into int, but this made the literal negative.")}else a.uint32_t_literal_suffix&&(s+="u");_+1<e.vector_size()&&(s+=", ")}break;case E.Int:if(o)s+=le(e.scalar_i32(t,0));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):s+=le(e.scalar_i32(t,_)),_+1<e.vector_size()&&(s+=", ");break;case E.UShort:if(o)s+=le(e.scalar(t,0));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):""!==a.uint16_t_literal_suffix?(s+=le(e.scalar_u16(t,_)),s+=a.uint16_t_literal_suffix):(s+=this.type_to_glsl(i),s+="(",s+=le(e.scalar_u16(t,_)),s+=")"),_+1<e.vector_size()&&(s+=", ");break;case E.Short:if(o)s+=le(e.scalar_i16(t,0));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):""!==a.int16_t_literal_suffix?(s+=le(e.scalar_i16(t,_)),s+=a.int16_t_literal_suffix):(s+=this.type_to_glsl(i),s+="(",s+=le(e.scalar_i16(t,_)),s+=")"),_+1<e.vector_size()&&(s+=", ");break;case E.UByte:if(o)s+=le(e.scalar_u8(t,0));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):(s+=this.type_to_glsl(i),s+="(",s+=le(e.scalar_u8(t,_)),s+=")"),_+1<e.vector_size()&&(s+=", ");break;case E.SByte:if(o)s+=le(e.scalar_i8(t,0));else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):(s+=this.type_to_glsl(i),s+="(",s+=le(e.scalar_i8(t,_)),s+=")"),_+1<e.vector_size()&&(s+=", ");break;case E.Boolean:if(o)s+=e.scalar(t,0)?"true":"false";else for(_=0;_<e.vector_size();_++)e.vector_size()>1&&0!==e.specialization_constant_id(t,_)?s+=this.to_expression(e.specialization_constant_id(t,_)):s+=e.scalar(t,_)?"true":"false",_+1<e.vector_size()&&(s+=", ");break;default:throw new Error("Invalid constant expression basetype.")}return e.vector_size()>1&&!n&&(s+=")"),s},r.prototype.statement=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(this.is_forcing_recompilation())this.statement_count++;else if(this.redirect_statement)this.redirect_statement.push(e.join("")),this.statement_count++;else{for(var r=0;r<this.indent;r++)this.buffer.append("   ");this.statement_inner.apply(this,e),this.buffer.append("\n")}},r.prototype.statement_no_indent=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.indent;this.indent=0,this.statement.apply(this,e),this.indent=r},r.prototype.begin_scope=function(){this.statement("{"),this.indent++},r.prototype.end_scope=function(e){if(!this.indent)throw new Error("Popping empty indent stack.");this.indent--,e?this.statement("}",e):this.statement("}")},r.prototype.end_scope_decl=function(e){if(!this.indent)throw new Error("Popping empty indent stack.");this.indent--,e?this.statement("} ",e,";"):this.statement("};")},r.prototype.add_resource_name=function(e){var t=et(x,this.ir.meta,e).decoration;t.alias=this.add_variable(this.resource_names,this.block_names,t.alias)},r.prototype.add_local_variable_name=function(e){var t=et(x,this.ir.meta,e).decoration;t.alias=this.add_variable(this.local_variable_names,this.block_names,t.alias)},r.prototype.add_member_name=function(e,t){var r=et(x,this.ir.meta,e.self).members;if(t<r.length&&""!==r[t].alias){var i=r[t].alias;if(""===i)return;i=he.sanitize_identifier(i,!0,!0),i=this.update_name_cache(e.member_name_cache,i),r[t].alias=i}},r.prototype.type_to_array_glsl=function(e){if(e.pointer&&e.storage===v.PhysicalStorageBufferEXT&&e.basetype!==E.Struct)return"";if(0===e.array.length)return"";if(this.options.flatten_multidimensional_arrays){var t="";t+="[";for(var r=e.array.length;r;r--)t+=this.enclose_expression(this.to_array_size(e,r-1)),r>1&&(t+=" * ");return t+="]"}if(e.array.length>1)throw new Error("Arrays of arrays not supported before ESSL version 310. Try using --flatten-multidimensional-arrays or set options.flatten_multidimensional_arrays to true.")},r.prototype.add_function_overload=function(e){for(var t=new Pt,r=0,i=e.arguments;r<i.length;r++){var a=i[r],s=this.get_pointee_type_id(a.type),o=this.get(R,s);this.combined_image_samplers.length&&(o.basetype===E.SampledImage||o.basetype===E.Image&&1===o.image.sampled||o.basetype===E.Sampler)||t.u32(s)}var n=t.get(),_=this.to_name(e.self),c=this.function_overloads[_];if(c){var l=c;l.has(n)?(this.add_resource_name(e.self),et(Set,this.function_overloads,this.to_name(e.self)).add(n)):l.add(n)}else this.add_resource_name(e.self),et(Set,this.function_overloads,this.to_name(e.self)).add(n)},r.prototype.to_array_size=function(e,t){console.assert(e.array.length===e.array_size_literal.length);var r=e.array[t];return e.array_size_literal[t]?r?le(r):this.backend.unsized_array_supported?"":"1":this.to_expression(r)},r.prototype.to_array_size_literal=function(e,t){return void 0===t&&(t=e.array.length-1),console.assert(e.array.length===e.array_size_literal.length),e.array_size_literal[t]?e.array[t]:this.evaluate_constant_u32(e.array[t])},r.prototype.emit_fixup=function(){if(this.is_vertex_like_shader()){if(this.options.vertex.fixup_clipspace){var e=this.backend.float_literal_suffix?"f":"";this.statement("gl_Position.z = 2.0",e," * gl_Position.z - gl_Position.w;")}this.options.vertex.flip_vert_y&&this.statement("gl_Position.y = -gl_Position.y;")}},r.prototype.variable_decl=function(e,r,i){if(void 0===i&&(i=0),e instanceof R){var a=e,s=this.type_to_glsl(a,i);return(s=this.remap_variable_type_name(a,r,s))+" "+r+this.type_to_array_glsl(a)}var o=this.get_variable_data_type(e);if(o.pointer_depth>1&&!this.backend.support_pointer_to_pointer)throw new Error("Cannot declare pointer-to-pointer types.");var n=this.options,_=this.ir,c=this.to_qualifiers_glsl(e.self)+this.variable_decl(o,this.to_name(e.self),e.self);if(e.loop_variable&&e.static_expression){var l=e.static_expression;_.ids[l].get_type()!==t.Undef?c+=" = "+this.to_unpacked_expression(e.static_expression):n.force_zero_initialized_variables&&this.type_can_zero_initialize(o)&&(c+=" = "+this.to_zero_initialized_expression(this.get_variable_data_type_id(e)))}else if(e.initializer&&!this.variable_decl_is_remapped_storage(e,v.Workgroup)){l=e.initializer;_.ids[l].get_type()!==t.Undef?c+=" = "+this.to_initializer_expression(e):n.force_zero_initialized_variables&&this.type_can_zero_initialize(o)&&(c+=" = "+this.to_zero_initialized_expression(this.get_variable_data_type_id(e)))}return c},r.prototype.variable_decl_function_local=function(e){var t=e.storage;e.storage=v.Function;var r=this.variable_decl(e);return e.storage=t,r},r.prototype.variable_decl_is_remapped_storage=function(e,t){return e.storage===t},r.prototype.to_func_call_arg=function(e,t){var r=t,i=this.maybe_get(T,t);return i&&i.basevariable&&(r=i.basevariable),this.to_expression(r)},r.prototype.is_non_native_row_major_matrix=function(e){if(this.backend.native_row_major_matrix&&!this.is_legacy())return!1;var t=this.maybe_get(ae,e);return t?t.need_transpose:this.has_decoration(e,te.RowMajor)},r.prototype.member_is_non_native_row_major_matrix=function(e,t){if(this.backend.native_row_major_matrix&&!this.is_legacy())return!1;if(!this.has_member_decoration(e.self,t,te.RowMajor))return!1;var r=this.get(R,e.member_types[t]);if(r.columns!==r.vecsize)throw new Error("Row-major matrices must be square on this platform.");return!0},r.prototype.member_is_remapped_physical_type=function(e,t){return this.has_extended_member_decoration(e.self,t,b.PhysicalTypeID)},r.prototype.member_is_packed_physical_type=function(e,t){return this.has_extended_member_decoration(e.self,t,b.PhysicalTypePacked)},r.prototype.convert_row_major_matrix=function(e,t,r,i){if(e=this.strip_enclosed_expression(e),this.is_matrix(t)){if(this.options.version<120){if(2===t.vecsize&&2===t.columns)this.requires_transpose_2x2||(this.requires_transpose_2x2=!0,this.force_recompile());else if(3===t.vecsize&&3===t.columns)this.requires_transpose_3x3||(this.requires_transpose_3x3=!0,this.force_recompile());else{if(4!==t.vecsize||4!==t.columns)throw new Error("Non-square matrices are not supported in legacy GLSL, cannot transpose.");this.requires_transpose_4x4||(this.requires_transpose_4x4=!0,this.force_recompile())}return"spvTranspose(".concat(e,")")}return"transpose(".concat(e,")")}var a=e.lastIndexOf("[");if(-1===a)return e;var s=e.substring(a);e=e.substring(0,a);for(var o=this.type_to_glsl_constructor(t)+"(",n=0;n<t.vecsize;n++)o+="".concat(e,"[").concat(n,"]").concat(s),n+1<t.vecsize&&(o+=", ");return o+=")"},r.prototype.preserve_alias_on_reset=function(e){this.preserved_aliases[e]=this.get_name(e)},r.prototype.reset_name_caches=function(){var e=this;this.preserved_aliases.forEach((function(t,r){return e.set_name(r,t)})),this.preserved_aliases=[],this.resource_names.clear(),this.block_input_names.clear(),this.block_output_names.clear(),this.block_ubo_names.clear(),this.block_ssbo_names.clear(),this.block_names.clear(),this.function_overloads={}},r.prototype.emit_struct=function(e){if(0===e.type_alias||this.has_extended_decoration(e.type_alias,b.BufferBlockRepacked)){this.add_resource_name(e.self);var t=this.type_to_glsl(e),r=this.backend;this.statement(r.explicit_struct_type?"":"struct ",t),this.begin_scope(),e.member_name_cache.clear();for(var i=0,a=!1,s=0,o=e.member_types;s<o.length;s++){var n=o[s];this.add_member_name(e,i),this.emit_struct_member(e,n,i),i++,a=!0}this.type_is_empty(e)&&!r.supports_empty_struct&&(this.statement("int empty_struct_member;"),a=!0),this.has_extended_decoration(e.self,b.PaddingTarget)&&this.emit_struct_padding_target(e),this.end_scope_decl(),a&&this.statement("")}},r.prototype.emit_resources=function(){var e=this,r=this.get_entry_point(),i=this.options,a=this.ir;if(this.replace_illegal_names(),r.model===ve.Fragment&&this.is_legacy()&&this.replace_fragment_outputs(),(this.pls_inputs.length>0||this.pls_outputs.length>0)&&this.emit_pls(),this.should_force_emit_builtin_block(v.Output))this.emit_declared_builtin_block(v.Output,r.model);else if(r.geometry_passthrough)this.emit_declared_builtin_block(v.Input,r.model);else{var s=r.model===ve.Fragment?"in":"out";0!==this.clip_distance_count&&this.statement(s," float gl_ClipDistance[",this.clip_distance_count,"];"),0!==this.cull_distance_count&&this.statement(s," float gl_CullDistance[",this.cull_distance_count,"];"),0===this.clip_distance_count&&0===this.cull_distance_count||this.statement("")}this.position_invariant&&(this.statement("invariant gl_Position;"),this.statement(""));for(var o=!1,n=a.create_loop_hard_lock(),_=0,c=a.ids_for_constant_or_type;_<c.length;_++){var l=c[_],p=a.ids[l];if(p.get_type()===t.Constant){var u=p.get(O);(u.specialization||u.is_used_as_lut)&&(/*!options.vulkan_semantics &&*/u.specialization&&(u.specialization_constant_macro_name=this.constant_value_macro_name(this.get_decoration(u.self,te.SpecId))),this.emit_constant(u),o=!0)}else if(p.get_type()===t.ConstantOp)this.emit_specialization_constant_op(p.get(V)),o=!0;else if(p.get_type()===t.Type){(d=p.get(R)).basetype===E.Struct&&0===d.array.length&&!d.pointer&&!this.has_decoration(d.self,te.Block)&&!this.has_decoration(d.self,te.BufferBlock)&&(o&&this.statement(""),o=!1,this.emit_struct(d))}}if(n.dispose(),o&&this.statement(""),o=!1,a.addressing_model===$.PhysicalStorageBuffer64EXT){for(var h=0,f=this.physical_storage_non_block_pointer_types;h<f.length;h++){var d=f[h];this.emit_buffer_reference_block(d,!1)}a.for_each_typed_id(R,(function(t,r){r.basetype===E.Struct&&r.pointer&&1===r.pointer_depth&&!e.type_is_array_of_pointers(r)&&r.storage===v.PhysicalStorageBufferEXT&&e.emit_buffer_reference_block(t,!0)})),a.for_each_typed_id(R,(function(t,r){r.basetype===E.Struct&&r.pointer&&1===r.pointer_depth&&!e.type_is_array_of_pointers(r)&&r.storage===v.PhysicalStorageBufferEXT&&e.emit_buffer_reference_block(t,!1)}))}a.for_each_typed_id(T,(function(t,r){var i=e.get(R,r.basetype),s=i.storage===v.StorageBuffer||i.storage===v.Uniform||i.storage===v.ShaderRecordBufferKHR,o=et(x,a.meta,i.self).decoration.decoration_flags,n=o.get(te.Block)||o.get(te.BufferBlock);r.storage!==v.Function&&i.pointer&&s&&!e.is_hidden_variable(r)&&n&&e.emit_buffer_block(r)})),a.for_each_typed_id(T,(function(t,r){var i=e.get(R,r.basetype);r.storage!==v.Function&&i.pointer&&i.storage===v.PushConstant&&!e.is_hidden_variable(r)&&e.emit_push_constant_block(r)})),a.for_each_typed_id(T,(function(t,r){var i=e.get(R,r.basetype),a=i.basetype===E.Image&&i.image.dim===Ue.Buffer,s=i.basetype===E.Image&&1===i.image.sampled,n=i.basetype===E.Sampler;(a||!s&&!n)&&(r.storage===v.Function||!i.pointer||i.storage!==v.UniformConstant&&i.storage!==v.AtomicCounter&&i.storage!==v.RayPayloadKHR&&i.storage!==v.IncomingRayPayloadKHR&&i.storage!==v.CallableDataKHR&&i.storage!==v.IncomingCallableDataKHR&&i.storage!==v.HitAttributeKHR||e.is_hidden_variable(r)||(e.emit_uniform(r),o=!0))})),o&&this.statement(""),o=!1;var g=!1;a.for_each_typed_id(T,(function(t,r){var a=e.get(R,r.basetype),s=e.is_hidden_variable(r);if(r.storage===v.Output&&!e.is_legacy()&&e.location_is_framebuffer_fetch(e.get_decoration(r.self,te.Location))&&(s=!1),r.storage===v.Function||!a.pointer||r.storage!==v.Input&&r.storage!==v.Output||!e.interface_variable_exists_in_entry_point(r.self)||s){if(e.is_builtin_variable(r)){var n=e.get_decoration(r.self,te.BuiltIn);!g&&(i.vertex.support_nonzero_base_instance&&n===m.InstanceIndex||n===m.BaseInstance)?(e.statement("#ifdef GL_ARB_shader_draw_parameters"),e.statement("#define SPIRV_Cross_BaseInstance gl_BaseInstanceARB"),e.statement("#else"),e.statement("uniform int SPIRV_Cross_BaseInstance;"),e.statement("#endif"),o=!0,g=!0):n===m.BaseVertex?(e.statement("#ifdef GL_ARB_shader_draw_parameters"),e.statement("#define SPIRV_Cross_BaseVertex gl_BaseVertexARB"),e.statement("#else"),e.statement("uniform int SPIRV_Cross_BaseVertex;"),e.statement("#endif")):n===m.DrawIndex&&(e.statement("#ifndef GL_ARB_shader_draw_parameters"),e.statement("#error GL_ARB_shader_draw_parameters is not supported."),e.statement("#endif"))}}else{if(e.get_execution_model()===ve.Vertex&&r.storage===v.Input&&1===a.array.length)throw new Error("OpenGL ES doesn't support array input variables in vertex shader.");e.emit_interface_block(r),o=!0}}));for(var b=0,y=this.global_variables;b<y.length;b++){var S=y[b],I=this.get(T,S);if(!this.is_hidden_variable(I,!0))if(I.storage!==v.Output){if(!this.variable_is_lut(I)){this.add_resource_name(I.self);var k="";i.force_zero_initialized_variables&&I.storage===v.Private&&!I.initializer&&!I.static_expression&&this.type_can_zero_initialize(this.get_variable_data_type(I))&&(k=" = "+this.to_zero_initialized_expression(this.get_variable_data_type_id(I))),this.statement(this.variable_decl(I),k,";"),o=!0}}else I.initializer&&null!==this.maybe_get(O,I.initializer)&&this.emit_output_variable_initializer(I)}o&&this.statement(""),this.declare_undefined_values()},r.prototype.emit_extension_workarounds=function(e){if(this.workaround_ubo_load_overload_types.length){for(var t=0,r=this.workaround_ubo_load_overload_types;t<r.length;t++){var i=r[t],a=this.get(R,i);this.statement(this.type_to_glsl(a)," spvWorkaroundRowMajor(",this.type_to_glsl(a)," wrap) { return wrap; }")}this.statement("")}this.requires_transpose_2x2&&(this.statement("mat2 spvTranspose(mat2 m)"),this.begin_scope(),this.statement("return mat2(m[0][0], m[1][0], m[0][1], m[1][1]);"),this.end_scope(),this.statement("")),this.requires_transpose_3x3&&(this.statement("mat3 spvTranspose(mat3 m)"),this.begin_scope(),this.statement("return mat3(m[0][0], m[1][0], m[2][0], m[0][1], m[1][1], m[2][1], m[0][2], m[1][2], m[2][2]);"),this.end_scope(),this.statement("")),this.requires_transpose_4x4&&(this.statement("mat4 spvTranspose(mat4 m)"),this.begin_scope(),this.statement("return mat4(m[0][0], m[1][0], m[2][0], m[3][0], m[0][1], m[1][1], m[2][1], m[3][1], m[0][2], m[1][2], m[2][2], m[3][2], m[0][3], m[1][3], m[2][3], m[3][3]);"),this.end_scope(),this.statement(""))},r.prototype.emit_buffer_block_global=function(e){var t=this.get(R,e.basetype),r=this.ir,i=et(x,r.meta,t.self);if(e.storage===v.StorageBuffer||i.decoration.decoration_flags.get(te.BufferBlock))throw new Error("SSBOs not supported in legacy targets.");for(var a=[],s=0,o=0,n=t.member_types;o<n.length;o++){var _=n[o],c=this.get(R,_),l=this.to_member_name(t,s);a.push(l+this.type_to_array_glsl(c)),this.statement("uniform ",this.variable_decl(c,l),";"),s++}this.unnamed_ubo_info[this.to_name(t.self)]=a,this.statement("")},r.prototype.emit_buffer_block_native=function(e){var t=this.get(R,e.basetype),r=this.ir,i=this.options,a=r.get_buffer_block_flags(e),s=et(x,r.meta,t.self).decoration,o=e.storage===v.StorageBuffer||e.storage===v.ShaderRecordBufferKHR||s.decoration_flags.get(te.BufferBlock),n=o&&a.get(te.Restrict),_=o&&a.get(te.NonReadable),c=o&&a.get(te.NonWritable),l=o&&a.get(te.Coherent),p=this.to_name(t.self,!1),u=o?this.block_ssbo_names:this.block_ubo_names;(""===s.alias||u.has(p)||this.resource_names.has(p))&&(p=this.get_block_fallback_name(e.self)),""===(p=this.add_variable(u,this.resource_names,p))&&(p="_"+this.get(R,e.basetype).self+"_"+e.self),this.block_names.add(p),u.add(p),this.declared_block_names[e.self]=p,this.statement(this.layout_for_variable(e),l?"coherent ":"",n?"restrict ":"",_?"writeonly ":"",c?"readonly ":"",o?"buffer ":"uniform ",p),this.begin_scope(),t.member_name_cache.clear();for(var h=0,f=0,d=t.member_types;f<d.length;f++){var m=d[f];this.add_member_name(t,h),this.emit_struct_member(t,m,h),h++}this.preserve_alias_on_reset(e.self),this.add_resource_name(e.self);var g="";""===r.get_name(e.self)&&i.keep_unnamed_ubos?this.removed_structs.add(e.self):g=this.to_name(e.self)+this.type_to_array_glsl(t),this.end_scope_decl(g),this.statement("")},r.prototype.emit_buffer_reference_block=function(e,t){var r=this.get(R,e),i="",a=this.ir;if(t?(i=this.to_name(r.self,!1),(0===et(x,a.meta,r.self).decoration.alias.length||this.block_ssbo_names.has(i)||this.resource_names.has(i))&&(i="_"+r.self),0===(i=this.add_variable(this.block_ssbo_names,this.resource_names,i)).length&&(i="_"+r.self),this.block_names.add(i),this.block_ssbo_names.add(i),et(x,a.meta,r.self).decoration.alias=i):i=r.basetype!==E.Struct?this.type_to_glsl(r):this.to_name(r.self,!1),t)this.statement("layout(buffer_reference) buffer ",i,";");else{var s=this.physical_storage_type_to_alignment[e],o=0;if(s&&(o=s.alignment),r.basetype===E.Struct){var n=["buffer_reference"];o&&n.push("buffer_reference_align = "+o),n.push(this.buffer_to_packing_standard(r,!0));var _=a.get_buffer_block_type_flags(r),c="";_.get(te.Restrict)&&(c+=" restrict"),_.get(te.Coherent)&&(c+=" coherent"),_.get(te.NonReadable)&&(c+=" writeonly"),_.get(te.NonWritable)&&(c+=" readonly"),this.statement("layout(",n.join(", "),")",c," buffer ",i)}else o?this.statement("layout(buffer_reference, buffer_reference_align = ",o,") buffer ",i):this.statement("layout(buffer_reference) buffer ",i);if(this.begin_scope(),r.basetype===E.Struct){r.member_name_cache.clear();for(var l=0,p=0,u=r.member_types;p<u.length;p++){var h=u[p];this.add_member_name(r,l),this.emit_struct_member(r,h,l),l++}}else{var f=this.get_pointee_type(r);this.statement(this.type_to_glsl(f)," value",this.type_to_array_glsl(f),";")}this.end_scope_decl(),this.statement("")}},r.prototype.emit_declared_builtin_block=function(e,t){var r=this,i=new y,a=new y,s=!1,o=!1,n=0,_=0,c=!1,l=!1,p=!1,u=0,h=0,f=0,d=[],g=this.ir;if(g.for_each_typed_id(T,(function(t,b){var S=r.get(R,b.basetype),I=r.has_decoration(S.self,te.Block),k=new y;if(b.storage===e&&I&&r.is_builtin_variable(b)){for(var w=0,E=0,T=et(x,g.meta,S.self).members;E<T.length;E++){if((C=T[E]).builtin&&(k.set(C.builtin_type),C.builtin_type===m.CullDistance?n=r.to_array_size_literal(r.get(R,S.member_types[w])):C.builtin_type===m.ClipDistance&&(_=r.to_array_size_literal(r.get(R,S.member_types[w]))),qt(C.builtin_type)&&C.decoration_flags.get(te.Offset)&&(p=!0,d[C.builtin_type]=C.offset),qt(C.builtin_type)&&C.decoration_flags.get(te.Stream))){var L=C.stream;if(l&&f!==L)throw new Error("IO block member Stream mismatch.");l=!0,f=L}w++}if(e===v.Output&&r.has_decoration(b.self,te.XfbBuffer)&&r.has_decoration(b.self,te.XfbStride)){var N=r.get_decoration(b.self,te.XfbBuffer),A=r.get_decoration(b.self,te.XfbStride);if(c&&N!==h)throw new Error("IO block member XfbBuffer mismatch.");if(c&&A!==u)throw new Error("IO block member XfbBuffer mismatch.");c=!0,h=N,u=A}if(e===v.Output&&r.has_decoration(b.self,te.Stream)){L=r.get_decoration(b.self,te.Stream);if(l&&f!==L)throw new Error("IO block member Stream mismatch.");l=!0,f=L}}else if(b.storage===e&&!I&&r.is_builtin_variable(b)){var C;if((C=et(x,g.meta,b.self).decoration).builtin){if(a.set(C.builtin_type),C.builtin_type===m.CullDistance?n=r.to_array_size_literal(S):C.builtin_type===m.ClipDistance&&(_=r.to_array_size_literal(S)),qt(C.builtin_type)&&C.decoration_flags.get(te.XfbStride)&&C.decoration_flags.get(te.XfbBuffer)&&C.decoration_flags.get(te.Offset)){p=!0,d[C.builtin_type]=C.offset;N=C.xfb_buffer,A=C.xfb_stride;if(c&&N!==h)throw new Error("IO block member XfbBuffer mismatch.");if(c&&A!==u)throw new Error("IO block member XfbBuffer mismatch.");c=!0,h=N,u=A}if(qt(C.builtin_type)&&C.decoration_flags.get(te.Stream)){L=r.get_decoration(b.self,te.Stream);if(l&&f!==L)throw new Error("IO block member Stream mismatch.");l=!0,f=L}}}if(!k.empty()){if(s)throw new Error("Cannot use more than one builtin I/O block.");i=k,s=!0,o=S.array.length>0}})),(a=new y(a.get_lower())).set(m.Position),a.set(m.PointSize),a.set(m.ClipDistance),a.set(m.CullDistance),s||(i=a),!i.empty()){if(e===v.Output){if(c&&p)throw new Error("Need GL_ARB_enhanced_layouts for xfb_stride or xfb_buffer.");if(l)throw new Error("Multiple geometry streams not supported in ESSL.");this.statement("out gl_PerVertex")}else this.get_entry_point().geometry_passthrough?this.statement("layout(passthrough) in gl_PerVertex"):this.statement("in gl_PerVertex");var b;if(this.begin_scope(),i.get(m.Position))(b=d[m.Position])?this.statement("layout(xfb_offset = ",b,") vec4 gl_Position;"):this.statement("vec4 gl_Position;");if(i.get(m.PointSize))(b=d.find[m.PointSize])?this.statement("layout(xfb_offset = ",b,") float gl_PointSize;"):this.statement("float gl_PointSize;");if(i.get(m.ClipDistance))(b=d[m.ClipDistance])?this.statement("layout(xfb_offset = ",b,") float gl_ClipDistance[",_,"];"):this.statement("float gl_ClipDistance[",_,"];");if(i.get(m.CullDistance))(b=d[m.CullDistance])?this.statement("layout(xfb_offset = ",b,") float gl_CullDistance[",n,"];"):this.statement("float gl_CullDistance[",n,"];");o||this.end_scope_decl(),this.statement("")}},r.prototype.should_force_emit_builtin_block=function(e){var t=this;if(e!==v.Output)return!1;var r=!1;return this.ir.for_each_typed_id(T,(function(i,a){if(!r){var s=t.get(R,a.basetype),o=t.has_decoration(s.self,te.Block);if(a.storage===e&&o&&t.is_builtin_variable(a))for(var n=s.member_types.length,_=0;_<n;_++)t.has_member_decoration(s.self,_,te.BuiltIn)&&qt(t.get_member_decoration(s.self,_,te.BuiltIn))&&t.has_member_decoration(s.self,_,te.Offset)&&(r=!0);else a.storage===e&&!o&&t.is_builtin_variable(a)&&qt(t.get_decoration(s.self,te.BuiltIn))&&t.has_decoration(a.self,te.Offset)&&(r=!0)}})),r},r.prototype.emit_push_constant_block_glsl=function(e){var t=this.ir,r=this.get(R,e.basetype),i=et(x,t.meta,e.self).decoration.decoration_flags;i.clear(te.Binding),i.clear(te.DescriptorSet);var a=et(x,t.meta,r.self).decoration.decoration_flags,s=a.get(te.Block);a.clear(te.Block),this.emit_struct(r),s&&a.set(te.Block),this.emit_uniform(e),this.statement("")},r.prototype.emit_interface_block=function(e){var t=this.get(R,e.basetype),r=this.ir,i=et(x,r.meta,t.self).decoration.decoration_flags.get(te.Block),a=this.to_storage_qualifiers_glsl(e);i||t.basetype===E.Struct?this.emit_flattened_io_block(e,a):(this.add_resource_name(e.self),this.statement(this.layout_for_variable(e),this.to_qualifiers_glsl(e.self),this.variable_decl(t,this.to_name(e.self),e.self),";"))},r.prototype.constant_value_macro_name=function(e){return this.options.specialization_constant_prefix+e},r.prototype.get_constant_mapping_to_workgroup_component=function(e){var t=this.get_entry_point(),r=-1;return 0===t.workgroup_size.constant&&t.flags.get(Ee.LocalSizeId)&&(e.self===t.workgroup_size.id_x?r=0:e.self===t.workgroup_size.id_y?r=1:e.self===t.workgroup_size.id_z&&(r=2)),r},r.prototype.emit_constant=function(e){var t=this.get(R,e.constant_type),r=this.to_name(e.self),i=new Ut,a=new Ut,s=new Ut,o=this.get_work_group_size_specialization_constants(i,a,s);if(e.self!==o){var n=e.self===i.id||e.self===a.id||e.self===s.id;if(/*!options.vulkan_semantics &&*/!n||this.has_decoration(e.self,te.SpecId))if(this.has_decoration(e.self,te.SpecId)){var _=e.specialization_constant_macro_name;this.statement("#ifndef ",_),this.statement("#define ",_," ",this.constant_expression(e)),this.statement("#endif"),n||this.statement("const ",this.variable_decl(t,r)," = ",_,";")}else this.statement("const ",this.variable_decl(t,r)," = ",this.constant_expression(e),";")}},r.prototype.emit_specialization_constant_op=function(e){var t=this.get(R,e.basetype),r=this.to_name(e.self);this.statement("const ",this.variable_decl(t,r)," = ",this.constant_op_expression(e),";")},r.prototype.emit_continue_block=function(e,t,r){var i=this.get(J,e);this.current_continue_block=i;var a=[],s=this.redirect_statement;this.redirect_statement=a;for(var o=this.ir;0==(et(0,o.block_meta,i.self)&Ne.LOOP_HEADER_BIT);)if(this.emit_block_instructions(i),i.next_block)this.flush_phi(e,i.next_block),i=this.get(J,i.next_block);else if(i.true_block&&t)this.flush_phi(e,i.true_block),i=this.get(J,i.true_block);else{if(!i.false_block||!r)throw new Error("Invalid continue block detected!");this.flush_phi(e,i.false_block),i=this.get(J,i.false_block)}this.redirect_statement=s;for(var n=0;n<a.length;++n){var _=a[n];""!==_&&";"===_.charAt(_.length-1)&&(a[n]=_.substring(0,_.length-1))}return this.current_continue_block=null,a.join(", ")},r.prototype.attempt_emit_loop_header=function(e,t){var r=this.continue_block_type(this.get(J,e.continue_block));if(t===D.MergeToSelectForLoop||t===D.MergeToSelectContinueForLoop){var i=this.statement_count;this.emit_block_instructions(e);var a=!this.forced_temporaries.has(e.condition);if(i===this.statement_count&&a){switch(r){case B.ForLoop:this.flush_undeclared_variables(e);var s=this.emit_for_loop_initializers(e),o=this.to_expression(e.condition);if(this.execution_is_noop(this.get(J,e.true_block),this.get(J,e.merge_block))&&(o="!"+this.enclose_expression(o)),this.emit_block_hints(e),t!==D.MergeToSelectContinueForLoop){var n=this.emit_continue_block(e.continue_block,!1,!1);this.statement("for (",s,"; ",o,"; ",n,")")}else this.statement("for (",s,"; ",o,"; )");break;case B.WhileLoop:this.flush_undeclared_variables(e),this.emit_while_loop_initializers(e),this.emit_block_hints(e);o=this.to_expression(e.condition);this.execution_is_noop(this.get(J,e.true_block),this.get(J,e.merge_block))&&(o="!"+this.enclose_expression(o)),this.statement("while (",o,")");break;default:return e.disable_block_optimization=!0,this.force_recompile(),this.begin_scope(),!1}return this.begin_scope(),!0}return e.disable_block_optimization=!0,this.force_recompile(),this.begin_scope(),!1}if(t===D.MergeToDirectForLoop){var _=this.get(J,e.next_block);this.flush_undeclared_variables(_);i=this.statement_count;this.emit_block_instructions(_);a=!this.forced_temporaries.has(_.condition);if(i===this.statement_count&&a){var c=_.true_block;switch(r){case B.ForLoop:s=this.emit_for_loop_initializers(e),o=this.to_expression(_.condition);this.execution_is_noop(this.get(J,_.true_block),this.get(J,e.merge_block))&&(o="!"+this.enclose_expression(o),c=_.false_block);n=this.emit_continue_block(e.continue_block,!1,!1);this.emit_block_hints(e),this.statement("for (",s,"; ",o,"; ",n,")");break;case B.WhileLoop:this.emit_while_loop_initializers(e),this.emit_block_hints(e);o=this.to_expression(_.condition);this.execution_is_noop(this.get(J,_.true_block),this.get(J,e.merge_block))&&(o="!"+this.enclose_expression(o),c=_.false_block),this.statement("while (",o,")");break;default:return e.disable_block_optimization=!0,this.force_recompile(),this.begin_scope(),!1}return this.begin_scope(),this.branch(_.self,c),!0}return e.disable_block_optimization=!0,this.force_recompile(),this.begin_scope(),!1}return!1},r.prototype.branch_to_continue=function(e,t){var r=this.get(J,t);if(e!==t)if(console.assert(this.is_continue(t)),r.complex_continue){var i=this.expression_usage_counts.concat();this.emit_block_chain(r),this.expression_usage_counts=i}else{var a=this.get(J,e),s=!1,o=0;if(a.merge_block?o=e:a.loop_dominator!==J.NoDominator&&(o=a.loop_dominator),0!==o)s=this.get_cfg_for_current_function().node_terminates_control_flow_in_sub_graph(o,e);s||this.statement("continue;")}},r.prototype.branch=function(e,t,r,i){void 0===r?this._branch(e,t):this._branchTrueFalse(e,t,r,i)},r.prototype._branch=function(e,t){this.flush_phi(e,t),this.flush_control_dependent_expressions(e);var r=this.is_continue(t),i=this.ir;if(0!=(i.block_meta[t]&Ne.LOOP_HEADER_BIT)&&this.get(J,e).loop_dominator===t)this.statement("continue;");else if(e!==t&&this.is_break(t))this.current_emitting_switch&&this.is_loop_break(t)&&this.current_emitting_switch.loop_dominator!==J.NoDominator&&this.get(J,this.current_emitting_switch.loop_dominator).merge_block===t&&(this.current_emitting_switch.need_ladder_break||(this.force_recompile(),this.current_emitting_switch.need_ladder_break=!0),this.statement("_",this.current_emitting_switch.self,"_ladder_break = true;")),this.statement("break;");else if(r||e===t){var a=0!=(et(0,i.block_meta,t)&(Ne.SELECTION_MERGE_BIT|Ne.MULTISELECT_MERGE_BIT|Ne.LOOP_MERGE_BIT));r&&a||this.branch_to_continue(e,t)}else this.is_conditional(t)||this.emit_block_chain(this.get(J,t))},r.prototype._branchTrueFalse=function(e,t,r,i){var a=this.get(J,e),s=a.merge===P.Selection?a.next_block:0,o=r!==s||this.flush_phi_required(e,r),n=i!==s||this.flush_phi_required(e,i);(o||n)&&(a.hint!==M.Flatten&&a.hint!==M.DontFlatten||this.emit_block_hints(a),o?(this.statement("if (",this.to_expression(t),")"),this.begin_scope(),this.branch(e,r),this.end_scope(),n&&(this.statement("else"),this.begin_scope(),this.branch(e,i),this.end_scope())):n&&(this.statement("if (!",this.to_enclosed_expression(t),")"),this.begin_scope(),this.branch(e,i),this.end_scope()))},r.prototype.flush_phi=function(e,t){var r=this.get(J,t);if(r.ignore_phi_from_block!==e)for(var i=new Set,a=0;a<r.phi_variables.length;++a){var s=r.phi_variables[a];if(s.parent===e){var o=this.get(T,s.function_variable);if(o.loop_variable&&!o.loop_variable_enable)o.static_expression=s.local_variable;else{this.flush_variable_declaration(s.function_variable);for(var n=!1,_=a+1;_<r.phi_variables.length;++_){var c=r.phi_variables[_];if(c.local_variable===s.function_variable&&c.parent===e){n=!0;break}}n&&(o.allocate_temporary_copy||(o.allocate_temporary_copy=!0,this.force_recompile()),this.statement("_",s.function_variable,"_copy"," = ",this.to_name(s.function_variable),";"),i.add(s.function_variable));var l=this.to_expression(s.function_variable),p=void 0;p=i.has(s.local_variable)?"_"+s.local_variable+"_copy":this.to_pointer_expression(s.local_variable),this.optimize_read_modify_write(this.get(R,o.basetype),l,p)||this.statement(l," = ",p,";")}this.register_write(s.function_variable)}}},r.prototype.flush_variable_declaration=function(e){var t=this.maybe_get(T,e),r=this.options;if(t&&t.deferred_declaration){var i="";!r.force_zero_initialized_variables||t.storage!==v.Function&&t.storage!==v.Generic&&t.storage!==v.Private||t.initializer||!this.type_can_zero_initialize(this.get_variable_data_type(t))||(i=" = "+this.to_zero_initialized_expression(this.get_variable_data_type_id(t))),this.statement(this.variable_decl_function_local(t),i,";"),t.deferred_declaration=!1}t&&this.emit_variable_temporary_copies(t)},r.prototype.flush_undeclared_variables=function(e){for(var t=0,r=e.dominated_variables;t<r.length;t++){var i=r[t];this.flush_variable_declaration(i)}},r.prototype.emit_variable_temporary_copies=function(e){if(e.allocate_temporary_copy&&!this.flushed_phi_variables.has(e.self)){var t=this.get(R,e.basetype),r=this.get_decoration_bitset(e.self);this.statement(this.flags_to_qualifiers_glsl(t,r),this.variable_decl(t,"_"+e.self+"_copy"),";"),this.flushed_phi_variables.add(e.self)}},r.prototype.should_dereference=function(e){if(!this.expression_type(e).pointer)return!1;if(!this.expression_is_lvalue(e))return!1;var t=this.maybe_get(T,e);if(t)return t.phi_variable;var r=this.maybe_get(ae,e);return!r||!r.access_chain},r.prototype.should_forward=function(e){var t=this.maybe_get(T,e);return!(!t||!t.forwardable)||!this.options.force_temporary&&!!this.is_immutable(e)},r.prototype.should_suppress_usage_tracking=function(e){return!this.expression_is_forwarded(e)||this.expression_suppresses_usage_tracking(e)},r.prototype.emit_mix_op=function(e,t,r,i,a){var s=this.expression_type(a),o=this.get(R,e);o.pointer&&(this.register_write(r),this.register_write(i));var n=this.to_trivial_mix_op(o,r,i,a);if(void 0!==n)this.emit_unary_func_op(e,t,a,n);else if(/*!has_boolean_mix &&*/s.basetype===E.Boolean){var _=this.to_ternary_expression(this.get(R,e),a,i,r);this.emit_op(e,t,_,this.should_forward(r)&&this.should_forward(i)&&this.should_forward(a)),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i),this.inherit_expression_dependencies(t,a)}else this.emit_trinary_func_op(e,t,r,i,a,"mix")},r.prototype.emit_nminmax_op=function(e,t,r,i,a){var s=this.ir,o=et(0,this.extra_sub_expressions,t);if(!o){o=s.increase_bound_by(5);var n=f(R,this.get(R,e));n.basetype=E.Boolean,this.set(R,o,n)}var _=o+0,c=o+1,l=o+2,p=o+3,u=o+4;s.meta[p]=f(x,s.meta[t]),s.meta[u]=f(x,s.meta[t]),this.emit_unary_func_op(_,c,r,"isnan"),this.emit_unary_func_op(_,l,i,"isnan"),this.emit_binary_func_op(e,p,r,i,a===Oe.NMin?"min":"max"),this.emit_mix_op(e,u,p,i,c),this.emit_mix_op(e,t,u,r,l)},r.prototype.to_trivial_mix_op=function(e,t,r,i){var a=this.backend,s=this.maybe_get(O,t),o=this.maybe_get(O,r),n=this.expression_type(i);if(s&&o&&!s.specialization&&!o.specialization){var _=this.get(R,s.constant_type);if(n.basetype===E.Boolean&&_.basetype!==E.Struct&&!this.is_array(_)&&(a.use_constructor_splatting||_.vecsize===n.vecsize)&&!(_.columns>1)){for(var c=!0,l=0;c&&l<_.vecsize;l++)switch(e.basetype){case E.Short:case E.UShort:c=0===s.scalar_u16(0,l)&&1===o.scalar_u16(0,l);break;case E.Int:case E.UInt:c=0===s.scalar(0,l)&&1===o.scalar(0,l);break;case E.Half:c=0===s.scalar_f16(0,l)&&1===o.scalar_f16(0,l);break;case E.Float:c=0===s.scalar_f32(0,l)&&1===o.scalar_f32(0,l);break;case E.Double:c=0===s.scalar_f64(0,l)&&1===o.scalar_f64(0,l);break;case E.Int64:case E.UInt64:c=s.scalar_u64(0,l)===BigInt(0)&&o.scalar_u64(0,l)===BigInt(1);break;default:c=!1}return c?this.type_to_glsl_constructor(e):void 0}}},r.prototype.emit_trinary_func_op=function(e,t,r,i,a,s){var o=this.should_forward(r)&&this.should_forward(i)&&this.should_forward(a);this.emit_op(e,t,s+"("+this.to_unpacked_expression(r)+", "+this.to_unpacked_expression(i)+", "+this.to_unpacked_expression(a)+")",o),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i),this.inherit_expression_dependencies(t,a)},r.prototype.emit_binary_func_op=function(e,t,r,i,a){var s=this.should_forward(r)&&this.should_forward(i);this.emit_op(e,t,a+"("+this.to_unpacked_expression(r)+", "+this.to_unpacked_expression(i)+")",s),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i)},r.prototype.emit_trinary_func_op_bitextract=function(e,t,r,i,a,s,o,n,_,c){var l=this.get(R,e),p=f(R,l);p.basetype=n;var u=this.expression_type(r).basetype!==n?this.bitcast_glsl(p,r):this.to_unpacked_expression(r),h=this.to_unpacked_expression(i),d=this.to_unpacked_expression(a);p.basetype=_,p.vecsize=1;var m=this.expression_type(i).basetype!==_?this.type_to_glsl_constructor(p)+"("+h+")":h;p.basetype=c,p.vecsize=1;var g=this.expression_type(a).basetype!==c?this.type_to_glsl_constructor(p)+"("+d+")":d,b="";l.basetype!==o?(p.vecsize=l.vecsize,p.basetype=o,b=this.bitcast_glsl_op(l,p),b+="("+s+"("+u+", "+m+", "+g+"))"):b+=s+"("+u+", "+m+", "+g+")",this.emit_op(e,t,b,this.should_forward(r)&&this.should_forward(i)&&this.should_forward(a)),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i),this.inherit_expression_dependencies(t,a)},r.prototype.emit_bitfield_insert_op=function(e,t,r,i,a,s,o,n){var _=this.should_forward(r)&&this.should_forward(i)&&this.should_forward(a)&&this.should_forward(s),c=this.to_unpacked_expression(r),l=this.to_unpacked_expression(i),p=this.to_unpacked_expression(a),u=this.to_unpacked_expression(s),h=new R;h.vecsize=1,h.basetype=n,this.expression_type(a).basetype!==n&&(p=this.type_to_glsl_constructor(h)+"("+p+")"),this.expression_type(s).basetype!==n&&(u=this.type_to_glsl_constructor(h)+"("+u+")"),this.emit_op(e,t,o+"("+c+", "+l+", "+p+", "+u+")",_),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i),this.inherit_expression_dependencies(t,a),this.inherit_expression_dependencies(t,s)},r.prototype.emit_unary_func_op=function(e,t,r,i){var a=this.should_forward(r);this.emit_op(e,t,i+"("+this.to_unpacked_expression(r)+")",a),this.inherit_expression_dependencies(t,r)},r.prototype.emit_binary_op=function(e,t,r,i,a){var s=this.backend.support_precise_qualifier&&this.has_decoration(t,te.NoContraction)&&gt(this.get(R,e)),o=this.should_forward(r)&&this.should_forward(i)&&!s;this.emit_op(e,t,this.to_enclosed_unpacked_expression(r)+" "+a+" "+this.to_enclosed_unpacked_expression(i),o),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i)},r.prototype.emit_unrolled_binary_op=function(e,t,r,i,a,s,o){var n=this.expression_type(r),_=this.expression_type(i),c=f(R,n),l=f(R,_);c.basetype=o,l.basetype=o,c.vecsize=1,l.vecsize=1;var p=this.get(R,e),u=this.type_to_glsl_constructor(p);u+="(";for(var h=0;h<p.vecsize;h++)s&&(u+="!("),o!==E.Unknown&&n.basetype!==o?u+=this.bitcast_expression(c,n.basetype,this.to_extract_component_expression(r,h)):u+=this.to_extract_component_expression(r,h),u+=" "+a+" ",o!==E.Unknown&&_.basetype!==o?u+=this.bitcast_expression(l,_.basetype,this.to_extract_component_expression(i,h)):u+=this.to_extract_component_expression(i,h),s&&(u+=")"),h+1<p.vecsize&&(u+=", ");u+=")",this.emit_op(e,t,u,this.should_forward(r)&&this.should_forward(i)),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i)},r.prototype.emit_unary_func_op_cast=function(e,t,r,i,a,s){var o=this.get(R,e),n=this.expression_type(r),_=f(R,o);_.basetype=a,_.width=n.width;var c="";c=n.basetype!==a?n.basetype===E.Boolean?this.type_to_glsl(_)+"("+this.to_unpacked_expression(r)+")":this.bitcast_glsl(_,r):this.to_unpacked_expression(r);var l="";o.basetype!==s?(_.basetype=s,_.width=o.width,l=o.basetype===E.Boolean?this.type_to_glsl(o):this.bitcast_glsl_op(o,_),l+="("+i+"("+c+"))"):l+=i+"("+c+")",this.emit_op(e,t,l,this.should_forward(r)),this.inherit_expression_dependencies(t,r)},r.prototype.emit_binary_func_op_cast=function(e,t,r,i,a,s,o){var n={cast_op0:"",cast_op1:"",input_type:s},_=this.binary_op_bitcast_helper(n,r,i,o),c=this.get(R,e),l="";c.basetype!==s&&c.basetype!==E.Boolean?(_.basetype=s,l=this.bitcast_glsl_op(c,_),l+="("+a+"("+n.cast_op0+", "+n.cast_op1+"))"):l+=a+"("+n.cast_op0+", "+n.cast_op1+")",this.emit_op(e,t,l,this.should_forward(r)&&this.should_forward(i)),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i)},r.prototype.emit_trinary_func_op_cast=function(e,t,r,i,a,s,o){var n=this.get(R,e),_=f(R,n);_.basetype=o;var c=this.expression_type(r).basetype!==o?this.bitcast_glsl(_,r):this.to_unpacked_expression(r),l=this.expression_type(i).basetype!==o?this.bitcast_glsl(_,i):this.to_unpacked_expression(i),p=this.expression_type(a).basetype!==o?this.bitcast_glsl(_,a):this.to_unpacked_expression(a),u="";n.basetype!==o?(u=this.bitcast_glsl_op(n,_),u+="("+s+"("+c+", "+l+", "+p+"))"):u+=s+"("+c+", "+l+", "+p+")",this.emit_op(e,t,u,this.should_forward(r)&&this.should_forward(i)&&this.should_forward(a)),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i),this.inherit_expression_dependencies(t,a)},r.prototype.emit_binary_op_cast=function(e,t,r,i,a,s,o){var n={cast_op0:"",cast_op1:"",input_type:s},_=this.binary_op_bitcast_helper(n,r,i,o),c=this.get(R,e),l="";c.basetype!==n.input_type&&c.basetype!==E.Boolean?(_.basetype=s,l=this.bitcast_glsl_op(c,_),l+="("+n.cast_op0+" "+a+" "+n.cast_op1+")"):l+=n.cast_op0+" "+a+" "+n.cast_op1,this.emit_op(e,t,l,this.should_forward(r)&&this.should_forward(i)),this.inherit_expression_dependencies(t,r),this.inherit_expression_dependencies(t,i)},r.prototype.binary_op_bitcast_helper=function(e,t,r,i){var a=this.expression_type(t),s=this.expression_type(r),o=a.basetype!==s.basetype||!i&&a.basetype!==e.input_type,n=new R;return n.basetype=e.input_type,n.vecsize=a.vecsize,n.columns=a.columns,n.width=a.width,o?(e.cast_op0=this.bitcast_glsl(n,t),e.cast_op1=this.bitcast_glsl(n,r)):(e.cast_op0=this.to_enclosed_unpacked_expression(t),e.cast_op1=this.to_enclosed_unpacked_expression(r),e.input_type=a.basetype),f(R,n)},r.prototype.emit_complex_bitcast=function(e,t,r){var i,a=this.get(R,e),s=this.expression_type(r);if(a.basetype===E.Half&&s.basetype===E.Float&&1===s.vecsize)i="unpackFloat2x16(floatBitsToUint("+this.to_unpacked_expression(r)+"))";else{if(a.basetype!==E.Float||s.basetype!==E.Half||2!==s.vecsize)return!1;i="uintBitsToFloat(packFloat2x16("+this.to_unpacked_expression(r)+"))"}return this.emit_op(e,t,i,this.should_forward(r)),!0},r.prototype.to_ternary_expression=function(e,t,r,i){var a,s=this;if(1===this.expression_type(t).vecsize)a=this.to_enclosed_expression(t)+" ? "+this.to_enclosed_pointer_expression(r)+" : "+this.to_enclosed_pointer_expression(i);else{var o=function(e,t){return s.to_extract_component_expression(e,t)};a=this.type_to_glsl_constructor(e),a+="(";for(var n=0;n<e.vecsize;n++)a+=o(t,n),a+=" ? ",a+=o(r,n),a+=" : ",a+=o(i,n),n+1<e.vecsize&&(a+=", ");a+=")"}return a},r.prototype.emit_unary_op=function(e,t,r,i){var a=this.should_forward(r);this.emit_op(e,t,i+this.to_enclosed_unpacked_expression(r),a),this.inherit_expression_dependencies(t,r)},r.prototype.expression_is_forwarded=function(e){return this.forwarded_temporaries.has(e)},r.prototype.expression_suppresses_usage_tracking=function(e){return this.suppressed_usage_tracking.has(e)},r.prototype.expression_read_implies_multiple_reads=function(e){var t=this.maybe_get(ae,e);return!!t&&this.current_loop_level>t.emitted_loop_level},r.prototype.emit_op=function(e,t,r,i,a){return void 0===a&&(a=!1),i&&!this.forced_temporaries.has(t)?(this.forwarded_temporaries.add(t),a&&this.suppressed_usage_tracking.add(t),this.set(ae,t,r,e,!0)):(this.statement(this.declare_temporary(e,t),r,";"),this.set(ae,t,this.to_name(t),e,!0))},r.prototype.access_chain_internal_append_index=function(e,t,r,i,a,s){var o=0!=(i&wt.INDEX_IS_LITERAL_BIT),n=0==(i&wt.SKIP_REGISTER_EXPRESSION_READ_BIT);return e+="[",e+=o?le(s):this.to_unpacked_expression(s,n),e+="]"},r.prototype.access_chain_internal=function(e,r,i,a,s,o){var n=this,_="",c=this,l=c.backend,p=c.options,u=c.ir,h=0!=(s&wt.INDEX_IS_LITERAL_BIT),f=0!=(s&wt.LITERAL_MSB_FORCE_ID),d=0!=(s&wt.CHAIN_ONLY_BIT),g=0!=(s&wt.PTR_CHAIN_BIT),y=0==(s&wt.SKIP_REGISTER_EXPRESSION_READ_BIT),S=0!=(s&wt.FLATTEN_ALL_MEMBERS_BIT);if(!d){var I=this.maybe_get(ae,e),k=I&&I.need_transpose;I&&(I.need_transpose=!1),_=this.to_enclosed_expression(e,y),I&&(I.need_transpose=k)}var w=this.expression_type_id(e);if(!l.native_pointers){if(g)throw new Error("Backend does not support native pointers and does not support OpPtrAccessChain.");if(this.should_dereference(e)){var L=this.get(R,w);_=this.dereference_expression(L,_)}}for(var N=this.get_pointee_type(w),A=_.indexOf("[")>=0,C=this.is_non_native_row_major_matrix(e),P=this.has_extended_decoration(e,b.PhysicalTypePacked),M=this.get_extended_decoration(e,b.PhysicalTypeID),D=this.has_decoration(e,te.Invariant),B=!1,z=!1,U=function(t,r){var i=s;r||(i&=~wt.INDEX_IS_LITERAL_BIT),_=n.access_chain_internal_append_index(_,e,N,i,A,t)},G=0;G<a;G++){var F=r[G+i],V=h;if(V&&f&&F>>31!=0&&(V=!1,F&=2147483647),g&&0===G){if(p.flatten_multidimensional_arrays&&(B=z=N.array.length>=1)&&(_+="["),p.flatten_multidimensional_arrays&&z){_+=V?le(F):this.to_enclosed_expression(F,y);for(var H=N.array.length;H;H--)_+=" * ",_+=this.enclose_expression(this.to_array_size(N,H-1));0===N.array.length?B=!1:_+=" + ",B||(_+="]")}else U(F,V);N.basetype===E.ControlPointArray&&(w=N.parent_type,N=this.get(R,w)),A=!0}else if(N.array.length>0){p.flatten_multidimensional_arrays&&!B&&(B=z=N.array.length>1)&&(_+="["),console.assert(N.parent_type);var q=this.maybe_get(T,e);if(l.force_gl_in_out_block&&0===G&&q&&this.is_builtin_variable(q)&&!this.has_decoration(N.self,te.Block))switch(K=et(x,u.meta,e).decoration.builtin_type){case m.Position:case m.PointSize:q.storage===v.Input?_="gl_in["+this.to_expression(F,y)+"]."+_:q.storage===v.Output?_="gl_out["+this.to_expression(F,y)+"]."+_:U(F,V);break;default:U(F,V)}else if(p.flatten_multidimensional_arrays&&z){var X=this.get(R,N.parent_type);_+=V?le(F):this.to_enclosed_expression(F,y);for(H=X.array.length;H;H--)_+=" * ",_+=this.enclose_expression(this.to_array_size(X,H-1));0===X.array.length?B=!1:_+=" + ",B||(_+="]")}else this.builtin_translates_to_nonarray(this.get_decoration(e,te.BuiltIn))||U(F,V);w=N.parent_type,N=this.get(R,w),A=!0}else if(N.basetype===E.Struct){if(V||(F=this.evaluate_constant_u32(F)),F<N.member_type_index_redirection.length&&(F=N.member_type_index_redirection[F]),F>=N.member_types.length)throw new Error("Member index is out of bounds!");var K;if(void 0!==(K=this.is_member_builtin(N,F))&&this.access_chain_needs_stage_io_builtin_translation(e))A?(_+=".",_+=this.builtin_to_glsl(K,N.storage)):_=this.builtin_to_glsl(K,N.storage);else{var j=this.get_member_qualified_name(w,F);""!==j?_=j:_+=S?"_"+this.to_member_name(N,F):this.to_member_reference(e,N,F,g)}this.has_member_decoration(N.self,F,te.Invariant)&&(D=!0),P=this.member_is_packed_physical_type(N,F),M=this.member_is_remapped_physical_type(N,F)?this.get_extended_member_decoration(N.self,F,b.PhysicalTypeID):0,C=this.member_is_non_native_row_major_matrix(N,F),N=this.get(R,N.member_types[F])}else if(N.columns>1)_+="[",_+=V?le(F):this.to_unpacked_expression(F,y),_+="]",w=N.parent_type,N=this.get(R,w);else if(N.vecsize>1){var W="";if(C){var Q=_.lastIndexOf("[");Q>=0&&(W=_.substring(Q),_=_.substring(0,Q))}var Z=v.Generic,Y=!1;if(0==(s&wt.FORCE_COMPOSITE_BIT)?this.expression_type(e).pointer&&(Z=this.get_expression_effective_storage_class(e)):Y=!0,C||Y||(_=this.prepare_access_chain_for_scalar_access(_,this.get(R,N.parent_type),Z,P)),V){var J=F>=N.vecsize;P||C?_+="["+(J?0:F)+"]":(_+=".",_+=this.index_to_swizzle(J?0:F))}else if(u.ids[F].get_type()!==t.Constant||P||C)_+="["+this.to_unpacked_expression(F,y)+"]";else{var $=this.get(O,F);J=$.scalar()>=N.vecsize;$.specialization?_+="["+(J?"0":this.to_expression(F))+"]":_+="."+this.index_to_swizzle(J?0:$.scalar())}C&&!Y&&(_=this.prepare_access_chain_for_scalar_access(_,this.get(R,N.parent_type),Z,P)),_+=W,C=!1,P=!1,M=0,w=N.parent_type,N=this.get(R,w)}else if(!l.allow_truncated_access_chain)throw new Error("Cannot subdivide a scalar value!")}if(B)throw new Error("Flattening of multidimensional arrays were enabled, but the access chain was terminated in the middle of a multidimensional array. This is not supported.");return o&&(o.need_transpose=C,o.storage_is_packed=P,o.storage_is_invariant=D,o.storage_physical_type=M),_},r.prototype.get_expression_effective_storage_class=function(e){var r=this.maybe_get_backing_variable(e),i=this.ir.ids[e].get_type()===t.Expression&&!this.get(ae,e).access_chain&&(this.forced_temporaries.has(e)||!this.forwarded_temporaries.has(e));return r&&!i?this.variable_decl_is_remapped_storage(r,v.Workgroup)?v.Workgroup:this.variable_decl_is_remapped_storage(r,v.StorageBuffer)||r.storage===v.Uniform&&this.has_decoration(this.get(R,r.basetype).self,te.BufferBlock)?v.StorageBuffer:r.storage:this.expression_type(e).storage},r.prototype.access_chain_needs_stage_io_builtin_translation=function(e){return!0},r.prototype.prepare_access_chain_for_scalar_access=function(e,t,r,i){return e},r.prototype.access_chain=function(e,t,r,i,a,s,o){if(void 0===s&&(s=null),void 0===o&&(o=!1),this.flattened_buffer_blocks.has(e)){var n={matrix_stride:0,array_stride:0,need_transpose:!1};return this.flattened_access_chain_offset(this.expression_type(e),t,r,i,0,16,n,o),s&&(s.need_transpose=a.columns>1&&n.need_transpose,s.storage_is_packed=!1),this.flattened_access_chain(e,t,r,i,a,0,n.matrix_stride,n.array_stride,n.need_transpose)}if(this.flattened_structs.hasOwnProperty(e)&&i>0){var _=wt.CHAIN_ONLY_BIT|wt.SKIP_REGISTER_EXPRESSION_READ_BIT;o&&(_|=wt.PTR_CHAIN_BIT),this.flattened_structs[e]&&(_|=wt.FLATTEN_ALL_MEMBERS_BIT,s&&(s.flattened_struct=a.basetype===E.Struct));var c=this.access_chain_internal(e,t,r,i,_,null).substring(1);s&&(s.need_transpose=!1,s.storage_is_packed=!1);var l=this.to_flattened_access_chain_expression(e)+"_"+c;return he.sanitize_underscores(l)}_=wt.SKIP_REGISTER_EXPRESSION_READ_BIT;return o&&(_|=wt.PTR_CHAIN_BIT),this.access_chain_internal(e,t,r,i,_,s)},r.prototype.flattened_access_chain=function(e,t,r,i,a,s,o,n,_){if(a.array.length>0)throw new Error("Access chains that result in an array can not be flattened");return a.basetype===E.Struct?this.flattened_access_chain_struct(e,t,r,i,a,s):a.columns>1?this.flattened_access_chain_matrix(e,t,r,i,a,s,o,_):this.flattened_access_chain_vector(e,t,r,i,a,s,o,_)},r.prototype.flattened_access_chain_struct=function(e,t,r,i,a,s){for(var o=this.type_to_glsl_constructor(a)+"(",n=0;n<a.member_types.length;++n){0!==n&&(o+=", ");var _=this.get(R,a.member_types[n]),c=this.type_struct_member_offset(a,n),l=!1,p=0;_.columns>1&&(l=this.combined_decoration_for_member(a,n).get(te.RowMajor),p=this.type_struct_member_matrix_stride(a,n));var u=this.flattened_access_chain(e,t,r,i,_,s+c,p,0,l);o+=l?this.convert_row_major_matrix(u,_,0,!1):u}return o+=")"},r.prototype.flattened_access_chain_matrix=function(e,t,r,i,a,s,o,n){console.assert(o);var _=f(R,a);if(n){var c=_.vecsize;_.vecsize=_.columns,_.columns=c}for(var l=this.type_to_glsl_constructor(_)+"(",p=0;p<_.columns;p++)0!==p&&(l+=", "),l+=this.flattened_access_chain_vector(e,t,r,i,_,s+p*o,o,!1);return l+=")"},r.prototype.flattened_access_chain_vector=function(e,t,r,i,a,s,o,n){var _=this.flattened_access_chain_offset(this.expression_type(e),t,r,i,s,16),c=this.to_name(this.expression_type(e).self);if(n){var l="";a.vecsize>1&&(l+=this.type_to_glsl_constructor(a),l+="(");for(var p=0;p<a.vecsize;++p){0!==p&&(l+=", ");var u=_.second+p*o;console.assert(u%(a.width/8)==0);var h=u/(a.width/8);l+=c,l+="[",l+=_.first,l+=le(h/4),l+="]",l+=this.vector_swizzle(1,h%4)}return a.vecsize>1&&(l+=")"),l}console.assert(_.second%(a.width/8)==0);h=_.second/(a.width/8),l="";return l+=c,l+="[",l+=_.first,l+=le(h/4),l+="]",l+=this.vector_swizzle(a.vecsize,h%4)},r.prototype.flattened_access_chain_offset=function(e,t,r,i,a,s,o,n){void 0===o&&(o=null),void 0===n&&(n=!1);for(var _=this.get_pointee_type(e),c="",l=(null==o?void 0:o.need_transpose)||!1,p=(null==o?void 0:o.matrix_stride)||0,u=(null==o?void 0:o.array_stride)||0,h=0;h<i;h++){var f=t[r+h];if(n&&0===h){if(!(u=this.get_decoration(e.self,te.ArrayStride)))throw new Error("SPIR-V does not define ArrayStride for buffer block.");if(g=this.maybe_get(O,f))a+=g.scalar()*u;else{if(u%s)throw new Error("Array stride for dynamic indexing must be divisible by the size of a 4-component vector. Likely culprit here is a float or vec2 array inside a push constant block which is std430. This cannot be flattened. Try using std140 layout instead.");c+=this.to_enclosed_expression(f)+" * "+le(u/s)+" + "}}else if(_.array.length>0){if(g=this.maybe_get(O,f))a+=g.scalar()*u;else{if(u%s)throw new Error("Array stride for dynamic indexing must be divisible by the size of a 4-component vector. Likely culprit here is a float or vec2 array inside a push constant block which is std430. This cannot be flattened. Try using std140 layout instead.");c+=this.to_enclosed_expression(f,!1)+" * "+le(u/s)+" + "}var d=_.parent_type;(_=this.get(R,d)).array.length>0&&(u=this.get_decoration(d,te.ArrayStride))}else if(_.basetype===E.Struct){if((f=this.evaluate_constant_u32(f))>=_.member_types.length)throw new Error("Member index is out of bounds!");a+=this.type_struct_member_offset(_,f);var m=_;(_=this.get(R,_.member_types[f])).columns>1?(p=this.type_struct_member_matrix_stride(m,f),l=this.combined_decoration_for_member(m,f).get(te.RowMajor)):l=!1,_.array.length>0&&(u=this.type_struct_member_array_stride(m,f))}else if(_.columns>1){if(g=this.maybe_get(O,f))a+=(f=this.evaluate_constant_u32(f))*(l?_.width/8:p);else{if((b=l?_.width/8:p)%s)throw new Error("Matrix stride for dynamic indexing must be divisible by the size of a 4-component vector. Likely culprit here is a row-major matrix being accessed dynamically. This cannot be flattened. Try using std140 layout instead.");c+=this.to_enclosed_expression(f,!1),c+=" * ",c+=le(b/s),c+=" + "}_=this.get(R,_.parent_type)}else{if(!(_.vecsize>1))throw new Error("Cannot subdivide a scalar value!");var g;if(g=this.maybe_get(O,f))a+=(f=this.evaluate_constant_u32(f))*(l?p:_.width/8);else{var b;if((b=l?p:_.width/8)%s)throw new Error("Stride for dynamic vector indexing must be divisible by the size of a 4-component vector. This cannot be flattened in legacy targets.");c+=this.to_enclosed_expression(f,!1)+" * "+le(b/s)+" + "}_=this.get(R,_.parent_type)}}return o&&(o.need_transpose=l,o.matrix_stride=p,o.array_stride=u),new xe(c,a)},r.prototype.index_to_swizzle=function(e){switch(e){case 0:default:return"x";case 1:return"y";case 2:return"z";case 3:return"w"}},r.prototype.remap_swizzle=function(e,t,r){if(e.vecsize===t)return r;if(1!==t||this.backend.can_swizzle_scalar){for(var i=this.enclose_expression(r)+".",a=0;a<e.vecsize;a++)i+=this.index_to_swizzle(Math.min(a,t-1));return this.backend.swizzle_is_function&&e.vecsize>1&&(i+="()"),i=this.remove_duplicate_swizzle(i)||i}return this.type_to_glsl(e)+"("+r+")"},r.prototype.declare_temporary=function(e,t){var r=this.get(R,e),i=et(x,this.ir.meta,t).decoration.decoration_flags;if(this.current_continue_block&&!this.hoisted_temporaries.has(t)){var a=this.get(J,this.current_continue_block.loop_dominator);return a.declare_temporary.find((function(r){return r.first===e&&r.second===t}))||(a.declare_temporary.push(new xe(e,t)),this.hoisted_temporaries.add(t),this.force_recompile()),this.to_name(t)+" = "}return this.hoisted_temporaries.has(t)?this.to_name(t)+" = ":(this.add_local_variable_name(t),this.flags_to_qualifiers_glsl(r,i)+this.variable_decl(r,this.to_name(t))+" = ")},r.prototype.emit_uninitialized_temporary=function(e,t){if(this.current_continue_block&&!this.hoisted_temporaries.has(t)){var r=this.get(J,this.current_continue_block.loop_dominator);r.declare_temporary.find((function(r){return r.first===e&&r.second===t}))||(r.declare_temporary.push(new xe(e,t)),this.hoisted_temporaries.add(t),this.force_recompile())}else if(!this.hoisted_temporaries.has(t)){var i=this.get(R,e),a=et(x,this.ir.meta,t).decoration.decoration_flags;this.add_local_variable_name(t);var s="";this.options.force_zero_initialized_variables&&this.type_can_zero_initialize(i)&&(s=" = "+this.to_zero_initialized_expression(e)),this.statement(this.flags_to_qualifiers_glsl(i,a),this.variable_decl(i,this.to_name(t)),s,";")}},r.prototype.emit_uninitialized_temporary_expression=function(e,t){return this.forced_temporaries.add(t),this.emit_uninitialized_temporary(e,t),this.set(ae,t,this.to_name(t),e,!0)},r.prototype.append_global_func_args=function(e,t,r){for(var i=e.arguments,a=i.length,s=t;s<a;s++){var o=i[s];console.assert(o.alias_global_variable);var n=this.get(T,o.id).basevariable;n&&this.flush_variable_declaration(n),r.push(this.to_func_call_arg(o,o.id))}},r.prototype.to_non_uniform_aware_expression=function(e){var t=this.to_expression(e);return this.has_decoration(e,te.NonUniform)&&(t=this.convert_non_uniform_expression(t,e)),t},r.prototype.to_expression=function(e,r){void 0===r&&(r=!0),this.invalid_expressions.hasOwnProperty(e)&&this.handle_invalid_expression(e);var i=this.ir;if(i.ids[e].get_type()===t.Expression)for(var a=0,s=this.get(ae,e).expression_dependencies;a<s.length;a++){var o=s[a];this.invalid_expressions.hasOwnProperty(o)&&this.handle_invalid_expression(o)}switch(r&&this.track_expression_read(e),i.ids[e].get_type()){case t.Expression:var n=this.get(ae,e);if(n.base_expression)return this.to_enclosed_expression(n.base_expression)+n.expression;if(n.need_transpose){var _=this.get_extended_decoration(e,b.PhysicalTypeID),c=this.has_extended_decoration(e,b.PhysicalTypePacked);return this.convert_row_major_matrix(n.expression,this.get(R,n.expression_type),_,c)}return this.flattened_structs.hasOwnProperty(e)?this.load_flattened_struct(n.expression,this.get(R,n.expression_type)):this.is_forcing_recompilation()?"_":n.expression;case t.Constant:var l=this.get(O,e),p=this.get(R,l.constant_type);if(this.has_decoration(l.self,te.BuiltIn))return this.builtin_to_glsl(this.get_decoration(l.self,te.BuiltIn),v.Generic);if(l.specialization){if(this.backend.workgroup_size_is_hidden){var u=this.get_constant_mapping_to_workgroup_component(l);if(u>=0){var h=this.builtin_to_glsl(m.WorkgroupSize,v.Input)+this.vector_swizzle(1,u);return p.basetype!==E.UInt&&(h=this.bitcast_expression(p,E.UInt,h)),h}}return this.to_name(e)}return l.is_used_as_lut?this.to_name(e):p.basetype!==E.Struct||this.backend.can_declare_struct_inline?p.array.length>0&&!this.backend.can_declare_arrays_inline?this.to_name(e):this.constant_expression(l):this.to_name(e);case t.ConstantOp:return this.to_name(e);case t.Variable:var f=this.get(T,e);if(f.statically_assigned||f.loop_variable&&!f.loop_variable_enable)return this.to_expression(f.static_expression);if(f.deferred_declaration)return f.deferred_declaration=!1,this.variable_decl(f);if(this.flattened_structs.hasOwnProperty(e))return this.load_flattened_struct(this.to_name(e),this.get(R,f.basetype));var d=et(x,i.meta,f.self).decoration;return d.builtin?this.builtin_to_glsl(d.builtin_type,f.storage):this.to_name(e);case t.CombinedImageSampler:throw new Error("Combined image samplers have no default expression representation.");case t.AccessChain:throw new Error("Access chains have no default expression representation.");default:return this.to_name(e)}},r.prototype.to_composite_constructor_expression=function(e,t){var r=this.expression_type(e),i=this.backend;return r.array.length>0&&(!i.array_is_value_type||t&&!i.buffer_offset_array_is_value_type)?this.to_rerolled_array_expression(this.to_enclosed_expression(e),r):this.to_unpacked_expression(e)},r.prototype.to_rerolled_array_expression=function(e,t){for(var r=this.to_array_size_literal(t),i=this.get(R,t.parent_type),a="{ ",s=0;s<r;s++){var o=e+"["+le(s)+"]";0===i.array.length?a+=o:a+=this.to_rerolled_array_expression(o,i),s+1<r&&(a+=", ")}return a+=" }"},r.prototype.to_enclosed_expression=function(e,t){return void 0===t&&(t=!0),this.enclose_expression(this.to_expression(e,t))},r.prototype.to_unpacked_expression=function(e,t){void 0===t&&(t=!0);var r=this.maybe_get(ae,e),i=!!r&&r.need_transpose,a=this.has_extended_decoration(e,b.PhysicalTypeID),s=this.has_extended_decoration(e,b.PhysicalTypePacked);return i||!a&&!s?this.to_expression(e,t):this.unpack_expression_type(this.to_expression(e,t),this.get_pointee_type(this.expression_type_id(e)),this.get_extended_decoration(e,b.PhysicalTypeID),this.has_extended_decoration(e,b.PhysicalTypePacked),!1)},r.prototype.to_unpacked_row_major_matrix_expression=function(e){return this.unpack_expression_type(this.to_expression(e),this.expression_type(e),this.get_extended_decoration(e,b.PhysicalTypeID),this.has_extended_decoration(e,b.PhysicalTypePacked),!0)},r.prototype.to_enclosed_unpacked_expression=function(e,t){return void 0===t&&(t=!0),this.enclose_expression(this.to_unpacked_expression(e,t))},r.prototype.to_dereferenced_expression=function(e,t){void 0===t&&(t=!0);var r=this.expression_type(e);return r.pointer&&this.should_dereference(e)?this.dereference_expression(r,this.to_enclosed_expression(e,t)):this.to_expression(e,t)},r.prototype.to_pointer_expression=function(e,t){return void 0===t&&(t=!0),this.expression_type(e).pointer&&this.expression_is_lvalue(e)&&!this.should_dereference(e)?this.address_of_expression(this.to_enclosed_expression(e,t)):this.to_unpacked_expression(e,t)},r.prototype.to_enclosed_pointer_expression=function(e,t){return void 0===t&&(t=!0),this.expression_type(e).pointer&&this.expression_is_lvalue(e)&&!this.should_dereference(e)?this.address_of_expression(this.to_enclosed_expression(e,t)):this.to_enclosed_unpacked_expression(e,t)},r.prototype.to_extract_component_expression=function(e,t){var r=this.to_enclosed_expression(e);return this.has_extended_decoration(e,b.PhysicalTypePacked)?r+"["+t+"]":r+"."+this.index_to_swizzle(t)},r.prototype.to_extract_constant_composite_expression=function(e,t,r,i,a){var s=new O;s.constant_type=e;var o=this.get(R,t.constant_type);return console.assert(o.basetype!==E.Struct&&0===o.array.length),console.assert(!t.specialization),this.is_matrix(o)?2===a?(s.m.c[0].vecsize=1,s.m.columns=1,s.m.c[0].r[0]=t.m.c[r[i]].r[r[i+1]]):(console.assert(1===a),s.m.c[0].vecsize=o.vecsize,s.m.columns=1,s.m.c[0]=t.m.c[r[i]]):(console.assert(1===a),s.m.c[0].vecsize=1,s.m.columns=1,s.m.c[0].r[0]=t.m.c[0].r[r[i]]),this.constant_expression(s)},r.prototype.enclose_expression=function(e){var t=!1,r=e.length;r>0&&("-"!==(s=e.charAt(0))&&"+"!==s&&"!"!==s&&"~"!==s&&"&"!==s&&"*"!==s||(t=!0));if(!t){for(var i=0,a=0;a<r;++a){var s;if("("===(s=e.charAt(a))||"["===s)i++;else if(")"===s||"]"===s)console.assert(i),i--;else if(" "===s&&0===i){t=!0;break}}console.assert(0===i)}return t?"("+e+")":e},r.prototype.dereference_expression=function(e,t){return"&"===t.charAt(0)?t.substring(1):this.backend.native_pointers?"*"+t:e.storage===v.PhysicalStorageBufferEXT&&e.basetype!==E.Struct&&1===e.pointer_depth?this.enclose_expression(t)+".value":t},r.prototype.address_of_expression=function(e){return e.length>3&&"("===e.charAt(0)&&"*"===e.charAt(1)&&")"===e.charAt(e.length-1)?this.enclose_expression(e.substring(2,e.length-1)):"*"===e.charAt(0)?e.substring(1):"&"+this.enclose_expression(e)},r.prototype.strip_enclosed_expression=function(e){var t=e.length,r=e.charAt(t-1);if(t<2||"("!==e.charAt(0)||")"!==r)return e;for(var i=0,a=0;a<t;++a){var s=e.charAt(a);if("("===s)i++;else if(")"===s&&0===--i&&s!==r)return e}return e.substring(1,t-1)},r.prototype.to_member_name=function(e,t){if(0!==e.type_alias&&!this.has_extended_decoration(e.type_alias,b.BufferBlockRepacked))return this.to_member_name(this.get(R,e.type_alias),t);var r=et(x,this.ir.meta,e.self).members;return t<r.length&&""!==r[t].alias?r[t].alias:"_m"+t},r.prototype.to_member_reference=function(e,t,r,i){return"."+this.to_member_name(t,r)},r.prototype.to_multi_member_reference=function(e,t){for(var r="",i=e,a=0;a<t.length;++a){var s=t[a];r+="."+this.to_member_name(i,s),i=this.get(R,i.member_types[s])}return r},r.prototype.type_to_glsl_constructor=function(e){var t=this.options,r=this.backend;if(r.use_array_constructor&&e.array.length>1)throw t.flatten_multidimensional_arrays?new Error("Cannot flatten constructors of multidimensional array constructors, e.g. float[][]()."):new Error("Arrays of arrays not supported before ESSL version 310.");var i=this.type_to_glsl(e);if(r.use_array_constructor)for(var a=0;a<e.array.length;a++)i+="[]";return i},r.prototype.argument_decl=function(e){var t=this.expression_type(e.id),r="";return t.pointer&&(e.write_count&&e.read_count?r="inout ":e.write_count&&(r="out ")),(""===r?"":r+" ")+this.to_qualifiers_glsl(e.id)+this.variable_decl(t,this.to_name(e.id),e.id)},r.prototype.to_qualifiers_glsl=function(e){var t=this.ir,r=this.backend,i=et(x,t.meta,e).decoration.decoration_flags,a="",s=this.maybe_get(T,e);s&&s.storage===v.Workgroup&&!r.shared_is_implied&&(a+="shared "),a+=this.to_interpolation_qualifiers(i),s&&(a+=this.to_storage_qualifiers_glsl(s));var o=this.expression_type(e);if(o.image.dim!==Ue.SubpassData&&2===o.image.sampled){i.get(te.Coherent)&&(a+="coherent "),i.get(te.Restrict)&&(a+="restrict "),i.get(te.NonWritable)&&(a+="readonly ");var n=o.image.format===ut.Unknown;if(i.get(te.NonReadable)&&(a+="writeonly ",n=!1),n)throw new Error("Cannot use GL_EXT_shader_image_load_formatted in ESSL.")}return a+=this.to_precision_qualifiers_glsl(e)},r.prototype.fixup_io_block_patch_qualifiers=function(e){var t=this.get(R,e.basetype);if(this.has_decoration(t.self,te.Block)){for(var r=t.member_types.length,i=0;i<r;i++)if(this.has_member_decoration(t.self,i,te.Patch)){this.set_decoration(e.self,te.Patch);break}if(this.has_decoration(e.self,te.Patch))for(i=0;i<r;i++)this.unset_member_decoration(t.self,i,te.Patch)}},r.prototype.emit_output_variable_initializer=function(e){var t=this,r=this.ir,i=this.get(j,r.default_entry_point),a=this.get(R,e.basetype),s=this.has_decoration(e.self,te.Patch),o=this.has_decoration(a.self,te.Block),n=this.get_execution_model()===ve.TessellationControl&&!s;if(o){var _=a.member_types.length,c=1===a.array.length,l=1;c&&(l=this.to_array_size_literal(a));for(var p=n?1:l,u=function(o){if(h.has_member_decoration(a.self,o,te.BuiltIn)){if(h.get_member_decoration(a.self,o,te.BuiltIn)===m.CullDistance&&!h.cull_distance_count)return"continue";if(h.get_member_decoration(a.self,o,te.BuiltIn)===m.ClipDistance&&!h.clip_distance_count)return"continue"}var _;if(c){_="_".concat(e.self,"_").concat(o,"_init");var u=h.get(R,e.basetype).member_types[o],f=h.get(R,u);f.parent_type=u,f.array.push(l),f.array_size_literal.push(!0);for(var d=[],g=h.get(O,e.initializer),b=0;b<l;b++)d.push(h.to_expression(h.get(O,g.subconstants[b]).subconstants[o]));h.statement("const ",h.type_to_glsl(f)," ",_,h.type_to_array_glsl(f)," = ",h.type_to_glsl_constructor(f),"(",d.join(", "),");")}var y=function(a){i.fixup_hooks_in.push((function(){var i=new Nt,l=t.get(O,e.initializer),p=0,u=0;if(n){var h=r.increase_bound_by(3),f=new R;f.basetype=E.UInt,f.width=32,t.set(R,h,f),t.set(ae,h+1,t.builtin_to_glsl(m.InvocationId,v.Input),h,!0),t.set(O,h+2,h,o,!1),p=h+1,u=h+2}if(s&&(t.statement("if (gl_InvocationID === 0)"),t.begin_scope()),c&&!n){var d=[a,o],g=t.access_chain_internal(e.self,d,0,2,wt.INDEX_IS_LITERAL_BIT,i);t.statement(g," = ",_,"[",a,"];")}else if(n){d=[p,u],g=t.access_chain_internal(e.self,d,0,2,0,i);t.statement(g," = ",_,"[",t.builtin_to_glsl(m.InvocationId,v.Input),"];")}else{g=t.access_chain_internal(e.self,[o],0,1,wt.INDEX_IS_LITERAL_BIT,i);t.statement(g," = ",t.to_expression(l.subconstants[o]),";")}s&&t.end_scope()}))};for(b=0;b<p;b++)y(b)},h=this,f=0;f<_;f++)u(f)}else if(n){var d="_".concat(e.self,"_init");this.statement("const ",this.type_to_glsl(a)," ",d,this.type_to_array_glsl(a)," = ",this.to_expression(e.initializer),";"),i.fixup_hooks_in.push((function(){t.statement(t.to_expression(e.self),"[gl_InvocationID] = ",d,"[gl_InvocationID];")}))}else if(this.has_decoration(e.self,te.BuiltIn)&&this.get_decoration(e.self,te.BuiltIn)===m.SampleMask)i.fixup_hooks_in.push((function(){for(var r=t.get(O,e.initializer),i=r.subconstants.length,a=0;a<i;a++)t.statement(t.to_expression(e.self),"[",a,"] = ",le(t.get(O,r.subconstants[a]).scalar_i32()),";")}));else{var g="".concat(e.self,"_init");this.statement("const ",this.type_to_glsl(a)," ",g,this.type_to_array_glsl(a)," = ",this.to_expression(e.initializer),";"),i.fixup_hooks_in.push((function(){s&&(t.statement("if (gl_InvocationID === 0)"),t.begin_scope()),t.statement(t.to_expression(e.self)," = ",g,";"),s&&t.end_scope()}))}},r.prototype.to_precision_qualifiers_glsl=function(e){var t=this.expression_type(e);if(this.backend.allow_precision_qualifiers&&(t.basetype===E.Image||t.basetype===E.SampledImage)&&this.get(R,t.image.type).width<32)return"mediump ";return this.flags_to_qualifiers_glsl(t,et(x,this.ir.meta,e).decoration.decoration_flags)},r.prototype.to_storage_qualifiers_glsl=function(e){var t=this.get_entry_point();if(this.subpass_input_is_framebuffer_fetch(e.self))return"";if(e.storage===v.Input||e.storage===v.Output){if(this.is_legacy()&&t.model===ve.Vertex)return e.storage===v.Input?"attribute ":"varying ";if(this.is_legacy()&&t.model===ve.Fragment)return"varying ";if(t.model===ve.Fragment&&e.storage===v.Output){var r=this.get_decoration(e.self,te.Location);return this.location_is_framebuffer_fetch(r)?"inout ":"out "}return e.storage===v.Input?"in ":"out "}if(e.storage===v.UniformConstant||e.storage===v.Uniform||e.storage===v.PushConstant)return"uniform ";if(e.storage===v.RayPayloadKHR)throw new Error("Raytracing not supported");if(e.storage===v.IncomingRayPayloadKHR)throw new Error("Raytracing not supported");if(e.storage===v.HitAttributeKHR)throw new Error("Raytracing not supported");if(e.storage===v.CallableDataKHR)throw new Error("Raytracing not supported");if(e.storage===v.IncomingCallableDataKHR)throw new Error("Raytracing not supported");return""},r.prototype.flags_to_qualifiers_glsl=function(e,t){if(t.get(te.RestrictPointerEXT))return"restrict ";var r=this.backend,i=this.options,a="";if(gt(e)&&t.get(te.NoContraction)&&r.support_precise_qualifier&&(a="precise "),!(e.basetype===E.Float||e.basetype===E.Int||e.basetype===E.UInt||e.basetype===E.Image||e.basetype===E.SampledImage||e.basetype===E.Sampler))return a;var s=this.get_entry_point();if(t.get(te.RelaxedPrecision)){var o=e.basetype===E.Float&&i.fragment.default_float_precision===It.Mediump&&s.model===ve.Fragment,n=(e.basetype===E.Int||e.basetype===E.UInt)&&i.fragment.default_int_precision===It.Mediump&&s.model===ve.Fragment;a+=o||n?"":"mediump "}else{var _=e.basetype===E.Float&&(i.fragment.default_float_precision===It.Highp&&s.model===ve.Fragment||s.model!==ve.Fragment),c=(e.basetype===E.Int||e.basetype===E.UInt)&&(i.fragment.default_int_precision===It.Highp&&s.model===ve.Fragment||s.model!==ve.Fragment);a+=_||c?"":"highp "}return a},r.prototype.format_to_glsl=function(e){if(this.is_desktop_only_format(e))throw new Error("Attempting to use image format not supported in ES profile.");switch(e){case ut.Rgba32f:return"rgba32f";case ut.Rgba16f:return"rgba16f";case ut.R32f:return"r32f";case ut.Rgba8:return"rgba8";case ut.Rgba8Snorm:return"rgba8_snorm";case ut.Rg32f:return"rg32f";case ut.Rg16f:return"rg16f";case ut.Rgba32i:return"rgba32i";case ut.Rgba16i:return"rgba16i";case ut.R32i:return"r32i";case ut.Rgba8i:return"rgba8i";case ut.Rg32i:return"rg32i";case ut.Rg16i:return"rg16i";case ut.Rgba32ui:return"rgba32ui";case ut.Rgba16ui:return"rgba16ui";case ut.R32ui:return"r32ui";case ut.Rgba8ui:return"rgba8ui";case ut.Rg32ui:return"rg32ui";case ut.Rg16ui:return"rg16ui";case ut.R11fG11fB10f:return"r11f_g11f_b10f";case ut.R16f:return"r16f";case ut.Rgb10A2:return"rgb10_a2";case ut.R8:return"r8";case ut.Rg8:return"rg8";case ut.R16:return"r16";case ut.Rg16:return"rg16";case ut.Rgba16:return"rgba16";case ut.R16Snorm:return"r16_snorm";case ut.Rg16Snorm:return"rg16_snorm";case ut.Rgba16Snorm:return"rgba16_snorm";case ut.R8Snorm:return"r8_snorm";case ut.Rg8Snorm:return"rg8_snorm";case ut.R8ui:return"r8ui";case ut.Rg8ui:return"rg8ui";case ut.R16ui:return"r16ui";case ut.Rgb10a2ui:return"rgb10_a2ui";case ut.R8i:return"r8i";case ut.Rg8i:return"rg8i";case ut.R16i:return"r16i";default:return null}},r.prototype.layout_for_member=function(e,t){if(this.is_legacy())return"";if(!(this.has_decoration(e.self,te.Block)||this.has_decoration(e.self,te.BufferBlock)))return"";var r=this.ir,i=et(x,r.meta,e.self).members;if(t>=i.length)return"";var a=i[t],s=[];if(this.has_member_decoration(e.self,t,te.PassthroughNV)&&s.push("passthrough"),this.combined_decoration_for_member(e,t).get(te.RowMajor)&&s.push("row_major"),a.decoration_flags.get(te.Location)&&this.can_use_io_location(e.storage,!0)&&s.push("location = "+a.location),a.decoration_flags.get(te.Component)&&this.can_use_io_location(e.storage,!0))throw new Error("Component decoration is not supported in ES targets.");if(this.has_extended_decoration(e.self,b.ExplicitOffset)&&a.decoration_flags.get(te.Offset)?s.push("offset = "+a.offset):e.storage===v.Output&&a.decoration_flags.get(te.Offset)&&s.push("xfb_offset = "+a.offset),0===s.length)return"";var o="layout(";return o+=s.join(", "),o+=") "},r.prototype.to_interpolation_qualifiers=function(e){var t="";if(e.get(te.Flat)&&(t+="flat "),e.get(te.NoPerspective)&&(t+="noperspective "),e.get(te.Centroid)&&(t+="centroid "),e.get(te.Patch)&&(t+="patch "),e.get(te.Sample)&&(t+="sample "),e.get(te.Invariant)&&(t+="invariant "),e.get(te.ExplicitInterpAMD)&&(this.require_extension_internal("GL_AMD_shader_explicit_vertex_parameter"),t+="__explicitInterpAMD "),e.get(te.PerVertexNV))throw new Error("pervertexNV requires ESSL 320.");return t},r.prototype.layout_for_variable=function(e){if(this.is_legacy())return"";if(this.subpass_input_is_framebuffer_fetch(e.self))return"";var t=this.options,r=this.ir,i=[],a=this.get(R,e.basetype),s=this.get_decoration_bitset(e.self),o=this.get_decoration_bitset(a.self);s.get(te.PassthroughNV)&&i.push("passthrough"),s.get(te.RowMajor)&&i.push("row_major"),s.get(te.ColMajor)&&i.push("column_major");var n=this.has_decoration(a.self,te.Block);if(s.get(te.Location)&&this.can_use_io_location(e.storage,n)){for(var _=new y,c=et(x,r.meta,a.self).members,l=0;l<c.length;l++)_.merge_or(this.combined_decoration_for_member(a,l));_.get(te.Location)||i.push("location = "+this.get_decoration(e.self,te.Location))}this.get_execution_model()===ve.Fragment&&e.storage===v.Output&&this.location_is_non_coherent_framebuffer_fetch(this.get_decoration(e.self,te.Location))&&i.push("noncoherent");var p=!1;if(n&&e.storage===v.Output){var u=a.member_types.length,h=!1,f=!1,d=!1,m=0,g=0,b=0;s.get(te.XfbBuffer)&&s.get(te.XfbStride)&&(h=!0,g=this.get_decoration(e.self,te.XfbBuffer),m=this.get_decoration(e.self,te.XfbStride)),s.get(te.Stream)&&(d=!0,b=this.get_decoration(e.self,te.Stream));for(l=0;l<u;l++){if(this.has_member_decoration(a.self,l,te.Stream)){var S=this.get_member_decoration(a.self,l,te.Stream);if(d&&S!==b)throw new Error("IO block member Stream mismatch.");d=!0,b=S}if(this.has_member_decoration(a.self,l,te.Offset)){if(f=!0,this.has_member_decoration(a.self,l,te.XfbBuffer)){var I=this.get_member_decoration(a.self,l,te.XfbBuffer);if(h&&I!==g)throw new Error("IO block member XfbBuffer mismatch.");h=!0,g=I}if(this.has_member_decoration(a.self,l,te.XfbStride)){var k=this.get_member_decoration(a.self,l,te.XfbStride);if(h&&k!==m)throw new Error("IO block member XfbStride mismatch.");h=!0,m=k}}}if(h&&f&&(i.push("xfb_buffer = "+g),i.push("xfb_stride = "+m),p=!0),d)throw new Error("Multiple geometry streams not supported in ESSL.")}else if(e.storage===v.Output&&(s.get(te.XfbBuffer)&&s.get(te.XfbStride)&&s.get(te.Offset)&&(i.push("xfb_buffer = "+this.get_decoration(e.self,te.XfbBuffer)),i.push("xfb_stride = "+this.get_decoration(e.self,te.XfbStride)),i.push("xfb_offset = "+this.get_decoration(e.self,te.Offset)),p=!0),s.get(te.Stream)))throw new Error("Multiple geometry streams not supported in ESSL.");if(s.get(te.Component)&&this.can_use_io_location(e.storage,n)&&(p=!0,i.push("component = "+this.get_decoration(e.self,te.Component))),p)throw new Error("GL_ARB_enhanced_layouts is not supported in ESSL.");s.get(te.Index)&&i.push("index = "+this.get_decoration(e.self,te.Index));var w,T=e.storage===v.StorageBuffer||e.storage===v.ShaderRecordBufferKHR||e.storage===v.Uniform&&o.get(te.BufferBlock),L=e.storage===v.PushConstant&&t.emit_push_constant_as_uniform_buffer,N=e.storage===v.Uniform&&o.get(te.Block),A=t.version>=300;if(N&&t.emit_uniform_buffer_as_plain_uniforms&&(A=!1),w=t.version>=310,A||e.storage!==v.Uniform||(w=!1),e.storage===v.ShaderRecordBufferKHR&&(w=!1),w&&s.get(te.Binding)&&i.push("binding = "+this.get_decoration(e.self,te.Binding)),e.storage!==v.Output&&s.get(te.Offset)&&i.push("offset = "+this.get_decoration(e.self,te.Offset)),A&&(N||L)?i.push(this.buffer_to_packing_standard(a,!1)):A&&T&&i.push(this.buffer_to_packing_standard(a,!0)),a.basetype===E.Image&&2===a.image.sampled){var C=this.format_to_glsl(a.image.format);C&&i.push(C)}return 0===i.length?"":"layout("+i.join(", ")+") "},r.prototype.to_combined_image_sampler=function(e,t){var r=this.to_non_uniform_aware_expression(e),i="",a=r.indexOf("[");a>=0&&(i=r.substring(a));var s=this.current_function.arguments,o=this.maybe_get_backing_variable(e),n=this.maybe_get_backing_variable(t);o&&(e=o.self),n&&(t=n.self);var _=s.find((function(t){return e===t.id})),c=s.find((function(e){return t===e.id}));if(_||c){var l=!_,p=!c,u=l?e:s.indexOf(_),h=p?t:s.indexOf(c);if(f=this.current_function.combined_parameters.find((function(e){return e.global_image===l&&e.global_sampler===p&&e.image_id===u&&e.sampler_id===h})))return this.to_expression(f.id)+i;throw new Error("Cannot find mapping for combined sampler parameter, was build_combined_image_samplers() used before compile() was called?")}var f=this.combined_image_samplers.find((function(r){return r.image_id===e&&r.sampler_id===t}));if(f)return this.to_expression(f.combined_id)+i;throw new Error("Cannot find mapping for combined sampler, was build_combined_image_samplers() used before compile() was called?")},r.prototype.skip_argument=function(e){var t=this.expression_type(e);return t.basetype===E.Sampler||t.basetype===E.Image&&1===t.image.sampled},r.prototype.emit_array_copy=function(e,t,r,i,a){this.statement(e," = ",this.to_expression(r),";")},r.prototype.emit_block_hints=function(e){},r.prototype.to_initializer_expression=function(e){return this.to_unpacked_expression(e.initializer)},r.prototype.to_zero_initialized_expression=function(e){var t=this.ir,r=t.increase_bound_by(1);return t.make_constant_null(r,e,!1),this.constant_expression(this.get(O,r))},r.prototype.type_can_zero_initialize=function(e){if(e.pointer)return!1;if(e.array.length>0&&this.options.flatten_multidimensional_arrays)return!1;for(var t=0,r=e.array_size_literal;t<r.length;t++){if(!r[t])return!1}for(var i=0,a=e.member_types;i<a.length;i++){var s=a[i];if(!this.type_can_zero_initialize(this.get(R,s)))return!1}return!0},r.prototype.buffer_is_packing_standard=function(e,t,r,i,a){void 0===r&&(r=null),void 0===i&&(i=0),void 0===a&&(a=void 0);for(var s=0,o=1,n=this.has_decoration(e.self,te.Block)||this.has_decoration(e.self,te.BufferBlock),_=this.ir,c=0;c<e.member_types.length;c++){var l=this.get(R,e.member_types[c]),p=et(x,_.meta,e.self).members[c].decoration_flags,u=this.type_to_packed_alignment(l,p,t),h=0;n&&c+1===e.member_types.length&&l.array.length>0||(h=this.type_to_packed_size(l,p,t));var f=this.type_struct_member_offset(e,c);if(void 0!==a&&f>=a)break;var d=Math.max(u,o);if(s=s+d-1&~(d-1),o=l.basetype!==E.Struct||l.pointer?1:u,f>=i){if(Kt(t)){if(0!=(f&d-1))return r&&(r[0]=c),!1}else if(f!==s)return r&&(r[0]=c),!1;if(l.array.length>0&&this.type_to_packed_array_stride(l,p,t)!=this.type_struct_member_array_stride(e,c))return r&&(r[0]=c),!1;var m=jt(t);if(!l.pointer&&l.member_types.length>0&&!this.buffer_is_packing_standard(l,m))return r&&(r[0]=c),!1}s=f+h}return!0},r.prototype.buffer_to_packing_standard=function(e,t){if(t&&this.buffer_is_packing_standard(e,Et.Std430))return"std430";if(this.buffer_is_packing_standard(e,Et.Std140))return"std140";throw new Error("Buffer block cannot be expressed as any of std430, std140, scalar, even with enhanced layouts. You can try flattening this block to support a more flexible layout.")},r.prototype.type_to_packed_base_size=function(e,t){switch(e.basetype){case E.Double:case E.Int64:case E.UInt64:return 8;case E.Float:case E.Int:case E.UInt:return 4;case E.Half:case E.Short:case E.UShort:return 2;case E.SByte:case E.UByte:return 1;default:throw new Error("Unrecognized type in type_to_packed_base_size.")}},r.prototype.type_to_packed_alignment=function(e,t,r){var i=this.ir;if(e.storage===v.PhysicalStorageBufferEXT){if(!e.pointer)throw new Error("Types in PhysicalStorageBufferEXT must be pointers.");if(i.addressing_model===$.PhysicalStorageBuffer64EXT)return Wt(r)&&this.type_is_array_of_pointers(e)?16:8;throw new Error("PhysicalStorageBuffer64EXT must be used for PhysicalStorageBufferEXT.")}if(e.array.length){var a=1;Wt(r)&&(a=16);for(var s=this.get(R,e.parent_type);s.array.length;)s=this.get(R,s.parent_type);return Math.max(a,this.type_to_packed_alignment(s,t,r))}if(e.basetype===E.Struct){for(var o=1,n=0;n<e.member_types.length;n++){var _=et(x,i.meta,e.self).members[n].decoration_flags;o=Math.max(o,this.type_to_packed_alignment(this.get(R,e.member_types[n]),_,r))}return Wt(r)&&(o=Math.max(o,16)),o}var c=this.type_to_packed_base_size(e,r);if(Qt(r))return c;if(1===e.vecsize&&1===e.columns)return c;if((2===e.vecsize||4===e.vecsize)&&1===e.columns)return e.vecsize*c;if(3===e.vecsize&&1===e.columns)return 4*c;if(t.get(te.ColMajor)&&e.columns>1)return Wt(r)||3===e.vecsize?4*c:e.vecsize*c;if(t.get(te.RowMajor)&&e.vecsize>1)return Wt(r)||3===e.columns?4*c:e.columns*c;throw new Error("Did not find suitable rule for type. Bogus decorations?")},r.prototype.type_to_packed_array_stride=function(e,t,r){var i=e.parent_type;console.assert(i);var a=this.get(R,i),s=this.type_to_packed_size(a,t,r),o=this.type_to_packed_alignment(e,t,r);return s+o-1&~(o-1)},r.prototype.type_to_packed_size=function(e,t,r){if(e.array.length)return this.to_array_size_literal(e)*this.type_to_packed_array_stride(e,t,r);var i=this.ir;if(e.storage===v.PhysicalStorageBufferEXT){if(!e.pointer)throw new Error("Types in PhysicalStorageBufferEXT must be pointers.");if(i.addressing_model===$.PhysicalStorageBuffer64EXT)return 8;throw new Error("PhysicalStorageBuffer64EXT must be used for PhysicalStorageBufferEXT.")}var a=0;if(e.basetype===E.Struct)for(var s=1,o=0;o<e.member_types.length;o++){var n=et(x,i.meta,e.self).members[o].decoration_flags,_=this.get(R,e.member_types[o]),c=this.type_to_packed_alignment(_,n,r),l=Math.max(c,s);s=_.basetype===E.Struct?c:1,a=a+l-1&~(l-1),a+=this.type_to_packed_size(_,n,r)}else{var p=this.type_to_packed_base_size(e,r);Qt(r)?a=e.vecsize*e.columns*p:(1===e.columns&&(a=e.vecsize*p),t.get(te.ColMajor)&&e.columns>1&&(a=Wt(r)||3===e.vecsize?4*e.columns*p:e.columns*e.vecsize*p),t.get(te.RowMajor)&&e.vecsize>1&&(a=Wt(r)||3===e.columns?4*e.vecsize*p:e.vecsize*e.columns*p))}return a},r.prototype.bitcast_glsl_op=function(e,t){if(e.pointer||t.pointer)return 2!==e.vecsize&&2!==t.vecsize||this.require_extension_internal("GL_EXT_buffer_reference_uvec2"),this.type_to_glsl(e);if(e.basetype===t.basetype)return"";console.assert(e.basetype!==E.Boolean),console.assert(t.basetype!==E.Boolean);var r=bt(e)&&bt(t),i=e.width===t.width;if(r&&i)return this.type_to_glsl(e);if(8===e.width&&t.width>=16&&r&&1===t.vecsize)return"unpack8";if(8===t.width&&16===e.width&&r&&1===e.vecsize)return"pack16";if(8===t.width&&32===e.width&&r&&1===e.vecsize)return"pack32";if(e.basetype===E.UInt&&t.basetype===E.Float){if(this.is_legacy_es())throw new Error("Float -> Uint bitcast not supported on legacy ESSL.");return"floatBitsToUint"}if(e.basetype===E.Int&&t.basetype===E.Float){if(this.is_legacy_es())throw new Error("Float -> Int bitcast not supported on legacy ESSL.");return"floatBitsToInt"}if(e.basetype===E.Float&&t.basetype===E.UInt){if(this.is_legacy_es())throw new Error("Uint -> Float bitcast not supported on legacy ESSL.");return"uintBitsToFloat"}if(e.basetype===E.Float&&t.basetype===E.Int){if(this.is_legacy_es())throw new Error("Int -> Float bitcast not supported on legacy ESSL.");return"intBitsToFloat"}return e.basetype===E.Int64&&t.basetype===E.Double?"doubleBitsToInt64":e.basetype===E.UInt64&&t.basetype===E.Double?"doubleBitsToUint64":e.basetype===E.Double&&t.basetype===E.Int64?"int64BitsToDouble":e.basetype===E.Double&&t.basetype===E.UInt64?"uint64BitsToDouble":e.basetype===E.Short&&t.basetype===E.Half?"float16BitsToInt16":e.basetype===E.UShort&&t.basetype===E.Half?"float16BitsToUint16":e.basetype===E.Half&&t.basetype===E.Short?"int16BitsToFloat16":e.basetype===E.Half&&t.basetype===E.UShort?"uint16BitsToFloat16":e.basetype===E.UInt64&&t.basetype===E.UInt&&2===t.vecsize?"packUint2x32":e.basetype===E.UInt&&t.basetype===E.UInt64&&2===e.vecsize?"unpackUint2x32":e.basetype===E.Half&&t.basetype===E.UInt&&1===t.vecsize?"unpackFloat2x16":e.basetype===E.UInt&&t.basetype===E.Half&&2===t.vecsize?"packFloat2x16":e.basetype===E.Int&&t.basetype===E.Short&&2===t.vecsize?"packInt2x16":e.basetype===E.Short&&t.basetype===E.Int&&1===t.vecsize?"unpackInt2x16":e.basetype===E.UInt&&t.basetype===E.UShort&&2===t.vecsize?"packUint2x16":e.basetype===E.UShort&&t.basetype===E.UInt&&1===t.vecsize?"unpackUint2x16":e.basetype===E.Int64&&t.basetype===E.Short&&4===t.vecsize?"packInt4x16":e.basetype===E.Short&&t.basetype===E.Int64&&1===t.vecsize?"unpackInt4x16":e.basetype===E.UInt64&&t.basetype===E.UShort&&4===t.vecsize?"packUint4x16":e.basetype===E.UShort&&t.basetype===E.UInt64&&1===t.vecsize?"unpackUint4x16":""},r.prototype.bitcast_glsl=function(e,t){var r=this.bitcast_glsl_op(e,this.expression_type(t));return""===r?this.to_enclosed_unpacked_expression(t):r+"("+this.to_unpacked_expression(t)+")"},r.prototype.bitcast_expression=function(e,t,r){if(void 0===r){if(e=e,r=this.to_expression(t),(a=this.expression_type(t)).basetype!==e){var i=a;i.basetype=e,r=this.bitcast_glsl_op(i,a)+"("+r+")"}return r}var a,s=t;return(e=e).basetype===s?r:((a=e).basetype=s,this.bitcast_glsl_op(e,a)+"("+r+")")},r.prototype.build_composite_combiner=function(e,t,r,i){for(var a=0,s="",o="",n=this.get(R,e),_=n.basetype!==E.Struct&&0===n.array.length&&1===n.columns,c=!1,l=this.backend,p=0;p<i;p++){var u=this.maybe_get(ae,t[p+r]);if(_&&u&&u.base_expression&&u.base_expression===a)console.assert(""!==u.expression&&"."===u.expression.charAt(0)),o+=u.expression.substring(1),c=!0;else{c?(l.swizzle_is_function&&(o+="()"),o=this.remove_duplicate_swizzle(o)||this.remove_unity_swizzle(a,o)||o,c=!1,s+=o=this.strip_enclosed_expression(o)):s+=o,p&&(s+=", ");var h=n.basetype===E.Struct&&this.has_member_decoration(n.self,p,te.Offset);o=this.to_composite_constructor_expression(t[p+r],h)}a=u?u.base_expression:0}return c&&(l.swizzle_is_function&&(o+="()"),o=this.remove_duplicate_swizzle(o)||this.remove_unity_swizzle(a,o)||o,o=this.strip_enclosed_expression(o)),s+=o},r.prototype.remove_duplicate_swizzle=function(e){var t=e.lastIndexOf(".");if(t<=0)return null;var r=e.substring(t+1);if(this.backend.swizzle_is_function){if(r.length<2)return null;if("()"!==r.substring(r.length-2))return null;r.substring(0,r.length-2)}for(var i=0;i<r.length;i++)if(i>=4||r[i]!==Ot[i])return null;var a=e.lastIndexOf(".",t-1);if(a<0)return e;for(i=++a;i<t;i++)if(e[i]<"w"||e[i]>"z"){if(this.backend.swizzle_is_function&&i+2===t&&"("===e[i]&&")"===e[i+1])break;return null}return t-a>=r.length&&(e=e.substring(0,a+r.length),this.backend.swizzle_is_function&&(e+="()")),e},r.prototype.remove_unity_swizzle=function(e,t){var r=t.indexOf(".");if(r<=0)return null;var i=t.substring(r+1);if(this.backend.swizzle_is_function){if(i.length<2)return null;if("()"!==i.substring(i.length-2))return null;i=i.substring(0,i.length-2)}for(var a=0;a<i.length;a++)if(a>=4||i[a]!==Ot[a])return null;var s=this.expression_type(e);return console.assert(1===s.columns&&0===s.array.length),s.vecsize===i.length&&(t=t.substring(0,r)),t},r.prototype.replace_illegal_names=function(e){var t=this;void 0===e&&(e=Vt);var r=this.ir;r.for_each_typed_id(T,(function(i,a){if(!t.is_hidden_variable(a)){var s=r.find_meta(a.self);if(s){var o=s.decoration;e.has(o.alias)&&(o.alias="_"+o.alias)}}})),r.for_each_typed_id(j,(function(t,i){var a=r.find_meta(i.self);if(a){var s=a.decoration;e.has(s.alias)&&(s.alias="_"+s.alias)}})),r.for_each_typed_id(R,(function(t,i){var a=r.find_meta(i.self);if(a){var s=a.decoration;e.has(s.alias)&&(s.alias="_"+s.alias);for(var o=0,n=a.members;o<n.length;o++){var _=n[o];e.has(_.alias)&&(_.alias="_"+_.alias)}}}))},r.prototype.emit_entry_point_declarations=function(){},r.prototype.replace_fragment_output=function(e){var t=this.ir,r=et(x,t.meta,e.self).decoration,i=0;r.decoration_flags.get(te.Location)&&(i=r.location);var a=this.get(R,e.basetype);if(0===a.array.length)r.alias="gl_FragData[".concat(i,"]"),this.is_legacy_es()&&0!==i&&this.require_extension_internal("GL_EXT_draw_buffers");else{if(1!==a.array.length)throw new Error("Array-of-array output variable used. This cannot be implemented in legacy GLSL.");if(r.alias="gl_FragData",0!==i)throw new Error("Arrayed output variable used, but location is not 0. This is unimplemented in SPIRV-Cross.");this.is_legacy_es()&&this.require_extension_internal("GL_EXT_draw_buffers")}e.compat_builtin=!0},r.prototype.replace_fragment_outputs=function(){var e=this;this.ir.for_each_typed_id(T,(function(t,r){var i=e.get(R,r.basetype);e.is_builtin_variable(r)||r.remapped_variable||!i.pointer||r.storage!==v.Output||e.replace_fragment_output(r)}))},r.prototype.legacy_tex_op=function(e,t,r){var i;switch(t.image.dim){case Ue.Dim1D:i="1D";break;case Ue.Dim2D:i="2D";break;case Ue.Dim3D:i="3D";break;case Ue.Cube:i="Cube";break;case Ue.Rect:i="2DRect";break;case Ue.Buffer:i="Buffer";break;case Ue.SubpassData:i="2D";break;default:i=""}var a=!1,s=this.get_entry_point();if("textureGrad"!==e&&"textureProjGrad"!==e&&("textureLod"!==e&&"textureProjLod"!==e||s.model===ve.Vertex)||this.is_legacy_es()&&(a=!0,this.require_extension_internal("GL_EXT_shader_texture_lod")),"textureLodOffset"===e||"textureProjLodOffset"===e){if(this.is_legacy_es())throw new Error(e+" not allowed in legacy ES");this.require_extension_internal("GL_EXT_gpu_shader4")}var o=this.is_depth_image(t,r);if(o&&this.is_legacy_es()){if("texture"!==e&&"textureProj"!==e)throw new Error(e+" not allowed on depth samplers in legacy ES");this.require_extension_internal("GL_EXT_shadow_samplers")}if("textureSize"===e){if(this.is_legacy_es())throw new Error("textureSize not supported in legacy ES");if(o)throw new Error("textureSize not supported on shadow sampler in legacy GLSL");this.require_extension_internal("GL_EXT_gpu_shader4")}if("texelFetch"===e&&this.is_legacy_es())throw new Error("texelFetch not supported in legacy ES");var n=this.is_legacy_es()&&o,_=o?"shadow":"texture";if("texture"===e)return n?_+i+"EXT":_+i;if("textureLod"===e)return _+i+a?"LodEXT":"Lod";if("textureProj"===e)return _+i+n?"ProjEXT":"Proj";if("textureGrad"===e)return _+i+this.is_legacy_es()?"GradEXT":"Grad";if("textureProjLod"===e)return _+i+a?"ProjLodEXT":"ProjLod";if("textureLodOffset"===e)return _+i+"LodOffset";if("textureProjGrad"===e)return _+i+this.is_legacy_es()?"ProjGradEXT":"ProjGrad";if("textureProjLodOffset"===e)return _+i+"ProjLodOffset";if("textureSize"===e)return"textureSize"+i;if("texelFetch"===e)return"texelFetch"+i;throw new Error("Unsupported legacy texture op: "+e)},r.prototype.load_flattened_struct=function(e,t){var r=this.type_to_glsl_constructor(t);r+="(";for(var i=0;i<t.member_types.length;i++){i&&(r+=", ");var a=this.get(R,t.member_types[i]);a.basetype===E.Struct?r+=this.load_flattened_struct(this.to_flattened_struct_member(e,t,i),a):r+=this.to_flattened_struct_member(e,t,i)}return r+=")"},r.prototype.to_flattened_struct_member=function(e,t,r){var i=e+"_"+this.to_member_name(t,r);return he.sanitize_underscores(i),i},r.prototype.store_flattened_struct=function(e,t,r,i){if("number"!=typeof e){var a=Array.from(i);a.push(0);for(var s=r,o=0;o<i.length;++o){var n=i[o];s=this.get(R,s.member_types[n])}for(o=0;o<s.member_types.length;o++){a[a.length-1]=o;var _=he.sanitize_underscores(e+"_"+this.to_member_name(s,o));if(this.get(R,s.member_types[o]).basetype===E.Struct)this.store_flattened_struct(_,t,r,a);else{var c=this.to_expression(t)+this.to_multi_member_reference(r,a);this.statement(_," = ",c,";")}}}else{var l=e,p=t,u=this.expression_type(l),h=this.to_flattened_access_chain_expression(l);this.store_flattened_struct(h,p,u,[])}},r.prototype.to_flattened_access_chain_expression=function(e){var t,r=this.maybe_get(T,e);if(r)t=this.to_name(r.self);else{var i=this.maybe_get(ae,e);t=i?i.expression:this.to_expression(e)}return t},r.prototype.track_expression_read=function(e){switch(this.ir.ids[e].get_type()){case t.Expression:for(var r=0,i=this.get(ae,e).implied_read_expressions;r<i.length;r++){var a=i[r];this.track_expression_read(a)}break;case t.AccessChain:for(var s=0,o=this.get(oe,e).implied_read_expressions;s<o.length;s++){a=o[s];this.track_expression_read(a)}}if(this.expression_is_forwarded(e)&&!this.expression_suppresses_usage_tracking(e)){var n=et(0,this.expression_usage_counts,e);n++,this.expression_read_implies_multiple_reads(e)&&n++,n>=2&&(this.forced_temporaries.add(e),this.force_recompile())}},r.prototype.request_workaround_wrapper_overload=function(e){this.workaround_ubo_load_overload_types.indexOf(e)<0&&(this.force_recompile(),this.workaround_ubo_load_overload_types.push(e))},r.prototype.rewrite_load_for_wrapped_row_major=function(e,t,r){var i=this.maybe_get_backing_variable(r);if(!i)return e;var a=this.get(R,i.basetype);if(!(a.basetype===E.Struct&&a.storage===v.Uniform&&this.has_decoration(a.self,te.Block)))return e;var s=this.get(R,t),o=!1;if(this.is_matrix(s)&&(s=a),s.basetype===E.Struct)for(var n=0;n<s.member_types.length;n++)if(this.combined_decoration_for_member(s,n).get(te.RowMajor)){o=!0;break}return o&&(this.request_workaround_wrapper_overload(t),e="spvWorkaroundRowMajor("+e+")"),e},r.prototype.is_legacy=function(){return this.options.version<300},r.prototype.is_legacy_es=function(){return this.options.version<300},r.prototype.register_impure_function_call=function(){for(var e=0,t=this.global_variables;e<t.length;e++){var r=t[e];this.flush_dependees(this.get(T,r))}for(var i=0,a=this.aliased_variables;i<a.length;i++){var s=a[i];this.flush_dependees(this.get(T,s))}},r.prototype.register_control_dependent_expression=function(e){this.forwarded_temporaries.has(e)&&(console.assert(this.current_emitting_block),this.current_emitting_block.invalidate_expressions.push(e))},r.prototype.args_will_forward=function(e,t,r,i,a){if(this.forced_temporaries.has(e))return!1;for(var s=0;s<i;s++)if(!this.should_forward(t[s+r]))return!1;if(!a){for(var o=0,n=this.global_variables;o<n.length;o++){var _=n[o];if(!this.should_forward(_))return!1}for(var c=0,l=this.aliased_variables;c<l.length;c++){var p=l[c];if(!this.should_forward(p))return!1}}return!0},r.prototype.register_call_out_argument=function(e){this.register_write(e);var t=this.maybe_get(T,e);t&&this.flush_variable_declaration(t.self)},r.prototype.pls_decl=function(e){var t=this.get(T,e.id),r=new R;return r.vecsize=Zt(e.format),r.basetype=function(e){switch(e){case Ve.RGBA8I:case Ve.RG16I:return E.Int;case Ve.RGB10A2UI:case Ve.RGBA8UI:case Ve.RG16UI:case Ve.R32UI:return E.UInt;default:return E.Float}}(e.format),function(e){switch(e){case Ve.R11FG11FB10F:return"layout(r11f_g11f_b10f) ";case Ve.R32F:return"layout(r32f) ";case Ve.RG16F:return"layout(rg16f) ";case Ve.RGB10A2:return"layout(rgb10_a2) ";case Ve.RGBA8:return"layout(rgba8) ";case Ve.RG16:return"layout(rg16) ";case Ve.RGBA8I:return"layout(rgba8i)";case Ve.RG16I:return"layout(rg16i) ";case Ve.RGB10A2UI:return"layout(rgb10_a2ui) ";case Ve.RGBA8UI:return"layout(rgba8ui) ";case Ve.RG16UI:return"layout(rg16ui) ";case Ve.R32UI:return"layout(r32ui) ";default:return""}}(e.format)+this.to_pls_qualifiers_glsl(t)+this.type_to_glsl(r)+" "+this.to_name(t.self)},r.prototype.to_pls_qualifiers_glsl=function(e){return et(x,this.ir.meta,e.self).decoration.decoration_flags.get(te.RelaxedPrecision)?"mediump ":"highp "},r.prototype.emit_pls=function(){var e=this.get_entry_point(),t=this.options;if(e.model!==ve.Fragment)throw new Error("Pixel local storage only supported in fragment shaders.");if(t.version<300)throw new Error("Pixel local storage only supported in ESSL 3.0 and above.");if(this.pls_inputs.length>0){this.statement("__pixel_local_inEXT _PLSIn"),this.begin_scope();for(var r=0,i=this.pls_inputs;r<i.length;r++){var a=i[r];this.statement(this.pls_decl(a),";")}this.end_scope_decl(),this.statement("")}if(this.pls_outputs.length>0){this.statement("__pixel_local_outEXT _PLSOut"),this.begin_scope();for(var s=0,o=this.pls_outputs;s<o.length;s++){var n=o[s];this.statement(this.pls_decl(n),";")}this.end_scope_decl(),this.statement("")}},r.prototype.remap_pls_variables=function(){for(var e=0,t=this.pls_inputs;e<t.length;e++){var r=t[e],i=!1;if((o=this.get(T,r.id)).storage===v.UniformConstant)i=this.get(R,o.basetype).image.dim===Ue.SubpassData;if(o.storage!==v.Input&&!i)throw new Error("Can only use in and target variables for PLS inputs.");o.remapped_variable=!0}for(var a=0,s=this.pls_outputs;a<s.length;a++){var o,n=s[a];if((o=this.get(T,n.id)).storage!==v.Output)throw new Error("Can only use out variables for PLS outputs.");o.remapped_variable=!0}},r.prototype.location_is_framebuffer_fetch=function(e){return!!this.inout_color_attachments.find((function(t){return t.first===e}))},r.prototype.location_is_non_coherent_framebuffer_fetch=function(e){return!!this.inout_color_attachments.find((function(t){return t.first===e&&!t.second}))},r.prototype.subpass_input_is_framebuffer_fetch=function(e){if(!this.has_decoration(e,te.InputAttachmentIndex))return!1;for(var t=this.get_decoration(e,te.InputAttachmentIndex),r=0,i=this.subpass_to_framebuffer_fetch_attachment;r<i.length;r++){if(i[r].first===t)return!0}return!1},r.prototype.emit_inout_fragment_outputs_copy_to_subpass_inputs=function(){for(var e=this,t=function(t){var i=r.find_subpass_input_by_attachment_index(t.first),a=r.find_color_output_by_location(t.second);if(!i)return"continue";if(!a)throw new Error("Need to declare the corresponding fragment output variable to be able to read from it.");if(r.is_array(r.get(R,a.basetype)))throw new Error("Cannot use GL_EXT_shader_framebuffer_fetch with arrays of color outputs.");r.get(j,r.get_entry_point().self).fixup_hooks_in.push((function(){if(e.is_legacy())e.statement(e.to_expression(i.self)," = ","gl_LastFragData[",e.get_decoration(a.self,te.Location),"];");else{var t=e.get(R,a.basetype).vecsize;e.statement(e.to_expression(i.self),e.vector_swizzle(t,0)," = ",e.to_expression(a.self),";")}}))},r=this,i=0,a=this.subpass_to_framebuffer_fetch_attachment;i<a.length;i++){t(a[i])}},r.prototype.find_subpass_input_by_attachment_index=function(e){var t=this,r=null;return this.ir.for_each_typed_id(T,(function(i,a){t.has_decoration(a.self,te.InputAttachmentIndex)&&t.get_decoration(a.self,te.InputAttachmentIndex)===e&&(r=a)})),r},r.prototype.find_color_output_by_location=function(e){var t=this,r=null;return this.ir.for_each_typed_id(T,(function(i,a){a.storage===v.Output&&t.get_decoration(a.self,te.Location)===e&&(r=a)})),r},r.prototype.add_variable=function(e,t,r){return""===r?r:(r=he.sanitize_underscores(r),he.is_globally_reserved_identifier(r,!0)?r="":this.update_name_cache(e,t,r))},r.prototype.check_function_call_constraints=function(e,t,r){for(var i=0;i<r;i++){var a=this.maybe_get(T,e[t+i]);if(a&&a.remapped_variable){var s=this.get(R,a.basetype);if(s.basetype===E.Image&&s.image.dim===Ue.SubpassData)throw new Error("Tried passing a remapped subpassInput variable to a function. This will not work correctly because type-remapping information is lost. To workaround, please consider not passing the subpass input as a function parameter, or use in/out variables instead which do not need type remapping information.")}}},r.prototype.handle_invalid_expression=function(e){this.forced_temporaries.add(e),this.force_recompile()},r.prototype.init=function(){var e=this.ir,t=this.options;e.source.known&&(t.version=e.source.version)},r.prototype.compile=function(){var e=this.ir,t=this.options,r=this.backend;e.fixup_reserved_names(),r.nonuniform_qualifier="",r.needs_row_major_load_workaround=!0,r.allow_precision_qualifiers=!0,r.force_gl_in_out_block=!0,r.supports_extensions=!0,r.use_array_constructor=!0,r.workgroup_size_is_hidden=!0,r.support_precise_qualifier=!1,this.is_legacy_es()&&(r.support_case_fallthrough=!1),this.fixup_type_alias(),this.reorder_type_alias(),this.build_function_control_flow_graphs_and_analyze(),this.find_static_extensions(),this.fixup_image_load_store_access(),this.update_active_builtins(),this.analyze_image_and_sampler_usage(),this.analyze_interlocked_resource_usage(),this.inout_color_attachments.length>0&&this.emit_inout_fragment_outputs_copy_to_subpass_inputs(),e.addressing_model===$.PhysicalStorageBuffer64EXT&&this.analyze_non_block_pointer_types();var i=0;do{if(i>=3)throw new Error("Over 3 compilation loops detected. Must be a bug!");this.reset(),this.buffer.reset(),this.emit_header(),this.emit_resources(),this.emit_extension_workarounds(this.get_execution_model()),this.emit_function(this.get(j,e.default_entry_point),new y),i++}while(this.is_forcing_recompilation());this.get_entry_point().name="main";var a=this.fixup_removed_structs(this.buffer.str());return this.get_execution_model()===ve.Vertex&&t.remove_attribute_layouts&&(a=this.remove_attribute_layouts(a)),a},r.prototype.fixup_removed_structs=function(e){var t=this;return this.removed_structs.forEach((function(r){var i=new RegExp(t.to_name(r)+"\\.","g");e=e.replace(i,"")})),e},r.prototype.remove_attribute_layouts=function(e){return e.replace(/layout\(location\s*=\s*\d+\)\s+in/g,"in")},r.prototype.find_static_extensions=function(){var e=this,t=this.ir,r=this.options;t.for_each_typed_id(R,(function(t,r){if(r.basetype===E.Double)throw new Error("FP64 not supported in ES profile.");if(r.basetype===E.Int64||r.basetype===E.UInt64)throw new Error("64-bit integers not supported in ES profile.");r.basetype===E.Half?e.require_extension_internal("GL_EXT_shader_explicit_arithmetic_types_float16"):r.basetype===E.SByte||r.basetype===E.UByte?e.require_extension_internal("GL_EXT_shader_explicit_arithmetic_types_int8"):r.basetype!==E.Short&&r.basetype!==E.UShort||e.require_extension_internal("GL_EXT_shader_explicit_arithmetic_types_int16")}));var i=this.get_entry_point();switch(i.model){case ve.GLCompute:throw new Error("Compute shaders are not supported!");case ve.Geometry:throw new Error("Geometry shaders are not supported!");case ve.TessellationEvaluation:case ve.TessellationControl:throw new Error("Tessellation shaders are not supported!");case ve.RayGenerationKHR:case ve.IntersectionKHR:case ve.AnyHitKHR:case ve.ClosestHitKHR:case ve.MissKHR:case ve.CallableKHR:}if(0!==this.pls_inputs.length||0!==this.pls_outputs.length){if(i.model!==ve.Fragment)throw new Error("Can only use GL_EXT_shader_pixel_local_storage in fragment shaders.");this.require_extension_internal("GL_EXT_shader_pixel_local_storage")}if(0!==this.inout_color_attachments.length){if(i.model!==ve.Fragment)throw new Error("Can only use GL_EXT_shader_framebuffer_fetch in fragment shaders.");for(var a=!1,s=!1,o=0,n=this.inout_color_attachments;o<n.length;o++){n[o].second?a=!0:s=!0}a&&this.require_extension_internal("GL_EXT_shader_framebuffer_fetch"),s&&this.require_extension_internal("GL_EXT_shader_framebuffer_fetch_non_coherent")}if(t.addressing_model===$.PhysicalStorageBuffer64EXT)throw new Error("GL_EXT_buffer_reference is only supported in Vulkan GLSL.");if(t.addressing_model!==$.Logical)throw new Error("Only Logical and PhysicalStorageBuffer64EXT addressing models are supported.");for(var _=0,c=t.declared_capabilities;_<c.length;_++){switch(c[_]){case we.ShaderNonUniformEXT:throw new Error("CapabilityShaderNonUniformEXT not supported");case we.RuntimeDescriptorArrayEXT:throw new Error("CapabilityRuntimeDescriptorArrayEXT not supported");case we.GeometryShaderPassthroughNV:throw new Error("GeometryShaderPassthroughNV capability not supported");case we.VariablePointers:case we.VariablePointersStorageBuffer:throw new Error("VariablePointers capability is not supported in GLSL.");case we.MultiView:throw new Error("MultiView capability is not supported in GLSL.");case we.RayQueryKHR:throw new Error("RayQuery capability is not supported.");case we.RayTraversalPrimitiveCullingKHR:throw new Error("RayTraversalPrimitiveCulling capability is not supported.")}}if(r.ovr_multiview_view_count)throw new Error("OVR_multiview2 is not supported")},r.prototype.emit_for_loop_initializers=function(e){if(0===e.loop_variables.length)return"";for(var r=this.ir,i=this.for_loop_initializers_are_same_type(e),a=0,s=0,o=e.loop_variables;s<o.length;s++){var n=o[s];0!==(_=this.get(T,n).static_expression)&&r.ids[_].get_type()!==t.Undef||a++}if(1===e.loop_variables.length&&0===a)return this.variable_decl(this.get(T,e.loop_variables[0]));if(i&&a!==e.loop_variables.length){for(var _="",c=0,l=e.loop_variables;c<l.length;c++){m=l[c];var p=this.get(T,m).static_expression;if(0===p||r.ids[p].get_type()===t.Undef)this.statement(this.variable_decl(this.get(T,m)),";");else{var u=this.get(T,m),h=this.get_variable_data_type(u);""===_?_=this.to_qualifiers_glsl(u.self)+this.type_to_glsl(h)+" ":(_+=", ",h.pointer&&(_+="* ")),_+=this.to_name(m)+" = "+this.to_pointer_expression(u.static_expression)}}return _}for(var f=0,d=e.loop_variables;f<d.length;f++){var m=d[f];this.statement(this.variable_decl(this.get(T,m)),";")}return""},r.prototype.emit_while_loop_initializers=function(e){for(var t=0,r=e.loop_variables;t<r.length;t++){var i=r[t],a=this.get(T,i);this.statement(this.variable_decl(a),";")}},r.prototype.for_loop_initializers_are_same_type=function(e){if(e.loop_variables.length<=1)return!0;for(var r=this.ir,i=0,a=new y,s=0,o=e.loop_variables;s<o.length;s++){var n=o[s],_=this.get(T,n).static_expression;if(0!==_&&r.ids[_].get_type()!==t.Undef){if(0===i)i=this.get(T,n).basetype,h(this.get_decoration_bitset(n),a);else if(i!==this.get(T,n).basetype)return!1;if(!a.equals(this.get_decoration_bitset(n)))return!1}}return!0},r.prototype.optimize_read_modify_write=function(e,t,r){if(r.length<t.length+3)return!1;if(e.vecsize>1&&e.columns>1)return!1;if(0!==r.indexOf(t))return!1;for(var i=-1,a=t.length+1;a<r.length;++a){var s=r.charAt(a);if("+"===s||"-"===s||"/"===s||"*"===s||"%"===s||"|"===s||"&"===s||"^"===s){i=a;break}}if(i!==t.length+1)return!1;if(" "!==r.charAt(i+1))return!1;var o=r.charAt(i),n=r.substring(t.length+3);return"+"!==o&&"-"!==o||"1"!==n&&"uint(1)"!==n&&"1u"!==n&&"int(1u)"!==n?this.statement(t," ",o,"= ",n,";"):this.statement(t,o,o,";"),!0},r.prototype.fixup_image_load_store_access=function(){var e=this;this.options.enable_storage_image_qualifier_deduction&&this.ir.for_each_typed_id(T,(function(t,r){var i=e.expression_type(t);if(i.basetype===E.Image&&2===i.image.sampled){var a=et(x,e.ir.meta,t).decoration.decoration_flags;a.get(te.NonWritable)||a.get(te.NonReadable)||(a.set(te.NonWritable),a.set(te.NonReadable))}}))},r.prototype.type_is_empty=function(e){return e.basetype===E.Struct&&0===e.member_types.length},r.prototype.declare_undefined_values=function(){var e=this,t=!1;this.ir.for_each_typed_id(ne,(function(r,i){var a=e.get(R,i.basetype);if(a.basetype!==E.Void){var s="";e.options.force_zero_initialized_variables&&e.type_can_zero_initialize(a)&&(s=" = "+e.to_zero_initialized_expression(i.basetype)),e.statement(e.variable_decl(a,e.to_name(i.self),i.self),s,";"),t=!0}})),t&&this.statement("")},r.prototype.can_use_io_location=function(e,t){var r=this.options;return!(this.get_execution_model()!==ve.Vertex&&e===v.Input||this.get_execution_model()!==ve.Fragment&&e===v.Output)&&(!((this.get_execution_model()===ve.Vertex&&e===v.Input||this.get_execution_model()===ve.Fragment&&e===v.Output)&&r.version<300)&&(e!==v.Uniform&&e!==v.UniformConstant&&e!==v.PushConstant))},r.prototype.convert_half_to_string=function(e,t,r){var i,a,s=e.scalar_f16(t,r);if(isNaN(s)||s===Number.POSITIVE_INFINITY||s===Number.NEGATIVE_INFINITY)if((a=new R).basetype=E.Half,a.vecsize=1,a.columns=1,s===Number.POSITIVE_INFINITY)i=this.type_to_glsl(a)+"(1.0 / 0.0)";else if(s===Number.NEGATIVE_INFINITY)i=this.type_to_glsl(a)+"(-1.0 / 0.0)";else{if(!isNaN(s))throw new Error("Cannot represent non-finite floating point constant.");i=this.type_to_glsl(a)+"(0.0 / 0.0)"}else(a=new R).basetype=E.Half,a.vecsize=1,a.columns=1,(i=le(s)).indexOf(".")<0&&(i+=".0"),i=this.type_to_glsl(a)+"("+i+")";return i},r.prototype.convert_float_to_string=function(e,t,r){var i,a=e.scalar_f32(t,r),s=this.backend;if(isNaN(a)||a===Number.POSITIVE_INFINITY||a===Number.NEGATIVE_INFINITY)if(this.is_legacy())if(a===Number.POSITIVE_INFINITY)i=s.float_literal_suffix?"(1.0f / 0.0f)":"(1.0 / 0.0)";else if(a===Number.NEGATIVE_INFINITY)i=s.float_literal_suffix?"(-1.0f / 0.0f)":"(-1.0 / 0.0)";else{if(!isNaN(a))throw new Error("Cannot represent non-finite floating point constant.");i=s.float_literal_suffix?"(0.0f / 0.0f)":"(0.0 / 0.0)"}else{var o=new R,n=new R;o.basetype=E.Float,n.basetype=E.UInt,o.vecsize=1,n.vecsize=1,o.width=32,n.width=32;var _="0x"+e.scalar(t,r)+"u",c="inf";a===Number.NEGATIVE_INFINITY?c="-inf":isNaN(a)&&(c="nan"),i=this.bitcast_glsl_op(o,n)+"(".concat(_," /* ").concat(c," */)")}else(i=le(a)).indexOf(".")<0&&(i+=".0"),s.float_literal_suffix&&(i+="f");return i},r.prototype.convert_double_to_string=function(e,t,r){var i,a=e.scalar_f64(t,r),s=this.backend;if(isNaN(a)||isNaN(a))throw new Error("64-bit integers/float not supported in ES profile.");return(i=le(a)).indexOf(".")<0&&(i+=".0"),s.double_literal_suffix&&(i+="lf"),i},r.prototype.convert_separate_image_to_expression=function(e){var t=this.maybe_get_backing_variable(e);if(t){var r=this.get(R,t.basetype);if(r.basetype===E.Image&&1===r.image.sampled&&r.image.dim!==Ue.Buffer){if(!this.dummy_sampler_id)throw new Error("Cannot find dummy sampler ID. Was build_dummy_sampler_for_combined_images() called?");return this.to_combined_image_sampler(e,this.dummy_sampler_id)}}return this.to_non_uniform_aware_expression(e)},r.prototype.cast_to_variable_store=function(e,t,r){var i=this.maybe_get_backing_variable(e);if(i&&(e=i.self),!this.has_decoration(e,te.BuiltIn))return t;var a=this.get_decoration(e,te.BuiltIn),s=r.basetype;switch(a){case m.Layer:case m.PrimitiveId:case m.ViewportIndex:case m.FragStencilRefEXT:case m.SampleMask:case m.PrimitiveShadingRateKHR:case m.ShadingRateKHR:s=E.Int}if(s!==r.basetype){var o=r;o.basetype=s,t=this.bitcast_expression(o,r.basetype,t)}return t},r.prototype.cast_from_variable_load=function(e,t,r){if(r.array.length>0)return t;var i=this.maybe_get_backing_variable(e);if(i&&(e=i.self),!this.has_decoration(e,te.BuiltIn))return t;var a=this.get_decoration(e,te.BuiltIn),s=r.basetype;switch(a){case m.Layer:case m.PrimitiveId:case m.ViewportIndex:case m.InstanceId:case m.InstanceIndex:case m.VertexId:case m.VertexIndex:case m.SampleId:case m.BaseVertex:case m.BaseInstance:case m.DrawIndex:case m.FragStencilRefEXT:case m.InstanceCustomIndexNV:case m.SampleMask:case m.PrimitiveShadingRateKHR:case m.ShadingRateKHR:s=E.Int;break;case m.GlobalInvocationId:case m.LocalInvocationId:case m.WorkgroupId:case m.LocalInvocationIndex:case m.WorkgroupSize:case m.NumWorkgroups:case m.IncomingRayFlagsNV:case m.LaunchIdNV:case m.LaunchSizeNV:s=E.UInt}return s!==r.basetype&&(t=this.bitcast_expression(r,s,t)),t},r.prototype.unroll_array_from_complex_load=function(e,t,r){if(!this.backend.force_gl_in_out_block)return r;var i=this.maybe_get(T,t);if(!i)return r;if(i.storage!==v.Input&&i.storage!==v.Output)return r;var a=this.get_variable_data_type(i);if(0===a.array.length)return r;var s=this.get_decoration(i.self,te.BuiltIn),o=this.is_builtin_variable(i)&&(s===m.PointSize||s===m.Position||s===m.SampleMask),n=this.has_decoration(i.self,te.Patch),_=o&&s===m.SampleMask;if(!n&&o){var c="_"+e+"_unrolled";this.statement(this.variable_decl(a,c,e),";");var l=void 0;if(a.array_size_literal[a.array_size_literal.length-1]){var p=a.array[a.array.length-1];if(l=le(p),0===p)throw new Error("Cannot unroll an array copy from unsized array.")}else l=this.to_expression(a.array[a.array.length-1]);if(this.statement("for (int i = 0; i < int(",l,"); i++)"),this.begin_scope(),o&&!_)this.statement(c,"[i] = gl_in[i].",r,";");else if(_){var u=new R;u.basetype=E.Int,this.statement(c,"[i] = ",this.bitcast_expression(u,a.basetype,r+"[i]"),";")}else this.statement(c,"[i] = ",r,"[i];");this.end_scope(),r=c}return r},r.prototype.unroll_array_to_complex_store=function(e,t){if(!this.backend.force_gl_in_out_block)return!1;var r=this.maybe_get(T,e);if(!r||r.storage!==v.Output)return!1;if(!this.is_builtin_variable(r)||this.get_decoration(r.self,te.BuiltIn)!==m.SampleMask)return!1;var i,a=this.expression_type(t);if(a.array_size_literal[a.array_size_literal.length-1]){var s=a.array[a.array.length-1];if(i=le(s),0===s)throw new Error("Cannot unroll an array copy from unsized array.")}else i=this.to_expression(a.array[a.array.length-1]);var o=new R;return o.basetype=E.Int,this.statement("for (int i = 0; i < int(",i,"); i++)"),this.begin_scope(),this.statement(this.to_expression(e),"[i] = ",this.bitcast_expression(o,a.basetype,this.to_expression(t)+"[i]"),";"),this.end_scope(),!0},r.prototype.convert_non_uniform_expression=function(e,t){if("\0"===this.backend.nonuniform_qualifier)return e;var r=this.maybe_get_backing_variable(t);if(!r)return e;if(r.storage!==v.UniformConstant&&r.storage!==v.StorageBuffer&&r.storage!==v.Uniform)return e;if(0===this.get(R,r.basetype).array.length)return e;var i=e.indexOf("[");if(i<0)return e;for(var a=-1,s=1,o=i+1;o<e.length;o++)if("]"===e.charAt(o)){if(0==--s){a=o;break}}else"["===e[o]&&s++;return console.assert(0===s),i>=0||a>=0||a<i?e:(i++,e.substring(0,i)+this.backend.nonuniform_qualifier+"("+e.substring(i,a)+")"+e.substring(a))},r.prototype.disallow_forwarding_in_expression_chain=function(e){if(this.expression_is_forwarded(e.self)&&!this.expression_suppresses_usage_tracking(e.self)&&!this.forced_invariant_temporaries.has(e.self)){this.forced_temporaries.add(e.self),this.forced_invariant_temporaries.add(e.self),this.force_recompile();for(var t=0,r=e.expression_dependencies;t<r.length;t++){var i=r[t];this.disallow_forwarding_in_expression_chain(this.get(ae,i))}}},r.prototype.handle_store_to_invariant_variable=function(e,t){if(this.has_decoration(e,te.Invariant)){var r=this.maybe_get(ae,t);r&&this.disallow_forwarding_in_expression_chain(r)}},r.prototype.expression_is_constant_null=function(e){var t=this.maybe_get(O,e);return!!t&&t.constant_is_null()},r.prototype.expression_is_non_value_type_array=function(e){if(0===this.expression_type(e).array.length)return!1;if(!this.backend.array_is_value_type)return!0;var t=this.maybe_get_backing_variable(e);if(!t)return!1;var r=this.get(R,t.basetype);return!this.backend.buffer_offset_array_is_value_type&&r.basetype===E.Struct&&this.has_member_decoration(r.self,0,te.Offset)},r.prototype.emit_store_statement=function(e,t){var r=this.to_pointer_expression(t);if(""!==r){if(this.handle_store_to_invariant_variable(e,t),!this.unroll_array_to_complex_store(e,t)){var i=this.to_dereferenced_expression(e);this.has_decoration(e,te.NonUniform)&&(i=this.convert_non_uniform_expression(i,e)),r=this.cast_to_variable_store(e,r,this.expression_type(t)),this.optimize_read_modify_write(this.expression_type(t),i,r)||this.statement(i," = ",r,";")}this.register_write(e)}},r.prototype.get_integer_width_for_instruction=function(e){if(e.length<3)return 32;var t=this.stream(e);switch(e.op){case re.SConvert:case re.ConvertSToF:case re.UConvert:case re.ConvertUToF:case re.IEqual:case re.INotEqual:case re.SLessThan:case re.SLessThanEqual:case re.SGreaterThan:case re.SGreaterThanEqual:case re.ULessThan:case re.ULessThanEqual:case re.UGreaterThan:case re.UGreaterThanEqual:return this.expression_type(t[2]).width;default:var r=this.maybe_get(R,t[0]);return r&&bt(r)?r.width:32}},r.prototype.get_integer_width_for_glsl_instruction=function(e,t,r,i){if(i<1)return 32;switch(e){case Oe.SAbs:case Oe.SSign:case Oe.UMin:case Oe.SMin:case Oe.UMax:case Oe.SMax:case Oe.UClamp:case Oe.SClamp:case Oe.FindSMsb:case Oe.FindUMsb:return this.expression_type(t[r]).width;default:return 32}},r.prototype.variable_is_lut=function(e){if(e.statically_assigned&&0!==e.static_expression&&e.remapped_variable){var t=this.maybe_get(O,e.static_expression);if(t&&t.is_used_as_lut)return!0}return!1},r.prototype.fixup_type_alias=function(){var e=this,t=this.ir;t.for_each_typed_id(R,(function(r,i){i.type_alias&&(e.has_decoration(i.self,te.Block)||e.has_decoration(i.self,te.BufferBlock)?i.type_alias=0:e.type_is_block_like(i)&&i.self===r&&(t.for_each_typed_id(R,(function(e,t){e!==r&&t.type_alias===i.type_alias&&(t.type_alias=r)})),e.get(R,i.type_alias).type_alias=r,i.type_alias=0))}))},r.prototype.reorder_type_alias=function(){for(var e=this.ir,r=e.create_loop_hard_lock(),i=e.ids_for_type[t.Type],a=0;a<i.length;++a){var s=this.get(R,i[a]);if(0!==s.type_alias&&!this.has_extended_decoration(s.type_alias,b.BufferBlockRepacked)){var o=i.indexOf(s.type_alias);if(console.assert(o>=0),a<o){var n=e.ids_for_constant_or_type,_=n.indexOf(i[a]),c=n.indexOf(i[o]);console.assert(_>=0),console.assert(c>=0),Ht(i,a,o),Ht(n,_,c)}}}r.dispose()},r.prototype.vector_swizzle=function(e,t){return console.assert(e>=1&&e<=4),console.assert(t>=0&&t<4),console.assert(Gt[e-1][t]),Gt[e-1][t]},r}(ft);function Kt(e){switch(e){case Et.Std140:case Et.Std430:case Et.PackingScalar:return!1;default:return!0}}function jt(e){switch(e){case Et.Std140EnhancedLayout:return Et.Std140;case Et.Std430EnhancedLayout:return Et.Std430;case Et.PackingScalarEnhancedLayout:return Et.PackingScalar;default:return e}}function Wt(e){switch(e){case Et.Std140:case Et.Std140EnhancedLayout:return!0;default:return!1}}function Qt(e){switch(e){case Et.PackingScalar:case Et.PackingScalarEnhancedLayout:return!0;default:return!1}}function Zt(e){switch(e){default:case Ve.R32F:case Ve.R32UI:return 1;case Ve.RG16F:case Ve.RG16:case Ve.RG16UI:case Ve.RG16I:return 2;case Ve.R11FG11FB10F:return 3;case Ve.RGB10A2:case Ve.RGBA8:case Ve.RGBA8I:case Ve.RGB10A2UI:case Ve.RGBA8UI:return 4}}function Yt(e,t,r,i){for(var a=0,s=t;a<s.length;a++){var o=s[a];if(e.has_decoration(o.id,te.Location))if(e.get_decoration(o.id,te.Location)===r){var n=e.get_type(o.base_type_id);if(n.basetype===E.Struct){e.set_name(o.base_type_id,"SPIRV_Cross_Interface_Location"+r);for(var _=0;_<n.member_types.length;_++)e.set_member_name(o.base_type_id,_,"InterfaceMember"+_)}e.set_name(o.id,i)}}}var Jt,$t=function(e,t){this.id=e,this.format=t};function er(e,t,r){var i=new Me(t);i.parse();var a=new Xt(i.get_parsed_ir());if(a.unnamed_ubo_info=r,0!==e.variable_type_remaps.length){a.set_variable_type_remap_callback((function(t,r){for(var i=0,a=e.variable_type_remaps;i<a.length;i++){var s=a[i];if(r===s.variable_name)return s.new_variable_type}return r}))}for(var s=0,o=e.masked_stage_outputs;s<o.length;s++){var n=o[s];a.mask_stage_output_by_location(n.first,n.second)}for(var _=0,c=e.masked_stage_builtins;_<c.length;_++){n=c[_];a.mask_stage_output_by_builtin(n)}for(var l=0,p=e.entry_point_rename;l<p.length;l++){var u=p[l];a.rename_entry_point(u.old_name,u.new_name,u.execution_model)}var h=a.get_entry_points_and_stages(),f=e.entry,d=ve.Max;if(e.entry_stage&&e.entry_stage.length>0)if(d=function(e){if("vert"===e)return ve.Vertex;if("frag"===e)return ve.Fragment;throw new Error("Invalid stage!")}(e.entry_stage),f&&""!==f){for(var m=!1,g=0,b=h;g<b.length;g++){if((w=b[g]).execution_model===d&&w.name===f){m=!0;break}}if(!m)throw new Error("Could not find an entry point %s with stage: ".concat(e.entry_stage))}else{for(var y=0,S=h;y<S.length;y++){if((w=S[y]).execution_model===d){f=w.name;break}}if(!f)throw new Error("Could not find an entry point with stage: ".concat(e.entry_stage))}else if(f&&""!==f){for(var I=0,x=0,k=h;x<k.length;x++){var w;(w=k[x]).name===f&&(I++,d=w.execution_model)}if(0===I)throw new Error("There is no entry point with name: ".concat(f));if(I>1)throw new Error("There is more than one entry point with name: ".concat(f,". Use --stage."))}if(f&&""!==f&&a.set_entry_point(f,d),!e.set_version&&!a.get_common_options().version)throw new Error("Didn't specify GLSL version and SPIR-V did not specify language.");var E,T=a.get_common_options();e.set_version&&(T.version=e.version),T.force_temporary=e.force_temporary,T.separate_shader_objects=e.sso,T.flatten_multidimensional_arrays=e.flatten_multidimensional_arrays,T.enable_420pack_extension=e.use_420pack_extension,T.vertex.fixup_clipspace=e.fixup,T.vertex.flip_vert_y=e.yflip,T.vertex.support_nonzero_base_instance=e.support_nonzero_baseinstance,T.emit_push_constant_as_uniform_buffer=e.glsl_emit_push_constant_as_ubo,T.emit_uniform_buffer_as_plain_uniforms=e.glsl_emit_ubo_as_plain_uniforms,T.force_flattened_io_blocks=e.glsl_force_flattened_io_blocks,T.keep_unnamed_ubos=e.glsl_keep_unnamed_ubos,T.remove_attribute_layouts=e.glsl_remove_attribute_layouts,T.specialization_constant_prefix=e.specialization_constant_prefix,T.ovr_multiview_view_count=e.glsl_ovr_multiview_view_count,T.emit_line_directives=e.emit_line_directives,T.enable_storage_image_qualifier_deduction=e.enable_storage_image_qualifier_deduction,T.force_zero_initialized_variables=e.force_zero_initialized_variables;for(var L=0,R=e.glsl_ext_framebuffer_fetch;L<R.length;L++){var N=R[L];a.remap_ext_framebuffer_fetch(N.first,N.second,!e.glsl_ext_framebuffer_fetch_noncoherent)}if(e.remove_unused){var A=a.get_active_interface_variables();E=a.get_shader_resources(A),a.set_enabled_interface_variables(A)}else E=a.get_shader_resources();if(e.flatten_ubo){for(var C=0,P=E.uniform_buffers;C<P.length;C++){var M=P[C];a.flatten_buffer_block(M.id)}for(var D=0,B=E.push_constant_buffers;D<B.length;D++){M=B[D];a.flatten_buffer_block(M.id)}}var z=rr(e.pls_in,E.stage_inputs,E.subpass_inputs),U=rr(e.pls_out,E.stage_outputs,null);a.remap_pixel_local_storage(z,U);for(var G=0,F=e.extensions;G<F.length;G++){var O=F[G];a.require_extension(O)}for(var V=0,H=e.remaps;V<H.length;V++){var q=H[V];tr(a,E.stage_inputs,q)||(tr(a,E.stage_outputs,q)||tr(a,E.subpass_inputs,q))}for(var X=0,K=e.interface_variable_renames;X<K.length;X++){if((u=K[X]).storageClass===v.Input)Yt(a,E.stage_inputs,u.location,u.variable_name);else{if(u.storageClass!==v.Output)throw new Error("error at --rename-interface-variable <in|out> ...");Yt(a,E.stage_outputs,u.location,u.variable_name)}}a.build_combined_image_samplers(),e.combined_samplers_inherit_bindings&&function(e){for(var t=0,r=e.get_combined_image_samplers();t<r.length;t++){var i=r[t];if(e.has_decoration(i.image_id,te.DescriptorSet)){var a=e.get_decoration(i.image_id,te.DescriptorSet);e.set_decoration(i.combined_id,te.DescriptorSet,a)}if(e.has_decoration(i.image_id,te.Binding)){var s=e.get_decoration(i.image_id,te.Binding);e.set_decoration(i.combined_id,te.Binding,s)}}}(a);for(var j=0,W=a.get_combined_image_samplers();j<W.length;j++){q=W[j];a.set_name(q.combined_id,"SPIRV_Cross_Combined"+a.get_name(q.image_id)+a.get_name(q.sampler_id))}return a.compile()}function tr(e,t,r){var i=t.find((function(e){return e.name===r.src_name}));return!!i&&(e.set_remapped_variable_state(i.id,!0),e.set_name(i.id,r.dst_name),e.set_subpass_input_remapped_components(i.id,r.components),!0)}function rr(e,t,r){for(var i=[],a=0,s=e;a<s.length;a++){for(var o=s[a],n=!1,_=0,c=t;_<c.length;_++){if((u=c[_]).name===o.name){i.push(new $t(u.id,o.format)),n=!0;break}}if(!n&&r)for(var l=0,p=r;l<p.length;l++){var u;if((u=p[l]).name===o.name){i.push(new $t(u.id,o.format)),n=!0;break}}if(!n)throw new Error("Did not find stage input/output/target with name ".concat(o.name))}return i}function ir(e,t){return null==e?t:e}return e.Version=void 0,(Jt=e.Version||(e.Version={}))[Jt.WebGL1=100]="WebGL1",Jt[Jt.WebGL2=300]="WebGL2",e.compile=function(e,t,i){var a=new r;(i=i||{}).unnamedUBOInfo=ir(i.unnamedUBOInfo,{}),a.version=t,a.set_version=!0,a.remove_unused=ir(i.removeUnused,!0),a.glsl_keep_unnamed_ubos=ir(i.keepUnnamedUBOs,!0),a.glsl_remove_attribute_layouts=ir(i.removeAttributeLayouts,!1),a.specialization_constant_prefix=ir(i.specializationConstantPrefix,"SPIRV_CROSS_CONSTANT_ID_"),a.flatten_multidimensional_arrays=!0;var s=new Uint32Array(e);if(a.reflect&&""!==a.reflect)throw new Error("Reflection not yet supported!");return er(a,s,i.unnamedUBOInfo)},Object.defineProperty(e,"__esModule",{value:!0}),e}({});
